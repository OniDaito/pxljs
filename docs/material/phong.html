<!DOCTYPE html>

<html>
<head>
  <title>phong.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>phong.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
{RGB,RGBA} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../colour/colour"</span>
{Material} = <span class="hljs-built_in">require</span> <span class="hljs-string">"./material"</span>
{Texture} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../gl/texture"</span>
{uber_phong_diff_tex, uber_phong_spec_tex, uber_phong_emis_tex, uber_vertex_colour, uber_phong_mat} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../gl/uber_shader_paths'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>TODO - transparent alpha blending materials</p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>We donâ€™t reference textures. Rather, textures are sampled and are set to the variable baseColour
which can either be a texture or a basic passed in colour. This variable is common throughout all
shaders.</p>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>TODO - eventually most of this will be in a textfile that we process into javascript at build time</p>

            </div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="phongmaterial">PhongMaterial</h2>
<p>A basic material that contains phong elements
Requires an existing lighting solution, complete with ambient light
We choose the lights using #ifdef statements that we set thus we can set the different lights</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PhongMaterial</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Material</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>
<ul>
<li><strong>ambient</strong> - a Colour.RGB - Default RGB(0,0,0)</li>
<li><strong>diffuse</strong> - a Colour.RGB or a Texture</li>
<li><strong>specular</strong> - a Colour.RGB or a Texture - Default RGB(1,1,1)</li>
<li><strong>shine</strong> - a Number - Default 20</li>
<li><strong>emissive</strong> -  a Colour.RGB or a Texture - default RGB(0,0,0) </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@ambient, @diffuse, @specular, @shine, @emissive)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()

    @_uber_defines = [<span class="hljs-string">'MAT_PHONG'</span>, <span class="hljs-string">'VERTEX_NORMAL'</span>, <span class="hljs-string">'ADVANCED_CAMERA'</span>]

    @_preDrawCalls = []
    
    @ambient = <span class="hljs-keyword">new</span> RGB(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @ambient?
  
    @specular = <span class="hljs-keyword">new</span> RGB(<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @specular?
    @shine = <span class="hljs-number">20.0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @shine?
    @emissive = <span class="hljs-keyword">new</span> RGB(<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>) <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @emissive?

    @contract.roles.uMaterialAmbientColour  = <span class="hljs-string">"ambient"</span>
    @contract.roles.uMaterialShininess = <span class="hljs-string">"shine"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Construct the shader chunks depending on what we are passed in.
TODO Texture Cube support for phong materials</p>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Essentially, given the parameters, we are creating subtly different
materials. This way is elegant for the end user but perhaps not so
elegant in terms of library. Phong is really a class of materials
but at the same time, I dont want to create another factory class just
to create textures. Ultimately, all we really care about is whether the 
generated shader will be different.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    usingTexture = <span class="hljs-literal">false</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>If not diffuse assume vertex colours
TODO - Finish off vertex diffuse colours</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @diffuse?
      @_uber_defines += [<span class="hljs-string">'VERTEX_COLOUR'</span>]
      @_uber0 = uber_vertex_colour <span class="hljs-literal">true</span>, @_uber0
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">if</span> @diffuse <span class="hljs-keyword">instanceof</span> RGB <span class="hljs-keyword">or</span> @diffuse <span class="hljs-keyword">instanceof</span> RGBA</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>TODO - Eventually put in materials that are transparent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        @diffuse = <span class="hljs-keyword">new</span> RGB( @diffuse.r, @diffuse.g, @diffuse.b)
        @contract.roles.uMaterialDiffuseColour  = <span class="hljs-string">"diffuse"</span>
        @_uber0 = uber_phong_diff_tex <span class="hljs-literal">false</span>, @_uber0
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @diffuse <span class="hljs-keyword">instanceof</span> Texture
        @diffuse.contract.roles.uSamplerDiffuse = <span class="hljs-string">"unit"</span>
        @_preDrawCalls.push () =&gt;
          @diffuse.bind()
        usingTexture = <span class="hljs-literal">true</span>
        @_uber0 = uber_phong_diff_tex <span class="hljs-literal">true</span>, @_uber0</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>TODO - Also texture cube  would be good here as well</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">if</span> @specular <span class="hljs-keyword">instanceof</span> RGB
      @contract.roles.uMaterialSpecularColour = <span class="hljs-string">"specular"</span>
      @_uber0 = uber_phong_spec_tex <span class="hljs-literal">false</span>, @_uber0
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @specular <span class="hljs-keyword">instanceof</span> Texture
      @specular.contract.roles.uSamplerSpecular = <span class="hljs-string">"unit"</span>
      @_preDrawCalls.push () =&gt;
          @specular.bind()

      usingTexture = <span class="hljs-literal">true</span>
      @_uber0 = uber_phong_spec_tex <span class="hljs-literal">true</span>, @_uber0

    <span class="hljs-keyword">if</span> @emissive <span class="hljs-keyword">instanceof</span> RGB
      @contract.roles.uMaterialEmissiveColour = <span class="hljs-string">"emissive"</span>
      @_uber0 = uber_phong_emis_tex <span class="hljs-literal">false</span>, @_uber0
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @emissive <span class="hljs-keyword">instanceof</span> Texture
      @emissive.contract.roles.uSamplerEmissive = <span class="hljs-string">"unit"</span>
      @_preDrawCalls.push () =&gt;
        @emissive.bind()

      usingTexture = <span class="hljs-literal">true</span>
      @_uber0 = uber_phong_spec_tex <span class="hljs-literal">true</span>, @_uber0

    <span class="hljs-keyword">if</span> usingTexture
      @_uber_defines.push <span class="hljs-string">'VERTEX_TEXTURE'</span>

    @_uber0 = uber_phong_mat <span class="hljs-literal">true</span>, @_uber0</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Override to bind textures if there are any</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _preDraw : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">for</span> func <span class="hljs-keyword">in</span> @_preDrawCalls
      func()

<span class="hljs-built_in">module</span>.exports =
  PhongMaterial : PhongMaterial</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
