<!DOCTYPE html><html lang="en"><head><title>geometry/shape</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="geometry/shape"><meta name="groc-project-path" content="src/geometry/shape.coffee"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/geometry/shape.coffee</div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><pre><code>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __/__/\_ \____/
|__|        \/     js

                PXL.js
                Benjamin Blundell - ben@pxljs.com
                http://pxljs.com

This software is released under the MIT Licence. See LICENCE.txt for details</code></pre></div></div><div class="code"><div class="wrapper">{Node} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../core/node'</span>
{RGB,RGBA} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../colour/colour'</span>
{Vec2, Vec3, PI, degToRad} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../math/math'</span>
{Vertex, Triangle, Quad, Geometry} = <span class="hljs-built_in">require</span> <span class="hljs-string">'./primitive'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="cuboid">Cuboid</h2>
<p>A basic Cuboid with indices</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cuboid</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Geometry</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>TODO - Add resolution here?
TODO - Add tangents here too?</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>constructor</strong></p>
<ul>
<li><strong>dim</strong> - a Vec3 - Default Vec3(1,1,1)</li>
<li><strong>colour</strong> - a Colour</li>
</ul></div></div><div class="code"><div class="wrapper">  
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(dim, colour)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()

    <span class="hljs-property">@indexed</span> = <span class="hljs-literal">true</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> dim?
      dim = <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>

    w = dim.x / <span class="hljs-number">2</span>
    h = dim.y / <span class="hljs-number">2</span>
    d = dim.z / <span class="hljs-number">2</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>front</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 -w,-h,d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,d  
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 w,-h,d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 w,h,d 
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,d  
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 -w,h,d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>back</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,-d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 -w,-h,-d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,-d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 w,-h,-d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,-d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 w,h,-d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,-d
      n : Vec3.normalize <span class="hljs-keyword">new</span> Vec3 -w,h,-d
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span> 

    <span class="hljs-keyword">if</span> colour?
      <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-property">@vertices</span>
        v.c = colour

    <span class="hljs-property">@indices</span> = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">0</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">7</span>,<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">6</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>]

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.<span class="hljs-property">@indices</span>.length-<span class="hljs-number">1</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>
      <span class="hljs-property">@faces</span>.push <span class="hljs-keyword">new</span> Triangle(<span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">1</span>]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">2</span>]])</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="cuboiddup">CuboidDup</h2>
<p>A basic Cuboid with no with no interpolated normals. Each corner has duplicated faces for normals</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CuboidDup</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Geometry</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>TODO - Add resolution here?
TODO - Add tangents here too?</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>constructor</strong></p>
<ul>
<li><strong>dim</strong> - a Vec3 - Default Vec3(1,1,1)</li>
<li><strong>colour</strong> - a Colour</li>
</ul></div></div><div class="code"><div class="wrapper">  
  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(dim, colour)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()

    <span class="hljs-property">@indexed</span> = <span class="hljs-literal">true</span>
    <span class="hljs-property">@layout</span> = GL.TRIANGLES <span class="hljs-keyword">if</span> GL?
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> dim?
      dim = <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>

    w = dim.x / <span class="hljs-number">2</span>
    h = dim.y / <span class="hljs-number">2</span>
    d = dim.z / <span class="hljs-number">2</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>front</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>back</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,-d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,-d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>left</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,-d
      n : <span class="hljs-keyword">new</span> Vec3 -<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,d  
      n : <span class="hljs-keyword">new</span> Vec3 -<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,d
      n : <span class="hljs-keyword">new</span> Vec3 -<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 -<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>right</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,-d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>top</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,-d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,h,d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>  </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>bottom</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,-d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 -w,-h,d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">0</span> 
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,d
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span>
    
    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3 w,-h,-d  
      n : <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>
      t : <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">0</span>,<span class="hljs-number">1</span>  

    <span class="hljs-keyword">if</span> colour?
      <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-property">@vertices</span>
        v.c = colour


    <span class="hljs-property">@indices</span> = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">7</span>,<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">8</span>,<span class="hljs-number">10</span>,<span class="hljs-number">11</span>,<span class="hljs-number">14</span>,<span class="hljs-number">13</span>,<span class="hljs-number">12</span>,<span class="hljs-number">15</span>,<span class="hljs-number">14</span>,<span class="hljs-number">12</span>,<span class="hljs-number">16</span>,<span class="hljs-number">17</span>,<span class="hljs-number">18</span>,<span class="hljs-number">16</span>,<span class="hljs-number">18</span>,<span class="hljs-number">19</span>,<span class="hljs-number">22</span>,<span class="hljs-number">21</span>,<span class="hljs-number">20</span>,<span class="hljs-number">23</span>,<span class="hljs-number">22</span>,<span class="hljs-number">20</span> ]

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.<span class="hljs-property">@indices</span>.length-<span class="hljs-number">1</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>
      <span class="hljs-property">@faces</span>.push <span class="hljs-keyword">new</span> Triangle(<span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">1</span>]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">2</span>]])</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="sphere">Sphere</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><a href="http://local.wasp.uwa.edu.au/~pbourke/texture_colour/spheremap/">http://local.wasp.uwa.edu.au/~pbourke/texture_colour/spheremap/</a>  Paul Bourke&#39;s sphere code
We should weigh an alternative that reduces the batch count by using GL_TRIANGLES instead
TODO - Add Tangents?
TODO - not convinced this generation is correct</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Sphere</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Geometry</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>@constructor</strong></p>
<ul>
<li><strong>radius</strong> - a Number - Default 1.0</li>
<li><strong>segments</strong> - a Number - Default 10</li>
<li><strong>colour</strong> - a Colour</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(radius, segments, colour)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()
    gl = PXL.Context.gl <span class="hljs-comment"># Global / Current context</span>
    <span class="hljs-property">@layout</span> = gl.TRIANGLE_STRIP

    <span class="hljs-keyword">if</span> radius?
      <span class="hljs-keyword">if</span> radius &lt; <span class="hljs-number">0</span>
        radius = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">else</span>
      radius - <span class="hljs-number">1.0</span>

    <span class="hljs-keyword">if</span> segments?
      <span class="hljs-keyword">if</span> segments &lt; <span class="hljs-number">0</span>
        segments = <span class="hljs-number">10</span>
    <span class="hljs-keyword">else</span>
      segments = <span class="hljs-number">10</span>

    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.segments/<span class="hljs-number">2</span>]
      theta1 = j * <span class="hljs-number">2</span> * PI / segments - (PI / <span class="hljs-number">2</span>)
      theta2 = (j + <span class="hljs-number">1</span>) * <span class="hljs-number">2</span> * PI / segments - (PI / <span class="hljs-number">2</span>)

      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.segments+<span class="hljs-number">1</span>]
        e0 = <span class="hljs-keyword">new</span> Vec3()
   
        theta3 = i * <span class="hljs-number">2</span> * PI / segments
 
        e0.x = Math.cos(theta1) * Math.cos(theta3)
        e0.y = Math.sin(theta1)
        e0.z = Math.cos(theta1) * Math.sin(theta3)

        p0 = Vec3.multScalar(e0,radius)
        c0 = <span class="hljs-keyword">new</span> RGBA(<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">1.0</span>)
        t0 = <span class="hljs-keyword">new</span> Vec2( <span class="hljs-number">0.999</span> - i / segments, <span class="hljs-number">0.999</span> - <span class="hljs-number">2</span> * j / segments)
        v = <span class="hljs-keyword">new</span> Vertex 
          p : p0
          t : t0
          n : e0   

        <span class="hljs-property">@vertices</span>.push v

        e1 = <span class="hljs-keyword">new</span> Vec3()

        e1.x = Math.cos(theta2) * Math.cos(theta3)
        e1.y = Math.sin(theta2)
        e1.z = Math.cos(theta2) * Math.sin(theta3)

        p1 = Vec3.multScalar(e1,radius)

        t1 = <span class="hljs-keyword">new</span> Vec2( <span class="hljs-number">0.999</span> - i / segments, <span class="hljs-number">0.999</span> - <span class="hljs-number">2</span> * (j+<span class="hljs-number">1</span>) / segments)
        v = <span class="hljs-keyword">new</span> Vertex
          p : p1
          n : e1
          t : t1
     
        <span class="hljs-property">@vertices</span>.push v

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">2.</span>.<span class="hljs-property">@vertices</span>.length-<span class="hljs-number">1</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>
        <span class="hljs-property">@faces</span>.push <span class="hljs-keyword">new</span> Triangle(<span class="hljs-property">@vertices</span>[i], <span class="hljs-property">@vertices</span>[i-<span class="hljs-number">1</span>], <span class="hljs-property">@vertices</span>[i-<span class="hljs-number">2</span>])
      <span class="hljs-keyword">else</span>
        <span class="hljs-property">@faces</span>.push <span class="hljs-keyword">new</span> Triangle(<span class="hljs-property">@vertices</span>[i], <span class="hljs-property">@vertices</span>[i-<span class="hljs-number">2</span>], <span class="hljs-property">@vertices</span>[i-<span class="hljs-number">1</span>])
    
    <span class="hljs-keyword">if</span> colour?
      <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-property">@vertices</span>
        v.c = colour</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><h2 id="cylinder">Cylinder</h2>
<p>A basic cylinder</p></div></div><div class="code"><div class="wrapper"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Cylinder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Geometry</span></span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>@constructor</strong> </p>
<ul>
<li><strong>radius</strong> - a Number - Default 0.5</li>
<li><strong>resolution</strong> - a Number - Default 10</li>
<li><strong>height</strong> - a Number - Default 1.0</li>
<li><strong>colour</strong> - a Colour</li>
</ul></div></div><div class="code"><div class="wrapper">  <span class="hljs-attribute">constructor</span>: <span class="hljs-function"><span class="hljs-params">(radius, resolution, segments, height, colour)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()
    <span class="hljs-property">@indices</span> = []

    <span class="hljs-property">@indexed</span> = <span class="hljs-literal">true</span>
 </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>TODO - This could be neater</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> radius? 
      <span class="hljs-keyword">if</span> radius &lt; <span class="hljs-number">0</span>
        radius = <span class="hljs-number">0.5</span>
    <span class="hljs-keyword">else</span>
      radius = <span class="hljs-number">0.5</span>

    <span class="hljs-keyword">if</span> resolution?
      <span class="hljs-keyword">if</span> resolution &lt; <span class="hljs-number">0</span>
        resolution = <span class="hljs-number">10.0</span>
    <span class="hljs-keyword">else</span>
      resolution = <span class="hljs-number">10.0</span>

    <span class="hljs-keyword">if</span> segments?
      <span class="hljs-keyword">if</span> segments &lt; <span class="hljs-number">0</span>
        segments = <span class="hljs-number">10</span>
    <span class="hljs-keyword">else</span>
      segments = <span class="hljs-number">10</span>

    <span class="hljs-keyword">if</span> height?
      <span class="hljs-keyword">if</span> height &lt; <span class="hljs-number">0</span>
        height = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">else</span>
      height = <span class="hljs-number">1.0</span>

    hstep = height / segments
    height = height / <span class="hljs-number">2.0</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>top</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,height,<span class="hljs-number">0</span>)
      n : <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>)
      t : <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">0.5</span>,<span class="hljs-number">0.0</span>)
      a : <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>) <span class="hljs-comment"># cx this - hairy coconut</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.resolution]

      x = radius * Math.sin degToRad(<span class="hljs-number">360.0</span> / resolution * i)
      z = radius * Math.cos degToRad(<span class="hljs-number">360.0</span> / resolution * i)
      
      tangent = <span class="hljs-keyword">new</span> Vec3(x,<span class="hljs-number">0</span>,z)
      tangent.normalize()
      tangent.cross <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)

      <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
        p : <span class="hljs-keyword">new</span> Vec3(x,height,z)
        n : Vec3.normalize(<span class="hljs-keyword">new</span> Vec3(x,<span class="hljs-number">1.0</span>,z)) 
        t : <span class="hljs-keyword">new</span> Vec2(i/resolution, <span class="hljs-number">0.0</span>) 
        a : tangent
    </div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>top cap</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.resolution]
      <span class="hljs-property">@indices</span>.push <span class="hljs-number">0</span>
      <span class="hljs-property">@indices</span>.push i
      <span class="hljs-keyword">if</span> i == resolution
        <span class="hljs-property">@indices</span>.push <span class="hljs-number">1</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-property">@indices</span>.push (i+<span class="hljs-number">1</span>)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.segments]</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>next end</p></div></div><div class="code"><div class="wrapper">      <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> [<span class="hljs-number">1.</span>.resolution]

        x = radius * Math.sin degToRad(<span class="hljs-number">360.0</span> / resolution * j)
        z = radius * Math.cos degToRad(<span class="hljs-number">360.0</span> / resolution * j)

        tangent = <span class="hljs-keyword">new</span> Vec3(x,<span class="hljs-number">0</span>,z)
        tangent.normalize()
        tangent.cross <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>)

        n0 = Vec3.normalize(<span class="hljs-keyword">new</span> Vec3(x,<span class="hljs-number">0</span>,z))
        <span class="hljs-keyword">if</span> i == segments
          n0 = Vec3.normalize(<span class="hljs-keyword">new</span> Vec3(x,-<span class="hljs-number">1</span>,z))
        
        <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
          p : <span class="hljs-keyword">new</span> Vec3(x, height - (hstep * i) ,z) 
          n : n0
          t : <span class="hljs-keyword">new</span> Vec2(j/resolution, i/segments ) 
          a : tangent

      <span class="hljs-comment">#sides1</span>
      s = (i - <span class="hljs-number">1</span>) * resolution + <span class="hljs-number">1</span>
      e = s + resolution
  
      <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.resolution-<span class="hljs-number">1</span>]
        <span class="hljs-property">@indices</span>.push (s + j)
        <span class="hljs-property">@indices</span>.push (e + j)
        <span class="hljs-keyword">if</span> j == (resolution-<span class="hljs-number">1</span>)
          <span class="hljs-property">@indices</span>.push (e)
        <span class="hljs-keyword">else</span>
          <span class="hljs-property">@indices</span>.push (e + j + <span class="hljs-number">1</span>)
      
      <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.resolution-<span class="hljs-number">1</span>]
        <span class="hljs-property">@indices</span>.push (s+j)
        <span class="hljs-keyword">if</span> j == (resolution-<span class="hljs-number">1</span>)
          <span class="hljs-property">@indices</span>.push (e)
          <span class="hljs-property">@indices</span>.push (s)
        <span class="hljs-keyword">else</span>
          <span class="hljs-property">@indices</span>.push (e+j+<span class="hljs-number">1</span>)
          <span class="hljs-property">@indices</span>.push (s+j+<span class="hljs-number">1</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Very last point for bottom cap</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-property">@vertices</span>.push <span class="hljs-keyword">new</span> Vertex 
      p : <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,-height,<span class="hljs-number">0</span>)
      n : <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,-<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>)
      t : <span class="hljs-keyword">new</span> Vec2(<span class="hljs-number">0.5</span>,<span class="hljs-number">1.0</span>)
      a : <span class="hljs-keyword">new</span> Vec3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>bottom cap</p></div></div><div class="code"><div class="wrapper">    s = (segments * resolution) + <span class="hljs-number">2</span>
    e = s + resolution - <span class="hljs-number">1</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [s..e]
      <span class="hljs-property">@indices</span>.push (s - <span class="hljs-number">1</span>)
      <span class="hljs-keyword">if</span> i == e
        <span class="hljs-property">@indices</span>.push s
      <span class="hljs-keyword">else</span>
        <span class="hljs-property">@indices</span>.push (i+<span class="hljs-number">1</span>)

      <span class="hljs-property">@indices</span>.push i

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.<span class="hljs-property">@indices</span>.length-<span class="hljs-number">1</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">3</span>
      <span class="hljs-property">@faces</span>.push <span class="hljs-keyword">new</span> Triangle <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">1</span>]], <span class="hljs-property">@vertices</span>[<span class="hljs-property">@indices</span>[i+<span class="hljs-number">2</span>]]</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Add colour - convert to RGBA here as that is what we expect in the shader
Potentially this is bad but attributes are what they are and this is cheaper</p></div></div><div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> colour?
      <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> colour.a?
        colour = <span class="hljs-keyword">new</span> RGBA(colour.r,colour.g,colour.b,<span class="hljs-number">1.0</span>)
      <span class="hljs-keyword">for</span> v <span class="hljs-keyword">in</span> <span class="hljs-property">@vertices</span>
        v.c = colour

    @


<span class="hljs-built_in">module</span>.exports = 
  <span class="hljs-attribute">Cuboid</span>: Cuboid
  <span class="hljs-attribute">Sphere</span>: Sphere
  <span class="hljs-attribute">CuboidDup</span>: CuboidDup
  Cylinder : Cylinder
  
 </div></div></div></div></body></html>