<!DOCTYPE html>

<html>
<head>
  <title>util.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>util.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details
 
 JavaScript Language Utility Methods</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

util = {}

util.extend = <span class="hljs-function"><span class="hljs-params">(obj, source)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>ECMAScript5 compatibility based on: <a href="http://www.nczonline.net/blog/2012/12/11/are-your-mixins-ecmascript-5-compatible/">http://www.nczonline.net/blog/2012/12/11/are-your-mixins-ecmascript-5-compatible/</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> Object.keys
    keys = Object.keys(source)
    i = <span class="hljs-number">0</span>
    il = keys.length

    <span class="hljs-keyword">while</span> i &lt; il
      prop = keys[i]
      Object.defineProperty obj, prop, Object.getOwnPropertyDescriptor(source, prop)
      i++
  <span class="hljs-keyword">else</span>
    safeHasOwnProperty = {}.hasOwnProperty
    <span class="hljs-keyword">for</span> prop <span class="hljs-keyword">of</span> source
      obj[prop] = source[prop]  <span class="hljs-keyword">if</span> safeHasOwnProperty.call(source, prop)
  obj</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>removes the element from the given list (if it exists) and returns the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>util.removeElement = <span class="hljs-function"><span class="hljs-params">(element, list)</span> -&gt;</span>
  index = list.indexOf element
  list.splice index, <span class="hljs-number">1</span> <span class="hljs-keyword">unless</span> index <span class="hljs-keyword">is</span> <span class="hljs-number">-1</span>
  list

util.flatten = <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span>
  flat = []
  <span class="hljs-keyword">for</span> key <span class="hljs-keyword">of</span> obj
    flat.push obj[key]
  flat



util.type = <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> obj == <span class="hljs-literal">undefined</span> <span class="hljs-keyword">or</span> obj == <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> String obj
  classToType = <span class="hljs-keyword">new</span> Object
  <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> <span class="hljs-string">"Boolean Number String Function Array Date"</span>
    RegExp.split(<span class="hljs-string">" "</span>)
  myClass = Object.prototype.toString.call obj
  <span class="hljs-keyword">if</span> myClass <span class="hljs-keyword">of</span> classToType
    <span class="hljs-keyword">return</span> classToType(myClass)
  <span class="hljs-keyword">return</span> <span class="hljs-string">'object'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>TODO - ES5 has a clone method on Object. Should test for that</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
util.clone = <span class="hljs-function"><span class="hljs-params">(obj)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>This line is supposed to be superfast but apparently doesnt 
clone completely, such as UniformLocations and similar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  JSON.parse JSON.stringify obj</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> obj? <span class="hljs-keyword">or</span> <span class="hljs-keyword">typeof</span> obj <span class="hljs-keyword">isnt</span> <span class="hljs-string">'object'</span>
    <span class="hljs-keyword">return</span> obj

  <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">instanceof</span> Date
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Date(obj.getTime()) 

  <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">instanceof</span> RegExp
    flags = <span class="hljs-string">''</span>
    flags += <span class="hljs-string">'g'</span> <span class="hljs-keyword">if</span> obj.<span class="hljs-built_in">global</span>?
    flags += <span class="hljs-string">'i'</span> <span class="hljs-keyword">if</span> obj.ignoreCase?
    flags += <span class="hljs-string">'m'</span> <span class="hljs-keyword">if</span> obj.multiline?
    flags += <span class="hljs-string">'y'</span> <span class="hljs-keyword">if</span> obj.sticky?
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> RegExp(obj.source, flags)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>TODO - More typed array clones? 
we cant just call the constructor and set the classes you see! :S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">instanceof</span> Float32Array
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Float32Array(obj)

  <span class="hljs-keyword">if</span> obj <span class="hljs-keyword">instanceof</span> Uint16Array
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Uint16Array(obj)

  newInstance = <span class="hljs-keyword">new</span> obj.constructor()

  <span class="hljs-keyword">for</span> key <span class="hljs-keyword">of</span> obj
    newInstance[key] = util.clone obj[key]

  <span class="hljs-keyword">return</span> newInstance</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>copy the values from one to another
used to update the cache
TODO - for now, lets not bother with objects inside object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
util.copy = <span class="hljs-function"><span class="hljs-params">(from, to)</span> -&gt;</span>

  <span class="hljs-keyword">if</span> from <span class="hljs-keyword">instanceof</span> Float32Array <span class="hljs-keyword">and</span> to <span class="hljs-keyword">instanceof</span> Float32Array
    <span class="hljs-keyword">if</span> from.length == to.size
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.from.length<span class="hljs-number">-1</span>]
        to[i] = from[i]
      <span class="hljs-keyword">return</span>


  <span class="hljs-keyword">if</span> from <span class="hljs-keyword">instanceof</span> Uint16Array <span class="hljs-keyword">and</span> to <span class="hljs-keyword">instanceof</span> Uint16Array
    <span class="hljs-keyword">if</span> from.length == to.size
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.from.length<span class="hljs-number">-1</span>]
        to[i] = from[i]
      <span class="hljs-keyword">return</span>
  
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> from <span class="hljs-keyword">isnt</span> <span class="hljs-string">'object'</span> <span class="hljs-keyword">and</span> typof to <span class="hljs-keyword">isnt</span> <span class="hljs-string">'object'</span>
    to = from</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Read the Parameters on the URL line in the browser</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>util.QueryString = <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span> 

  query_string = {}
  query = <span class="hljs-built_in">window</span>.location.search.substring(<span class="hljs-number">1</span>) <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>?
  vars = query.split(<span class="hljs-string">"&amp;"</span>)
  
  <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.vars.length<span class="hljs-number">-1</span>]
    pair = vars[i].split(<span class="hljs-string">"="</span>)
    
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> query_string[pair[<span class="hljs-number">0</span>]] == <span class="hljs-string">"undefined"</span>
      query_string[pair[<span class="hljs-number">0</span>]] = pair[<span class="hljs-number">1</span>]

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> query_string[pair[<span class="hljs-number">0</span>]] == <span class="hljs-string">"string"</span>
      arr = [ query_string[pair[<span class="hljs-number">0</span>]], pair[<span class="hljs-number">1</span>] ]
      query_string[pair[<span class="hljs-number">0</span>]] = arr
    
    <span class="hljs-keyword">else</span>
      query_string[pair[<span class="hljs-number">0</span>]].push(pair[<span class="hljs-number">1</span>])
  
  <span class="hljs-keyword">return</span> query_string

<span class="hljs-built_in">module</span>.exports = util</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

