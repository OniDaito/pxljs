<!DOCTYPE html>

<html>
<head>
  <title>red_black_tree.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>red_black_tree.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details

An implementation <span class="hljs-keyword">of</span> the Red Black Tree from the Javascript Implementation found
at https:<span class="hljs-regexp">//gi</span>thub.com/gorhill/Javascript-Voronoi/blob/master/rhill-voronoi-core.js</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>##RedBlackTree###</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedBlackTree</span></span>
  constructor : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @root = <span class="hljs-literal">null</span>

  insertSuccessor : <span class="hljs-function"><span class="hljs-params">(node, successor)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> node
      successor.rbPrevious = node
      successor.rbNext = node.rbNext
      
      <span class="hljs-keyword">if</span> node.rbNext
        node.rbNext.rbPrevious = successor  
      
      node.rbNext = successor
    
      <span class="hljs-keyword">if</span> node.rbRight   
        node = node.rbRight

        <span class="hljs-keyword">while</span> node.rbLeft
          node = node.rbLeft
        
        node.rbLeft = successor
      
      <span class="hljs-keyword">else</span>
        node.rbRight = successor
      parent = node
    
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @root
      node = @getFirst(@root)
      successor.rbPrevious = <span class="hljs-literal">null</span>
      successor.rbNext = node
      node.rbPrevious = successor
      node.rbLeft = successor
      parent = node
      
    <span class="hljs-keyword">else</span> 
      successor.rbPrevious = successor.rbNext = <span class="hljs-literal">null</span>
     
      @root = successor
      parent = <span class="hljs-literal">null</span>
      
    successor.rbLeft = successor.rbRight = <span class="hljs-literal">null</span>
    successor.rbParent = parent
    successor.rbRed = <span class="hljs-literal">true</span>
   
    grandpa
    uncle
    node = successor

    <span class="hljs-keyword">while</span> parent <span class="hljs-keyword">and</span> parent.rbRed
      grandpa = parent.rbParent
      <span class="hljs-keyword">if</span> parent <span class="hljs-keyword">is</span> grandpa.rbLeft
        uncle = grandpa.rbRight
        <span class="hljs-keyword">if</span> uncle <span class="hljs-keyword">and</span> uncle.rbRed
          parent.rbRed = uncle.rbRed = <span class="hljs-literal">false</span>
          grandpa.rbRed = <span class="hljs-literal">true</span>
          node = grandpa
        
        <span class="hljs-keyword">else</span> 
          <span class="hljs-keyword">if</span> node <span class="hljs-keyword">is</span> parent.rbRight
            @rotateLeft(parent)
            node = parent
            parent = node.rbParent
            
          parent.rbRed = <span class="hljs-literal">false</span>
          grandpa.rbRed = <span class="hljs-literal">true</span>
          @rotateRight(grandpa)
          
      <span class="hljs-keyword">else</span>
        uncle = grandpa.rbLeft
        <span class="hljs-keyword">if</span> (uncle &amp;&amp; uncle.rbRed)
          parent.rbRed = uncle.rbRed = <span class="hljs-literal">false</span>
          grandpa.rbRed = <span class="hljs-literal">true</span>
          node = grandpa
            
        <span class="hljs-keyword">else</span>
          <span class="hljs-keyword">if</span> (node <span class="hljs-keyword">is</span> parent.rbLeft)
            @rotateRight(parent)
            node = parent
            parent = node.rbParent
              
          parent.rbRed = <span class="hljs-literal">false</span>
          grandpa.rbRed = <span class="hljs-literal">true</span>
          @rotateLeft grandpa
          
          parent = node.rbParent

    @root.rbRed = <span class="hljs-literal">false</span>      

  removeNode : <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> node.rbNext
      node.rbNext.rbPrevious = node.rbPrevious
  
    <span class="hljs-keyword">if</span> node.rbPrevious
      node.rbPrevious.rbNext = node.rbNext
    
    node.rbNext = node.rbPrevious = <span class="hljs-literal">null</span>

    parent = node.rbParent
    left = node.rbLeft
    right = node.rbRight
    next

    <span class="hljs-keyword">if</span> !left
      next = right

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> !right
      next = left
    <span class="hljs-keyword">else</span>
      next = @getFirst right
    <span class="hljs-keyword">if</span> parent
      <span class="hljs-keyword">if</span> parent.rbLeft <span class="hljs-keyword">is</span> node
        parent.rbLeft = next      
      <span class="hljs-keyword">else</span>
        parent.rbRight = next
  
    <span class="hljs-keyword">else</span>
      @root = next</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>enforce red-black rules</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    isRed

    <span class="hljs-keyword">if</span> left <span class="hljs-keyword">and</span> right
      isRed = next.rbRed
      next.rbRed = node.rbRed
      next.rbLeft = left
      left.rbParent = next
      <span class="hljs-keyword">if</span> next <span class="hljs-keyword">isnt</span> right
        parent = next.rbParent
        next.rbParent = node.rbParent
        node = next.rbRight
        parent.rbLeft = node
        next.rbRight = right
        right.rbParent = next
      
      <span class="hljs-keyword">else</span> 
        next.rbParent = parent
        parent = next
        node = next.rbRight
    <span class="hljs-keyword">else</span>
      isRed = node.rbRed
      node = next
  
    <span class="hljs-keyword">if</span> node
      node.rbParent = parent
  
    <span class="hljs-keyword">if</span> isRed
      <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span> node <span class="hljs-keyword">and</span> node.rbRed
      node.rbRed = <span class="hljs-literal">false</span>
      <span class="hljs-keyword">return</span>

    sibling
    <span class="hljs-keyword">loop</span>
      <span class="hljs-keyword">if</span> node <span class="hljs-keyword">is</span> @root
        <span class="hljs-keyword">break</span>
        
      <span class="hljs-keyword">if</span> node <span class="hljs-keyword">is</span> parent.rbLeft
        sibling = parent.rbRight
        
        <span class="hljs-keyword">if</span> sibling.rbRed
          sibling.rbRed = <span class="hljs-literal">false</span>
          parent.rbRed = <span class="hljs-literal">true</span>
          @rotateLeft(parent)
          sibling = parent.rbRight
        
        <span class="hljs-keyword">if</span> (sibling.rbLeft <span class="hljs-keyword">and</span> sibling.rbLeft.rbRed) <span class="hljs-keyword">or</span> (sibling.rbRight <span class="hljs-keyword">and</span> sibling.rbRight.rbRed)
          <span class="hljs-keyword">if</span> !sibling.rbRight <span class="hljs-keyword">or</span> !sibling.rbRight.rbRed
            sibling.rbLeft.rbRed = <span class="hljs-literal">false</span>
            sibling.rbRed = <span class="hljs-literal">true</span>
            @rotateRight sibling
            sibling = parent.rbRight
            
          sibling.rbRed = parent.rbRed
          parent.rbRed = sibling.rbRight.rbRed = <span class="hljs-literal">false</span>
          @rotateLeft parent
          node = @root
          <span class="hljs-keyword">break</span>
          
      <span class="hljs-keyword">else</span>
        sibling = parent.rbLeft
        <span class="hljs-keyword">if</span> (sibling.rbRed)
          sibling.rbRed = <span class="hljs-literal">false</span>
          parent.rbRed = <span class="hljs-literal">true</span>
          @rotateRight parent
          sibling = parent.rbLeft
          
        <span class="hljs-keyword">if</span> (sibling.rbLeft <span class="hljs-keyword">and</span> sibling.rbLeft.rbRed) <span class="hljs-keyword">or</span> (sibling.rbRight <span class="hljs-keyword">and</span> sibling.rbRight.rbRed)
          <span class="hljs-keyword">if</span> !sibling.rbLeft <span class="hljs-keyword">or</span> !sibling.rbLeft.rbRed
            sibling.rbRight.rbRed = <span class="hljs-literal">false</span>
            sibling.rbRed = <span class="hljs-literal">true</span>
            @rotateLeft sibling
            sibling = parent.rbLeft
        
          sibling.rbRed = parent.rbRed
          parent.rbRed = sibling.rbLeft.rbRed = <span class="hljs-literal">false</span>
          @rotateRight parent
          node = @root
          <span class="hljs-keyword">break</span>
              
      sibling.rbRed = <span class="hljs-literal">true</span>
      node = parent
      parent = parent.rbParent

      <span class="hljs-keyword">break</span> <span class="hljs-keyword">if</span> node.rbRed 
    
    <span class="hljs-keyword">if</span> node
      node.rbRed = <span class="hljs-literal">false</span>

  rotateLeft : <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    p = node
    q = node.rbRight
    parent = p.rbParent

    <span class="hljs-keyword">if</span> parent
      <span class="hljs-keyword">if</span> parent.rbLeft <span class="hljs-keyword">is</span> p
        parent.rbLeft = q
      <span class="hljs-keyword">else</span>
        parent.rbRight = q
    <span class="hljs-keyword">else</span>
      @root = q
    
    q.rbParent = parent
    p.rbParent = q
    p.rbRight = q.rbLeft
    <span class="hljs-keyword">if</span> p.rbRight
      p.rbRight.rbParent = p
  
    q.rbLeft = p

  rotateRight : <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    p = node
    q = node.rbLeft
    parent = p.rbParent;
    
    <span class="hljs-keyword">if</span> parent
      <span class="hljs-keyword">if</span> parent.rbLeft <span class="hljs-keyword">is</span> p
        parent.rbLeft = q
      <span class="hljs-keyword">else</span>
        parent.rbRight = q
    
    <span class="hljs-keyword">else</span>
      @root = q

    q.rbParent = parent
    p.rbParent = q
    p.rbLeft = q.rbRight
  
    <span class="hljs-keyword">if</span> p.rbLeft
      p.rbLeft.rbParent = p
  
    q.rbRight = p

  getFirst : <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    <span class="hljs-keyword">while</span> node.rbLeft
      node = node.rbLeft

    node

  getLast : <span class="hljs-function"><span class="hljs-params">(node)</span> -&gt;</span>
    <span class="hljs-keyword">while</span> node.rbRight
      node = node.rbRight

    node
  
<span class="hljs-built_in">module</span>.exports =
  RedBlackTree : RedBlackTree</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

