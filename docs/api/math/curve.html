<!DOCTYPE html>

<html>
<head>
  <title>curve.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>curve.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
{Vec2, Vec3, Vec4, Matrix4, PI } = <span class="hljs-built_in">require</span> <span class="hljs-string">'../math/math'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="curve2">Curve2</h2>
<p>The basis for a series of two dimensional curves. These may or may not be normalised
This class also can be used to represent a straight line with gradient one, through
the origin - basically your classic straight line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Curve2</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p><strong>pointOnCurve</strong> - Return the point on this curve given u (or x)</p>
<ul>
<li><strong>u</strong> - a Number - Required</li>
<li>returns a new Vec2</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointOnCurve : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec2 u,u</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p><strong>y</strong> - Given x give us y</p>
<ul>
<li><strong>x</strong> - a Number - Required</li>
<li>returns a Number</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  y : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
    x</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p><strong>stepForU</strong> - given U return the step distance </p>
<ul>
<li><strong>x</strong> - Step along the curve x o</li>
<li>returns a Number</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stepForU : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
    x</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p><strong>xForStep</strong> - given d step along the curve give us x</p>
<ul>
<li><strong>d</strong> - a Number</li>
<li>returns a Number</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  xForStep : <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span>
    x</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p><strong>pointDistance</strong> </p>
<ul>
<li><strong>d</strong> - a Number</li>
<li>returns a new Vec2</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointDistance : <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>sqrt(d^2 / 2) = a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    t = Math.sqrt(d*d/<span class="hljs-number">2.0</span>)
    <span class="hljs-keyword">new</span> Vec2 t,t</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p><strong>tangentOnCurve</strong></p>
<ul>
<li><strong>x</strong> - a Number</li>
<li>returns a new Vec2</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tangentOnCurve : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p><strong>tangentDistance</strong></p>
<ul>
<li><strong>d</strong> - a Number</li>
<li>returns a new Vec2</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tangentDistance: <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec2 <span class="hljs-number">1</span>,<span class="hljs-number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="curve">Curve</h2>
<p>The basis for any parametric curve. We cache values for distance and u so we can
step along the curve using distance or normalized values
TODO - Rename this as CurveP - for parametric</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Curve</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Our step size along the curve to generate points</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @step_rez = <span class="hljs-number">0.01</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Cache points for speed as oppose to memory
TODO - Might change to instance variables later</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @cache_table = <span class="hljs-literal">true</span> 
  @cache_size = <span class="hljs-number">200</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    @length = <span class="hljs-number">0</span>

    <span class="hljs-keyword">if</span> Curve.cache_table</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>create a table of positions as a cache</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      @_table = []
      step = <span class="hljs-number">1</span> / Curve.cache_size
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.Curve.cache_size<span class="hljs-number">-1</span>]
        tu = i * step
        @_table.push { u : tu, d : @stepForU(tu) }
      @length = @_table[ @_table.length - <span class="hljs-number">1</span>][<span class="hljs-string">"d"</span>]

    <span class="hljs-keyword">else</span>
      @length = @stepForU(<span class="hljs-number">1.0</span>)

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p><strong>pointOnCurve</strong> - Return the point on this curve given u (or x)</p>
<ul>
<li><strong>u</strong> - a Number - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointOnCurve : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec3 <span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p><strong>stepForU</strong> - given U return the step distance </p>
<ul>
<li><strong>x</strong> - Step along the curve x o</li>
<li>returns a Number</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  stepForU : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>

    <span class="hljs-keyword">if</span> u == <span class="hljs-number">0</span>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>

    prev_dist = <span class="hljs-number">0</span>
    curr_dist = <span class="hljs-number">0</span>
    prev_u = <span class="hljs-number">0</span>
    curr_u = <span class="hljs-number">0</span>
    prev_point = @pointOnCurve(<span class="hljs-number">0</span>)
    curr_point = prev_point

    <span class="hljs-keyword">while</span> curr_u &lt; u
      prev_dist = curr_dist
      prev_u = curr_u
      prev_point.copy curr_point

      curr_u += Curve.step_rez
      curr_point = @pointOnCurve curr_u
      curr_dist += curr_point.dist prev_point
      
    du = (u - prev_u) / (curr_u - prev_u)

    du * (curr_dist - prev_dist) + prev_dist</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><strong>uForStep</strong> - given a euclidean distance what is the step</p>
<ul>
<li><strong>d</strong> - a Number</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  uForStep : <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span>

    <span class="hljs-keyword">if</span> d == <span class="hljs-number">0</span>
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>

    prev_dist = <span class="hljs-number">0</span>
    curr_dist = <span class="hljs-number">0</span>
    prev_u = <span class="hljs-number">0</span>
    curr_u = <span class="hljs-number">0</span>
    prev_point = @pointOnCurve(<span class="hljs-number">0</span>)
    curr_point = prev_point

    <span class="hljs-keyword">while</span> curr_dist &lt; d
      prev_dist = curr_dist
      prev_u = curr_u
      prev_point.copy curr_point

      curr_u += Curve.step_rez
      curr_point = @pointOnCurve curr_u
      curr_dist += curr_point.dist prev_point


    dd = d - prev_dist
    <span class="hljs-keyword">if</span> (curr_dist - prev_dist) &gt; <span class="hljs-number">0</span>    
      dd = dd / (curr_dist - prev_dist)

    dd * (curr_u - prev_u) + prev_u</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p><strong>pointDistance</strong></p>
<ul>
<li><strong>d</strong> - a Number - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointDistance : <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>If we have a cache table step through it and find u</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
    <span class="hljs-keyword">if</span> d == <span class="hljs-number">0</span>
      <span class="hljs-keyword">return</span> @pointOnCurve <span class="hljs-number">0</span>

    <span class="hljs-keyword">if</span> d &gt;= @length
      <span class="hljs-keyword">return</span> @pointOnCurve <span class="hljs-number">1.0</span>

    <span class="hljs-keyword">if</span> @_table
      curr_dist = <span class="hljs-number">0</span>
      curr_u = <span class="hljs-number">0</span>
      prev_dist = <span class="hljs-number">0</span>
      prev_u = <span class="hljs-number">0</span>

      <span class="hljs-keyword">for</span> step <span class="hljs-keyword">in</span> @_table
       
        prev_u = curr_u
        prev_dist = curr_dist

        curr_u = step.u
        curr_dist = step.d 

        <span class="hljs-keyword">if</span> step.d &gt;= d
          <span class="hljs-keyword">break</span>

      dd = d - prev_dist
      <span class="hljs-keyword">if</span> (curr_dist - prev_dist) &gt; <span class="hljs-number">0</span>    
        dd = dd / (curr_dist - prev_dist)

      @pointOnCurve( dd * (curr_u - prev_u) + prev_u )

    <span class="hljs-keyword">else</span> 
      @pointOnCurve @uForStep d</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p><strong>tangentOnCurve</strong> - get a tangent from the normalised co-ordinate</p>
<ul>
<li><strong>u</strong> - a Number - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tangentOnCurve : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>
    v0 = @pointOnCurve(u) 
    v1 = @pointOnCurve(u + Curve.step_rez / <span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">if</span> u &gt;= <span class="hljs-number">1.0</span>
      v1 = v0
      v0 = v1 - Curve.step_rez / <span class="hljs-number">2</span>

    Vec3.sub(v1,v0).normalize()</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p><strong>tangentDistance </strong> - get a tangent from the distance along the curve</p>
<ul>
<li><strong>d</strong> - a Number</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tangentDistance : <span class="hljs-function"><span class="hljs-params">(d)</span> -&gt;</span>
    v0 = @pointDistance(d) 
    v1 = @pointDistance(d + Curve.step_rez / <span class="hljs-number">2</span>)
    
    <span class="hljs-keyword">if</span> d &gt;= @length
      v1 = v0
      v0 = v1 - Curve.step_rez / <span class="hljs-number">2</span>

    Vec3.sub(v1,v0).normalize()</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="beziercubic3">BezierCubic3</h2>
<p>A Quadratic, bezier curve with four vectors determining the shape
A 3D curve as oppose to 2D</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BezierCubic3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Curve</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>
<ul>
<li><strong>v0</strong> - a Vec3 - Required</li>
<li><strong>v1</strong> - a Vec3 - Required</li>
<li><strong>v2</strong> - a Vec3 - Required</li>
<li><strong>v3</strong> - a Vec3 - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(@v0,@v1,@v2,@v3)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()

  _B1 : <span class="hljs-function"><span class="hljs-params">(t)</span> -&gt;</span>
    t*t*t
  
  _B2 : <span class="hljs-function"><span class="hljs-params">(t)</span> -&gt;</span>
    <span class="hljs-number">3</span>*t*t*(<span class="hljs-number">1</span>-t)
  
  _B3 : <span class="hljs-function"><span class="hljs-params">(t)</span> -&gt;</span>
    <span class="hljs-number">3</span>*t*(<span class="hljs-number">1</span>-t)*(<span class="hljs-number">1</span>-t)

  _B4 : <span class="hljs-function"><span class="hljs-params">(t)</span> -&gt;</span> 
    (<span class="hljs-number">1</span>-t)*(<span class="hljs-number">1</span>-t)*(<span class="hljs-number">1</span>-t)</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p><strong>pointOnCurve</strong> </p>
<ul>
<li><strong>u</strong> - a Number - Range 0 to 1 - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointOnCurve: <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec3( v0.x*@_B1(u) + v1.x*@_B2(u) + v2.x*@_B3(u) + v3.x*@_B4(u),
      v0.y*@_B1(u) + v1.y*@_B2(u) + v2.y*@_B3(u) + v3.y*@_B4(u),
      v0.z*@_B1(u) + v1.z*@_B2(u) + v2.z*@_B3(u) + v3.z*@_B4(u))</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>TODO This formula actually works IF you remmeber there are two answers
It DOESNT work for lines that are parallel to the x or y axis
We need to revert to the directrix equation for that - this happens
if either a or b is 0
Takes the line in the form ax + by + c = 0
This is nothing to do with the song “Parabola” by the band Tool; at least
I don’t think it is :S
@f - The Focus as a Vec2
@a - parameter of the line equation (or 0 if x directrix)
@b - parameter of the line equation (or 0 if y directrix)
@c - parameter of the line equation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Parabola</span> </span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p><strong>constructor</strong></p>
<ul>
<li><strong>f</strong> - a Vec2 - Required</li>
<li><strong>a</strong> - a Number - Required</li>
<li><strong>b</strong> - a Number - Required</li>
<li><strong>c</strong> - a Number - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(@f, @a, @b, @c)</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p><strong>sample</strong></p>
<ul>
<li><strong>x</strong> - a Number - Required</li>
<li>returns an Array of Number - Length 2</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sample : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Three ways to sample - arbitrary line, x axis or y axis</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> @a == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> @b != <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>x axis aligned
(x-h)^2 = 4p(y-k)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      h = @f.x
      k = (@f.y + @c) / <span class="hljs-number">2</span>
      p = @f.y - k

      a = <span class="hljs-number">1</span>/(<span class="hljs-number">4</span>*p)
      b = -h/(<span class="hljs-number">2</span>*p)
      c = (h*h)/(<span class="hljs-number">4</span>*p) + k
      y = a*x*x+b*x+c
      <span class="hljs-keyword">return</span> [y,y]

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @b == <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> @a != <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>y axis aligned - use the quadratic formula as we will have two answers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      
      h = (@f.x + @c) / <span class="hljs-number">2</span>
      k = @f.y
      p = @f.x - h

      y0 = Math.sqrt(<span class="hljs-number">4</span>*p*(x-h)) + k
      y1 = k - Math.sqrt(<span class="hljs-number">4</span>*p*(x-h))
        
      <span class="hljs-keyword">return</span> [y0,y1]
   
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> @a != <span class="hljs-number">0</span>  <span class="hljs-keyword">and</span> @b != <span class="hljs-number">0</span>
      as = @a * @a
      bs = @b * @b
      cs = @c * @c
      u = @f.x
      us = u * u
      v = @f.y
      vs = v * v
      xs = x * x
      t0 = (<span class="hljs-number">-2</span>*as*v<span class="hljs-number">-2</span>*@a*@b*x<span class="hljs-number">-2</span>*bs*v<span class="hljs-number">-2</span>*@b*@c)

      t1 = Math.sqrt((t0*t0)<span class="hljs-number">-4</span>*as*(as*us<span class="hljs-number">-2</span>*as*u*x+as*vs<span class="hljs-number">-2</span>*@a*@c*x+bs*us<span class="hljs-number">-2</span>*bs*u*x+bs*vs+bs*xs-cs))
      t2 = <span class="hljs-number">2</span>*as*v+<span class="hljs-number">2</span>*@a*@b*x+<span class="hljs-number">2</span>*bs*v+<span class="hljs-number">2</span>*@b*@c
      t3 = <span class="hljs-number">2</span>*as

      [ (-t1 + t2) / t3, (t1 + t2) / t3 ]
    <span class="hljs-keyword">else</span>
      PXLError(<span class="hljs-string">"Malformed "</span>)
      <span class="hljs-keyword">return</span> [<span class="hljs-number">0</span>,<span class="hljs-number">0</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p><strong>lineCrossing</strong> - figure out where a line crosses this parabola given the equation in the form ax + by + c = 0</p>
<ul>
<li><strong>e</strong> - a Number - Required</li>
<li><strong>f</strong> - a Number - Required</li>
<li><strong>g</strong> - a Number - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lineCrossing : <span class="hljs-function"><span class="hljs-params">(e,f,g)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>[e,f,g] = line.equation()</p>

            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>TODO - line crossing for edges that are parallel to a major axis!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    a = @a
    b = @b
    c = @c
    as = @a * @a 
    bs = @b * @b
    cs = @c * @c
    fs = f * f
    es = e * e
    gs = g * g
    h = @f.x
    k = @f.y
    hs = h * h
    ks = k * k

    <span class="hljs-built_in">console</span>.log a,b,c,f,e,g,h,k

    t0 = (<span class="hljs-number">2</span>*as*e*f*k+<span class="hljs-number">2</span>*as*e*g<span class="hljs-number">-2</span>*as*fs*h+<span class="hljs-number">2</span>*a*b*f*g<span class="hljs-number">-2</span>*a*c*fs+<span class="hljs-number">2</span>*bs*e*f*k<span class="hljs-number">-2</span>*bs*fs*h+<span class="hljs-number">2</span>*b*c*e*f)
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"t0"</span>,t0
    t1 = <span class="hljs-number">4</span>*(as*es+<span class="hljs-number">2</span>*a*b*e*f+bs*fs)*(as*fs*hs+as*fs*ks+<span class="hljs-number">2</span>*as*f*g*k+as*gs+bs*fs*hs+bs*fs*ks+<span class="hljs-number">2</span>*bs*f*g*k+<span class="hljs-number">2</span>*b*c*f*g-cs*fs)
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"t1"</span>,t1
    t2 = <span class="hljs-number">2</span>*as*e*f*k<span class="hljs-number">-2</span>*as*e*g+<span class="hljs-number">2</span>*as*fs*h<span class="hljs-number">-2</span>*a*b*f*g+<span class="hljs-number">2</span>*a*c*fs<span class="hljs-number">-2</span>*bs*e*f*k+<span class="hljs-number">2</span>*bs*fs*h<span class="hljs-number">-2</span>*b*c*e*f
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"t2"</span>,t2
    t3 = <span class="hljs-number">2</span>*(as*es+<span class="hljs-number">2</span>*a*b*e*f+bs*fs)
    <span class="hljs-built_in">console</span>.log <span class="hljs-string">"t3"</span>,t3


    x0 = (-Math.sqrt(t0*t0-t1)-t2)/t3
    x1 = (Math.sqrt(t0*t0-t1)-t2)/t3
    
    [ <span class="hljs-keyword">new</span> Vec2(x0, (-e*x0-g)/f), <span class="hljs-keyword">new</span> Vec2(x1, (-e*x1-g)/f) ]</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="catmullpatch">CatmullPatch</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CatmullPatch</span> </span></pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>TODO - as we are are not keeping a count of the points, we cant really
alter the patch on the fly :( </p>

            </div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>
<ul>
<li><strong>points</strong> - an Array of Vec3 - Length 16 - Required
Assume points are given in column major order!</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(points)</span> -&gt;</span>
    
    <span class="hljs-keyword">if</span> points.length != <span class="hljs-number">16</span>
      PXLError <span class="hljs-string">"Catmull Patch needs 16 points"</span>
      <span class="hljs-keyword">return</span>

    b = <span class="hljs-keyword">new</span> Matrix4([<span class="hljs-number">-0.5</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-0.5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1.5</span>,<span class="hljs-number">-2.5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">-1.5</span>,<span class="hljs-number">2</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>,<span class="hljs-number">-0.5</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Create the matrices we need for the output points</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    t = []
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> points
      t.push p.x
    @px = <span class="hljs-keyword">new</span> Matrix4(t)

    t = []
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> points
      t.push p.y
    @py = <span class="hljs-keyword">new</span> Matrix4(t)

    t = []
    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> points
      t.push p.z
    @pz = <span class="hljs-keyword">new</span> Matrix4(t)

    bt = Matrix4.transpose(b)

    @px = Matrix4.mult(b,@px).mult(bt)
    @py = Matrix4.mult(b,@py).mult(bt)
    @pz = Matrix4.mult(b,@pz).mult(bt)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p><strong>sample</strong> - Sample the patch with a vec2 (u,w) to gain the required point </p>
<ul>
<li><strong>v</strong> - a Vec2 - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sample : <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    u1 = v.x
    u2 = u1 * u1
    u3 = u2 * u1

    w1 = v.y
    w2 = w1 * w1
    w3 = w2 * w1
    
    u = <span class="hljs-keyword">new</span> Vec4(u3,u2,u1,<span class="hljs-number">1</span>)
    w = <span class="hljs-keyword">new</span> Vec4(w3,w2,w1,<span class="hljs-number">1</span>)

    um = Matrix4.multVec(@px, w)
    x = u.x * um.x + u.y * um.y + u.z * um.z + u.w * um.w

    um = Matrix4.multVec(@py, w)
    y = u.x * um.x + u.y * um.y + u.z * um.z + u.w * um.w

    um = Matrix4.multVec(@pz, w)
    z = u.x * um.x + u.y * um.y + u.z * um.z + u.w * um.w

    <span class="hljs-keyword">new</span> Vec3(x,y,z)</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>TODO - eventually use the proper matrix <a href="http://www.cubic.org/docs/hermite.htm">http://www.cubic.org/docs/hermite.htm</a></p>

            </div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="cubichermitespline">CubicHermiteSpline</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CubicHermiteSpline</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Curve</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>
<ul>
<li><strong>p0</strong> - a Vec2 or Vec3 - Required</li>
<li><strong>p1</strong> - a Vec2 or Vec3 - Required</li>
<li><strong>m0</strong> - a Vec2 or Vec3 - Required</li>
<li><strong>m1</strong> - a Vec2 or Vec3 - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(@p0, @p1, @m0, @m1)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p><strong>pointOnCurve</strong> - Return the point on this curve given u (or x)</p>
<ul>
<li><strong>u</strong> - a Number - Required</li>
<li>returns a new Vec2 or Vec3 </li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointOnCurve : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span>

    t3 = u*u*u 
    t2 = u*u

    c0 = @p0.clone().multScalar(<span class="hljs-number">2</span> * t3 - <span class="hljs-number">3</span> * t2 + <span class="hljs-number">1</span>) 
    c1 = @m0.clone().multScalar(t3 - <span class="hljs-number">2</span> * t2 + u)
    c2 = @p1.clone().multScalar(<span class="hljs-number">-2</span> * t3 + <span class="hljs-number">3</span> * t2)
    c3 = @m1.clone().multScalar(t3 - t2)

    c0.add(c1).add(c2).add(c3)</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h2 id="catmullromspline">CatmullRomSpline</h2>
<p>A collection of curves forming a Catmull-rom spline.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CatmullRomSpline</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Curve</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>TODO - as we are are not keeping a count of the points, we cant really
alter the spline on the fly :(
<strong>@constructor</strong></p>
<ul>
<li><strong>points</strong> - an Array of Vec2 or Vec3 - Minimum Length 4 - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(points)</span> -&gt;</span>

    <span class="hljs-keyword">if</span> points.length &lt; <span class="hljs-number">4</span>
      PXLError <span class="hljs-string">"Catmull-Rom Spline needs at least 4 points"</span>
      <span class="hljs-keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Build from a set of CubicHermiteSplines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    segments  = points.length - <span class="hljs-number">3</span>

    @splines = []
 
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span>.segments<span class="hljs-number">-1</span>]
      m0 = points[i+<span class="hljs-number">2</span>].clone().sub( points[i])
      m1 = points[i+<span class="hljs-number">3</span>].clone().sub( points[i+<span class="hljs-number">1</span>])

      @splines.push <span class="hljs-keyword">new</span> CubicHermiteSpline points[i+<span class="hljs-number">1</span>], points[i+<span class="hljs-number">2</span>], m0, m1

    <span class="hljs-keyword">super</span>()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p><strong>pointOnCurve</strong> - Return the point on this curve given u (or x)</p>
<ul>
<li><strong>u</strong> - a Number - Range 0 to 1 - Required</li>
<li>returns a new Vec3</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pointOnCurve : <span class="hljs-function"><span class="hljs-params">(u)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>Decide where in spline we are given the numbers we have</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    segment  = Math.floor(u * @splines.length)

    <span class="hljs-keyword">if</span> u &gt;= <span class="hljs-number">1</span>
      @splines[@splines.length<span class="hljs-number">-1</span>].pointOnCurve (<span class="hljs-number">1.0</span>)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> u &lt;= <span class="hljs-number">0</span>
      @splines[<span class="hljs-number">0</span>].pointOnCurve(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>
      @splines[segment].pointOnCurve ( (@splines.length * u) - segment)</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h2 id="curveslide">CurveSlide</h2>
<p><a href="http://www.cs.cmu.edu/~fp/courses/graphics/asst5/cameraMovement.pdf">http://www.cs.cmu.edu/~fp/courses/graphics/asst5/cameraMovement.pdf</a>
essentially step along via a distance, passing in previous values
and setting new ones</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CurveSlide</span> </span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p><strong>@constructor</strong></p>
<ul>
<li><strong>curve</strong> - a Curve - Required</li>
<li><strong>normal</strong> - a Vec3 - Required</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(@curve, @normal)</span> -&gt;</span>
    @reset @normal,<span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p><strong>reset</strong> - reset the slide starting from distance d, with a starting normal</p>
<ul>
<li><strong>normal</strong> - a Vec3 - Required</li>
<li><strong>d</strong> - a Number - Default 0</li>
<li>returns this</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset : <span class="hljs-function"><span class="hljs-params">(@normal, d=<span class="hljs-number">0</span>)</span> -&gt;</span>
    @d = d
    @pos = @curve.pointDistance @d
    @tangent = @curve.tangentDistance @d
    @bp = Vec3.cross @normal, @tangent
    @np = @normal
    @binormal = @bp
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p><strong>slide</strong> - slide along the curve from the starting point by d distance</p>
<ul>
<li><strong>dd</strong> - a Number - Required</li>
<li>returns this</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slide : <span class="hljs-function"><span class="hljs-params">(dd)</span> -&gt;</span>
    @d += dd
    <span class="hljs-keyword">if</span> @d &gt; @curve.length
      @reset @normal, <span class="hljs-number">0</span>

    @pos = @curve.pointDistance @d
    @tangent = @curve.tangentDistance @d

    @bp = @binormal
 
    @normal = Vec3.cross @bp, @tangent
    @binormal = Vec3.cross @tangent, @normal
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h2 id="nurb">NURB</h2>
<p>NURB Class
TODO - Most of it - there is still a fair bit to go</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NURB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Curve</span></span>
  constructor : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @

<span class="hljs-built_in">module</span>.exports = 
  Curve2 : Curve2
  BezierCubic3:  BezierCubic3
  CubicHermiteSpline : CubicHermiteSpline
  CatmullRomSpline : CatmullRomSpline
  Parabola : Parabola
  CatmullPatch : CatmullPatch
  CurveSlide : CurveSlide</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>

