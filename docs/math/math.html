<!DOCTYPE html>

<html>
<head>
  <title>math.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>math.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details


http:<span class="hljs-regexp">//</span>www.flipcode.com/documents/matrfaq.html
http:<span class="hljs-regexp">//</span>www.euclideanspace.com/maths/algebra/realNormedAlgebra/quaternions/index.htm

  - Thanks: Tojiro - https:<span class="hljs-regexp">//gi</span>thub.com/toji/gl-matrix
  - Thanks: Cinder <span class="hljs-keyword">for</span> most <span class="hljs-keyword">of</span> the math!

The maths functons <span class="hljs-keyword">in</span> PXLJS work as follows;
  - Any instance method that doesn<span class="hljs-string">'t return a different tyoe to the instance, modifies 
    that instance and returns a reference to the original. For example:
    Vec3 a(1,0,0); 
    b = a.add(1,0,0);

    b will be a pointer or reference to a which will now have the value (2,0,0)

  - Class methods do the opposite to the above - they return a new version
    Vec3 a(1,0,0)
    Vec3 b(2,0,0)
    c = Vec3.add(a,b)
    
    c is now a new vector in its own right, with value (3,0,0)
  
  - Functions that are exceptions to this are things like dot, equals and length which
  return values that are not copies or references to thing being called upon.


- TODO
  * Matrix mult function for vectors as well as scalars and matrices
  * Some aliases (like multiply) might be nice
  * Make functions that multiply other things destructive
  * We have set/getPos on the matrices but should we have rotation as well?
  * multiply / divide as well that check the types for eloquence

</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

{PXLWarning} = <span class="hljs-built_in">require</span> <span class="hljs-string">'../util/log'</span>

<span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> Float32Array?
  glMatrixArrayType = Float32Array
<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> WebGLFloatArray?
  glMatrixArrayType = WebGLFloatArray
<span class="hljs-keyword">else</span>
  glMatrixArrayType = Array</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Useful constants</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>EPSILON = <span class="hljs-number">4.37114e-05</span>
PI = <span class="hljs-number">3.14159</span>

sinx_over_x : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> x * x &lt; <span class="hljs-number">1.19209290e-07</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> Math.sin(x) / x
<span class="hljs-function">
<span class="hljs-title">radToDeg</span> = <span class="hljs-params">(a)</span> -&gt;</span>
  a * <span class="hljs-number">57.2957795</span>
<span class="hljs-function">
<span class="hljs-title">degToRad</span> = <span class="hljs-params">(a)</span> -&gt;</span>
  a * <span class="hljs-number">0.017453292523928</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>##Vec2###
A two component vector with x,y</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vec2</span></span>

  DIM : <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>@sub - static function - non destructive subtraction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @sub:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"sub"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>@add - static function - non destructive addition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @add:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"add"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>@div - static function - non destructive division.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @div:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"div"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>@mult - static function - non destructive multiplication.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>@multScalar - static function - non destructive multiplication by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>@normalize - static function - non destructive normalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @normalize:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"normalize"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>@dot - static function - return the dot product.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @dot:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.dot(b)

  constructor: <span class="hljs-function"><span class="hljs-params">(x=<span class="hljs-number">0</span>,y=<span class="hljs-number">0</span>)</span> -&gt;</span>
  	[@x,@y] = [x,y]</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>copy - make a copy of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">new</span> Vec2(@x,@y)</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>copyFrom - copy the value from another vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    @x = a.x
    @y = a.y
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>length - return the length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  length: <span class="hljs-function">-&gt;</span>
    Math.sqrt @lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>lengthSquared - return the squared length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lengthSquared: <span class="hljs-function">-&gt;</span>
    @x * @x + @y * @y</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>normalize - normalize - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize: <span class="hljs-function">-&gt;</span>
    m = @length()
    @multScalar(<span class="hljs-number">1.0</span>/m) <span class="hljs-keyword">if</span> m &gt; <span class="hljs-number">0</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>sub - subtract another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sub: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x -= v.x
    @y -= v.y
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>add - add another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x += v.x
    @y += v.y
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>dv - return a new vector being the difference between this vector and another (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dv: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec2  Math.abs(@x - v.x) Math.abs(@y - v.y)</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>dist - return the distance between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dist: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec2.sub(@,v).length()</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>distSquared - return the distance squared between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  distSquared: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec2.sub(@,v).lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>div - divide by another vector n </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  div: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y] = [@x/n.x,@y/n.y]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>mult - multiply by another vector v </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    [@x,@y] = [@x*v.x,@y*v.y]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>multScalar - multiply by a scalar n</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y] = [@x*n,@y*n]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>equals - are these two vectors equal in size/direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  equals: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x == v.x <span class="hljs-keyword">and</span> @y == v.y</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>dot - return the dot porduct between this and v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dot: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x*v.x + @y*v.y</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>invalid - is this vector actually valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invalid: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> (@x == Infinity) || isNaN(@x) || @y == Infinity || isNaN(@y)</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>flatten - used by shaders to get a nice list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  flatten: <span class="hljs-function">-&gt;</span>
    [@x,@y]</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Short-hand to set the values in one go</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set : <span class="hljs-function"><span class="hljs-params">(@x, @y)</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>##Edge2###
A container for two vertices, ordered as start and finish - directed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Edge2</span></span>

  constructor: <span class="hljs-function"><span class="hljs-params">(@start, @end)</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Convert this edge to a line in the form ax + by + c = 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  equation : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    [@start.y - @end.y, @end.x - @start.x, @start.x*@end.y - @end.x*@start.y]</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>TODO - Hold these for speed?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  sample : <span class="hljs-function"><span class="hljs-params">(x)</span> -&gt;</span>
    [a,b,c] = @equation()
    (-a*x-c) / b

  length : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @end.dist @start</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="halfedge2">HalfEdge2</h2>
<p>An edge structure that points to the two faces it is connected to
start / end are vertices and @face0, @face1 are either triangles
or quads at present</p>

            </div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>TODO - the relationship between math things and primitives is getting blurred. We need to 
sort that out.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HalfEdge2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Edge2</span></span>
  constructor : <span class="hljs-function"><span class="hljs-params">(@start, @end, @face0, @face1)</span> -&gt;</span>
    <span class="hljs-keyword">super</span>(@start, @end)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>##Vec3###
A 3 dimension vector (x,y,z)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vec3</span></span>

  DIM : <span class="hljs-number">3</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>@sub - static function - non destructive subtraction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @sub:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"sub"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>@add - static function - non destructive addition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @add:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"add"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>@cross - static function - return the cross product.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @cross:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"cross"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>@div - static function - non destructive division.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @div:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"div"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>@mult - static function - non destructive multiplication.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>@multScalar - static function - non destructive multiplication by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>@normalize - static function - non destructive normalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @normalize:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"normalize"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>@dot - static function - return the dot product.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @dot:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.dot(b)
      
  constructor: <span class="hljs-function"><span class="hljs-params">(x=<span class="hljs-number">0</span>,y=<span class="hljs-number">0</span>,z=<span class="hljs-number">0</span>)</span> -&gt;</span>
  	[@x,@y,@z] = [x,y,z]</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>copy - make a copy of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">new</span> Vec3(@x,@y,@z)</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>copyFrom - copy the value from another vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    @x = a.x
    @y = a.y
    @z = a.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>xy - a basic swizzle returning a new Vec2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  xy : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec3 @x, @y</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>length - return the length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  length: <span class="hljs-function">-&gt;</span>
    Math.sqrt @lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>lengthSquared - return the squared length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lengthSquared: <span class="hljs-function">-&gt;</span>
    @x * @x + @y * @y + @z * @z</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>normalize - normalize - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize: <span class="hljs-function">-&gt;</span>
    m = @length()
    @multScalar(<span class="hljs-number">1.0</span>/m) <span class="hljs-keyword">if</span> m &gt; <span class="hljs-number">0</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>sub - subtract another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sub: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x -= v.x
    @y -= v.y
    @z -= v.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>add - add another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x += v.x
    @y += v.y
    @z += v.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>cross - cross this vector with another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  cross: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    x = @y * v.z - @z * v.y 
    y = @z * v.x - @x * v.z 
    z = @x * v.y - @y * v.x
    @x = x
    @y = y
    @z = z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>dv - return a new vector being the difference between this vector and another (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dv: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec3  Math.abs(@x - v.x) Math.abs(@y - v.y) Math.abs(@z - v.z)</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>dist - return the distance between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dist: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec3.sub(@,v).length()</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>distSquared - return the distance squared between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  distSquared: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec3.sub(@,v).lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>div - divide by another vector n </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  div: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y,@z] = [@x/n.x,@y/n.y,@z/n.z]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>mult - multiply by another vector v </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    [@x,@y,@z] = [@x*v.x,@y*v.y,@z*v.z]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>multScalar - multiply by a scalar n</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y,@z] = [@x*n,@y*n,@z*n]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>equals - are these two vectors equal in size/direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  equals: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x == v.x <span class="hljs-keyword">and</span> @y == v.y <span class="hljs-keyword">and</span> @z == v.z</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>dot - return the dot porduct between this and v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dot: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x*v.x + @y*v.y + @z*v.z</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>invalid - is this vector actually valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invalid: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> (@x == Infinity) || isNaN(@x) || @y == Infinity || isNaN(@y) || @z == Infinity || isNaN(@z)</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>flatten - used by shaders to get a nice list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  flatten: <span class="hljs-function">-&gt;</span>
    [@x,@y,@z]</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Short-hand to set the values in one go</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set : <span class="hljs-function"><span class="hljs-params">(@x, @y, @z)</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>##Vec4###
A four dimensional vector (x,y,z,w)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Vec4</span></span>

  DIM : <span class="hljs-number">4</span></pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>@sub - static function - non destructive subtraction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @sub:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"sub"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>@add - static function - non destructive addition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @add:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"add"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>@cross - static function - return the cross product.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @cross:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"cross"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>@div - static function - non destructive division.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @div:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"div"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>@mult - static function - non destructive multiplication.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>@multScalar - static function - non destructive multiplication by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>@normalize - static function - non destructive normalization.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @normalize:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"normalize"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>@dot - static function - return the dot product.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @dot:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.dot(b)

  constructor: <span class="hljs-function"><span class="hljs-params">(x=<span class="hljs-number">0</span>,y=<span class="hljs-number">0</span>,z=<span class="hljs-number">0</span>,w=<span class="hljs-number">1</span>)</span> -&gt;</span>
  	[@x,@y,@z,@w] = [x,y,z,w]</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>copy - make a copy of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">new</span> Vec4(@x,@y,@z,@w)</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>copyFrom - copy the value from another vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    @x = a.x
    @y = a.y
    @z = a.z
    @w = a.w
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>xyz - a basic swizzle returning a new Vec3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  xyz : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec3 @x, @y, @z</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>length - return the length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  length: <span class="hljs-function">-&gt;</span>
    Math.sqrt @lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>lengthSquared - return the squared length of this vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lengthSquared: <span class="hljs-function">-&gt;</span>
    @x * @x + @y * @y + @z * @z + @w * @w</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>normalize - normalize - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize: <span class="hljs-function">-&gt;</span>
    m = @length()
    @multScalar(<span class="hljs-number">1.0</span>/m) <span class="hljs-keyword">if</span> m &gt; <span class="hljs-number">0</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>sub - subtract another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sub: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x -= v.x
    @y -= v.y
    @z -= v.z
    @w -= v.w
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>equals - are these two vectors equal in size/direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  equals: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x == v.x &amp;&amp; @y == v.y &amp;&amp; @z == v.z &amp;&amp; @w == v.w</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>add - add another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x += v.x
    @y += v.y
    @z += v.z
    @w += v.w
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>cross - cross this vector with another vector - destructive</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  cross: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>No idea what to do with W here! :S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    x = @y * v.z - @z * v.y 
    y = @z * v.x - @x * v.z 
    z = @x * v.y - @y * v.x
    @x = x
    @y = y
    @z = z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>dv - return a new vector being the difference between this vector and another (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dv: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Vec4  Math.abs(@x - v.x) Math.abs(@y - v.y) Math.abs(@z - v.z) Math.abs(@w - v.w)</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>dist - return the distance between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dist: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec4.sub(@,v).length()</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>distSquared - return the distance squared between this and another vector (v)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  distSquared: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    Vec4.sub(@,v).lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>div - divide by another vector n </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  div: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y,@z,@w] = [@x/n.x,@y/n.y,@z/n.z,@w/n.w]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>mult - multiply by another vector v </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    [@x,@y,@z,@w] = [@x*v.x,@y*v.y,@z*v.z,@w*v.w]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>multScalar - multiply by a scalar n</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    [@x,@y,@z,@w] = [@x*n,@y*n,@z*n,@w*n]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>dot - return the dot porduct between this and v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dot: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @x*v.x + @y*v.y + @z*v.z + @w*v.w</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>invalid - is this vector actually valid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invalid: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> (@x == Infinity) || isNaN(@x) || @y == Infinity || isNaN(@y) || @z == Infinity || isNaN(@z) || @w == Infinity || isNaN(@w)</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>flatten - used by shaders to get a nice list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  flatten: <span class="hljs-function">-&gt;</span>
    [@x,@y,@z,@w]</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Short-hand to set the values in one go</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set : <span class="hljs-function"><span class="hljs-params">(@x, @y, @z, @w)</span> -&gt;</span>
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>##Matrix2###
A 2x2 matrix in Column Major Format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Matrix2</span></span>

  DIM : <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>@addScalar - static function - add a scalar to every element in this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @addScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"addScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>@subScalar - static function - subtract a scalar from every element in this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @subScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"subScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>@multScalar - static function - multiply every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>@divScalar - static function - divide every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @divScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"divScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>@mult - static function - multiply this matrix by another matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <p>@multVec - static function - multiply a vector by this matrix, returning a new vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multVec: <span class="hljs-function"><span class="hljs-params">(m,v)</span>-&gt;</span>
    tv = v.copy()
    m.multVec(tv)
    tv</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              <p>@transpose - static function - return the transpose of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @transpose:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix2 [a.a[<span class="hljs-number">0</span>],a.a[<span class="hljs-number">2</span>],a.a[<span class="hljs-number">1</span>],a.a[<span class="hljs-number">3</span>]]</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>Take a list in column major format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(a=[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])</span> -&gt;</span>
    <span class="hljs-keyword">if</span> a <span class="hljs-keyword">instanceof</span> Matrix2
      @a = a.a
    <span class="hljs-keyword">else</span>
      @a = <span class="hljs-keyword">new</span> glMatrixArrayType(a)</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>copy - return a copy of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix2(@a)</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>copyFrom - copy all the values from another matrix, a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.3</span>]
      @a[i] = a.a[i]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>multScalar - multiply this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num * n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>addScalar - add a scalar to every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num + n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>subScalar - remove a scalar from every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  subScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num - n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>divScalar - divide every element by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  divScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num / n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>identity - set this matrix to be the identity matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  identity : <span class="hljs-function">-&gt;</span>
    @a.set([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>at - return the element at the row and column specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  at : <span class="hljs-function"><span class="hljs-params">(r,c)</span> -&gt;</span>
    @a[c * <span class="hljs-number">2</span> + r]</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>mult - multiply this matrix by matrix m</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(m)</span> -&gt;</span>

    a = <span class="hljs-keyword">new</span> Matrix2()

    a.a[ <span class="hljs-number">0</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">1</span>]
    a.a[ <span class="hljs-number">1</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">1</span>]
    a.a[ <span class="hljs-number">2</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">2</span>] + @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">3</span>]
    a.a[ <span class="hljs-number">3</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">2</span>] + @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">3</span>]
   
    @copyFrom(a)

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>multVec - multiply vector v by this matrix - destructive to v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multVec: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> v.z? <span class="hljs-keyword">or</span> v.w?
      PXLWarning <span class="hljs-string">"Mismatched vector and matrix dimensions"</span>
      <span class="hljs-keyword">return</span>
    x = @a[ <span class="hljs-number">0</span>]*v.x + @a[ <span class="hljs-number">2</span>]*v.y
    y = @a[ <span class="hljs-number">1</span>]*v.x + @a[ <span class="hljs-number">3</span>]*v.y

    v.x = x
    v.y = y
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>getCol - return a column from this matrix as a Vec2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getCol: <span class="hljs-function"><span class="hljs-params">(c)</span>-&gt;</span>
    c = c * Matrix2.DIM
    Vec2 @a[c + <span class="hljs-number">0</span>] @a[c + <span class="hljs-number">1</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>getRow - return a row from this matrix as a Vec2</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getRow: <span class="hljs-function"><span class="hljs-params">(r)</span> -&gt;</span>
    Vec2 @a[r + <span class="hljs-number">0</span>] @a[r + <span class="hljs-number">2</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>transpose - transpose this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  transpose : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @copyFrom <span class="hljs-keyword">new</span> Matrix2 [@a[<span class="hljs-number">0</span>],a[<span class="hljs-number">2</span>],@a[<span class="hljs-number">1</span>],@a[<span class="hljs-number">3</span>]]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>print - print this matrix to the console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  print: <span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">0</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">2</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">1</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">3</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>rotate - given an angle in radians, set this as a rotation matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rotate: <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>

    r = <span class="hljs-keyword">new</span> Matrix2()
    s = Math.sin a
    c = Math.cos a
   
    r.a[<span class="hljs-number">0</span>] = c
    r.a[<span class="hljs-number">1</span>] = s
    r.a[<span class="hljs-number">2</span>] = -s
    r.a[<span class="hljs-number">3</span>] = c

    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>scale - given a Vec3, create a scaling matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  scale: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>Leave w</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    r = <span class="hljs-keyword">new</span> Matrix3()
    r.a[<span class="hljs-number">0</span>] = v.x
    r.a[<span class="hljs-number">4</span>] = v.y
    r.a[<span class="hljs-number">8</span>] = v.z
    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>##Matrix3###
A 3x3 matrix in Column Major Format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Matrix3</span></span>

  DIM : <span class="hljs-number">3</span></pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>TODO - Euler x,y,z rotations needed? Probably not! :S</p>

            </div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>@addScalar - static function - add a scalar to every element in this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @addScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"addScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>@subScalar - static function - subtract a scalar from every element in this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @subScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"subScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>@multScalar - static function - multiply every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>@divScalar - static function - divide every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @divScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"divScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>@mult - static function - multiply this matrix by another matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>@invert - static function - return the inverse of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @invert:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a[<span class="hljs-string">"_invert"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>@multVec - static function - multiply a vector by this matrix, returning a new vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multVec: <span class="hljs-function"><span class="hljs-params">(m,v)</span>-&gt;</span>
    tv = v.copy()
    m.multVec(tv)
    tv</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>@transpose - static function - return the transpose of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @transpose:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix3([ a.a.a.a[<span class="hljs-number">0</span>],a.a[<span class="hljs-number">3</span>],a.a[<span class="hljs-number">6</span>],a.a[<span class="hljs-number">1</span>],a.a[<span class="hljs-number">4</span>],a.a[<span class="hljs-number">7</span>],a.a[<span class="hljs-number">2</span>],a.a[<span class="hljs-number">5</span>],a.a[<span class="hljs-number">8</span>]])</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <p>Take a list in column major format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(a=[<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">1.0</span>])</span> -&gt;</span>
    <span class="hljs-keyword">if</span> a <span class="hljs-keyword">instanceof</span> Matrix3
      @a = a.a
    <span class="hljs-keyword">else</span>
      @a = <span class="hljs-keyword">new</span> glMatrixArrayType(a)</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              <p>copy - return a copy of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix3(@a)</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>copyFrom - copy all the values from another matrix, a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.8</span>]
      @a[i] = a.a[i]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>multScalar - multiply this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num * n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>addScalar - add a scalar to every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num + n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>subScalar - remove a scalar from every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  subScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num - n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>divScalar - divide every element by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  divScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num / n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>identity - set this matrix to be the identity matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  identity : <span class="hljs-function">-&gt;</span>
    @a.set([<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">1.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">0.0</span>,<span class="hljs-number">1.0</span>])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>at - return the element at the row and column specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  at : <span class="hljs-function"><span class="hljs-params">(r,c)</span> -&gt;</span>
    @a[c * <span class="hljs-number">3</span> + r]</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>mult - multiply this matrix by matrix m</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(m)</span> -&gt;</span>

    a = <span class="hljs-keyword">new</span> Matrix3()

    a.a[ <span class="hljs-number">0</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">1</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">2</span>]
    a.a[ <span class="hljs-number">1</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">1</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">2</span>]
    a.a[ <span class="hljs-number">2</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">1</span>] + @a[ <span class="hljs-number">8</span>]*m.a[ <span class="hljs-number">2</span>]
   
    
    a.a[ <span class="hljs-number">3</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">3</span>] + @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">5</span>]
    a.a[ <span class="hljs-number">4</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">3</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">5</span>]
    a.a[ <span class="hljs-number">5</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">3</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">8</span>]*m.a[ <span class="hljs-number">5</span>]
   
    
    a.a[ <span class="hljs-number">6</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">6</span>] + @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">7</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">8</span>]
    a.a[ <span class="hljs-number">7</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">6</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">7</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">8</span>]
    a.a[ <span class="hljs-number">8</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">6</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">7</span>] + @a[ <span class="hljs-number">8</span>]*m.a[ <span class="hljs-number">8</span>]
   
    @copyFrom(a)

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>multVec - multiply vector v by this matrix - destructive to v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multVec: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> v.z? <span class="hljs-keyword">or</span> v.w?
      PXLWarning <span class="hljs-string">"Mismatched vector and matrix dimensions"</span>
      <span class="hljs-keyword">return</span>
    x = @a[ <span class="hljs-number">0</span>]*v.x + @a[ <span class="hljs-number">3</span>]*v.y + @a[ <span class="hljs-number">6</span>]*v.z
    y = @a[ <span class="hljs-number">1</span>]*v.x + @a[ <span class="hljs-number">4</span>]*v.y + @a[ <span class="hljs-number">7</span>]*v.z
    z = @a[ <span class="hljs-number">2</span>]*v.x + @a[ <span class="hljs-number">5</span>]*v.y + @a[ <span class="hljs-number">8</span>]*v.z

    v.x = x
    v.y = y
    v.z = z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>getCol - return a column from this matrix as a Vec3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getCol: <span class="hljs-function"><span class="hljs-params">(c)</span>-&gt;</span>
    c = c * Matrix3.DIM
    Vec3 @a[c + <span class="hljs-number">0</span>] @a[c + <span class="hljs-number">1</span>] @a[c + <span class="hljs-number">2</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>getRow - return a row from this matrix as a Vec3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getRow: <span class="hljs-function"><span class="hljs-params">(r)</span> -&gt;</span>
    Vec3 @a[r + <span class="hljs-number">0</span>] @a[r + <span class="hljs-number">3</span>] @a[r + <span class="hljs-number">6</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>_invert - invert this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _invert: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    inv = <span class="hljs-keyword">new</span> Matrix3()
    epsilon = <span class="hljs-number">4.37114e-05</span>
    inv.a[<span class="hljs-number">0</span>] = @a[<span class="hljs-number">4</span>] * @a[<span class="hljs-number">8</span>] - @a[<span class="hljs-number">5</span>] * @a[<span class="hljs-number">7</span>]
    inv.a[<span class="hljs-number">1</span>] = @a[<span class="hljs-number">2</span>] * @a[<span class="hljs-number">7</span>] - @a[<span class="hljs-number">1</span>] * @a[<span class="hljs-number">8</span>]
    inv.a[<span class="hljs-number">2</span>] = @a[<span class="hljs-number">1</span>] * @a[<span class="hljs-number">5</span>] - @a[<span class="hljs-number">2</span>] * @a[<span class="hljs-number">4</span>]
    inv.a[<span class="hljs-number">3</span>] = @a[<span class="hljs-number">5</span>] * @a[<span class="hljs-number">6</span>] - @a[<span class="hljs-number">3</span>] * @a[<span class="hljs-number">8</span>]
    inv.a[<span class="hljs-number">4</span>] = @a[<span class="hljs-number">0</span>] * @a[<span class="hljs-number">8</span>] - @a[<span class="hljs-number">2</span>] * @a[<span class="hljs-number">6</span>]
    inv.a[<span class="hljs-number">5</span>] = @a[<span class="hljs-number">2</span>] * @a[<span class="hljs-number">3</span>] - @a[<span class="hljs-number">0</span>] * @a[<span class="hljs-number">5</span>]
    inv.a[<span class="hljs-number">6</span>] = @a[<span class="hljs-number">3</span>] * @a[<span class="hljs-number">7</span>] - @a[<span class="hljs-number">4</span>] * @a[<span class="hljs-number">6</span>]
    inv.a[<span class="hljs-number">7</span>] = @a[<span class="hljs-number">1</span>] * @a[<span class="hljs-number">6</span>] - @a[<span class="hljs-number">0</span>] * @a[<span class="hljs-number">7</span>]
    inv.a[<span class="hljs-number">8</span>] = @a[<span class="hljs-number">0</span>] * @a[<span class="hljs-number">4</span>] - @a[<span class="hljs-number">1</span>] * @a[<span class="hljs-number">3</span>]

    det  = @a[<span class="hljs-number">0</span>] * inv.a[<span class="hljs-number">0</span>] + @a[<span class="hljs-number">1</span>] * inv.a[<span class="hljs-number">3</span>] + @a[<span class="hljs-number">2</span>] * inv.a[<span class="hljs-number">6</span>]

    <span class="hljs-keyword">if</span> Math.abs(det) &gt; epsilon
      invDet = <span class="hljs-number">1.0</span> / det
      inv.multScalar(invDet)
    inv</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>invert - invert this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invert: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @copyFrom @_invert()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>transpose - transpose this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  transpose : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @copyFrom <span class="hljs-keyword">new</span> Matrix3([@a[<span class="hljs-number">0</span>],@a[<span class="hljs-number">3</span>],@a[<span class="hljs-number">6</span>], @a[<span class="hljs-number">1</span>],@a[<span class="hljs-number">4</span>],@a[<span class="hljs-number">7</span>], @a[<span class="hljs-number">2</span>],@a[<span class="hljs-number">5</span>],@a[<span class="hljs-number">8</span>]])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>print - print this matrix to the console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  print: <span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">0</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">3</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">6</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">1</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">4</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">7</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">2</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">5</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">8</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>rotate - given a Vec3 and an angle in radians, create a rotation matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rotate: <span class="hljs-function"><span class="hljs-params">(v,a)</span> -&gt;</span>

    r = <span class="hljs-keyword">new</span> Matrix3()
    s = Math.sin a
    c = Math.cos a
    v.normalize()

    r.a[<span class="hljs-number">0</span>] = v.x * v.x * (<span class="hljs-number">1</span>-c) + c
    r.a[<span class="hljs-number">1</span>] = v.x * v.y * (<span class="hljs-number">1</span>-c) + v.z * s
    r.a[<span class="hljs-number">2</span>] = v.x * v.z * (<span class="hljs-number">1</span>-c) - v.y * s
    
    r.a[<span class="hljs-number">3</span>] = v.x * v.y * (<span class="hljs-number">1</span>-c) - v.z * s
    r.a[<span class="hljs-number">4</span>] = v.y * v.y * (<span class="hljs-number">1</span>-c) + c
    r.a[<span class="hljs-number">5</span>] = v.y * v.z * (<span class="hljs-number">1</span>-c) + v.x * s

    r.a[<span class="hljs-number">6</span>] = v.x * v.z * (<span class="hljs-number">1</span>-c) + v.y * s
    r.a[<span class="hljs-number">7</span>] = v.y * v.z * (<span class="hljs-number">1</span>-c) - v.x * s
    r.a[<span class="hljs-number">8</span>]= v.z * v.z * (<span class="hljs-number">1</span>-c) + c

    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>scale - given a Vec3, create a scaling matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  scale: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>Leave w</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    r = <span class="hljs-keyword">new</span> Matrix3()
    r.a[<span class="hljs-number">0</span>] = v.x
    r.a[<span class="hljs-number">4</span>] = v.y
    r.a[<span class="hljs-number">8</span>] = v.z
    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>##Matrix4###
Our 4x4 matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Matrix4</span></span>
  DIM : <span class="hljs-number">4</span></pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>TODO - Euler x,y,z rotations needed? Probably not! :S</p>

            </div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>@addScalar - static function - adds a scalar to every element in the matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @addScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"addScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>@subScalar - static function - subtract a scalar from every element in this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @subScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"subScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>@multScalar - static function - multiply every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>@divScalar - static function - divide every element in this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @divScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"divScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>@mult - static function - multiply this matrix by another matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>@invert - static function - return the inverse of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @invert:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a[<span class="hljs-string">"_invert"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <p>@transpose - static function - return the transpose of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @transpose:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix4( [ a.a[<span class="hljs-number">0</span>], a.a[<span class="hljs-number">4</span>], a.a[<span class="hljs-number">8</span>], a.a[<span class="hljs-number">12</span>], a.a[<span class="hljs-number">1</span>], a.a[<span class="hljs-number">5</span>], a.a[<span class="hljs-number">9</span>], a.a[<span class="hljs-number">13</span>], a.a[<span class="hljs-number">2</span>], a.a[<span class="hljs-number">6</span>], a.a[<span class="hljs-number">10</span>], a.a[<span class="hljs-number">14</span>], a.a[<span class="hljs-number">3</span>], a.a[<span class="hljs-number">7</span>], a.a[<span class="hljs-number">11</span>], a.a[<span class="hljs-number">15</span>] ] )</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              <p>@multVec - static function - multiply a vector by this matrix, returning a new vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multVec: <span class="hljs-function"><span class="hljs-params">(m,v)</span>-&gt;</span>
    tv = v.copy()
    m.multVec(tv)
    tv</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Take a list in column major format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(a=[<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>todo - add checking</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> a <span class="hljs-keyword">instanceof</span> Matrix4
      @a = a.a
    <span class="hljs-keyword">else</span>
      @a = <span class="hljs-keyword">new</span> glMatrixArrayType(a)</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>copy - return a copy of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix4(@a)</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>copyFrom - copy all the values from another matrix, a</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.15</span>]
      @a[i] = a.a[i]
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>multScalar - multiply this matrix by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num * n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>addScalar - add a scalar to every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  addScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num + n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>subScalar - remove a scalar from every element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  subScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num - n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>divScalar - divide every element by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  divScalar: <span class="hljs-function"><span class="hljs-params">(n)</span> -&gt;</span>
    @a = ( num / n <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> @a)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>identity - set this matrix to be the identity matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  identity : <span class="hljs-function">-&gt;</span>
    @a.set([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>at - return the element at the row and column specified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  at : <span class="hljs-function"><span class="hljs-params">(r,c)</span> -&gt;</span>
    @a[c * <span class="hljs-number">4</span> + r]</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>getMatrix3 - return the 3x3 matrix from this 4x4 - top left part</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getMatrix3 : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Matrix3([ @a[<span class="hljs-number">0</span>],@a[<span class="hljs-number">1</span>],@a[<span class="hljs-number">2</span>],@a[<span class="hljs-number">4</span>],@a[<span class="hljs-number">5</span>],@a[<span class="hljs-number">6</span>],@a[<span class="hljs-number">8</span>],@a[<span class="hljs-number">9</span>],@a[<span class="hljs-number">10</span>]])</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>mult - multiply this matrix by matrix m
TODO - I wonder if this is the fastest, best way? Probably not &gt;&lt; Not in place :S</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(m)</span> -&gt;</span>
    a = <span class="hljs-keyword">new</span> Matrix4()
    a.a[ <span class="hljs-number">0</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">1</span>] + @a[ <span class="hljs-number">8</span>]*m.a[ <span class="hljs-number">2</span>] + @a[<span class="hljs-number">12</span>]*m.a[ <span class="hljs-number">3</span>]
    a.a[ <span class="hljs-number">1</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">1</span>] + @a[ <span class="hljs-number">9</span>]*m.a[ <span class="hljs-number">2</span>] + @a[<span class="hljs-number">13</span>]*m.a[ <span class="hljs-number">3</span>]
    a.a[ <span class="hljs-number">2</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">1</span>] + @a[<span class="hljs-number">10</span>]*m.a[ <span class="hljs-number">2</span>] + @a[<span class="hljs-number">14</span>]*m.a[ <span class="hljs-number">3</span>]
    a.a[ <span class="hljs-number">3</span>] = @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">0</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">1</span>] + @a[<span class="hljs-number">11</span>]*m.a[ <span class="hljs-number">2</span>] + @a[<span class="hljs-number">15</span>]*m.a[ <span class="hljs-number">3</span>]
    
    a.a[ <span class="hljs-number">4</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">5</span>] + @a[ <span class="hljs-number">8</span>]*m.a[ <span class="hljs-number">6</span>] + @a[<span class="hljs-number">12</span>]*m.a[ <span class="hljs-number">7</span>]
    a.a[ <span class="hljs-number">5</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">5</span>] + @a[ <span class="hljs-number">9</span>]*m.a[ <span class="hljs-number">6</span>] + @a[<span class="hljs-number">13</span>]*m.a[ <span class="hljs-number">7</span>]
    a.a[ <span class="hljs-number">6</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">5</span>] + @a[<span class="hljs-number">10</span>]*m.a[ <span class="hljs-number">6</span>] + @a[<span class="hljs-number">14</span>]*m.a[ <span class="hljs-number">7</span>]
    a.a[ <span class="hljs-number">7</span>] = @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">4</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">5</span>] + @a[<span class="hljs-number">11</span>]*m.a[ <span class="hljs-number">6</span>] + @a[<span class="hljs-number">15</span>]*m.a[ <span class="hljs-number">7</span>]
    
    a.a[ <span class="hljs-number">8</span>] = @a[ <span class="hljs-number">0</span>]*m.a[ <span class="hljs-number">8</span>] + @a[ <span class="hljs-number">4</span>]*m.a[ <span class="hljs-number">9</span>] + @a[ <span class="hljs-number">8</span>]*m.a[<span class="hljs-number">10</span>] + @a[<span class="hljs-number">12</span>]*m.a[<span class="hljs-number">11</span>]
    a.a[ <span class="hljs-number">9</span>] = @a[ <span class="hljs-number">1</span>]*m.a[ <span class="hljs-number">8</span>] + @a[ <span class="hljs-number">5</span>]*m.a[ <span class="hljs-number">9</span>] + @a[ <span class="hljs-number">9</span>]*m.a[<span class="hljs-number">10</span>] + @a[<span class="hljs-number">13</span>]*m.a[<span class="hljs-number">11</span>]
    a.a[<span class="hljs-number">10</span>] = @a[ <span class="hljs-number">2</span>]*m.a[ <span class="hljs-number">8</span>] + @a[ <span class="hljs-number">6</span>]*m.a[ <span class="hljs-number">9</span>] + @a[<span class="hljs-number">10</span>]*m.a[<span class="hljs-number">10</span>] + @a[<span class="hljs-number">14</span>]*m.a[<span class="hljs-number">11</span>]
    a.a[<span class="hljs-number">11</span>] = @a[ <span class="hljs-number">3</span>]*m.a[ <span class="hljs-number">8</span>] + @a[ <span class="hljs-number">7</span>]*m.a[ <span class="hljs-number">9</span>] + @a[<span class="hljs-number">11</span>]*m.a[<span class="hljs-number">10</span>] + @a[<span class="hljs-number">15</span>]*m.a[<span class="hljs-number">11</span>]
    
    a.a[<span class="hljs-number">12</span>] = @a[ <span class="hljs-number">0</span>]*m.a[<span class="hljs-number">12</span>] + @a[ <span class="hljs-number">4</span>]*m.a[<span class="hljs-number">13</span>] + @a[ <span class="hljs-number">8</span>]*m.a[<span class="hljs-number">14</span>] + @a[<span class="hljs-number">12</span>]*m.a[<span class="hljs-number">15</span>]
    a.a[<span class="hljs-number">13</span>] = @a[ <span class="hljs-number">1</span>]*m.a[<span class="hljs-number">12</span>] + @a[ <span class="hljs-number">5</span>]*m.a[<span class="hljs-number">13</span>] + @a[ <span class="hljs-number">9</span>]*m.a[<span class="hljs-number">14</span>] + @a[<span class="hljs-number">13</span>]*m.a[<span class="hljs-number">15</span>]
    a.a[<span class="hljs-number">14</span>] = @a[ <span class="hljs-number">2</span>]*m.a[<span class="hljs-number">12</span>] + @a[ <span class="hljs-number">6</span>]*m.a[<span class="hljs-number">13</span>] + @a[<span class="hljs-number">10</span>]*m.a[<span class="hljs-number">14</span>] + @a[<span class="hljs-number">14</span>]*m.a[<span class="hljs-number">15</span>]
    a.a[<span class="hljs-number">15</span>] = @a[ <span class="hljs-number">3</span>]*m.a[<span class="hljs-number">12</span>] + @a[ <span class="hljs-number">7</span>]*m.a[<span class="hljs-number">13</span>] + @a[<span class="hljs-number">11</span>]*m.a[<span class="hljs-number">14</span>] + @a[<span class="hljs-number">15</span>]*m.a[<span class="hljs-number">15</span>]

    @copyFrom(a)

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>multVec - multiply vector v by this matrix - destructive to v</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multVec: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> v.z?
      PXLWarning <span class="hljs-string">"Mismatched vector and matrix dimensions"</span>
      <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> v.w?
      x = @a[ <span class="hljs-number">0</span>]*v.x + @a[ <span class="hljs-number">4</span>]*v.y + @a[ <span class="hljs-number">8</span>]*v.z + @a[<span class="hljs-number">12</span>]
      y = @a[ <span class="hljs-number">1</span>]*v.x + @a[ <span class="hljs-number">5</span>]*v.y + @a[ <span class="hljs-number">9</span>]*v.z + @a[<span class="hljs-number">13</span>]
      z = @a[ <span class="hljs-number">2</span>]*v.x + @a[ <span class="hljs-number">6</span>]*v.y + @a[<span class="hljs-number">10</span>]*v.z + @a[<span class="hljs-number">14</span>]
      w = @a[ <span class="hljs-number">3</span>]*v.x + @a[ <span class="hljs-number">7</span>]*v.y + @a[<span class="hljs-number">11</span>]*v.z + @a[<span class="hljs-number">15</span>] 
      v.x = x/w
      v.y = y/w
      v.z = z/w
    <span class="hljs-keyword">else</span>
      x = @a[ <span class="hljs-number">0</span>]*v.x + @a[ <span class="hljs-number">4</span>]*v.y + @a[ <span class="hljs-number">8</span>]*v.z + @a[<span class="hljs-number">12</span>] * v.w
      y = @a[ <span class="hljs-number">1</span>]*v.x + @a[ <span class="hljs-number">5</span>]*v.y + @a[ <span class="hljs-number">9</span>]*v.z + @a[<span class="hljs-number">13</span>] * v.w
      z = @a[ <span class="hljs-number">2</span>]*v.x + @a[ <span class="hljs-number">6</span>]*v.y + @a[<span class="hljs-number">10</span>]*v.z + @a[<span class="hljs-number">14</span>] * v.w
      w = @a[ <span class="hljs-number">3</span>]*v.x + @a[ <span class="hljs-number">7</span>]*v.y + @a[<span class="hljs-number">11</span>]*v.z + @a[<span class="hljs-number">15</span>] * v.w
      v.x = x
      v.y = y
      v.z = z
      v.w = w
    @



  at: <span class="hljs-function"><span class="hljs-params">(r,c)</span> -&gt;</span>
    @a[c * <span class="hljs-number">4</span> + r]</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>getCol - return a column from this matrix as a Vec4</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getCol: <span class="hljs-function"><span class="hljs-params">(c)</span>-&gt;</span>
    c = c * <span class="hljs-number">4</span>
    Vec4 @a[c + <span class="hljs-number">0</span>] @a[c + <span class="hljs-number">1</span>] @a[c + <span class="hljs-number">2</span>] @a[c + <span class="hljs-number">3</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>getRow - return a row from this matrix as a Vec4</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getRow: <span class="hljs-function"><span class="hljs-params">(r)</span> -&gt;</span>
    Vec4 @a[r + <span class="hljs-number">0</span>] @a[r + <span class="hljs-number">4</span>] @a[r + <span class="hljs-number">8</span>] @a[r + <span class="hljs-number">12</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>_invert - invert this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _invert : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    inv = <span class="hljs-keyword">new</span> Matrix4()
    epsilon = <span class="hljs-number">4.37114e-05</span>

    a0 = @a[ <span class="hljs-number">0</span>]*@a[ <span class="hljs-number">5</span>] - @a[ <span class="hljs-number">1</span>]*@a[<span class="hljs-number">4</span>]
    a1 = @a[ <span class="hljs-number">0</span>]*@a[ <span class="hljs-number">6</span>] - @a[ <span class="hljs-number">2</span>]*@a[ <span class="hljs-number">4</span>]
    a2 = @a[ <span class="hljs-number">0</span>]*@a[ <span class="hljs-number">7</span>] - @a[ <span class="hljs-number">3</span>]*@a[ <span class="hljs-number">4</span>]
    a3 = @a[ <span class="hljs-number">1</span>]*@a[ <span class="hljs-number">6</span>] - @a[ <span class="hljs-number">2</span>]*@a[ <span class="hljs-number">5</span>]
    a4 = @a[ <span class="hljs-number">1</span>]*@a[ <span class="hljs-number">7</span>] - @a[ <span class="hljs-number">3</span>]*@a[ <span class="hljs-number">5</span>]
    a5 = @a[ <span class="hljs-number">2</span>]*@a[ <span class="hljs-number">7</span>] - @a[ <span class="hljs-number">3</span>]*@a[ <span class="hljs-number">6</span>]
    b0 = @a[ <span class="hljs-number">8</span>]*@a[<span class="hljs-number">13</span>] - @a[ <span class="hljs-number">9</span>]*@a[<span class="hljs-number">12</span>]
    b1 = @a[ <span class="hljs-number">8</span>]*@a[<span class="hljs-number">14</span>] - @a[<span class="hljs-number">10</span>]*@a[<span class="hljs-number">12</span>]
    b2 = @a[ <span class="hljs-number">8</span>]*@a[<span class="hljs-number">15</span>] - @a[<span class="hljs-number">11</span>]*@a[<span class="hljs-number">12</span>]
    b3 = @a[ <span class="hljs-number">9</span>]*@a[<span class="hljs-number">14</span>] - @a[<span class="hljs-number">10</span>]*@a[<span class="hljs-number">13</span>]
    b4 = @a[ <span class="hljs-number">9</span>]*@a[<span class="hljs-number">15</span>] - @a[<span class="hljs-number">11</span>]*@a[<span class="hljs-number">13</span>]
    b5 = @a[<span class="hljs-number">10</span>]*@a[<span class="hljs-number">15</span>] - @a[<span class="hljs-number">11</span>]*@a[<span class="hljs-number">14</span>]

    det = a0*b5 - a1*b4 + a2*b3 + a3*b2 - a4*b1 + a5*b0

    <span class="hljs-keyword">if</span>  Math.abs( det ) &gt; epsilon
      inv.a[ <span class="hljs-number">0</span>] = + @a[ <span class="hljs-number">5</span>]*b5 - @a[ <span class="hljs-number">6</span>]*b4 + @a[ <span class="hljs-number">7</span>]*b3
      inv.a[ <span class="hljs-number">4</span>] = - @a[ <span class="hljs-number">4</span>]*b5 + @a[ <span class="hljs-number">6</span>]*b2 - @a[ <span class="hljs-number">7</span>]*b1
      inv.a[ <span class="hljs-number">8</span>] = + @a[ <span class="hljs-number">4</span>]*b4 - @a[ <span class="hljs-number">5</span>]*b2 + @a[ <span class="hljs-number">7</span>]*b0
      inv.a[<span class="hljs-number">12</span>] = - @a[ <span class="hljs-number">4</span>]*b3 + @a[ <span class="hljs-number">5</span>]*b1 - @a[ <span class="hljs-number">6</span>]*b0
      inv.a[ <span class="hljs-number">1</span>] = - @a[ <span class="hljs-number">1</span>]*b5 + @a[ <span class="hljs-number">2</span>]*b4 - @a[ <span class="hljs-number">3</span>]*b3
      inv.a[ <span class="hljs-number">5</span>] = + @a[ <span class="hljs-number">0</span>]*b5 - @a[ <span class="hljs-number">2</span>]*b2 + @a[ <span class="hljs-number">3</span>]*b1
      inv.a[ <span class="hljs-number">9</span>] = - @a[ <span class="hljs-number">0</span>]*b4 + @a[ <span class="hljs-number">1</span>]*b2 - @a[ <span class="hljs-number">3</span>]*b0
      inv.a[<span class="hljs-number">13</span>] = + @a[ <span class="hljs-number">0</span>]*b3 - @a[ <span class="hljs-number">1</span>]*b1 + @a[ <span class="hljs-number">2</span>]*b0
      inv.a[ <span class="hljs-number">2</span>] = + @a[<span class="hljs-number">13</span>]*a5 - @a[<span class="hljs-number">14</span>]*a4 + @a[<span class="hljs-number">15</span>]*a3
      inv.a[ <span class="hljs-number">6</span>] = - @a[<span class="hljs-number">12</span>]*a5 + @a[<span class="hljs-number">14</span>]*a2 - @a[<span class="hljs-number">15</span>]*a1
      inv.a[<span class="hljs-number">10</span>] = + @a[<span class="hljs-number">12</span>]*a4 - @a[<span class="hljs-number">13</span>]*a2 + @a[<span class="hljs-number">15</span>]*a0
      inv.a[<span class="hljs-number">14</span>] = - @a[<span class="hljs-number">12</span>]*a3 + @a[<span class="hljs-number">13</span>]*a1 - @a[<span class="hljs-number">14</span>]*a0
      inv.a[ <span class="hljs-number">3</span>] = - @a[ <span class="hljs-number">9</span>]*a5 + @a[<span class="hljs-number">10</span>]*a4 - @a[<span class="hljs-number">11</span>]*a3
      inv.a[ <span class="hljs-number">7</span>] = + @a[ <span class="hljs-number">8</span>]*a5 - @a[<span class="hljs-number">10</span>]*a2 + @a[<span class="hljs-number">11</span>]*a1
      inv.a[<span class="hljs-number">11</span>] = - @a[ <span class="hljs-number">8</span>]*a4 + @a[ <span class="hljs-number">9</span>]*a2 - @a[<span class="hljs-number">11</span>]*a0
      inv.a[<span class="hljs-number">15</span>] = + @a[ <span class="hljs-number">8</span>]*a3 - @a[ <span class="hljs-number">9</span>]*a1 + @a[<span class="hljs-number">10</span>]*a0

    invDet = <span class="hljs-number">1.0</span>/det

    inv.multScalar(invDet)
    inv</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>invert - invert this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invert: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @copyFrom @_invert() 
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>transpose - transpose this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  transpose : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @copyFrom <span class="hljs-keyword">new</span> Matrix4( [ @a[<span class="hljs-number">0</span>],@a[<span class="hljs-number">4</span>],@a[<span class="hljs-number">8</span>],@a[<span class="hljs-number">12</span>],@a[<span class="hljs-number">1</span>],@a[<span class="hljs-number">5</span>],@a[<span class="hljs-number">9</span>],@a[<span class="hljs-number">13</span>],@a[<span class="hljs-number">2</span>],@a[<span class="hljs-number">6</span>],@a[<span class="hljs-number">10</span>],@a[<span class="hljs-number">14</span>],@a[<span class="hljs-number">3</span>],@a[<span class="hljs-number">7</span>],@a[<span class="hljs-number">11</span>],@a[<span class="hljs-number">15</span>] ] )
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>translate - multiple this matrix by a translation matrix, formed from the Vec3 v
TODO - Here is a good example of having a debug build as oppose to a debug flag!</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  translate: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> v.DIM? 
      <span class="hljs-keyword">if</span> v.DIM != <span class="hljs-number">3</span>
        PXLWarning <span class="hljs-string">"Mismatched vector and matrix dimensions"</span>
        <span class="hljs-keyword">return</span> @

    r = <span class="hljs-keyword">new</span> Matrix4()
    r.a[<span class="hljs-number">12</span>] = v.x
    r.a[<span class="hljs-number">13</span>] = v.y
    r.a[<span class="hljs-number">14</span>] = v.z
    @mult(r)
      
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>setPos - Given a vector, sets the translation part of the matrix directly with no multiplication</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setPos : <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
    @a[<span class="hljs-number">12</span>] = v.x <span class="hljs-keyword">if</span> v.x?
    @a[<span class="hljs-number">13</span>] = v.y <span class="hljs-keyword">if</span> v.y?
    @a[<span class="hljs-number">14</span>] = v.z <span class="hljs-keyword">if</span> v.z?
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>getPos - return the translation component as a Vec3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getPos : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Vec3 @a[<span class="hljs-number">12</span>],@a[<span class="hljs-number">13</span>],@a[<span class="hljs-number">14</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>print - print this matrix to the console</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  print: <span class="hljs-function"><span class="hljs-params">()</span>-&gt;</span>
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">0</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">4</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">8</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">12</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">1</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">5</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">9</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">13</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">2</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">6</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">10</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">14</span>]
    <span class="hljs-built_in">console</span>.log @a[<span class="hljs-number">3</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">7</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">11</span>] + <span class="hljs-string">","</span> + @a[<span class="hljs-number">15</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>lookAt - similar to gluLookAt - creates a matrix from an eye, look and up vector (Vec3)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lookAt: <span class="hljs-function"><span class="hljs-params">(eye,look,up)</span> -&gt;</span>

    f = Vec3.sub(look,eye)
    f.normalize()
    u = up.copy()
    u.normalize()

    s = Vec3.cross(f,u)
    w = Vec3.cross(s,f)

    m = <span class="hljs-keyword">new</span> Matrix4([s.x,u.x,-f.x,<span class="hljs-number">0</span>,s.y,u.y,-f.y,<span class="hljs-number">0</span>,s.z,u.z,-f.z,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])
    t = <span class="hljs-keyword">new</span> Matrix4([<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>, -eye.x,-eye.y,-eye.z,<span class="hljs-number">1</span>])

    m.mult(t)
    @copyFrom(m)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>makePerspective - given a field-of-view in degrees, an aspect ratio (w/h) and near and far clip planes
create a perspective matrix
TODO - Should we not use Radians here a we are using radians everywhere else?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  makePerspective: <span class="hljs-function"><span class="hljs-params">(fovy,aspect,znear,zfar)</span> -&gt;</span>
    ymax = znear * Math.tan(fovy * Math.PI / <span class="hljs-number">360.0</span>)
    ymin = -ymax;
    xmin = ymin * aspect
    xmax = ymax * aspect
    @makeFrustum(xmin, xmax, ymin, ymax, znear, zfar)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>makeFrustum - used by makePerspective to create our frustrum </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  makeFrustum: <span class="hljs-function"><span class="hljs-params">(left, right,bottom, top, znear, zfar)</span> -&gt;</span>
    x = <span class="hljs-number">2</span>*znear/(right-left)
    y = <span class="hljs-number">2</span>*znear/(top-bottom)
    a = (right+left)/(right-left)
    b = (top+bottom)/(top-bottom)
    c = -(zfar+znear)/(zfar-znear)
    d = <span class="hljs-number">-2</span>*zfar*znear/(zfar-znear)
    @a = <span class="hljs-keyword">new</span> glMatrixArrayType([x,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,y,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,a,b,c,<span class="hljs-number">-1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,d,<span class="hljs-number">0</span>])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>makeOrtho - given left,right,bottom,top, near and far floats, create an orthographic projection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  makeOrtho: <span class="hljs-function"><span class="hljs-params">(left, right, bottom, top, znear, zfar)</span> -&gt;</span>
    tx = - (right + left) / (right - left)
    ty = - (top + bottom) / (top - bottom)
    tz = - (zfar + znear) / (zfar - znear)
    @a = <span class="hljs-keyword">new</span> glMatrixArrayType([<span class="hljs-number">2</span> / (right - left),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">2</span> / (top-bottom),<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>, <span class="hljs-number">-2</span> / (zfar - znear),<span class="hljs-number">0</span>,tx,ty,tz,<span class="hljs-number">1</span>])
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>rotate - given a vector and an angle (radians), create the rotation part of this matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  rotate: <span class="hljs-function"><span class="hljs-params">(v,a)</span> -&gt;</span>

    r = <span class="hljs-keyword">new</span> Matrix4()
    s = Math.sin(a)
    c = Math.cos(a)
    v.normalize()

    r.a[<span class="hljs-number">0</span>] = v.x * v.x * (<span class="hljs-number">1</span>-c) + c
    r.a[<span class="hljs-number">1</span>] = v.x * v.y * (<span class="hljs-number">1</span>-c) + v.z * s
    r.a[<span class="hljs-number">2</span>] = v.x * v.z * (<span class="hljs-number">1</span>-c) - v.y * s
    
    r.a[<span class="hljs-number">4</span>] = v.x * v.y * (<span class="hljs-number">1</span>-c) - v.z * s
    r.a[<span class="hljs-number">5</span>] = v.y * v.y * (<span class="hljs-number">1</span>-c) + c
    r.a[<span class="hljs-number">6</span>] = v.y * v.z * (<span class="hljs-number">1</span>-c) + v.x * s

    r.a[<span class="hljs-number">8</span>] = v.x * v.z * (<span class="hljs-number">1</span>-c) + v.y * s
    r.a[<span class="hljs-number">9</span>] = v.y * v.z * (<span class="hljs-number">1</span>-c) - v.x * s
    r.a[<span class="hljs-number">10</span>]= v.z * v.z * (<span class="hljs-number">1</span>-c) + c
  
    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>scale - scale our matrix by a Vec3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  scale: <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Leave w</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    r = <span class="hljs-keyword">new</span> Matrix4()
    r.a[<span class="hljs-number">0</span>] = v.x
    r.a[<span class="hljs-number">5</span>] = v.y
    r.a[<span class="hljs-number">10</span>] = v.z
    @mult(r)
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>##Quaternion###
A quaternion to deal with all our rotations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Quaternion</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>@addScalar - static function - add a scalar to every element in this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @addScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"addScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>@subScalar - static function - subtract a scalar from every element in this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @subScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"subScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>@multScalar - static function - multiply every element in this quaternion by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @multScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"multScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>@divScalar - static function - divide every element in this quaternion by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @divScalar:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"divScalar"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>@conjugate - static function - return the conjugate to this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @conjugate:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"conjugate"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>@mult - static function - multiply this quaternion by another quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @mult:<span class="hljs-function"><span class="hljs-params">(a,b)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"mult"</span>](b)</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>@invert - static function - return an inverted version</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @invert:<span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    a.copy()[<span class="hljs-string">"invert"</span>]()</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>transVec3 - static function - given a vector, return a new version of it, transformed by this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @transVec3:<span class="hljs-function"><span class="hljs-params">(q,v)</span> -&gt;</span>
    tv = v.copy()
    q.transVec3(tv)
    tv

  @fromRotations : <span class="hljs-function"><span class="hljs-params">(x,y,z)</span> -&gt;</span>
    tv = <span class="hljs-keyword">new</span> Quaternion()
    tv.fromRotations x,y,z
    tv</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>fromTo - static function - given two quaternions, return a new one from the first to the second</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  @fromTo: <span class="hljs-function"><span class="hljs-params">(f,t)</span> -&gt;</span>
    tv = <span class="hljs-keyword">new</span> Quaternion()
    tv.fromTo(f,t)
    tv</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>constructor - takes a Vec3 and a w (both optional)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor : <span class="hljs-function"><span class="hljs-params">(@x, @y, @z, @w)</span> -&gt;</span>
    @x = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @x?
    @y = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @y?
    @z = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @z?
    @w = <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @w?</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>copy - return a coy of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copy : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Quaternion @x, @y, @z, @w</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>copyFrom - copy another quaternion into this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  copyFrom : <span class="hljs-function"><span class="hljs-params">(q)</span> -&gt;</span>
    @x = q.x
    @y = q.y
    @z = q.z
    @w = q.w
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>axis - return the axis of this Quaternion </p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  axis : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    ca = @w
    invlen = <span class="hljs-number">1.0</span>/ Math.sqrt(<span class="hljs-number">1.0</span> - ca * ca)
    @x *= invlen
    @y *= invlen
    @z *= invlen</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>angle - return the angle of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  angle : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    ca = @w
    Math.acos(ca) * <span class="hljs-number">2</span></pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>pitch - return the pitch of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pitch : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    Math.atan2(<span class="hljs-number">2</span> * (@y * @z + @w * @x ), @w * @w - @x * @x - @y * @y + @z * @z )</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>yaw - return the pitch of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  yaw : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    Math.sin(<span class="hljs-number">-2</span> * ( @x * @z - @w * @y ))</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>roll - return the pitch of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  roll: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    Math.atan2(<span class="hljs-number">2</span> * ( @x * @y + @w * @z), @w * @w + @x * @x - @y * @y - @z * @z)</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>dot - return the dot product of this Quaternion with another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  dot : <span class="hljs-function"><span class="hljs-params">(a)</span> -&gt;</span>
    @w * a.w + @x * a.x + @y * a.y + @z * a.z</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>length - return the length of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  length : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    Math.sqrt @lengthSquared()</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>lengthSquared - return the lengthSquared of this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lengthSquared : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @w * @w + @x * @x + @y * @y + @z * @z</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <p>Conjugate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  conjugate : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @x = -@x
    @y = -@y
    @z = -@z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              <p>invert - invert this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  invert : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    q = Quaternion.conjugate(@)
    q = q.multScalar(<span class="hljs-number">1.0</span> / @lengthSquared())
    @x = q.x
    @y = q.y
    @z = q.z
    @w = q.w
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>add - Add another quaternion to this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  add : <span class="hljs-function"><span class="hljs-params">(q)</span> -&gt;</span>
    @w += q.w
    @x += q.x
    @y += q.y
    @z += q.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>sub - Subtract another quaternion from this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sub : <span class="hljs-function"><span class="hljs-params">(q)</span> -&gt;</span>
    @w -= q.w
    @x -= q.x
    @y -= q.y
    @z -= q.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>multiply - multiply this Quaternion with another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multiply : <span class="hljs-function"><span class="hljs-params">(q)</span> -&gt;</span>
    @mult(q)</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>mult - multiply this Quaternion with another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mult: <span class="hljs-function"><span class="hljs-params">(q)</span> -&gt;</span>
    w = -@x * q.x - @y * q.y - @z * q.z + @w * q.w
    x = @x * q.w + @y * q.z - @z * q.y + @w * q.x
    y = -@x * q.z + @y * q.w + @z * q.x + @w * q.y
    z = @x * q.y - @y * q.x + @z * q.w + @w * q.z
    @w = w
    @x = x 
    @y = y
    @z = z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>multScalar - multiply this Quaternion by a scalar</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  multScalar : <span class="hljs-function"><span class="hljs-params">(s)</span> -&gt;</span>
    @w *= s
    @x *= s
    @y *= s
    @z *= s
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>transVec3 - Transform a vector by this quaternion</p>

            </div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <p>TODO - this appears to rotate a vector in the opposite direction to glm and other libs
We should check the maths on this one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  transVec3 : <span class="hljs-function"><span class="hljs-params">(v)</span> -&gt;</span>
  
    qc = Quaternion.conjugate @
    vp = <span class="hljs-keyword">new</span> Quaternion(v.x, v.y, v.z, <span class="hljs-number">0</span>)

    vf = qc.mult(vp).mult(@)
    v.x = vf.x
    v.y = vf.y
    v.z = vf.z

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              <p>normalize - normalize this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  normalize : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>  
    len = <span class="hljs-number">1.0</span> / @length()
    @w *= len
    @x *= len
    @y *= len      
    @z *= len
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>log - ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  log : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    t = <span class="hljs-number">1.0</span>
    <span class="hljs-keyword">if</span> @w &lt; t
      t = @w
    
    theta = Math.acos(t)
    <span class="hljs-keyword">if</span> theta == <span class="hljs-number">0</span>
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Quaternion(@x, @y, @z ,<span class="hljs-number">0</span>)

    sintheta = Math.sin(theta)
    k = theta / sintheta
    <span class="hljs-keyword">if</span> Math.abs(sintheta) &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> Math.abs(theta) &gt;= <span class="hljs-number">3.402823466e+38</span> * Math.abs(sintheta)
      k  =<span class="hljs-number">1</span>

    <span class="hljs-keyword">new</span> Quaternion @x*k, @y*k, @z*k, <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>exp - ?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exp : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    theta = @v.length()
    sintheta = sin(theta)
    k = sintheta / theta

    <span class="hljs-keyword">if</span> Math.abs(theta) &lt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> Math.abs(sintheta) &gt;= <span class="hljs-number">3.402823466e+38</span> * Math.abs(theta)
      k  =<span class="hljs-number">1</span>

    costheta = Math.cos(theta)
  
    <span class="hljs-keyword">new</span> Quaternion @x * k, @y * k, @z * k, costheta</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>fromTo - set this quaternion to represent the movement from quaternion to another</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fromTo : <span class="hljs-function"><span class="hljs-params">(f,t)</span> -&gt;</span>
    axis = Vec3.cross(f,t)
    @w = f.dot(t)
    @x = axis.x
    @y = axis.y
    @z = axis.z
    @normalize()
    @w += <span class="hljs-number">1.0</span>

    <span class="hljs-keyword">if</span> @w &lt;= EPSILON
      <span class="hljs-keyword">if</span> f.z * f.z &gt; f.x * f.x
        @w = <span class="hljs-number">0.0</span>
        @x = <span class="hljs-number">0</span>
        @y = f.z
        @z = -f.y
      <span class="hljs-keyword">else</span>
        @w = <span class="hljs-number">0.0</span>
        @x = f.y
        @y = -f.x
        @z = <span class="hljs-number">0.0</span>
      @normalize()
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>fromAxisAngle - create a quaternion that represents rotation around an axis (a) (Vec3) radians (r)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fromAxisAngle : <span class="hljs-function"><span class="hljs-params">(a,r)</span> -&gt;</span>
    @w = Math.cos(r / <span class="hljs-number">2</span>)
    v = <span class="hljs-keyword">new</span> Vec3(a.x,a.y,a.z)
    v.normalize().multScalar(Math.sin(r/<span class="hljs-number">2</span>))
    @x = v.x
    @y = v.y
    @z = v.z
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>fromRotations - create a Quaternion from rotations around z,y,and x in that order in radians</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fromRotations : <span class="hljs-function"><span class="hljs-params">(x,y,z)</span> -&gt;</span>
    x *= <span class="hljs-number">0.5</span>
    y *= <span class="hljs-number">0.5</span>
    z *= <span class="hljs-number">0.5</span>

    cx = Math.cos x
    sx = Math.sin x

    cy = Math.cos y
    sy = Math.sin y

    cz = Math.cos z
    sz = Math.sin z

    @w  = cx * cy * cz - sx * sy * sz
    @x = sx*cy*cx + cx*sy*sz
    @y = cx*sy*cz - sx*cy*sz
    @z = cx*cy*sz + sx*sy*cx
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>getAxisAngle - return the axis and angle represented by this quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getAxisAngle : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    ca = @w
    r = Math.acos(ca) * <span class="hljs-number">2</span>
    invlen = <span class="hljs-number">1.0</span> / Math.sqrt(<span class="hljs-number">1.0</span> - ca * ca)

    [<span class="hljs-keyword">new</span> Vec3(@x * invlen, @y * invlen, @z * invlen), r]</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>getMatrix4 - return a matrix4 from this Quaternion</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getMatrix4 : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    xs = @x + @x   
    ys = @y + @y
    zs = @z + @z
    wx = @w * xs
    wy = @w * ys
    wz = @w * zs
    xx = @x * xs
    xy = @x * ys
    xz = @x * zs
    yy = @y * ys
    yz = @y * zs
    zz = @z * zs

    <span class="hljs-keyword">new</span> Matrix4( [<span class="hljs-number">1.0</span> - (yy+zz),
      xy + wz,
      xz - wy,
      <span class="hljs-number">0</span>,
      xy - wz,
      <span class="hljs-number">1.0</span> - ( xx + zz ),
      yz + wx,
      <span class="hljs-number">0</span>,
      xz + wy,
      yz - wx,
      <span class="hljs-number">1.0</span> - ( xx + yy ),
      <span class="hljs-number">0</span>,
      <span class="hljs-number">0</span>,
      <span class="hljs-number">0</span>,
      <span class="hljs-number">0</span>,
      <span class="hljs-number">1.0</span>])</pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>getMatrix3 - return a matrix3 from this Quaternion - The rotation component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getMatrix3 : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    xs = @x + @x   
    ys = @y + @y
    zs = @z + @z
    wx = @w * xs
    wy = @w * ys
    wz = @w * zs
    xx = @x * xs
    xy = @x * ys
    xz = @x * zs
    yy = @y * ys
    yz = @y * zs
    zz = @z * zs

    <span class="hljs-keyword">new</span> Matrix3( [<span class="hljs-number">1.0</span> - (yy+zz),
      xy + wz,
      xz - wy,
      xy - wz,
      <span class="hljs-number">1.0</span> - ( xx + zz ),
      yz + wx,
      xz + wy,
      yz - wx,
      <span class="hljs-number">1.0</span> - ( xx + yy )])</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>lerp - lerp between this quaternion at the start and the one at the ‘end’, t being 0-&gt;1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lerp : <span class="hljs-function"><span class="hljs-params">(t,end)</span> -&gt;</span>
   
    costheta = end.dot()
    result = Quaternion.multScalar(end,t)
    <span class="hljs-keyword">if</span> costheta &gt;= EPSILON
      result.add (result.multScalar(<span class="hljs-number">1.0</span> - t)) 
    <span class="hljs-keyword">else</span>
      result.add (result.multScalar(t - <span class="hljs-number">1.0</span>))
    result</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>slerpShortestUnenforced - slerp between this quaternion at the start and the one at the ‘end’, t being 0-&gt;1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slerpShortestUnenforced : <span class="hljs-function"><span class="hljs-params">(t,end)</span> -&gt;</span>
    d = @copy()
    d.sub(end)
    lengthD = Math.sqrt(@dot(end))
    st = @copy()
    st.add(end)
    lengthS = Math.sqrt(st.dot(st))

    a = <span class="hljs-number">2</span> * Math.atan2(lengthD,lengthS)
    s = <span class="hljs-number">1</span> - t

    q = @copy()
    q.multScalar(( sinx_over_x( s * a ) / sinx_over_x( a ) * s ) )
    e = end.copy()
    e.multScalar(( sinx_over_x( t * a ) / sinx_over_x( a ) * t ))
    q.add(e)
    q.normalize()
    q</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>slerp - slerp between this quaternion at the start and the one at the ‘end’, t being 0-&gt;1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  slerp : <span class="hljs-function"><span class="hljs-params">(t,end)</span> -&gt;</span>
    cosTheta = @dot( end )

    <span class="hljs-keyword">if</span> cosTheta &gt;= EPSILON
      <span class="hljs-keyword">if</span>  <span class="hljs-number">1.0</span>  - cosTheta  &gt; EPSILON
        theta = Math.acos(cosTheta)
        recipSinTheta = <span class="hljs-number">1.0</span> / Math.sin(theta)
        startInterp = Math.sin( (<span class="hljs-number">1.0</span> - t) * theta) * recipSinTheta
        endInterp = Math.sin( t * theta) * recipSinTheta
      <span class="hljs-keyword">else</span>
        startInterp = <span class="hljs-number">1.0</span> - t
        endInterp = t
    <span class="hljs-keyword">else</span> 
      <span class="hljs-keyword">if</span> <span class="hljs-number">1.0</span> + cosTheta &gt; EPSILON
        theta = Math.acos(-cosTheta)
        recipSinTheta = <span class="hljs-number">1.0</span> / Math.sin(theta)
        startInterp = Math.sin((t - <span class="hljs-number">1.0</span>) * theta ) * recipSinTheta
        endInterp = Math.sin(t*theta) * recipSinTheta       
      
      <span class="hljs-keyword">else</span>
        startInterp = t <span class="hljs-number">-1.0</span>
        endInterp = t
   
    q = @copy()
    q.mult(startInterp)
    e = end.copy()
    e.mult(endInterp)
    q.add(e)
    q</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>fromMatrix4 : Create a Quaternion from an existing Matrix4</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  fromMatrix4 : <span class="hljs-function"><span class="hljs-params">(m)</span> -&gt;</span>

    trace = m.a[<span class="hljs-number">0</span>] + m.a[<span class="hljs-number">5</span>] + m.a[<span class="hljs-number">10</span>]

    <span class="hljs-keyword">if</span>  trace &gt; <span class="hljs-number">0.0</span>
      s = Math.sqrt(trace + <span class="hljs-number">1.0</span>)
      @w = s * <span class="hljs-number">0.5</span>
      recip = <span class="hljs-number">0.5</span> / s

      @x = ( m.at(<span class="hljs-number">2</span>,<span class="hljs-number">1</span>) - m.at(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) ) * recip
      @y = ( m.at(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>) - m.at(<span class="hljs-number">2</span>,<span class="hljs-number">0</span>) ) * recip
      @z = ( m.at(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>) - m.at(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>) ) * recip

    <span class="hljs-keyword">else</span> 
      i = <span class="hljs-number">0</span>
      <span class="hljs-keyword">if</span> m.at(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>) &gt; m.at(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>)
        i = <span class="hljs-number">1</span>
      <span class="hljs-keyword">if</span> m.at(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>) &gt; m.at(i,i)
        i = <span class="hljs-number">2</span>

      j = ( i + <span class="hljs-number">1</span> ) % <span class="hljs-number">3</span>
      k = ( j + <span class="hljs-number">1</span> ) % <span class="hljs-number">3</span>
      s = Math.sqrt(m.at(i,i) - m.at(j,j) - m.at(k,k) + <span class="hljs-number">1.0</span>)

      <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span>
        @x = <span class="hljs-number">0.5</span> * s
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> i == <span class="hljs-number">1</span>
        @y = <span class="hljs-number">0.5</span> * s
      <span class="hljs-keyword">else</span> 
        @z = <span class="hljs-number">0.5</span> * s

      recip = <span class="hljs-number">0.5</span> / s

      @w = ( m.at(k,j) - m.at(j,k) ) * recip

      a = ( m.at(j,i) + m.at(i,j) ) * recip
      b = ( m.at(k,i) + m.at(i,k) ) * recip

      <span class="hljs-keyword">if</span> j == <span class="hljs-number">0</span>
        @x = a
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> j == <span class="hljs-number">1</span>
        @y = a
      <span class="hljs-keyword">else</span> 
        @z = a

      <span class="hljs-keyword">if</span> k == <span class="hljs-number">0</span>
        @x = b
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> k == <span class="hljs-number">1</span>
        @y = b
      <span class="hljs-keyword">else</span> 
        @z = b

    @



<span class="hljs-built_in">module</span>.exports = 
  Vec2 : Vec2
  Vec3 : Vec3
  Vec4 : Vec4
  Matrix2 : Matrix2
  Matrix3 : Matrix3
  Matrix4 : Matrix4
  radToDeg : radToDeg
  degToRad : degToRad
  Quaternion: Quaternion
  PI : PI
  EPSILON : EPSILON
  Edge2 : Edge2</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
