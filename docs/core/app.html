<!DOCTYPE html>

<html>
<head>
  <title>app.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.coffee</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h2 id="about">ABOUT</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre>             .__   
_________  __|  |  
\____ \  \/  /  |  
|  |_&gt; &gt;    &lt;|  |__
|   __<span class="hljs-regexp">/__/</span>\_ \____/
|__|        \/     js

                    PXL.js
                    Benjamin Blundell - ben@pxljs.com
                    http:<span class="hljs-regexp">//</span>pxljs.com

This software <span class="hljs-keyword">is</span> released under the MIT Licence. See LICENCE.txt <span class="hljs-keyword">for</span> details

- Resources

* http:<span class="hljs-regexp">//</span>www.yuiblog.com<span class="hljs-regexp">/blog/2007/06/12/module-pattern/</span>
* http:<span class="hljs-regexp">//</span>www.plexical.com<span class="hljs-regexp">/blog/2012/01/25/writing-coffeescript-for-browser-and-nod/</span>
* https:<span class="hljs-regexp">//gi</span>thub.com/field/FieldKit.js

- TODO 

* Not sure we want to make <span class="hljs-keyword">this</span> a listener <span class="hljs-keyword">for</span> events. I suspect we need a keyboard eventor
  style <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">and</span> <span class="hljs-title">touch</span> <span class="hljs-title">eventor</span> <span class="hljs-title">class</span> <span class="hljs-title">that</span> <span class="hljs-title">takes</span> <span class="hljs-title">a</span> <span class="hljs-title">DOM</span>?</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>##</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

{Vec2,Vec3, Vec4, Matrix4} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../math/math"</span> <span class="hljs-comment"># Makes this Matrix4 global for this file/closure only</span>
{Shader} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../gl/shader"</span> 
{PerspCamera, OrthoCamera} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../camera/camera"</span> 
{makeMouseEmitter, removeMouseEmitter } = <span class="hljs-built_in">require</span> <span class="hljs-string">"../interact/mouse"</span>
{makeTouchEmitter,removeTouchEmitter} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../interact/touch"</span>
{makeKeyEmitter, removeKeyEmitter} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../interact/key"</span>
{Colour} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../colour/colour"</span>
{PXLError, PXLWarning, PXLLog} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../util/log"</span>
{makeDebugContext} = <span class="hljs-built_in">require</span> <span class="hljs-string">"../util/debug"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>OnEachFrame function
Taken from <a href="http://nokarma.org/2011/02/02/javascript-game-development-the-game-loop/index.html">http://nokarma.org/2011/02/02/javascript-game-development-the-game-loop/index.html</a></p>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="app">App</h2>

            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The master class in effect. This class takes functions from your application and calls them
as and when needed
TODO - is Context a better name? I think so. We should change it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">App</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>constructor - Takes an object with the following parameters</p>
<p>canvas: canvas element, 
context: the glcontext
init: an init function, called once,
draw:  a draw function (called 60 times a second)
update : update function (called as fast as possible), 
error: an error function and an optional switch for debug mode
delay_start : true/false - dont start automatically
destroy : a funtion that is called when the context is destroyed / shutdown
debug : true / false - set a global debug mode for this context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  constructor: <span class="hljs-function"><span class="hljs-params">(params)</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Parse the basic parameters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> params.canvas?
      PXLError <span class="hljs-string">"No WebGL Canvas Provided"</span>
      <span class="hljs-keyword">return</span>

    @debug = <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> params.debug? <span class="hljs-keyword">then</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">else</span> params.debug
    @app_context = params.context
    @update = params.update
    @draw = params.draw
    @init = params.init
    @user_shutdown = params.shutdown

    @canvas = <span class="hljs-built_in">document</span>.getElementById params.canvas
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @canvas
      PXLError <span class="hljs-string">"Trying to create an app on canvas that does not exist"</span>
   
    @_pause = <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> params.pause? <span class="hljs-keyword">then</span> <span class="hljs-literal">false</span> <span class="hljs-keyword">else</span> params.pause
    @height = @canvas.height
    @width = @canvas.width
    
    @_context()

    @

  _context : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Deal with Context loss
TODO - Needs testing! :O</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function">    <span class="hljs-title">cl</span> = <span class="hljs-params">(event)</span> =&gt;</span>
      event.preventDefault()</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Remove the context from the applications list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      idx = <span class="hljs-number">0</span>
      <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> PXL.Applications.length
        <span class="hljs-keyword">if</span> PXL.Applications[i][<span class="hljs-number">0</span>] = @
          <span class="hljs-keyword">break</span>

      PXL.Applications.splice idx, <span class="hljs-number">1</span>

      @_context()

    @canvas.addEventListener <span class="hljs-string">"webglcontextlost"</span>, cl, <span class="hljs-literal">false</span>

    @_initContext() <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @gl?</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Do we want such emitters by default? Generally we do right?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    makeMouseEmitter @
    makeTouchEmitter @
    makeKeyEmitter @

    @resizeCanvas(@canvas.width, @canvas.height)
    
    <span class="hljs-keyword">if</span> @init?
      @init.call @app_context</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Context time is the time im seconds that this context has run
TODO - Do we still use this really?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @contextTime = <span class="hljs-number">0</span>

    <span class="hljs-built_in">window</span>.onEachFrame @,@run <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>?</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Create the Actual webGL Context. This is called at startup and if the context is lost</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _initContext : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>

    names = [<span class="hljs-string">"experimental-webgl"</span>, <span class="hljs-string">"webgl"</span>, <span class="hljs-string">"moz-webgl"</span>, <span class="hljs-string">"webkit-3d"</span>]
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> names
      @gl = @canvas.getContext name
      <span class="hljs-keyword">if</span> @gl?
        @_profile()
        @_framescounter = <span class="hljs-number">0</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>TODO - Actually make a proper debug context :P</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> @debug
          PXLLog <span class="hljs-string">"creating OpenGL debug context"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>makeDebugContext @gl</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
        <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @gl
      @onError() <span class="hljs-keyword">if</span> @onError?</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>TODO - Add a signal here perhaps? Event?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      PXLError <span class="hljs-string">"WebGL Not supported or context not found"</span>, <span class="hljs-string">"App"</span> 
    
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>TODO - Move profiling into some context that never changes?
 <a href="http://www.quirksmode.org/js/detect.html">http://www.quirksmode.org/js/detect.html</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> navigator? 
    `<span class="javascript"><span class="hljs-keyword">var</span> BrowserDetect = {
      init: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.browser = <span class="hljs-keyword">this</span>.searchString(<span class="hljs-keyword">this</span>.dataBrowser) || <span class="hljs-string">"An unknown browser"</span>;
        <span class="hljs-keyword">this</span>.version = <span class="hljs-keyword">this</span>.searchVersion(navigator.userAgent)
          || <span class="hljs-keyword">this</span>.searchVersion(navigator.appVersion)
          || <span class="hljs-string">"an unknown version"</span>;
        <span class="hljs-keyword">this</span>.OS = <span class="hljs-keyword">this</span>.searchString(<span class="hljs-keyword">this</span>.dataOS) || <span class="hljs-string">"an unknown OS"</span>;
      },
      searchString: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;data.length;i++) {
          <span class="hljs-keyword">var</span> dataString = data[i].string;
          <span class="hljs-keyword">var</span> dataProp = data[i].prop;
          <span class="hljs-keyword">this</span>.versionSearchString = data[i].versionSearch || data[i].identity;
          <span class="hljs-keyword">if</span> (dataString) {
            <span class="hljs-keyword">if</span> (dataString.indexOf(data[i].subString) != <span class="hljs-number">-1</span>)
              <span class="hljs-keyword">return</span> data[i].identity;
          }
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dataProp)
            <span class="hljs-keyword">return</span> data[i].identity;
        }
      },
      searchVersion: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">dataString</span>) </span>{
        <span class="hljs-keyword">var</span> index = dataString.indexOf(<span class="hljs-keyword">this</span>.versionSearchString);
        <span class="hljs-keyword">if</span> (index == <span class="hljs-number">-1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(dataString.substring(index+<span class="hljs-keyword">this</span>.versionSearchString.length+<span class="hljs-number">1</span>));
      },
      dataBrowser: [
        {
          string: navigator.userAgent,
          subString: <span class="hljs-string">"Chrome"</span>,
          identity: <span class="hljs-string">"Chrome"</span>
        },
        {   string: navigator.userAgent,
          subString: <span class="hljs-string">"OmniWeb"</span>,
          versionSearch: <span class="hljs-string">"OmniWeb/"</span>,
          identity: <span class="hljs-string">"OmniWeb"</span>
        },
        {
          string: navigator.vendor,
          subString: <span class="hljs-string">"Apple"</span>,
          identity: <span class="hljs-string">"Safari"</span>,
          versionSearch: <span class="hljs-string">"Version"</span>
        },
        {
          prop: <span class="hljs-built_in">window</span>.opera,
          identity: <span class="hljs-string">"Opera"</span>,
          versionSearch: <span class="hljs-string">"Version"</span>
        },
        {
          string: navigator.vendor,
          subString: <span class="hljs-string">"iCab"</span>,
          identity: <span class="hljs-string">"iCab"</span>
        },
        {
          string: navigator.vendor,
          subString: <span class="hljs-string">"KDE"</span>,
          identity: <span class="hljs-string">"Konqueror"</span>
        },
        {
          string: navigator.userAgent,
          subString: <span class="hljs-string">"Firefox"</span>,
          identity: <span class="hljs-string">"Firefox"</span>
        },
        {
          string: navigator.vendor,
          subString: <span class="hljs-string">"Camino"</span>,
          identity: <span class="hljs-string">"Camino"</span>
        },
        {   <span class="hljs-comment">// for newer Netscapes (6+)</span>
          string: navigator.userAgent,
          subString: <span class="hljs-string">"Netscape"</span>,
          identity: <span class="hljs-string">"Netscape"</span>
        },
        {
          string: navigator.userAgent,
          subString: <span class="hljs-string">"MSIE"</span>,
          identity: <span class="hljs-string">"Explorer"</span>,
          versionSearch: <span class="hljs-string">"MSIE"</span>
        },
        {
          string: navigator.userAgent,
          subString: <span class="hljs-string">"Gecko"</span>,
          identity: <span class="hljs-string">"Mozilla"</span>,
          versionSearch: <span class="hljs-string">"rv"</span>
        },
        {     <span class="hljs-comment">// for older Netscapes (4-)</span>
          string: navigator.userAgent,
          subString: <span class="hljs-string">"Mozilla"</span>,
          identity: <span class="hljs-string">"Netscape"</span>,
          versionSearch: <span class="hljs-string">"Mozilla"</span>
        }
      ],
      dataOS : [
        {
          string: navigator.platform,
          subString: <span class="hljs-string">"Win"</span>,
          identity: <span class="hljs-string">"Windows"</span>
        },
        {
          string: navigator.platform,
          subString: <span class="hljs-string">"Mac"</span>,
          identity: <span class="hljs-string">"Mac"</span>
        },
        {
             string: navigator.userAgent,
             subString: <span class="hljs-string">"iPhone"</span>,
             identity: <span class="hljs-string">"iPhone/iPod"</span>
          },
        {
          string: navigator.platform,
          subString: <span class="hljs-string">"Linux"</span>,
          identity: <span class="hljs-string">"Linux"</span>
        }
      ]

    };</span>`</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>profile - setup the limits of the current system we are on</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _profile : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    
    @profile = {}  

    @profile.antialias = @gl.getContextAttributes().antialias
    @profile.aa_size = @gl.getParameter @gl.SAMPLES
    highp = @gl.getShaderPrecisionFormat(@gl.FRAGMENT_SHADER, @gl.HIGH_FLOAT)
    @profile.highpSupported = highp.precision != <span class="hljs-number">0</span>
    @profile.maxTexSize = @gl.getParameter(@gl.MAX_TEXTURE_SIZE)
    @profile.maxCubeSize = @gl.getParameter(@gl.MAX_CUBE_MAP_TEXTURE_SIZE)
    @profile.maxRenderbufferSize = @gl.getParameter(@gl.MAX_RENDERBUFFER_SIZE)
    @profile.vertexTextureUnits = @gl.getParameter(@gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
    @profile.fragmentTextureUnits = @gl.getParameter(@gl.MAX_TEXTURE_IMAGE_UNITS)
    @profile.combinedUnits = @gl.getParameter(@gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS)
    @profile.maxVSattribs = @gl.getParameter(@gl.MAX_VERTEX_ATTRIBS)
    @profile.maxVertexShaderUniforms = @gl.getParameter(@gl.MAX_VERTEX_UNIFORM_VECTORS)
    @profile.maxFragmentShaderUniforms = @gl.getParameter(@gl.MAX_FRAGMENT_UNIFORM_VECTORS)
    @profile.maxVaryings = @gl.getParameter(@gl.MAX_VARYING_VECTORS)
    @profile.extensions = @gl.getSupportedExtensions()
    @profile.maxBufferSize = <span class="hljs-number">65536</span></pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Just to make sure we are in a browser before we perform this</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> navigator?
      BrowserDetect.init();

      @profile.browser = BrowserDetect.browser
      @profile.os = BrowserDetect.OS
      @profile.version = BrowserDetect.version</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Look for extensions that we like
TODO - Maybe allow these to be passed in as params? Maybe not?
These are here because we make use of them quite a bit</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      se = @gl.getSupportedExtensions()

      @profile.extensions = []

      <span class="hljs-keyword">if</span> <span class="hljs-string">'OES_standard_derivatives'</span> <span class="hljs-keyword">in</span> se
        @profile.extensions.push <span class="hljs-string">'OES_standard_derivatives'</span>
        @gl.getExtension <span class="hljs-string">'OES_standard_derivatives'</span>

      <span class="hljs-keyword">if</span> <span class="hljs-string">'OES_texture_float'</span> <span class="hljs-keyword">in</span> se
        @profile.extensions.push <span class="hljs-string">'OES_texture_float'</span>
        @gl.getExtension <span class="hljs-string">'OES_texture_float'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p><a href="http://stackoverflow.com/questions/11381673/javascript-solution-to-detect-mobile-browser">http://stackoverflow.com/questions/11381673/javascript-solution-to-detect-mobile-browser</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      `<span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">detectmob</span>(<span class="hljs-params"></span>) </span>{ 
        <span class="hljs-keyword">if</span>( navigator.userAgent.match(<span class="hljs-regexp">/Android/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/webOS/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/iPhone/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/iPad/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/iPod/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/BlackBerry/i</span>)
        || navigator.userAgent.match(<span class="hljs-regexp">/Windows Phone/i</span>)
        ){
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
      }</span>`
    
      @profile.mobile = detectmob()

      <span class="hljs-built_in">console</span>.log @profile</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>run - called by the frame function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  run : <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>
    <span class="hljs-keyword">if</span> @_pause
      <span class="hljs-keyword">return</span>

    <span class="hljs-keyword">if</span>  @_framescounter &gt; <span class="hljs-number">0</span>
      @_framescounter--

      <span class="hljs-keyword">if</span> @_framescounter &lt;= <span class="hljs-number">0</span>
        @pause <span class="hljs-literal">true</span>

    @_draw @getDelta()</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Pause / un-psue the draw and update loops if needed. force is a boolean and is optional</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  pause : <span class="hljs-function"><span class="hljs-params">(force)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> force?
      @_pause = !@_pause 
    <span class="hljs-keyword">else</span>
      @_pause = force

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @_pause
      @startTime = Date.now()
      @oldTime = @startTime
      @canvas.focus() <span class="hljs-comment"># Gain the focus so we can process keyboard events</span></pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Stop / start emitting events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @pauseKeyEmitter @_pause
    @pauseTouchEmitter @_pause
    @pauseMouseEmitter @_pause
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>getDelta - Returns the dt value in milliseconds</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  getDelta : <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span>

    deltaTime = Date.now() - @oldTime
    @oldTime = Date.now()
    <span class="hljs-keyword">return</span> deltaTime

  switchContext : <span class="hljs-function"><span class="hljs-params">(context)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> context?
      PXL.Context = context
      <span class="hljs-built_in">window</span>.GL = context.gl <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>?
    <span class="hljs-keyword">else</span> 
      <span class="hljs-keyword">if</span> PXL.Context != @
        PXL.Context = @ <span class="hljs-comment"># Global GL Function for our contexts</span>
        <span class="hljs-built_in">window</span>.GL = @gl <span class="hljs-keyword">if</span> <span class="hljs-built_in">window</span>?
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Called by the surrounding application javascript should you wish</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  resizeCanvas: <span class="hljs-function"><span class="hljs-params">(width, height)</span> -&gt;</span>
    @switchContext()

    <span class="hljs-keyword">if</span> @canvas
      <span class="hljs-keyword">if</span> @gl
        @width = width
        @height = height
        @canvas.width = width
        @canvas.height = height
    @</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>_draw - Internal draw function. Calls the userâ€™s draw function if provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _draw: <span class="hljs-function"><span class="hljs-params">(dt)</span> -&gt;</span>
    @contextTime = Date.now() - @startTime
    @switchContext()
    <span class="hljs-keyword">if</span> @draw?
      @draw.call @app_context, dt</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Stop running the loops and destroy the context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shutdown : <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    @pause <span class="hljs-literal">true</span>

    @user_shutdown.call @app_context <span class="hljs-keyword">if</span> @user_shutdown?</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Remove emitters</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    removeMouseEmitter @
    removeTouchEmitter @
    removeKeyEmitter @

    @</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>TODO - Perform some kind of deletion / garbage collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-built_in">module</span>.exports =
  App : App</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
