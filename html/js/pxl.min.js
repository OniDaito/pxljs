!function t(e,i,n){function r(o,a){if(!i[o]){if(!e[o]){var h="function"==typeof require&&require;if(!a&&h)return h(o,!0);if(s)return s(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[o]={exports:{}};e[o][0].call(l.exports,function(t){var i=e[o][1][t];return r(i?i:t)},l,l.exports,t,e,i,n)}return i[o].exports}for(var s="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}({1:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g;m=t("../math/math"),p=m.Vec2,f=m.Vec3,d=m.Vec4,a=m.Matrix4,g=t("../colour/colour"),u=g.RGB,l=g.RGBA,h=t("../util/log").PXLWarning,r=t("../math/curve").Curve2,s=function(){function t(t,e,i){this.obj0=t,this.obj1=e,this.curve=i,null==this.curve&&(this.curve=new r),"object"==typeof this.obj0&&this.obj0.__proto__!==this.obj1.__proto__&&h("Interpolating two different objects"),this.obj0 instanceof p?this._set=this._setVec2:this.obj0 instanceof f?this._set=this._setVec3:this.obj0 instanceof d?this._set=this._setVec4:this.obj0 instanceof u?this._set=this._setRGB:this.obj0 instanceof l?this._set=this._setRGBA:this.obj0 instanceof Quaternion?this._set=this._setQuat:"number"==typeof this.obj0&&(this._set=this._setScalar),this._value=0}return t.prototype.set=function(t){return(t<0||t>1)&&h("Interpolation set val must be between 0 and 1. It was set to "+t),this._value=t,this._set()},t.prototype._setVec2=function(){return new p(this.obj0.x+(this.obj.x-this.obj0.x)*this._value,this.obj0.y+(this.obj1.y-this.obj0.y)*this._value)},t.prototype._setVec3=function(){return new f(this.obj0.x+(this.obj1.x-this.obj0.x)*this._value,this.obj0.y+(this.obj1.y-this.obj0.y)*this._value,this.obj0.z+(this.obj1.z-this.obj0.z)*this._value)},t.prototype._setVec4=function(){return new d(this.obj0.x+(this.obj1.x-this.obj0.x)*this._value,this.obj0.y+(this.obj1.y-this.obj0.y)*this._value,this.obj0.z+(this.obj1.z-this.obj0.z)*this._value,this.obj0.w+(this.obj1.w-this.obj0.w)*this._value)},t.prototype._setRGB=function(){return new u(this.obj0.r+(this.obj1.r-this.obj0.r)*this._value,this.obj0.g+(this.obj1.g-this.obj0.g)*this._value,this.obj0.b+(this.obj1.b-this.obj0.b)*this._value)},t.prototype._setRGBA=function(){return new l(this.obj0.r+(this.obj1.r-this.obj0.r)*this._value,this.obj0.g+(this.obj1.g-this.obj0.g)*this._value,this.obj0.b+(this.obj1.b-this.obj0.b)*this._value,this.obj0.a+(this.obj1.a-this.obj0.a)*this._value)},t.prototype._setQuat=function(){return this.obj0.slerp(this.obj1,this._value)},t.prototype._setScalar=function(){return this.obj0+(this.obj1-this.obj0)*this._value},t}(),n=function(){function t(t,e,i){this.num_frames=t,this.framerate=e,this.label=i,null==this.framerate&&(this.framerate=24),null==this.label&&(this.label="unlabled_animaton"),this._current_frame=0,this._dt=0,this._loop=!0,this._frover=1/this.framerate,this._tweens=[]}return t.prototype.addTween=function(t){return this._tweens.push(t),this},t.prototype.reset=function(){var t,e,i,n;for(this._dt=0,this._current_frame=0,i=this._tweens,t=0,e=i.length;t<e;t++)n=i[t],n.reset();return this},t.prototype.step=function(t){var e;return this._dt+=t,this._dt>=this._frover&&(e=Math.floor(this._dt/this._frover),this._current_frame+=e,this._current_frame>=this.num_frames&&this._loop&&reset(),this._process(),this._dt=this._dt-e*this._frover),this},t.prototype._process=function(){var t,e,i,n,r,s;for(n=this._tweens,r=[],t=0,e=n.length;t<e;t++)s=n[t],s.f0.framenum<=this._current_frame&&s.f1.framenum>=this._current_frame?(i=Math.abs(this._current_frame-s.f0.framenum)/Math.abs(s.f0.framenum-s.f1.framenum),r.push(s.set(i))):r.push(void 0);return r},t}(),o=function(){function t(t,e,i){this.obj=t,this.value=e,this.framenum=i}return t}(),c=function(){function t(t,e,i){this.f0=t,this.f1=e,this.interp=i,this.f0.obj!==this.f1.obj&&h("Tween Keyframes do not point to the same object"),null==this.interp&&(this.interp=new s(this.f0.value,this.f1.value)),null!=this.f0.obj.copyFrom?(this._original=this.f0.obj.copy(),this.reset=function(){return this.f0.copyFrom(this._original)}):(this._original=this.f0,this.reset=function(){return this.f0=this._original})}return t.prototype.set=function(t){return null!=this.f0.obj.copyFrom?this.f0.obj.copyFrom(this.interp.set(t)):this.f0.obj=this.interp.set(t)},t}(),e.exports={Interpolation:s,KeyFrame:o,Animator:n,Tween:c}},{"../colour/colour":4,"../math/curve":29,"../math/math":30,"../util/log":36}],2:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};y=t("../math/math"),o=y.Matrix4,g=y.Vec2,v=y.Vec3,x=y.Vec4,l=y.Quaternion,_=t("../util/log"),u=_.PXLWarning,a=_.PXLError,h=_.PXLLog,s=t("../gl/contract").Contract,r=t("../util/cache_var").CacheVar,m=t("../gl/texture").Texture,n=function(){function t(t,e,i,n,r){var s;this.name=t,this.idx=e,this.parent=i,this.rotation_pose=n,this.position_pose=r,null!=this.parent?(this.rotation_relative=l.invert(this.parent.rotation_pose).mult(this.rotation_pose),this.rotation_relative.normalize(),s=this.position_pose.clone().sub(this.parent.position_pose),this.parent.rotation_pose.transVec3(s),this.position_relative=s):(this.rotation_relative=this.rotation_pose.clone(),this.position_relative=this.position_pose.clone()),this.inverse_bind_pose=new o,this.inverse_bind_pose.translate(this.position_pose).mult(this.rotation_pose.getMatrix4()),this.inverse_bind_pose.invert(),this.rotation_global=this.rotation_pose.clone(),this.position_global=this.position_pose.clone(),this.skinned_matrix=new o}return t.prototype.rotate=function(t){return this.rotation_relative.multiply(t).normalize(),this},t}(),f=function(){function t(t,e){this.index=t,this.count=e}return t}(),d=function(){function t(t,e){this.bone=t,this.bias=e}return t}(),p=function(){function t(){this.index=[],this.weights=[]}return t.prototype.addIndex=function(t){return this.index.push(t),this},t.prototype.addWeight=function(t){return this.weights.push(t),this},t.prototype.numWeights=function(){return this.weights.length},t.prototype.numIndices=function(){return this.index.length},t}(),c=function(){function t(e){var i,n,r;if(this.root=e,this.bones=[],this.matrix=new o,this.contract=new s,this.contract.roles.uBoneTexDim="_square_dim",this._square_dim=Math.sqrt(4*t.PXL_MAX_BONES_TEX),"undefined"!=typeof PXL&&null!==PXL)if(b.call(PXL.Context.profile.extensions,"OES_texture_float")>=0){for(this._tdata=new Float32Array(16*t.PXL_MAX_BONES_TEX),i=n=0,r=4*t.PXL_MAX_BONES_TEX;0<=r?n<=r:n>=r;i=0<=r?++n:--n)this._tdata[i]=1;this._palette=new m(this._tdata,{width:this._square_dim,height:this._square_dim,channels:GL.RGBA,datatype:GL.FLOAT,min:GL.NEAREST,max:GL.NEAREST}),this._palette.contract.roles.uBonePalette="unit"}else a("Uniform bone palette support not implemented.")}return t.PXL_MAX_BONES_TEX=256,t.PXL_MAX_BONES_UNI=64,t.PXL_MAX_WEIGHTS=4,t.PXL_MAX_BONES=128,t.prototype._preDraw=function(){return this.update(),this._palette.bind(),this},t.prototype._postDraw=function(){return this._palette.unbind(),this},t.prototype.addBone=function(e){return this.bones.length+1<t.PXL_MAX_BONES?this.bones.push(e):u("Maximum bone limit reached."),this},t.prototype._addToNode=function(t){return t.skeleton=this,this},t.prototype.getBone=function(t){var e,i,n,r;for(r=this.bones,i=0,n=r.length;i<n;i++)if(e=r[i],e.idx===t)return e;return null},t.prototype.getBoneByName=function(t){var e,i,n,r;for(r=this.bones,i=0,n=r.length;i<n;i++)if(e=r[i],e.name===t)return e;return null},t.prototype.update=function(){var t,e,i,n,r,s,o,a,h,u,c,p;for(h=this.bones,n=0,o=h.length;n<o;n++)t=h[n],void 0===t.parent?(t.rotation_global=t.rotation_relative,t.position_global=t.position_relative):(t.rotation_global.copy(t.parent.rotation_global).mult(t.rotation_relative).normalize(),p=t.position_relative.clone(),c=l.invert(t.parent.rotation_global),c.transVec3(p),p.add(t.parent.position_global),t.position_global.copy(p));for(i=0,u=this.bones,r=0,a=u.length;r<a;r++)if(t=u[r],t.skinned_matrix.identity().translate(t.position_global).mult(t.rotation_global.getMatrix4()),t.skinned_matrix.mult(t.inverse_bind_pose),"undefined"!=typeof PXL&&null!==PXL){for(e=s=0;s<=15;e=++s)this._tdata[16*i+e]=t.skinned_matrix.a[e];i+=1}return"undefined"!=typeof PXL&&null!==PXL&&this._palette.update(this._tdata),this},t}(),e.exports={Skeleton:c,Bone:n,Skin:p,SkinWeight:d,SkinIndex:f}},{"../gl/contract":11,"../gl/texture":14,"../math/math":30,"../util/cache_var":34,"../util/log":36}],3:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x=function(t,e){function i(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},y={}.hasOwnProperty;v=t("../math/math"),p=v.Vec2,f=v.Vec3,d=v.Vec4,s=v.Matrix4,l=v.Quaternion,m=v.degToRad,u=t("../geometry/primitive").Primitive,g=t("../interact/mouse").makeMouseListener,r=t("../gl/contract").Contract,n=function(){function t(t,e,i){this.pos=t,this.look=e,this.up=i,null==this.pos&&(this.pos=new f(0,0,5)),null==this.look&&(this.look=new f(0,0,0)),null==this.up&&(this.up=new f(0,1,0)),this.m=new s,this.p=new s,this.i=new s,this.ip=new s,this.q=new l,this.width=1,this.height=1,this.contract=new r,this.contract.roles.uCameraNear="near",this.contract.roles.uCameraFar="far",this.contract.roles.uInverseProjectionMatrix="ip",this.contract.roles.uProjectionMatrix="p",this.contract.roles.uCameraMatrix="m",this.contract.roles.uCameraInverseMatrix="i"}return t.prototype.update=function(t,e){return null==t&&(t=PXL.Context.width),null==e&&(e=PXL.Context.height),this.m.lookAt(this.pos,this.look,this.up),this.i=s.invert(this.m),this.width=t,this.height=e,"undefined"!=typeof GL&&null!==GL&&GL.viewport(0,0,this.width,this.height),this},t.prototype.lookAt=function(t,e,i){return this.pos=t,this.look=e,this.up=i,this.update()},t.prototype.setViewport=function(t,e){return this.width=t,this.height=e,this},t.prototype.orbit=function(t,e){var i,n;return this.q.fromAxisAngle(t,e),i=f.sub(this.look,this.pos),i.normalize(),n=f.sub(this.pos,this.look),this.q.transVec3(n),this.q.transVec3(this.up),n.add(this.look),this.pos.copy(n),this.update(),this},t.prototype.pantilt=function(t,e){var i,n;return this.q.fromAxisAngle(t,e),i=f.sub(this.look,this.pos),i.normalize(),n=new l,n.fromAxisAngle(f.cross(i,this.up),e),n.mult(this.q),n.transVec3(this.look),n.transVec3(this.up),this.update(),this},t.prototype._addToNode=function(t){return t.camera=this,this},t.prototype.track=function(t){var e;return e=new d(t.x,t.y,0,0),this.i.multVec(e),this.look.add(e),this.pos.add(e),this},t}(),a=function(t){function e(t,i,n,r,s){this.pos=t,this.look=i,this.up=n,this.near=r,this.far=s,e.__super__.constructor.call(this,this.pos,this.look,this.up),null==this.near&&(this.near=-1),null==this.far&&(this.far=1)}return x(e,t),e.prototype.update=function(t,i){return null==t&&(t=PXL.Context.width),null==i&&(i=PXL.Context.height),e.__super__.update.call(this,t,i),this.p.makeOrtho(0,t,0,i,this.near,this.far),this.ip=s.invert(this.p),this},e}(n),h=function(t){function e(t,i,n,r,s,o){this.pos=t,this.look=i,this.up=n,this.angle=r,this.near=s,this.far=o,e.__super__.constructor.call(this,this.pos,this.look,this.up),null==this.angle&&(this.angle=PXL.Math.degToRad(25)),null==this.near&&(this.near=.1),null==this.far&&(this.far=100),this.zoom_near=this.near,this.zoom_far=this.far}return x(e,t),e.prototype.update=function(t,i){return null==t&&(t=PXL.Context.width),null==i&&(i=PXL.Context.height),e.__super__.update.call(this,t,i),this.p.makePerspective(this.angle,t/i,this.near,this.far),this.ip=s.invert(this.p),this},e.prototype.castRay=function(t,e,i,n){var r,s,o,a,h,u;return null==i&&(i=PXL.Context.width),null==n&&(n=PXL.Context.height),e=n-e,a=new d(2*t/i-1,2*e/n-1,(-1),1),r=new d(2*t/i-1,2*e/n-1,1,1),this.ip.multVec(a),this.ip.multVec(r),u=1/a.w,h=new d(a.x*u,a.y*u,a.z*u,1),o=1/r.w,s=new d(r.x*o,r.y*o,r.z*o,1),s.sub(h),s.normalize(),this.i.multVec(s),s.normalize()},e.prototype._zoom=function(t){var e,i,n,r;return e=f.sub(this.look,this.pos),i=e.length(),r=this.zoom_far-this.zoom_near,n=i/r,this.zoom(n+t),this},e.prototype.zoom=function(t){var e,i;return t>0&&t<1&&(e=f.sub(this.pos,this.look),e.normalize(),i=this.zoom_far-this.zoom_near,e.multScalar(t*i),this.pos=f.add(this.look,e),this.update()),this},e}(n),o=function(t){function e(t,i,n,r,o,a,h){this.pos=t,this.look=i,this.up=n,this.angle=r,this.near=o,this.far=a,this.sense=h,e.__super__.constructor.call(this,this.pos,this.look,this.up,this.angle,this.near,this.far),PXL.Context.mouseMove.add(this.onMouseMove,this),PXL.Context.mouseDown.add(this.onMouseDown,this),PXL.Context.mouseUp.add(this.onMouseUp,this),PXL.Context.mouseWheel.add(this.onMouseWheel,this),null==this.sense&&(this.sense=.3),this.px=0,this.py=0,this.dx=0,this.dy=0,this.m.lookAt(this.pos,this.look,this.up),this.i=s.invert(this.m)}return x(e,t),e.prototype.onMouseMove=function(t){var e,i,n;return i=t.mouseX,n=t.mouseY,this.dx=i-this.px,this.px=i,this.dy=n-this.py,this.py=n,t.buttonLeft?(this.orbit(new f(0,1,0),m(-this.dx*this.sense)),e=f.sub(this.look,this.pos),this.orbit(f.cross(e,this.up),m(this.dy*this.sense))):t.buttonRight&&this.track(new p(this.dx*this.sense*-.02,this.dy*this.sense*.02)),this},e.prototype.onMouseDown=function(t){var e,i;return e=t.mouseX,i=t.mouseY,this.px=e,this.py=i,this.dx=0,this.dy=0,this},e.prototype.onMouseUp=function(t){return this},e.prototype.onMouseWheel=function(t){var e,i,n;return i=.01*t.wheelDelta*this.sense,n=this.far-this.near,e=i/n,this._zoom(e),this},e.prototype.update=function(t,i){return null==t&&(t=PXL.Context.width),null==i&&(i=PXL.Context.height),e.__super__.update.call(this,t,i),this},e.prototype.onMouseOut=function(t){return this.px=0,this.py=0,this.dx=0,this.dy=0,this},e.prototype.onMouseOver=function(t){var e;return 0===this.px&&0===this.py&&(e=[t.mouseX,t.mouseY],this.px=e[0],this.py=e[1]),this},e}(h),c=function(t){function e(t,i,n,r,s,o,a){this.pos=t,this.look=i,this.up=n,this.angle=r,this.near=s,this.far=o,this.sense=a,e.__super__.constructor.call(this,this.pos,this.look,this.up,this.angle,this.near,this.far),PXL.Context.touchPinch.add(this.onPinch,this),PXL.Context.touchSpread.add(this.onSpread,this),PXL.Context.touchSwipe.add(this.onSwipe,this)}return x(e,t),e.prototype.onPinch=function(t){var e,i,n;return i=.08*-t.ddist*this.sense,n=this.far-this.near,e=i/n,this._zoom(e),this},e.prototype.onSpread=function(t){var e,i,n;return i=.08*-t.ddist*this.sense,n=this.far-this.near,e=i/n,this._zoom(e),this},e.prototype.onSwipe=function(t){var e,i,n;return i=t.currentPos.x,n=t.currentPos.y,this.px=t.previousPos.x,this.py=t.previousPos.y,this.dx=i-this.px,this.px=i,this.dy=n-this.py,this.py=n,1===t.fingers?(this.orbit(new f(0,1,0),m(-this.dx*this.sense)),e=f.sub(this.look,this.pos),this.orbit(f.cross(e,this.up),m(-this.dy*this.sense))):2===t.fingers&&this.track(new p(this.dx*this.sense*-.02,this.dy*this.sense*.02)),this},e}(o),e.exports={Camera:n,OrthoCamera:a,PerspCamera:h,MousePerspCamera:o,TouchPerspCamera:c}},{"../geometry/primitive":9,"../gl/contract":11,"../interact/mouse":22,"../math/math":30}],4:[function(t,e,i){var n,r;r=function(){function t(t,e,i,n){this.r=null!=t?t:1,this.g=null!=e?e:1,this.b=null!=i?i:1,this.a=null!=n?n:1,this.r>1&&(this.r=this.r/255),this.g>1&&(this.g=this.g/255),this.b>1&&(this.b=this.b/255),this.a>1&&(this.a=this.a/255)}return t.prototype.DIM=4,t.prototype.flatten=function(){return[this.r,this.g,this.b,this.a]},t.WHITE=function(){return new t(1,1,1,1)},t.BLACK=function(){return new t(0,0,0,1)},t.MAGNOLIA=function(){return new t(1,1,.9,1)},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b,this.a)},t}(),n=function(){function t(t,e,i){this.r=t,this.g=e,this.b=i,this.r>1&&(this.r=this.r/255),this.b>1&&(this.g=this.g/255),this.g>1&&(this.b=this.b/255)}return t.prototype.DIM=3,t.prototype.flatten=function(){return[this.r,this.g,this.b]},t.WHITE=function(){return new t(1,1,1)},t.BLACK=function(){return new t(0,0,0)},t.MAGNOLIA=function(){return new r(1,1,.9)},t.prototype.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},t.prototype.clone=function(){return new t(this.r,this.g,this.b)},t}(),e.exports={RGBA:r,RGB:n}},{}],5:[function(t,e,n){var r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C=function(t,e){return function(){return t.apply(e,arguments)}},R=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};_=t("../math/math"),f=_.Vec2,d=_.Vec3,m=_.Vec4,o=_.Matrix4,p=t("../gl/shader").Shader,b=t("../camera/camera"),c=b.PerspCamera,a=b.OrthoCamera,w=t("../interact/mouse"),x=w.makeMouseEmitter,M=w.removeMouseEmitter,L=t("../interact/touch"),y=L.makeTouchEmitter,S=L.removeTouchEmitter,T=t("../interact/key"),v=T.makeKeyEmitter,E=T.removeKeyEmitter,s=t("../colour/colour").Colour,P=t("../util/log"),h=P.PXLError,l=P.PXLWarning,u=P.PXLLog,g=t("../util/debug").makeDebugContext,r=function(){function t(t){return this.getDelta=C(this.getDelta,this),this.run=C(this.run,this),null==t.canvas?void h("No WebGL Canvas Provided"):(this.debug=null!=t.debug&&t.debug,this.app_context=t.context,this.update=t.update,this.draw=t.draw,this.init=t.init,this.user_shutdown=t.shutdown,this.canvas=document.getElementById(t.canvas),this.canvas||h("Trying to create an app on canvas that does not exist"),this._pause=null!=t.pause&&t.pause,this.height=this.canvas.height,this.width=this.canvas.width,void this._context())}if(t.prototype._context=function(){var t;if(t=function(t){return function(e){var n,r,s,o;for(e.preventDefault(),n=0,o=PXL.Applications.length,r=0,s=o.length;r<s&&(n=o[r],!(PXL.Applications[i][0]=t));r++);return PXL.Applications.splice(n,1),t._context()}}(this),this.canvas.addEventListener("webglcontextlost",t,!1),null==this.gl&&this._initContext(),x(this),y(this),v(this),this.resizeCanvas(this.canvas.width,this.canvas.height),null!=this.init&&this.init.call(this.app_context),this.contextTime=0,"undefined"!=typeof window&&null!==window)return window.onEachFrame(this,this.run)},t.prototype._initContext=function(){var t,e,i,n;for(n=["experimental-webgl","webgl","moz-webgl","webkit-3d"],t=0,e=n.length;t<e;t++)if(i=n[t],this.gl=this.canvas.getContext(i),null!=this.gl)return this._profile(),this._framescounter=0,void(this.debug&&u("creating OpenGL debug context"));return this.gl||(null!=this.onError&&this.onError(),h("WebGL Not supported or context not found","App")),this},"undefined"!=typeof navigator&&null!==navigator)var e={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(t){for(var e=0;e<t.length;e++){var i=t[e].string,n=t[e].prop;if(this.versionSearchString=t[e].versionSearch||t[e].identity,i){if(i.indexOf(t[e].subString)!=-1)return t[e].identity}else if(n)return t[e].identity}},searchVersion:function(t){var e=t.indexOf(this.versionSearchString);if(e!=-1)return parseFloat(t.substring(e+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};return t.prototype._profile=function(){function t(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}var i,n;if(this.profile={},this.profile.antialias=this.gl.getContextAttributes().antialias,this.profile.aa_size=this.gl.getParameter(this.gl.SAMPLES),i=this.gl.getShaderPrecisionFormat(this.gl.FRAGMENT_SHADER,this.gl.HIGH_FLOAT),this.profile.highpSupported=0!==i.precision,this.profile.maxTexSize=this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),this.profile.maxCubeSize=this.gl.getParameter(this.gl.MAX_CUBE_MAP_TEXTURE_SIZE),this.profile.maxRenderbufferSize=this.gl.getParameter(this.gl.MAX_RENDERBUFFER_SIZE),this.profile.vertexTextureUnits=this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.profile.fragmentTextureUnits=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.profile.combinedUnits=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.profile.maxVSattribs=this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),this.profile.maxVertexShaderUniforms=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS),this.profile.maxFragmentShaderUniforms=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS),this.profile.maxVaryings=this.gl.getParameter(this.gl.MAX_VARYING_VECTORS),this.profile.extensions=this.gl.getSupportedExtensions(),this.profile.maxBufferSize=65536,"undefined"!=typeof navigator&&null!==navigator)return e.init(),this.profile.browser=e.browser,this.profile.os=e.OS,this.profile.version=e.version,n=this.gl.getSupportedExtensions(),this.profile.extensions=[],R.call(n,"OES_standard_derivatives")>=0&&(this.profile.extensions.push("OES_standard_derivatives"),this.gl.getExtension("OES_standard_derivatives")),R.call(n,"OES_texture_float")>=0&&(this.profile.extensions.push("OES_texture_float"),this.gl.getExtension("OES_texture_float")),this.profile.mobile=t(),console.log(this.profile)},t.prototype.run=function(){if(!this._pause)return this._framescounter>0&&(this._framescounter--,this._framescounter<=0&&this.pause(!0)),this._draw(this.getDelta())},t.prototype.pause=function(t){return null==t?this._pause=!this._pause:this._pause=t,this._pause||(this.startTime=Date.now(),this.oldTime=this.startTime,this.canvas.focus()),this.pauseKeyEmitter(this._pause),this.pauseTouchEmitter(this._pause),this.pauseMouseEmitter(this._pause),this},t.prototype.getDelta=function(){var t;return t=Date.now()-this.oldTime,this.oldTime=Date.now(),t},t.prototype.switchContext=function(t){return null!=t?(PXL.Context=t,"undefined"!=typeof window&&null!==window&&(window.GL=t.gl)):PXL.Context!==this&&(PXL.Context=this,"undefined"!=typeof window&&null!==window&&(window.GL=this.gl)),this},t.prototype.resizeCanvas=function(t,e){return this.switchContext(),this.canvas&&this.gl&&(this.width=t,this.height=e,this.canvas.width=t,this.canvas.height=e),this},t.prototype._draw=function(t){if(this.contextTime=Date.now()-this.startTime,this.switchContext(),null!=this.draw)return this.draw.call(this.app_context,t)},t.prototype.shutdown=function(){return this.pause(!0),null!=this.user_shutdown&&this.user_shutdown.call(this.app_context),M(this),S(this),E(this),this},t}(),e.exports={App:r}},{"../camera/camera":3,"../colour/colour":4,"../gl/shader":13,"../interact/key":21,"../interact/mouse":22,"../interact/touch":23,"../math/math":30,"../util/debug":35,"../util/log":36}],6:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};d=t("../math/math"),l=d.Vec3,c=d.Vec4,o=d.Matrix3,a=d.Matrix4,f=t("../gl/webgl").matchWithShader,s=t("../geometry/primitive").Geometry,n=t("../gl/contract").Contract,u=t("../util/log").PXLWarningOnce,m=t("./node_paths"),r=m.Front,p=m.main_draw,g=t("../util/util"),h=function(){function t(t,e,i){this.geometry=t,this.material=e,this.shader=i,this.matrix=new a,this.globalMatrix=new a,this._normalMatrix=new o,this._mvpMatrix=new a,this.children=[],this.contract=new n,this.contract.roles.uModelMatrix="globalMatrix",this.contract.roles.uMVPMatrix="_mvpMatrix",this.contract.roles.uNormalMatrix="_normalMatrix",this.contract.roles.uUber0="_uber0",this._cached=null,this.pointLights=[],this.spotLights=[],this.spotLightShadowMaps=[]}return t.prototype.add=function(t){return"function"==typeof t._addToNode&&t._addToNode(this),this},t.prototype.remove=function(t){return"function"==typeof t._removeFromNode&&t._removeFromNode(this),this},t.prototype._addToNode=function(t){return t.children.push(this),this},t.prototype.clone=function(){return g.clone(this)},t.prototype.del=function(t){var e;return v.call(this.children,t)>=0&&(e=this.children.indexOf(t),this.children.splice(e,1)),this},t.prototype._removeFromNode=function(t){return t.del(this),this},t.prototype.draw=function(){var t;return t=new r,t._uber0=0,p(this,t)},t}(),e.exports={Node:h}},{"../geometry/primitive":9,"../gl/contract":11,"../gl/webgl":17,"../math/math":30,"../util/log":36,"../util/util":43,"./node_paths":7}],7:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S;L=t("../math/math"),g=L.Vec3,v=L.Vec4,u=L.Matrix3,l=L.Matrix4,w=t("../gl/webgl").matchWithShader,T=t("../camera/camera"),n=T.Camera,p=T.PerspCamera,h=t("../material/material").Material,s=t("../material/depth").DepthMaterial,m=t("../gl/texture").Texture,P=t("../light/light"),f=P.PointLight,d=P.SpotLight,a=t("../geometry/primitive").Geometry,r=t("../gl/contract").Contract,c=t("../util/log").PXLWarningOnce,M=t("../gl/uber_shader_paths"),S=t("../util/util"),o=function(){function t(){this.globalMatrix=new l,this.pointLights=[],this.spotLights=[],this._normalMatrix=new l,this._mvpMatrix=new l,this._uber0=0,this.camera=void 0,this.shader=void 0,this.skeleton=void 0}return t.prototype.clone=function(){var e;return e=new t,e.globalMatrix.copy(this.globalMatrix),e.pointLights=this.pointLights.slice(0),e.spotLights=this.spotLights.slice(0),e._normalMatrix.copy(this._normalMatrix),e._mvpMatrix.copy(this._mvpMatrix),e._uber0=this._uber0,e.camera=this.camera,e.shader=this.shader,e.material=this.material,e.contract=this.contract,e.skeleton=this.skeleton,e},t}(),y=new s,x=new p(new g(0,1,0),new g(0,0,0),new g(1,0,0),3,.1,100),E=function(t,e,i){var n,r;return n=e.clone(),x.pos.copy(i.pos),x.look.copy(g.add(i.pos,i.dir)),x.up.copy(g.perp(i.dir)),x.angle=i.angle,x.far=i.attenuation[0],n.camera=x,r=e.globalMatrix.clone(),r.mult(x.m),r.mult(x.p),i.invMatrix.copy(r),i.shadowmap_fbo.bind(),n.camera.update(),GL.clearColor(0,0,0,0),GL.clear(GL.COLOR_BUFFER_BIT|GL.DEPTH_BUFFER_BIT),_(t,n,i),i.shadowmap_fbo.unbind()},_=function(t,e,i){var n,r,s,o,a,h,u,p,f,d,m;e.globalMatrix=l.mult(e.globalMatrix,t.matrix),p=t.globalMatrix.clone(),e.material=y,e.material._preDraw(),e._uber0=e.material._uber0,e._uber0=M.uber_vertex_camera(!0,e._uber0),p=l.mult(e.camera.m,p),e._mvpMatrix.copy(p),e._mvpMatrix.mult(e.camera.m),e._mvpMatrix.mult(e.camera.p),e._normalMatrix=p.getMatrix3().invert().transpose(),null!=t.geometry&&(t.geometry.brewed||t.geometry.brew(),e.geometry=t.geometry);for(a in t.contract.roles)null==e[a]&&(e[a]=t[a]);if(e.contract=t.contract,null!=t.skeleton&&(t.skeleton._preDraw(),e.skeleton=t.skeleton,e._uber0=M.uber_vertex_skinning(!0,e._uber0)),null!=PXL.Context.gl&&null!=e.geometry&&null!=e.shader){if(PXL.Context.shader=e.shader,PXL.Context.shader.bind(),w(e),PXL.Context.debug)for(f=PXL.Context.shader.contract.findUnmatched(),s=0,h=f.length;s<h;s++)m=f[s],c("Unmatched uniform/attribute in shader: "+m.name);e.geometry.drawGL()}for(d=t.children,o=0,u=d.length;o<u;o++)n=d[o],r=e.clone(),_(n,r,i);return t},b=function(t,e){var i,n,r,s,o,a,h,u,p,m,g,v,x,y,_,L,T,P;for(e.globalMatrix=l.mult(e.globalMatrix,t.matrix),x=t.globalMatrix.clone(),null!=t.camera&&(e.camera=t.camera,e.camera.update(),e._uber0=M.uber_vertex_camera(!0,e._uber0)),null!=e.camera&&(x=l.mult(e.camera.m,x),e._mvpMatrix.copy(x),e._mvpMatrix.mult(e.camera.m),e._mvpMatrix.mult(e.camera.p)),e._normalMatrix=x.getMatrix3().invert().transpose(),y=t.pointLights,r=0,u=y.length;r<u;r++)v=y[r],e.pointLights.push(v);for(t.pointLights.length>0&&(e._uber0=M.uber_lighting_point(!0,e._uber0)),_=t.spotLights,s=0,p=_.length;s<p;s++)v=_[s],v.shadowmap&&(null!=PXL.Context.gl&&(E(t,e,v),e.spotLights.push(v)),e._uber0=M.uber_shadowmap(!0,e.uber0)),e._uber0=M.uber_lighting_spot(!0,e._uber0);null!=t.ambientLight&&(e.ambientLight=t.ambientLight),null!=t.shader&&(e.shader=t.shader),null!=t.geometry&&(t.geometry.brewed||t.geometry.brew(),e.geometry=t.geometry),null!=t.skeleton&&(t.skeleton._preDraw(),e.skeleton=t.skeleton,e._uber0=M.uber_vertex_skinning(!0,e._uber0)),null!=t.material&&(null!=e.material&&!e.material._override||null==e.material)&&(t.material._preDraw(),e.material=t.material,e._uber0=M.uber_clear_material(e._uber0)|t.material._uber0);for(a in t.contract.roles)null==e[a]&&(e[a]=t[a]);if(e.contract=t.contract,null!=PXL.Context.gl&&null!=e.geometry&&null!=e.shader){if(f._preDraw(e.pointLights),d._preDraw(e.spotLights),PXL.Context.shader=e.shader,PXL.Context.shader.bind(),w(e),PXL.Context.debug)for(L=PXL.Context.shader.contract.findUnmatched(),o=0,m=L.length;o<m;o++)P=L[o],c("Unmatched uniform/attribute in shader: "+P.name);e.geometry.drawGL(),PXL.Context.shader.unbind(),PXL.Context.shader=void 0}for(T=t.children,h=0,g=T.length;h<g;h++)i=T[h],n=e.clone(),b(i,n);return null!=e.material&&e.material._postDraw(),null!=e.skeleton&&e.skeleton._postDraw(),t},e.exports={Front:o,main_draw:b}},{"../camera/camera":3,"../geometry/primitive":9,"../gl/contract":11,"../gl/texture":14,"../gl/uber_shader_paths":16,"../gl/webgl":17,"../light/light":24,"../material/depth":26,"../material/material":27,"../math/math":30,"../util/log":36,"../util/util":43}],8:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x=function(t,e){function i(){this.constructor=t}for(var n in e)y.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},y={}.hasOwnProperty;m=t("../colour/colour"),l=m.RGBA,u=m.RGB,g=t("../math/math"),r=g.Matrix4,c=g.Vec2,p=g.Vec3,f=g.Vec4,v=t("./primitive"),n=v.Geometry,d=v.Vertex,h=v.Quad,s=function(t){function e(t,i){var n,r,s,o,a,u,f,m,g,v,x,y,_,b,w,L,T,P;for(null==t&&(t=1),null==i&&(i=1),e.__super__.constructor.call(this),this.v=[],this.faces=[],this.indexed=!0,this.indices=[],n=s=0,f=i-1;0<=f?s<=f:s>=f;n=0<=f?++s:--s)for(r=o=0,m=t-1;0<=m?o<=m:o>=m;r=0<=m?++o:--o)b=-1+2/t*r,T=-1+2/i*n,w=1/t*r,P=1/i*n,this.vertices.push(new d({p:new p(b,0,T),c:new l(1,1,1,1),n:new p(0,1,0),t:new c(w,P)}));for(L=a=0,g=i-2;0<=g?a<=g:a>=g;L=0<=g?++a:--a)for(_=u=0,v=t-2;0<=v?u<=v:u>=v;_=0<=v?++u:--u)x=t*L,y=t*(L+1),this.indices.push(x+_),this.indices.push(y+_),this.indices.push(x+_+1),this.indices.push(x+_+1),this.indices.push(y+_),this.indices.push(y+_+1),this.faces.push(new h(this.v[y+_],this.v[y+_+1],this.v[x+_+1],this.v[x+_]))}return x(e,t),e}(n),o=function(t){function e(t,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T;for(this.xres=null!=t?t:2,this.zres=null!=i?i:2,e.__super__.constructor.call(this),_=xres*zres,this.p=new Float32Array(3*_),this.t=new Float32Array(2*_),this.n=new Float32Array(3*_),this.c=new Float32Array(4*_),this.indices=new Uint16Array(xres*(zres-1)*2),this.indexed=!0,this.flat=!0,"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.TRIANGLE_STRIP),a=0,o=0,r=0,s=0,h=0,n=l=0,m=zres-1;0<=m?l<=m:l>=m;n=0<=m?++l:--l)for(u=c=0,g=xres-1;0<=g?c<=g:c>=g;u=0<=g?++c:--c)b=-1+2/(xres-1)*u,
L=-1+2/(zres-1)*n,this.p[a++]=b,this.p[a++]=0,this.p[a++]=L,w=1/(xres-1)*u,T=1/(zres-1)*n,this.t[o++]=w,this.t[o++]=T,this.c[r++]=1,this.c[r++]=1,this.c[r++]=1,this.c[r++]=1,this.n[s++]=0,this.n[s++]=1,this.n[s++]=0;for(n=p=0,v=zres-2;0<=v?p<=v:p>=v;n=0<=v?++p:--p)if(n%2===0)for(u=f=0,x=xres-1;0<=x?f<=x:f>=x;u=0<=x?++f:--f)this.indices[h++]=xres*n+u,this.indices[h++]=xres*(n+1)+u;else for(u=d=y=xres-1;y<=0?d<=0:d>=0;u=y<=0?++d:--d)this.indices[h++]=xres*(n+1)+u,this.indices[h++]=xres*n+u}return x(e,t),e.prototype.getTrisIndexer=function(){var t;return t=function(t){return function(e){return[new p(t.p[3*t.indices[e]],t.p[3*t.indices[e]+1],t.p[3*t.indices[e]+2]),new p(t.p[3*t.indices[e+1]],t.p[3*t.indices[e+1]+1],t.p[3*t.indices[e+1]+2]),new p(t.p[3*t.indices[e+2]],t.p[3*t.indices[e+2]+1],t.p[3*t.indices[e+2]+2])]}}(this)},e}(n),a=function(t){function e(t,i,n){var r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z,N,X,F,O,D,U,V,B,k,q,H,W,j,Y,K,J,Q,Z,$,tt,et,it;for(this.xres=null!=t?t:2,this.zres=null!=i?i:2,null==n&&(n=!0),e.__super__.constructor.call(this),l=Math.floor(this.zres/2)+1,K=3*this.xres*this.zres,this.indexed=n,this.indexed&&(K=l*(this.xres-1)+(this.zres-l+1)*(this.xres-2)),this.p=new Float32Array(3*K),this.t=new Float32Array(2*K),this.n=new Float32Array(3*K),this.c=new Float32Array(4*K),this.indices=new Uint16Array(3*this.xres*this.zres),this.y=new Float32Array(3*K),this.flat=!0,"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.TRIANGLES),v=0,m=0,p=0,f=0,x=0,y=0,o=0,g=0,k=[0,1],u=2/Math.ceil(this.xres/2),j=1/Math.ceil(this.xres/2),s=[[1,0,0],[0,1,0],[0,0,1]],R=this.p,Y=this.t,h=this.c,P=this.n,r=this.y,this.indexed||(K=l*(this.xres-1)+(this.zres-l+1)*(this.xres-2),R=new Float32Array(3*K),Y=new Float32Array(2*K),h=new Float32Array(4*K),P=new Float32Array(3*K),r=new Float32Array(3*K)),c=b=0,G=this.zres;0<=G?b<=G:b>=G;c=0<=G?++b:--b){for(S=0,W=0,V=this.xres-1,c%2===0&&(V=this.xres-2,S=u/2,W=j/2),o=k[g],_=w=0,z=V-1;0<=z?w<=z:w>=z;_=0<=z?++w:--w)Z=-1+_*u+S,et=-1+2/this.zres*c,R[v++]=Z,R[v++]=0,R[v++]=et,$=j*_+W,it=1/this.zres*c,Y[m++]=$,Y[m++]=it,h[p++]=1,h[p++]=1,h[p++]=1,h[p++]=1,P[f++]=0,P[f++]=1,P[f++]=0,r[y++]=s[o][0],r[y++]=s[o][1],r[y++]=s[o][2],o++,o>2&&(o=0);g++,g>1&&(g=0)}for(tt=L=0,N=this.zres-1;0<=N?L<=N:L>=N;tt=0<=N?++L:--L){for(D=Math.floor(tt/2)*(this.xres-2+this.xres-1),U=D+this.xres-2,H=Math.ceil(this.xres/2),a=Math.floor(this.xres/2),M=!1,tt%2!==0&&(M=!0,D=U,U=D+this.xres-1,K=H,H=a,a=K),Q=T=0,X=a-1;0<=X?T<=X:T>=X;Q=0<=X?++T:--T)M?this.indices[x++]=U+Q:this.indices[x++]=U+Q+1,this.indices[x++]=D+Q+1,this.indices[x++]=D+Q;for(Q=E=0,F=H-1;0<=F?E<=F:E>=F;Q=0<=F?++E:--E)this.indices[x++]=U+Q,this.indices[x++]=U+Q+1,M?this.indices[x++]=D+Q+1:this.indices[x++]=D+Q}if(m=0,p=0,d=0,f=0,y=0,!this.indexed){for(c=C=0,O=this.indices.length-1;0<=O?C<=O:C>=O;c=0<=O?++C:--C){for(x=this.indices[c],_=A=0;A<=2;_=++A)this.p[d++]=R[3*x+_];for(_=I=0;I<=3;_=++I)this.c[p++]=h[4*x+_];for(_=B=0;B<=1;_=++B)this.t[m++]=Y[2*x+_];for(_=q=0;q<=2;_=++q)this.n[f++]=P[3*x+_];for(_=J=0;J<=2;_=++J)this.y[y++]=r[3*x+_]}this.indices=[]}}return x(e,t),e}(n),e.exports={Plane:s,PlaneFlat:o,PlaneHexagonFlat:a}},{"../colour/colour":4,"../math/math":30,"./primitive":9}],9:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T=function(t,e){function i(){this.constructor=t}for(var n in e)P.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},P={}.hasOwnProperty;_=t("../colour/colour"),p=_.RGBA,c=_.RGB,b=t("../math/math"),o=b.Matrix4,m=b.Vec2,g=b.Vec3,v=b.Vec4,n=t("../gl/contract").Contract,s=t("../gl/webgl").GeometryBrewer,w=t("../util/log"),u=w.PXLWarning,a=w.PXLError,h=w.PXLLog,L=t("../util/util"),r=function(){function t(){this.vertices=[],"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.TRIANGLES),this.flat=!1,this._flat_sizes={},this.faces=[],this.indexed=!1,this.indices=[],this.contract=new n,this.contract.roles.aVertexPosition="vertexpBuffer",this.contract.roles.aVertexTexCoord="vertextBuffer",this.contract.roles.aVertexNormal="vertexnBuffer",this.contract.roles.aVertexColour="vertexcBuffer",this.contract.roles.aVertexTangent="vertexaBuffer",this.contract.roles.aVertexBarycentre="vertexyBuffer",this.contract.roles.aVertexSkinWeight="vertexwBuffer",this.contract.roles.aVertexBoneIndex="vertexiBuffer",L.extend(this,s),this.brewed=!1}return t.prototype._addToNode=function(t){return t.geometry=this,this},t.prototype.flatten=function(){var t,e,i,n,r;for(n=[],i=this.vertices,t=0,e=i.length;t<e;t++)r=i[t],n.concat(r.flatten());return n},t.prototype.setIndex=function(t,e){return this.indices[t]=e,this},t.prototype.setVertex=function(t,e){return this.vertices[t]=e,this},t.prototype.addVertex=function(t){return this.vertices.push(t),this},t.prototype.addIndex=function(t){return this.indices.push(t)},t.prototype.getTrisIndexer=function(){var t,e,i,n;return t=function(t){return function(e){return[new g(t.p[3*t.indices[3*e]],t.p[3*t.indices[3*e]+1],t.p[3*t.indices[3*e]+2]),new g(t.p[3*t.indices[3*e+1]],t.p[3*t.indices[3*e+1]+1],t.p[3*t.indices[3*e+1]+2]),new g(t.p[3*t.indices[3*e+2]],t.p[3*t.indices[3*e+2]+1],t.p[3*t.indices[3*e+2]+2])]}}(this),e=function(t){return function(e){return[new g(t.p[9*e],t.p[9*e+1],t.p[9*e+2]),new g(t.p[9*e+3],t.p[9*e+4],t.p[9*e+5]),new g(t.p[9*e+6],t.p[9*e+7],t.p[9*e+8])]}}(this),n=function(t){return function(e){return[t.vertices[t.indices[3*e]],t.vertices[t.indices[3*e+1]],t.vertices[t.indices[3*e+2]]]}}(this),i=function(t){return function(e){return[t.vertices[3*e],t.vertices[3*e+1],t.vertices[3*e+2]]}}(this),this.flat?this.indexed?t:e:this.indexed?n:i},t.prototype.getNumTris=function(){return this instanceof PlaneFlat?this.indices.length-2:this.flat?this.indexed?this.indices.length/3:this.p.length/3:this.indexed?this.indices.length/3:this.vertices.length/3},t}(),x=function(){function t(t){var e;for(e in t)this[e]=t[e];null==this.p&&(this.p=new g(0,0,0))}return t.prototype.flatten=function(){var t,e;e=[];for(t in this)e.concat(this[t].flatten());return e},t}(),f=function(t){function e(t,i,n,r){this.n=r,e.__super__.constructor.call(this),null==t||null==i||null==n?this.vertices=[new x({p:new g((-1),(-1),0)}),new x({p:new g(1,(-1),0)}),new x({p:new g(0,1,0)})]:this.vertices=[t,i,n],null==this.n&&this.computeFaceNormal()}return T(e,t),e.prototype.flatten=function(){var t;return t=[],t=t.concat(this.vertices[0].flatten()),t=t.concat(this.vertices[1].flatten()),t=t.concat(this.vertices[2].flatten())},e.prototype.computeFaceNormal=function(){var t,e;return t=g.sub(this.vertices[1].p,this.vertices[0].p),e=g.sub(this.vertices[2].p,this.vertices[1].p),this.n=t.cross(e),this.n.normalize(),this},e}(r),l=function(t){function e(t,i,n,r,s){var o;this.n=s,e.__super__.constructor.call(this),null!=t&&null!=i&&null!=n&&null!=r||(t=new x({p:new g((-1),1,0),c:new p(1,1,1,1),n:new g(0,0,1),t:new m(0,1)}),i=new x({p:new g((-1),(-1),0),c:new p(1,1,1,1),n:new g(0,0,1),t:new m(0,0)}),n=new x({p:new g(1,1,0),c:new p(1,1,1,1),n:new g(0,0,1),t:new m(1,1)}),r=new x({p:new g(1,(-1),0),c:new p(1,1,1,1),n:new g(0,0,1),t:new m(1,0)})),this.vertices=[t,i,n,r],o=GL,"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.TRIANGLE_STRIP),null==this.n&&this.computeFaceNormal()}return T(e,t),e.prototype.computeFaceNormal=function(){var t,e;return t=g.sub(this.vertices[1].p,this.vertices[0].p),e=g.sub(this.vertices[2].p,this.vertices[1].p),this.n=t.cross(e),this.n.normalize(),this},e.prototype.flatten=function(){var t;return t=[],t=t.concat(this.vertices[0].flatten()),t=t.concat(this.vertices[1].flatten()),t=t.concat(this.vertices[2].flatten()),t=t.concat(this.vertices[3].flatten())},e}(r),y=function(t){function e(t){var i;e.__super__.constructor.call(this),i=GL,"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.POINTS),this.vertices=t}return T(e,t),e}(r),d=function(t){function e(t){e.__super__.constructor.call(this),this.vertices=[],this.faces=[],this.indexed=t,"undefined"!=typeof GL&&null!==GL&&(this.layout=GL.TRIANGLES)}return T(e,t),e.prototype.addTriangle=function(t){var e,i,n,r,s,o,a,h;if(this.indexed)for(e=i=0;i<=2;e=++i)s=this._findV(t.vertices[e]),s===-1?(this.vertices.push(t.vertices[e]),a=this.vertices.length,a-=1,t.vertices[e]._idx=a,this.indices.push(a)):this.indices.push(s);else for(o=t.v,n=0,r=o.length;n<r;n++)h=o[n],this.vertices.push(h);return this.faces.push(t),this},e.prototype.addTriangleFromIndices=function(t){var e,i,n,r,s;if(this.indexed){for(r=[],i=0,n=t.length;i<n;i++)e=t[i],e>-1&&e<this.indices.length?r.push(this.vertices[e]):a("Attempting to create a triangle from indicies that dont exist");s=new f(this.vertices[r[0]],this.vertices[r[1]],this.vertices[r[2]]),this.faces.push(s)}return this},e.prototype.addQuad=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,d,m,g,v;if(null!=this.indexed==!0){for(p=[0,1,3],n=0,o=p.length;n<o;n++)i=p[n],c=this._findV(t.vertices[i]),c===-1?(this.vertices.push(t.vertices[i]),v=this.vertices.length,v-=1,t.vertices[i]._idx=v,this.indices.push(v)):this.indices.push(c);for(d=[2,3,1],r=0,a=d.length;r<a;r++)i=d[r],c=this._findV(t.vertices[i]),c===-1?(this.vertices.push(t.vertices[i]),v=this.vertices.length,v-=1,t.vertices[i]._idx=v,this.indices.push(v)):this.indices.push(c)}else{for(m=[0,1,3],s=0,h=m.length;s<h;s++)e=m[s],this.vertices.push(t.vertices[e]);for(g=[2,3,1],l=0,u=g.length;l<u;l++)e=g[l],this.vertices.push(t.vertices[e])}return this.faces.push(new f(t.vertices[0],t.vertices[1],t.vertices[3])),this.faces.push(new f(t.vertices[2],t.vertices[3],t.vertices[1])),this},e.prototype._findV=function(t){var e,i,n;if(null!=t._idx)return t._idx;if(this.vertices.length>0)for(e=i=0,n=this.vertices.length-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)if(this.vertices[e]===t)return e;return-1},e}(r),e.exports={Geometry:r,Vertex:x,Triangle:f,Quad:l,TriangleMesh:d,VertexSoup:y}},{"../colour/colour":4,"../gl/contract":11,"../gl/webgl":17,"../math/math":30,"../util/log":36,"../util/util":43}],10:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_=function(t,e){function i(){this.constructor=t}for(var n in e)b.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},b={}.hasOwnProperty;o=t("../core/node").Node,v=t("../colour/colour"),u=v.RGB,l=v.RGBA,x=t("../math/math"),f=x.Vec2,d=x.Vec3,a=x.PI,g=x.degToRad,y=t("./primitive"),m=y.Vertex,p=y.Triangle,h=y.Quad,s=y.Geometry,n=function(t){function e(t,i){var n,r,s,o,a,h,u,l,c,g;if(e.__super__.constructor.call(this),this.indexed=!0,null==t&&(t=new d(1,1,1)),g=t.x/2,r=t.y/2,n=t.z/2,this.vertices.push(new m({p:new d((-g),(-r),n),n:d.normalize(new d((-g),(-r),n)),t:new f(0,0)})),this.vertices.push(new m({p:new d(g,(-r),n),n:d.normalize(new d(g,(-r),n)),t:new f(1,0)})),this.vertices.push(new m({p:new d(g,r,n),n:d.normalize(new d(g,r,n)),t:new f(1,1)})),this.vertices.push(new m({p:new d((-g),r,n),n:d.normalize(new d((-g),r,n)),t:new f(0,1)})),this.vertices.push(new m({p:new d((-g),(-r),(-n)),n:d.normalize(new d((-g),(-r),(-n))),t:new f(1,1)})),this.vertices.push(new m({p:new d(g,(-r),(-n)),n:d.normalize(new d(g,(-r),(-n))),t:new f(1,0)})),this.vertices.push(new m({p:new d(g,r,(-n)),n:d.normalize(new d(g,r,(-n))),t:new f(0,0)})),this.vertices.push(new m({p:new d((-g),r,(-n)),n:d.normalize(new d((-g),r,(-n))),t:new f(0,1)})),null!=i)for(u=this.vertices,o=0,h=u.length;o<h;o++)c=u[o],c.c=i;for(this.indices=[0,1,2,0,2,3,6,5,4,6,4,7,4,0,3,4,3,7,1,5,2,5,6,2,3,2,6,3,6,7,4,5,1,4,1,0],s=a=0,l=this.indices.length-1;a<=l;s=a+=3)this.faces.push(new p(this.vertices[this.indices[s]],this.vertices[this.indices[s+1]],this.vertices[this.indices[s+2]]))}return _(e,t),e}(s),c=function(t){function e(t,i,n){var r,s,o,h,u,c,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I;for(e.__super__.constructor.call(this),h=PXL.Context.gl,this.layout=h.TRIANGLE_STRIP,null!=t&&t<0&&(t=1),null!=i?i<0&&(i=10):i=10,c=g=0,L=i/2;0<=L?g<=L:g>=L;c=0<=L?++g:--g)for(C=2*c*a/i-a/2,R=2*(c+1)*a/i-a/2,u=v=0,T=i+1;0<=T?v<=T:v>=T;u=0<=T?++v:--v)s=new d,A=2*u*a/i,s.x=Math.cos(C)*Math.cos(A),s.y=Math.sin(C),s.z=Math.cos(C)*Math.sin(A),b=d.multScalar(s,t),r=new l(1,1,1,1),M=new f(.999-u/i,.999-2*c/i),I=new m({p:b,t:M,n:s}),this.vertices.push(I),o=new d,o.x=Math.cos(R)*Math.cos(A),o.y=Math.sin(R),o.z=Math.cos(R)*Math.sin(A),w=d.multScalar(o,t),S=new f(.999-u/i,.999-2*(c+1)/i),I=new m({p:w,n:o,t:S}),this.vertices.push(I);for(u=y=2,P=this.vertices.length-1;y<=P;u=y+=1)u%2===0?this.faces.push(new p(this.vertices[u],this.vertices[u-1],this.vertices[u-2])):this.faces.push(new p(this.vertices[u],this.vertices[u-2],this.vertices[u-1]));if(null!=n)for(E=this.vertices,_=0,x=E.length;_<x;_++)I=E[_],I.c=n}return _(e,t),e}(s),r=function(t){function e(t,i,n,r,s){var o,a,h,u,c,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z,N,X,F,O,D,U,V;for(e.__super__.constructor.call(this),this.indices=[],this.indexed=!0,null!=t?t<0&&(t=.5):t=.5,null!=i?i<0&&(i=10):i=10,null!=n?n<0&&(n=10):n=10,null!=r?r<0&&(r=1):r=1,a=r/n,r/=2,this.vertices.push(new m({p:new d(0,r,0),n:new d(0,1,0),t:new f(.5,0),a:new f(0,0,0)})),h=c=1,C=i;1<=C?c<=C:c>=C;h=1<=C?++c:--c)U=t*Math.sin(g(360/i*h)),V=t*Math.cos(g(360/i*h)),O=new d(U,0,V),O.normalize(),O.cross(new d(0,1,0)),this.vertices.push(new m({p:new d(U,r,V),n:d.normalize(new d(U,1,V)),t:new f(h/i,0),a:O}));for(h=v=1,R=i;1<=R?v<=R:v>=R;h=1<=R?++v:--v)this.indices.push(0),this.indices.push(h),h===i?this.indices.push(1):this.indices.push(h+1);for(h=y=1,A=n;1<=A?y<=A:y>=A;h=1<=A?++y:--y){for(u=_=1,I=i;1<=I?_<=I:_>=I;u=1<=I?++_:--_)U=t*Math.sin(g(360/i*u)),V=t*Math.cos(g(360/i*u)),O=new d(U,0,V),O.normalize(),O.cross(new d(0,(-1),0)),b=d.normalize(new d(U,0,V)),h===n&&(b=d.normalize(new d(U,(-1),V))),this.vertices.push(new m({p:new d(U,r-a*h,V),n:b,t:new f(u/i,h/n),a:O}));for(X=(h-1)*i+1,o=X+i,u=w=0,G=i-1;0<=G?w<=G:w>=G;u=0<=G?++w:--w)this.indices.push(X+u),this.indices.push(o+u),u===i-1?this.indices.push(o):this.indices.push(o+u+1);for(u=L=0,z=i-1;0<=z?L<=z:L>=z;u=0<=z?++L:--L)this.indices.push(X+u),u===i-1?(this.indices.push(o),this.indices.push(X)):(this.indices.push(o+u+1),this.indices.push(X+u+1))}for(this.vertices.push(new m({p:new d(0,(-r),0),n:new d(0,(-1),0),t:new f(.5,1),a:new d(0,0,0)})),X=n*i+2,o=X+i-1,h=T=N=X,E=o;N<=E?T<=E:T>=E;h=N<=E?++T:--T)this.indices.push(X-1),h===o?this.indices.push(X):this.indices.push(h+1),this.indices.push(h);for(h=P=0,M=this.indices.length-1;P<=M;h=P+=3)this.faces.push(new p(this.vertices[this.indices[h]],this.vertices[this.indices[h+1]],this.vertices[this.indices[h+2]]));if(null!=s)for(null==s.a&&(s=new l(s.r,s.g,s.b,1)),S=this.vertices,F=0,x=S.length;F<x;F++)D=S[F],D.c=s}return _(e,t),e}(s),e.exports={Cuboid:n,Sphere:c,Cylinder:r}},{"../colour/colour":4,"../core/node":6,"../math/math":30,"./primitive":9}],11:[function(t,e,i){var n,r;r=t("../util/util"),n=function(){function t(t,e,i){var n;if(this.attributes=t,this.uniforms=e,this.roles={},null!=i)for(n in i)this.roles[n]=i[n];this.matches={}}return t.join=function(t,e){var i,n,r,s,o,a,h,u,l;for(h=t.uniforms,n=0,s=h.length;n<s;n++)l=h[n],null!=e.contract.roles[l.name]&&(a=e[e.contract.roles[l.name]],t.matches[l.name]=a,e.contract.matches[l.name]=a);for(u=t.attributes,r=0,o=u.length;r<o;r++)i=u[r],null!=e.contract.roles[i.name]&&(a=e[e.contract.roles[i.name]],t.matches[i.name]=a,e.contract.matches[i.name]=a);return t},t.prototype.add=function(t,e){return this.roles[t]=e,this},t.prototype.hasRoleValue=function(t){var e;for(e in this.roles)if(this.roles[e]===t)return!0;return!1},t.prototype.findUnmatched=function(){var t,e,i,n,r,s,o,a,h;if(h=[],null!=this._cached){for(s=this.uniforms,e=0,n=s.length;e<n;e++)a=s[e],null==this.matches[a.name]&&h.push(a);for(o=this.attributes,i=0,r=o.length;i<r;i++)t=o[i],null==this.matches[t.name]&&h.push(t)}return h},t}(),e.exports={Contract:n}},{"../util/util":43}],12:[function(t,e,i){var n,r,s,o,a,h,u,l,c;l=t("../util/log"),s=l.PXLError,r=l.PXLDebug,c=t("../colour/colour"),o=c.RGB,a=c.RGBA,u=t("../math/math").Vec2,h=t("./texture").TextureBase,n=function(){function t(t,e,i,n,s){var o;this.width=t,this.height=e,this.channels=i,this.datatype=n,this.depth=s,o=PXL.Context.gl,null!=this.width&&null!=this.height||(this.width=PXL.Context.width,this.height=PXL.Context.height),null==this.channels&&(this.channels=o.RGBA),null==this.datatype&&(this.datatype=o.UNSIGNED_BYTE),null==this.depth&&(this.depth=!0),this.framebuffer=o.createFramebuffer(),r("Created an FBO  with dimensions: "+this.width+","+this.height),this._build()}return t.prototype.resize=function(t,e){if(t instanceof u)this.width=t.x,this.height=t.y;else{if(null==t||null==e)return this;this.width=t,this.height=e}return this._build(),this},t.prototype._build=function(){var t,e;if(t=PXL.Context.gl,t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),null==this.texture?(e={min:t.LINEAR,max:t.LINEAR,wraps:t.CLAMP_TO_EDGE,wrapt:t.CLAMP_TO_EDGE,width:this.width,height:this.height,channels:this.channels,datatype:this.datatype},this.texture=new h(e),this.texture.build()):(this.texture.bind(),t.texImage2D(t.TEXTURE_2D,0,this.channels,this.width,this.height,0,this.channels,this.datatype,null)),this.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture.texture,0),this.depth&&(t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer)),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),this.texture.unbind(),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)return s("Failed to Create Framebuffer!")},t.prototype.bind=function(){var t;return t=PXL.Context.gl,t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),this},t.prototype.unbind=function(){var t;return t=PXL.Context.gl,t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),this},t.prototype.clear=function(t){var e;return e=PXL.Context.gl,null==t?e.clearColor(0,0,0,0):t instanceof a?e.clearColor(t.r,t.g,t.b,t.a):t instanceof o&&e.clearColor(t.r,t.g,t.b,1),this.depth?e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT):e.clear(e.COLOR_BUFFER_BIT),this},t.prototype.washUp=function(){var t;return t=PXL.Context.gl,t.deleteFramebuffer(this.framebuffer),t.deleteRenderbuffer(this.renderbuffer),t.deleteTexture(this.texture.texture),this},t}(),e.exports={Fbo:n}},{"../colour/colour":4,"../math/math":30,"../util/log":36,"./texture":14}],13:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m;f=t("../math/math"),s=f.Matrix4,l=f.Vec2,c=f.Vec3,p=f.Vec4,r=t("../light/light").Light,d=t("../util/log"),o=d.PXLError,h=d.PXLWarning,a=d.PXLLog,n=t("./contract").Contract,u=function(){function t(t,e,i){this.vertex_source=t,this.fragment_source=e,"undefined"!=typeof PXL&&null!==PXL&&null!=PXL.Context.gl&&(this._compile(this.vertex_source,this.fragment_source),this.contract=new n(this._getAttributes(),this._getUniforms(),i)),this._uber=!1}return t.prototype._compile=function(t,e){var i,n,r,s,a,u;for(r=PXL.Context.gl,this.vertexShader=r.createShader(r.VERTEX_SHADER),this.vertexShader||o("No vertex shader object could be created"),this.fragmentShader=r.createShader(r.FRAGMENT_SHADER),this.fragmentShader||o("No Fragment shader object could be created"),r.shaderSource(this.vertexShader,t),r.compileShader(this.vertexShader),r.getShaderParameter(this.vertexShader,r.COMPILE_STATUS)||(this._printLog(this.vertexShader,t,"vertex"),o("Failed to compiled Vertex Shader")),r.shaderSource(this.fragmentShader,e),r.compileShader(this.fragmentShader),r.getShaderParameter(this.fragmentShader,r.COMPILE_STATUS)||(this._printLog(this.fragmentShader,e,"fragment"),o("Failed to compile Fragment Shader")),this.shaderProgram=r.createProgram(),r.attachShader(this.shaderProgram,this.vertexShader),r.attachShader(this.shaderProgram,this.fragmentShader),r.bindAttribLocation(this.shaderProgram,0,"aVertexPosition"),r.linkProgram(this.shaderProgram),r.validateProgram(this.shaderProgram),u=r.getProgramParameter(this.shaderProgram,r.LINK_STATUS),u||(h(r.getProgramInfoLog(this.shaderProgram)),o("Failed to Link Shader"),WebGLActiveInfo),n=this._getAttributes(),s=0,a=n.length;s<a;s++)i=n[s],r.bindAttribLocation(this.shaderProgram,i.pos,i.name);return this},t.prototype._printLog=function(t,e,i){var n,r,s,h,u,l,c;for(n=PXL.Context.gl.getShaderInfoLog(t),a("Shader compiler log: "+n),c="",u=1,l=e.split("\n"),r=0,h=l.length;r<h;r++)s=l[r],c+=u+": "+s+"\n",u++;return a(c),this._splitError(n,e),o("Could not compile "+i+" shader")},t.prototype._addToNode=function(t){return t.shader=this,this},t.prototype._splitError=function(t,e){var i,n,r,s,o,h,u,l,c;for(u=t.split("\n"),r=0,s=u.length;r<s;r++)o=u[r],l=o.match(/ERROR: (\d+):(\d+): (.*)/),l&&(n=parseInt(l[1],10)-1,h=parseInt(l[2],10)-1,c=l[3],i=e.split("\n"),a("Shader Error Log: "+n+", "+h+", "+c+","+i[h]));return this},t.prototype._getLocation=function(t){return PXL.Context.gl.getUniformLocation(this.shaderProgram,t)},t.prototype.bind=function(){return PXL.Context.gl.useProgram(this.shaderProgram),PXL.Context.shader=this,this},t.prototype.unbind=function(){return PXL.Context.gl.useProgram(null),this},t.prototype.washUp=function(){var t;return t=PXL.Context.gl,t.detachShader(this.shaderProgram,this.vertexShader),t.detachShader(this.shaderProgram,this.fragmentShader),t.deleteProgram(this.shaderProgram),t.deleteShader(this.vertexShader),t.deleteShader(this.fragmentShader),this},t.prototype._getAttributes=function(){var t,e,i,n,r,s,o;if(null==this.attributes)for(i=PXL.Context.gl,s=i.getProgramParameter(this.shaderProgram,GL.ACTIVE_ATTRIBUTES),this.attributes=[],n=r=0,o=s-1;0<=o?r<=o:r>=o;n=0<=o?++r:--r)t=i.getActiveAttrib(this.shaderProgram,n),e={name:t.name,pos:i.getAttribLocation(this.shaderProgram,t.name),type:t.type,size:t.size},this.attributes.push(e);return this.attributes},t.prototype._getUniforms=function(){var t,e,i,n,r,s,o,a;if(null==this.uniforms)for(t=PXL.Context.gl,n=t.getProgramParameter(this.shaderProgram,GL.ACTIVE_UNIFORMS),this.uniforms=[],e=i=0,r=n-1;0<=r?i<=r:i>=r;e=0<=r?++i:--i)o=t.getActiveUniform(this.shaderProgram,e),s=o.name,e=s.indexOf("["),e>0&&(s=o.name.slice(0,e)),a={name:s,pos:this._getLocation(o.name),type:o.type,size:o.size},this.uniforms.push(a);return this.uniforms},t.prototype._getTextures=function(){var t,e,i,n,r,s;for(e=this._parseShader("uniform"),s=[],i=0,n=e.length;i<n;i++)t=e[i],"sampler2D"===t.type&&(r=this._getLocation(t.name),null!=r&&r!==-1&&(t.pos=r,s.push(t)));return s},t.prototype._parseShader=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,f;for(i=[],u=this.sv.split(";").concat(this.sf.split(";")),r=0,a=u.length;r<a;r++)if(o=u[r],c=RegExp("\\b"+t+"\\b"),null!=o.match(c)){for(f=o.split(" "),n=[],s=0,h=f.length;s<h;s++)p=f[s],p=p.replace(/\n/,""),p=p.replace(/\s/,""),0!==p.length&&n.push(p);n.push(1),l=n[2].match(/\[([0-9]+)\]/),null!=l&&(n[3]=l[1]),n[2]=n[2].match(/([a-zA-Z]+)/g)[0],4===n.length&&(e={},e.name=n[2],e.type=n[1],e.pos=-1,e.size=n[3],i.push(e))}return i},t.prototype.setUniform1f=function(t,e){var i;return i=PXL.Context.gl,i.uniform1f(this._getLocation(t),e),this},t.prototype.setUniform1i=function(t,e){var i;return i=PXL.Context.gl,i.uniform1i(this._getLocation(t),e),this},t.prototype.setUniform1fv=function(t,e){var i;return i=PXL.Context.gl,i.uniform1fv(this._getLocation(t),e),this},t.prototype.setUniform2fv=function(t,e){var i;return i=PXL.Context.gl,i.uniform2fv(this._getLocation(t),e),this},t.prototype.setUniform2v=function(t,e){var i;return i=PXL.Context.gl,i.uniform2f(this._getLocation(t),e.x,e.y),this},t.prototype.setUniform3f=function(t,e,i,n){var r;return r=PXL.Context.gl,r.uniform3f(this._getLocation(t),e,i,n),this},t.prototype.setUniform3fv=function(t,e){var i;return i=PXL.Context.gl,i.uniform3fv(this._getLocation(t),e),this},t.prototype.setUniform3v=function(t,e){var i;return i=PXL.Context.gl,i.uniform3f(this._getLocation(t),e.x,e.y,e.z),this},t.prototype.setUniform3f=function(t,e,i,n){var r;return r=PXL.Context.gl,r.uniform3f(this._getLocation(t),e,i,n),this},t.prototype.setUniform4f=function(t,e,i,n,r){var s;return s=PXL.Context.gl,s.uniform4f(this._getLocation(t),e,i,n,r),this},t.prototype.setUniform4v=function(t,e){var i;return i=PXL.Context.gl,i.uniform4f(this._getLocation(t),e.x,e.y,e.z,e.w),this},t.prototype.setUniform4fv=function(t,e){var i;return i=PXL.Context.gl,i.uniform4fv(this._getLocation(t),e),this},t.prototype.setMatrix3f=function(t,e){var i;return i=PXL.Context.gl,i.uniformMatrix3fv(this._getLocation(t),!1,e.a),this},t.prototype.setMatrix4f=function(t,e){var i;return i=PXL.Context.gl,i.uniformMatrix4fv(this._getLocation(t),!1,e.a),this},t.prototype.enableAttribArray=function(t){var e,i;return e=PXL.Context.gl,i=e.getAttribLocation(this.shaderProgram,t),e.enableVertexAttribArray(i),this},t.prototype.getAttribLocation=function(t){var e;return e=PXL.Context.gl,e.getAttribLocation(this.shaderProgram,t)},t}(),m=function(t,e){var i,n,r,s,a,h,l,c,p,f,d,m,g,v,x,y,_;return s=function(t){var e,i,n,r;return r=n="",i=t.indexOf("##>VERTEX"),e=t.indexOf("##>FRAGMENT"),i!==-1&&(e!==-1&&e>i?r=t.slice(i+9,e):e!==-1&&e<i&&(r=t.slice(i+9))),e!==-1&&(i!==-1&&i>e?n=t.slice(e+11,i):e!==-1&&i<e&&(n=t.slice(e+11))),[r,n]},r=function(t){var e,i,n,r,s,a;if(s=t.match(/\{\{(ShaderChunkLibrary\.[a-zA-Z]+)\}\}/g),e=[],null!=s)for(i=0,n=s.length;i<n;i++)r=s[i],a=r.replace("}}","").split(".")[1],null==ShaderChunkLibrary[a]?o("Could not find "+a+" in Shader Library"):e.push(ShaderChunkLibrary[a]);return e},n=function(t){var e,i,n,r;for(i="",r=n=t.indexOf("precision"),e=-1;r!==-1;)e=t.indexOf(";",r),i+=t.slice(r,e+1)+"\n",r=t.indexOf("precision",e);return n!==-1&&(t=t.slice(e+1)),[i,t]},i=function(t){var e;return e=t.indexOf("void main"),e!==-1?[t.slice(e),t.slice(0,e)]:[void 0,t]},f=s(t),_=f[0],x=f[1],a=r(t),_=_.replace(/;(?! [a-zA-Z0-9])/g,";"),_=_.replace(/\{/g,"{"),_=_.replace(/\}/g,"}"),x=x.replace(/;(?! [a-zA-Z0-9])/g,";"),x=x.replace(/;(?! [a-zA-Z0-9])/g,";"),x=x.replace(/\{/g,"{"),x=x.replace(/\}/g,"}"),d=n(x),c=d[0],x=d[1],m=n(_),p=m[0],_=m[1],g=i(x),h=g[0],x=g[1],v=i(_),l=v[0],_=v[1],a.push(new ShaderChunk({func:_,main_func:l},{func:x,main_func:h})),y=new u(a,e,p,c)},e.exports={Shader:u,shaderFromText:m}},{"../light/light":24,"../math/math":30,"../util/log":36,"./contract":11}],14:[function(t,e,n){var r,s,o,a,h,u,l,c,p,f,d,m=function(t,e){function i(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},g={}.hasOwnProperty;h=t("../util/request").Request,p=t("../util/log"),s=p.PXLError,a=p.PXLWarning,o=p.PXLLog,r=t("../gl/contract").Contract,l=function(){function t(e){var i,n,o,a;if(null==PXL.Context.gl&&s("No context or url provided for texture"),i=PXL.Context.gl,null==e&&(e={}),0===t.UNITS.length)for(n=o=0,a=PXL.Context.profile.combinedUnits-1;0<=a?o<=a:o>=a;n=0<=a?++o:--o)t.UNITS.push(null);this.unit=0,this.min=null==e.min?i.LINEAR:e.min,this.max=null==e.max?i.LINEAR:e.max,this.wraps=null==e.wraps?i.CLAMP_TO_EDGE:e.wraps,this.wrapt=null==e.wrapt?i.CLAMP_TO_EDGE:e.wrapt,this.width=null==e.width?512:e.width,this.height=null==e.height?512:e.height,this.channels=null==e.channels?i.RGBA:e.channels,this.datatype=null==e.datatype?i.UNSIGNED_BYTE:e.datatype,this.texture=i.createTexture(),this.contract=new r,this.contract.roles.uSampler="unit"}return t.UNITS=[],t.prototype._isPowerOfTwo=function(t){return 0===(t&t-1)},t.prototype._findUnit=function(){var e,i,n;for(e=i=0,n=t.UNITS.length-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)if(null===t.UNITS[e]||t.UNITS[e]===this)return t.UNITS[e]=this,e;return s("Run out of available texture units"),0},t.prototype._nextHighestPowerOfTwo=function(t){var e;for(--t,e=1;e<32;)t|=t>>e,e<<=1;return t+1},t.prototype.build=function(t){var e,i;if(e=PXL.Context,null!=t&&(e=t),e)return i=e.gl,this.bind(),i.texImage2D(i.TEXTURE_2D,0,this.channels,this.width,this.height,0,this.channels,this.datatype,null),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,this.max),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.min),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,this.wraps),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,this.wrapt),this.unbind(),this.loaded=!0,this},t.prototype.bind=function(){var t;return t=PXL.Context.gl,null!=t&&(this.unit=this._findUnit(),t.activeTexture(GL.TEXTURE0+this.unit),t.bindTexture(t.TEXTURE_2D,this.texture)),this},t.prototype.unbind=function(){var e;return e=PXL.Context.gl,null!=e&&(e.activeTexture(e.TEXTURE0+this.unit),e.bindTexture(e.TEXTURE_2D,null),t.UNITS[this.unit]=null,this.unit=0),this},t.prototype.update=function(t){var e;return this.textureData instanceof Image&&null==t?(e=PXL.Context.gl,this.bind(),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,this.channels,this.channels,this.datatype,this.textureData),this.unbind()):null!=t&&t instanceof Array?(this.datatype===GL.UNSIGNED_BYTE?this.textureData=new Uint8Array(t):this.datatype===GL.FLOAT&&(this.textureData=new Float32Array(t)),e=PXL.Context.gl,this.bind(),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,this.channels,this.width,this.height,0,this.channels,this.datatype,this.textureData),this.unbind()):null!=t&&(t instanceof Uint8Array||t instanceof Float32Array)?(this.textureData=t,e=PXL.Context.gl,this.bind(),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.texImage2D(e.TEXTURE_2D,0,this.channels,this.width,this.height,0,this.channels,this.datatype,this.textureData),this.unbind()):void 0},t.prototype._addToNode=function(t){return t.textures.push(this),this},t.prototype._removeFromNode=function(t){return t.textures.splice(t.textures.indexOf(this)),this},t.prototype.washup=function(){var t;return t=PXL.Context.gl,t.deleteTexture(this.texture),this},t}(),u=function(t){function e(t,i){var n,r,a;if(e.__super__.constructor.call(this,i),null==PXL.Context.gl&&s("No context provided for texture"),null!=t)t instanceof Image?(this.textureData=t,this.width=this.textureData.width,this.height=this.textureData.height):t instanceof Array?this.datatype===GL.UNSIGNED_BYTE?this.textureData=new Uint8Array(t):this.datatype===GL.FLOAT&&(this.textureData=new Float32Array(t)):(t instanceof Uint8Array||t instanceof Float32Array)&&(this.textureData=t);else{for(o("No Texture Data provided. Assuming uint8 data"),t=[],n=r=0,a=this.width*this.height*this.channels-1;0<=a?r<=a:r>=a;n=0<=a?++r:--r)t.push(0);this.textureData=new Float32Array(t)}this.build()}return m(e,t),e.prototype.build=function(){var t,e;return t=PXL.Context,e=t.gl,e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.bindTexture(e.TEXTURE_2D,this.texture),this.textureData instanceof Image?e.texImage2D(e.TEXTURE_2D,0,this.channels,this.channels,this.datatype,this.textureData):e.texImage2D(e.TEXTURE_2D,0,this.channels,this.width,this.height,0,this.channels,this.datatype,this.textureData),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.min),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.max),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wraps),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrapt),e.bindTexture(e.TEXTURE_2D,null)},e}(l),d=function(t,e,i,n){var r,s,o,l,c;return null!=t&&null!=PXL.Context.gl||a("No context or url provided for texture"),r=PXL.Context,o=r.gl,l=new h(t),c=function(i){return function(){var i,r;if(r=new Image,r.src=t,i=function(){var t;return t=new u(r,n),"function"==typeof e?e(t):void 0},r.addEventListener("load",i),r.complete)return i()}}(this),s=function(e){return function(){return a("Failed to load Texture: "+t),"function"==typeof i?i():void 0}}(this),l.get(c,s)},c=function(t){function e(t,i){var n,r,s;for(e.__super__.constructor.call(this,i),n=PXL.Context.gl,n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.bindTexture(n.TEXTURE_CUBE_MAP,this.texture),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,this.max),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,this.min),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,this.wraps),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,this.wrapt),
r=s=0;s<=5;r=++s)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,this.channels,this.channels,this.datatype,t[r]);n.bindTexture(n.TEXTURE_CUBE_MAP,null)}return m(e,t),e.prototype.bind=function(t){var e;if(e=PXL.Context.gl,null!=e)return this.unit=this._findUnit(),e.activeTexture(e.TEXTURE0+this.unit),e.bindTexture(e.TEXTURE_CUBE_MAP,this.texture)},e.prototype.unbind=function(){var t;if(t=PXL.Context.gl,null!=t)return t.activeTexture(t.TEXTURE0+this.unit),t.bindTexture(t.TEXTURE_CUBE_MAP,null),l.UNITS[i]=null,this.unit=0},e}(l),f=function(t,e,i,n){var r,o,a,h,u;for(null!=t&&null!=PXL.Context||s("No context or urls provided for cubemap texture"),6!==t.length&&s("6 URLs must be provided for cubemap texture"),u=[],h=0,r=PXL.Context,o=a=0;a<=5;o=++a)u[o]=new Image,u[o].cubeID=o,u[o].src=t[o],u[o].onload=function(t){return function(){var t;if(h++,6===h)return t=new c(u,n),"function"==typeof e?e(t):void 0}}(this);return this},e.exports={Texture:u,TextureBase:l,TextureCube:c,textureFromURL:d,textureCubeFromURL:f}},{"../gl/contract":11,"../util/log":36,"../util/request":41}],15:[function(t,e,i){var n,r,s,o=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a={}.hasOwnProperty,h=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};n=t("./shader").Shader,s=t("../shaders/uber"),r=function(t){function e(){var t,i,n,r,o,a,h,u;for(this.uber_defines=[],r=0,a=arguments.length;r<a;r++)t=arguments[r],this._traverse(t);for(n="",u=this.uber_defines,o=0,h=u.length;o<h;o++)i=u[o],n+="#define "+i+"\n";this.vertex=n+s.vertex,this.fragment=n+s.fragment,e.__super__.constructor.call(this,this.vertex,this.fragment,void 0),this._uber=!0}return o(e,t),e.prototype._traverse=function(t){var e,i,n,r,s,o,a,u,l,c,p,f,d;if(null!=t.material)for(c=t.material._uber_defines,n=0,o=c.length;n<o;n++)i=c[n],h.call(this.uber_defines,i)<0&&this.uber_defines.push(i);if(null!=t.camera&&h.call(this.uber_defines,"BASIC_CAMERA")<0&&this.uber_defines.push("BASIC_CAMERA"),t.pointLights.length>0&&(h.call(this.uber_defines,"LIGHTING_POINT")<0&&this.uber_defines.push("LIGHTING_POINT"),h.call(this.uber_defines,"LIGHTING")<0&&this.uber_defines.push("LIGHTING")),t.spotLights.length>0)for(h.call(this.uber_defines,"LIGHTING_SPOT")<0&&this.uber_defines.push("LIGHTING_SPOT"),h.call(this.uber_defines,"LIGHTING")<0&&this.uber_defines.push("LIGHTING"),p=t.spotLights,r=0,a=p.length;r<a;r++)l=p[r],l.shadowmap&&(h.call(this.uber_defines,"SHADOWMAP")<0&&this.uber_defines.push("SHADOWMAP"),h.call(this.uber_defines,"FRAGMENT_DEPTH_OUT")<0&&this.uber_defines.push("FRAGMENT_DEPTH_OUT"));for(null!=t.skeleton&&h.call(this.uber_defines,"SKINNING")<0&&this.uber_defines.push("SKINNING"),f=t.children,d=[],s=0,u=f.length;s<u;s++)e=f[s],d.push(this._traverse(e));return d},e}(n),e.exports={UberShader:r}},{"../shaders/uber":33,"./shader":13}],16:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x;n=function(t){return t&-16225},v=function(t,e){return t?1|e:e&-2},m=function(t,e){return t?2|e:e&-3},x=function(t,e){return t?4|e:e&-5},f=function(t,e){return t?22|e:e&-23},s=function(t,e){return t?32|e:e&-33},r=function(t,e){return t?64|e:e&-65},a=function(t,e){return t?96|e:e&-97},o=function(t,e){return t?8|e:e&-9},d=function(t,e){return t?256|e:e&-257},g=function(t,e){return t?512|e:e&-513},h=function(t,e){return t?1024|e:e&-1025},c=function(t,e){return t?2048|e:e&-2049},u=function(t,e){return t?4096|e:e&-4097},l=function(t,e){return t?8192|e:e&-8193},p=function(t,e){return t?16384|e:e&-16385},e.exports={uber_clear_material:n,uber_vertex_flat:v,uber_vertex_camera:m,uber_vertex_skinning:x,uber_lighting_point:o,uber_uniform_colour:d,uber_vertex_colour:g,uber_phong_diff_tex:h,uber_phong_spec_tex:c,uber_phong_emis_tex:u,uber_phong_mat:l,uber_texture_mat:f,uber_depth_set:s,uber_depth_read:r,uber_lighting_spot:a,uber_shadowmap:p}},{}],17:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I;M=t("../math/math"),a=M.Matrix4,g=M.Vec3,m=M.Vec2,S=t("../colour/colour"),p=S.RGB,f=S.RGBA,C=t("../geometry/primitive"),s=C.Geometry,v=C.Vertex,d=C.Triangle,c=C.Quad,R=t("../util/log"),u=R.PXLWarning,l=R.PXLWarningOnce,h=R.PXLError,r=t("../gl/contract").Contract,n=t("../util/cache_var").CacheVar,I=t("../util/util"),o={},A=function(t,e,i){var n;return n=PXL.Context.gl,n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferData(n.ARRAY_BUFFER,e,i),n.bindBuffer(n.ARRAY_BUFFER,null),t},w=function(t,e,i){var n,r;return r=PXL.Context.gl,n=r.createBuffer(),A(n,t,e),n.itemSize=i,n.numItems=t.length/i,n},b=function(t,e,i){var n;return n=PXL.Context.gl,null==i&&(i=0),n.bindBuffer(n.ARRAY_BUFFER,t),n.bufferSubData(n.ARRAY_BUFFER,i,e),n.bindBuffer(n.ARRAY_BUFFER,null),t},L=function(t,e,i){var n,r;return r=PXL.Context.gl,n=r.createBuffer(),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n),r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,e),n.itemSize=i,n.numItems=t.length,r.bindBuffer(r.ARRAY_BUFFER,null),n},T=function(t){var e;return e=PXL.Context.gl,e.deleteBuffer(t),this},x=function(t,e){var i;if(i=PXL.Context.gl,t.pos!==-1)return i.bindBuffer(i.ARRAY_BUFFER,e),t.type===GL.LOW_INT||t.type===GL.MEDIUM_INT||t.type===GL.HIGH_INT||t.type===GL.INT?i.vertexAttribPointer(t.pos,1,i.INT,!1,0,0):t.type===GL.LOW_FLOAT||t.type===GL.MEDIUM_FLOAT||t.type===GL.HIGH_FLOAT||t.type===GL.FLOAT?i.vertexAttribPointer(t.pos,1,i.FLOAT,!1,0,0):t.type===GL.FLOAT_VEC2?i.vertexAttribPointer(t.pos,2,i.FLOAT,!1,0,0):t.type===GL.FLOAT_VEC3?i.vertexAttribPointer(t.pos,3,i.FLOAT,!1,0,0):t.type===GL.FLOAT_VEC4&&i.vertexAttribPointer(t.pos,4,i.FLOAT,!1,0,0),i.enableVertexAttribArray(t.pos),this},_=function(t,e){var i,n,r,s,o;if(t.pos!==-1){if(i=PXL.Context.gl,1===t.size)t.type===GL.LOW_FLOAT||t.type===GL.MEDIUM_FLOAT||t.type===GL.HIGH_FLOAT||t.type===GL.FLOAT?i.uniform1f(t.pos,e):t.type===GL.LOW_INT||t.type===GL.MEDIUM_INT||t.type===GL.HIGH_INT||t.type===GL.INT?i.uniform1i(t.pos,e):t.type===GL.FLOAT_VEC2?i.uniform2f(t.pos,e.x,e.y):t.type===GL.FLOAT_VEC3?null!=e.x?i.uniform3f(t.pos,e.x,e.y,e.z):i.uniform3f(t.pos,e.r,e.g,e.b):t.type===GL.FLOAT_VEC4?null!=e.x?i.uniform4f(t.pos,e.x,e.y,e.z,e.w):i.uniform4f(t.pos,e.r,e.g,e.b,e.a):t.type===GL.FLOAT_MAT4?i.uniformMatrix4fv(t.pos,!1,e.a):t.type===GL.FLOAT_MAT3?i.uniformMatrix3fv(t.pos,!1,e.a):t.type===GL.SAMPLER_2D&&i.uniform1i(t.pos,e);else if(e instanceof Array)if(e[0]instanceof Object)if(s=[],null!=e[0].flatten){for(n=0,r=e.length;n<r;n++)o=e[n],s=s.concat(o.flatten());t.type===GL.FLOAT_VEC2?i.uniform2fv(t.pos,new Float32Array(s)):t.type===GL.FLOAT_VEC3?i.uniform3fv(t.pos,new Float32Array(s)):t.type===GL.FLOAT_VEC4?i.uniform4fv(t.pos,new Float32Array(s)):t.type===GL.FLOAT_MAT3?i.uniformMatrix3fv(t.pos,!1,new Float32Array(s)):t.type===GL.FLOAT_MAT4&&i.uniformMatrix4fv(t.pos,!1,new Float32Array(s))}else l("Cant set uniform "+t.name+" - no flatten() function");else t.type===GL.LOW_FLOAT||t.type===GL.MEDIUM_FLOAT||t.type===GL.HIGH_FLOAT||t.type===GL.FLOAT?i.uniform1fv(t.pos,new Float32Array(e)):t.type===GL.LOW_INT||t.type===GL.MEDIUM_INT||t.type===GL.HIGH_INT||t.type===GL.INT?i.uniform1iv(t.pos,new Int32Array(e)):t.type===GL.FLOAT_VEC2?i.uniform2fv(t.pos,new Float32Array(e)):t.type===GL.FLOAT_VEC3?i.uniform3fv(t.pos,new Float32Array(e)):t.type===GL.FLOAT_VEC4?i.uniform4fv(t.pos,new Float32Array(e)):t.type===GL.FLOAT_MAT3?i.uniformMatrix3fv(t.pos,!1,new Float32Array(e)):t.type===GL.FLOAT_MAT4&&i.uniformMatrix4fv(t.pos,!1,new Float32Array(e));else e instanceof Float32Array?t.type===GL.LOW_FLOAT||t.type===GL.MEDIUM_FLOAT||t.type===GL.HIGH_FLOAT||t.type===GL.FLOAT?i.uniform1fv(t.pos,e):t.type===GL.FLOAT_VEC2?i.uniform2fv(t.pos,e):t.type===GL.FLOAT_VEC3?i.uniform3fv(t.pos,e):t.type===GL.FLOAT_VEC4?i.uniform4fv(t.pos,e):t.type===GL.FLOAT_MAT3?i.uniformMatrix3fv(t.pos,!1,e):t.type===GL.FLOAT_MAT4&&i.uniformMatrix4fv(t.pos,!1,e):e instanceof Int32Array&&(t.type!==GL.LOW_INT&&t.type!==GL.MEDIUM_INT&&t.type!==GL.HIGH_INT&&t.type!==GL.INT||i.uniform1iv(t.pos,e));return this}},y=function(t,e){var i,n,s,o,a;null!=t.contract&&r.join(e,t);for(o in t)if("children"!==o&&"faces"!==o&&"indices"!==o&&"vertices"!==o&&"normals"!==o&&"texcoords"!==o&&null!=t[o]&&"object"==typeof t[o])if(null!=t[o].contract)y(t[o],e);else if(t[o]instanceof Array)for(a=t[o],i=0,s=a.length;i<s;i++)n=a[i],"object"==typeof n&&y(n,e);return t},P=function(t){var e,i,n,r,s,o,a,u,l,c;if(null==PXL.Context.shader)return h("No Shader bound when calling matchWithShader"),t;if(null==PXL.Context.shader.contract)return h("No Shader contract when calling matchWithShader"),t;for(l=PXL.Context.shader.contract,u=PXL.Context.shader,y(t,l),o=l.uniforms,i=0,r=o.length;i<r;i++)c=o[i],null!=l.matches[c.name]&&_(c,l.matches[c.name]);for(a=l.attributes,n=0,s=a.length;n<s;n++)e=a[n],null!=l.matches[e.name]&&x(e,l.matches[e.name]);return t},o.brew=function(t){var e,i,n,r,s,o,a,h,u;if(!this.flat&&(null==this.vertices||this.vertices.length<=0))return this.brewed=!1,this;if(n=PXL.Context.gl,null==t&&(t={}),s=function(e){return function(i,r,s,o,a){var h,u,c,p,f,d;if(h=null!=t[o]?t[o]:n.STATIC_DRAW,i)return null==e[r]?e[r]=w(e[s],h,a):e[s].length===e[r].numItems?A(e[r],e[s],h):l("Attemping to update position buffer of different length");for(p=[],f=e.vertices,u=0,c=f.length;u<c;u++)d=f[u],p=p.concat(d[s].flatten());return null==e[r]?e[r]=w(new Float32Array(p),h,a):e.vertices.length===e[r].numItems?A(e[r],new Float32Array(p),h):l("Attemping to update position buffer of different length")}}(this),this.flat)for(r in this.contract.roles)o=this.contract.roles[r],this[o]instanceof Float32Array&&s(!0,"vertex"+r+"Buffer",r,r+"_buffer_access",this._flat_sizes[o]);else for(r in this.vertices[0])a="vertex"+r+"Buffer",this.contract.hasRoleValue(a)&&void 0!==r&&(u=this.vertices[0],i=u[r],h=i.DIM,s(!1,a,r,r+"_buffer_access",h));return e=null!=t.indices_buffer_access?t.indices_buffer_access:n.STATIC_DRAW,this.indexed&&(null==this.vertexIndexBuffer?this.vertexIndexBuffer=L(new Uint16Array(this.indices),e,1):this.indices.length===this.vertexIndexBuffer.numItems?A(this.vertexIndexBuffer,new Float32Array(this.indices),e):l("Attemping to update indices buffer of different length")),this.brewed=!0,this},o.rebrew=function(t){var e,i,n,r,s,o,a,h;if(null==t)return this;if(this.brewed===!1)return this;e=PXL.Context.gl;for(r in t)if(this.flat)o="vertex"+r+"Buffer",null!=this[o]&&b(this[o],this[r],t[r]);else{for(n=[],a=this.vertices,i=0,s=a.length;i<s;i++)h=a[i],n=n.concat(h[r].flatten());o="vertex"+r+"Buffer",null!=this[o]&&bufferData(this[o],new Float32Array(n),t[r])}return this},E=function(t){return function(e,i){var n;return null==i?t:t.brewed===!1?t:(n=PXL.Context.gl,null!=i.colour_buffer&&null!=e.vertexColourBuffer&&b(e.vertexColourBuffer,i.colour_buffer.data,i.colour_buffer.offset),null!=i.position_buffer&&null!=e.vertexPositionBuffer&&b(e.vertexPositionBuffer,i.position_buffer.data,i.position_buffer.offset),null!=i.normal_buffer&&null!=e.vertexNormalBuffer&&b(e.vertexNormalBuffer,i.normal_buffer.data,i.normal_buffer.offset),null!=i.texcoord_buffer&&null!=e.vertexTextureBuffer&&b(e.vertexTextureBuffer,i.texcoord_buffer.data,i.texcoord_buffer.offset),null!=i.tangent_buffer&&null!=e.vertexTangentBuffer&&b(e.vertexTangentBuffer,i.tangent_buffer.data,i.tangent_buffer.offset),t)}}(this),o.drawGL=function(){var t;return t=PXL.Context.gl,null!=this.vertexIndexBuffer&&this.indexed?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),t.drawElements(this.layout,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)):t.drawArrays(this.layout,0,this.vertexpBuffer.numItems),this},o.washup=function(){var t,e;e=[];for(t in this)this[t]instanceof WebGLBuffer?e.push(T(this[t])):e.push(void 0);return e},e.exports={rebrew_typed:E,GeometryBrewer:o,matchWithShader:P}},{"../colour/colour":4,"../geometry/primitive":9,"../gl/contract":11,"../math/math":30,"../util/cache_var":34,"../util/log":36,"../util/util":43}],18:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G=function(t,e){function i(){this.constructor=t}for(var n in e)z.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},z={}.hasOwnProperty;S=t("../util/log"),c=S.PXLWarning,u=S.PXLError,l=S.PXLLog,C=t("../geometry/primitive"),L=C.TriangleMesh,w=C.Triangle,M=C.Vertex,R=t("../math/math"),E=R.Vec4,P=R.Vec3,T=R.Vec2,d=R.Quaternion,a=R.Matrix4,o=R.Matrix3,h=t("../core/node").Node,A=t("../colour/colour"),m=A.RGB,g=A.RGBA,f=t("../util/promise").Promise,v=t("../util/request").Request,p=t("../material/phong").PhongMaterial,n=t("../material/basic").BasicColourMaterial,I=t("../animation/skeleton"),x=I.Skeleton,r=I.Bone,y=I.Skin,b=I.SkinWeight,_=I.SkinIndex,s=function(t){function e(t,i,n){var r,s,o,a,h,l;this.url=t,this.promise=i,this.params=n,e.__super__.constructor.call(this),this.version="",this.num_joints="",this.num_meshes="",this.add(new x),h=new f,o=new f,a=new f,a.when(o).then(function(t){return function(){return t.promise.resolve()}}(this)),h.then(function(t){return function(e){return t._parse_data(e),o.resolve()}}(this)),r=function(t){return function(){var e;return e=new v(t.url),e.get(function(e){return t._parse_materials(e,h)})}}(this),null!=this.promise?r():(s=function(t){return function(t){return u("Loading Model: "+url+" "+t)}}(this),l=new v(this.url),l.get(function(t){return function(e){return t._parse_materials_sync(e),t._parse_data(e)}}(this),s,!0))}return G(e,t),e.prototype._computeW=function(t,e,i){var n;return n=1-t*t-e*e-i*i,n<0?0:n=-Math.sqrt(n)},e.prototype._parse_materials_sync=function(t){return this},e.prototype._parse_materials=function(t,e){var i,r,s,o,a,h,u,c,d,g,v,x,y,_,b;for(u=t.split("\n"),g=0,r=this.url.slice(0,+(this.url.lastIndexOf("/")-1)+1||9e9),i=[],this._material_by_name={},g=o=0,b=u.length-1;0<=b?o<=b:o>=b;g=0<=b?++o:--o)h=u[g],h.indexOf("shader")!==-1&&(a=h.lastIndexOf('"'),s=h.indexOf('"'),c=h.slice(s+1,+(a-1)+1||9e9),d=r+"/"+c.slice(c.lastIndexOf("/")+1)+".png",y=new f,i.push(y),x=function(t){return function(){var e,i,n;return n=y,i=c,e=t._material_by_name,function(t){var r,s;return PXL.Context.debug&&l("MD5Model Loaded a Texture: "+i),s=new m.WHITE,r=new m.BLACK,e[i]=new p(s,t,r),n.resolve()}}}(this),v=function(t){return function(){var e,i,r;return r=y,i=c,e=t._material_by_name,function(t){var s;return PXL.Context.debug&&l("MD5Model Failed to load a Texture: "+i),s=new PXL.Colour.RGB(1,0,0),e[i]=new n(s),r.resolve()}}}(this),PXL.GL.textureFromURL(d,x(),v()));return _=new f,_.when.apply(_,i).then(function(i){return function(){return e.resolve(t)}}(this)),this},e.prototype._parse_data=function(t){var e,i,n,s,o,a,u,l,c,p,f,m,g,v,S,C,R,A,I,G,z,N,X,F,O,D,U,V,B,k,q,H,W,j,Y,K,J,Q,Z,$,tt,et,it,nt,rt,st,ot,at,ht,ut,lt,ct,pt,ft,dt,mt,gt,vt,xt,yt,_t,bt,wt,Lt,Tt,Pt,Et,Mt,St,Ct,Rt,At,It,Gt,zt,Nt,Xt,Ft,Ot,Dt,Ut,Vt,Bt;for(V=t.split("\n"),q=0;q<V.length;){if(U=V[q],"MD5Version"===U.slice(0,10)&&(this.version=U.slice(11)),"numJoints"===U.slice(0,9)&&(this.num_joints=parseInt(U.slice(10))),"numMeshes"===U.slice(0,9)&&this.num_meshes===parseInt(U.slice(10)),"joints {"===U.slice(0,8)){for(I=z=0,ft=this.num_joints-1;0<=ft?z<=ft:z>=ft;I=0<=ft?++z:--z)G=V[q+I+1],X=G.lastIndexOf('"'),W=G.slice(G.indexOf('"')+1,+(X-1)+1||9e9),Q=G.indexOf("("),f=G.indexOf(")"),it=parseInt(G.slice(X+1,+(Q-1)+1||9e9)),et=void 0,it>-1&&(et=this.skeleton.getBone(it)),St=G.slice(Q,+f+1||9e9).split(" "),Z=parseFloat(St[1]),$=parseFloat(St[2]),tt=parseFloat(St[3]),rt=new P(Z,$,tt),Q=G.lastIndexOf("("),f=G.lastIndexOf(")"),St=G.slice(Q,+f+1||9e9).split(" "),ot=parseFloat(St[1]),at=parseFloat(St[2]),ht=parseFloat(St[3]),xt=new d(ot,at,ht,this._computeW(ot,at,ht)),xt.normalize(),u=new r(W,I,et,xt,rt),this.skeleton.addBone(u);q+=this.num_joints}if("mesh {"===U.slice(0,6)){for(Mt=V[q];Mt.indexOf("shader")===-1;)q+=1,Mt=V[q];for(k=Mt.slice(Mt.indexOf('"')+1,+(Mt.lastIndexOf('"')-1)+1||9e9);Mt.indexOf("numverts")===-1;)q+=1,Mt=V[q];for(Y=parseInt(Mt.slice(Mt.indexOf("numverts")+8)),g=new L((!0)),v=new h(g),null!=this._material_by_name&&(v.material=this._material_by_name[k]),this.add(v),Lt=[],Xt=N=0,dt=Y-1;0<=dt?N<=dt:N>=dt;Xt=0<=dt?++N:--N)Mt=V[q+Xt+1],Q=Mt.indexOf("("),f=Mt.indexOf(")"),R=parseInt(Mt.slice(Mt.indexOf("vert")+1,+(Q-1)+1||9e9)),St=Mt.slice(Q,+f+1||9e9).split(" "),Gt=parseFloat(St[1]),zt=parseFloat(St[2]),St=Mt.slice(f).split(" "),R=parseInt(St[1]),m=parseInt(St[2]),wt={u:new T(Gt,zt),i:R,c:m},Lt.push(wt);for(q+=Y,Mt=V[q];Mt.indexOf("numtris")===-1;)q+=1,Mt=V[q];for(j=parseInt(Mt.slice(Mt.indexOf("numtris")+7)),C=B=0,mt=3*j-1;0<=mt?B<=mt:B>=mt;C=0<=mt?++B:--B)g.addIndex(0);for(Et=0,Et=H=0,gt=j-1;0<=gt?H<=gt:H>=gt;Et=0<=gt?++H:--H)Mt=V[q+Et+1],Rt=Mt.indexOf("tri"),St=Mt.slice(Rt).split(" "),R=parseInt(St[1]),i=parseInt(St[2]),o=parseInt(St[3]),p=parseInt(St[4]),g.setIndex(3*R,p),g.setIndex(3*R+1,o),g.setIndex(3*R+2,i);for(q+=j,Mt=V[q];Mt.indexOf("numweights")===-1;)q+=1,Mt=V[q];for(K=parseInt(Mt.slice(Mt.indexOf("numweights")+10)),Tt=[],S=new y,Ot=J=0,vt=K-1;0<=vt?J<=vt:J>=vt;Ot=0<=vt?++J:--J)Mt=V[q+Ot+1],Dt=Mt.indexOf("weight"),Q=Mt.indexOf("("),f=Mt.indexOf(")"),St=Mt.slice(Dt,+Q+1||9e9).split(" "),R=parseInt(St[1]),l=parseInt(St[2]),a=parseFloat(St[3]),bt=new b(this.skeleton.getBone(l),a),S.addWeight(bt),St=Mt.slice(Q,+f+1||9e9).split(" "),Z=parseFloat(St[1]),$=parseFloat(St[2]),tt=parseFloat(St[3]),Tt.push({position:new P(Z,$,tt),bias:a,bone:l});for(q+=K,C=st=0,ut=Y-1;0<=ut?st<=ut:st>=ut;C=0<=ut?++st:--st){for(_t=new _(Lt[C].i,Lt[C].c),S.addIndex(_t),nt=new P(0,0,0),s=[],A=yt=0,lt=_t.count-1;0<=lt?yt<=lt:yt>=lt;A=0<=lt?++yt:--yt)s.push(Tt[_t.index+A]);for(e=function(t,e){return t.bias<e.bias},s.sort(e),s.length>x.PXL_MAX_WEIGHTS&&s.splice(x.PXL_MAX_WEIGHTS-1,s.length-1),Ct=0,Ut=0,F=s.length;Ut<F;Ut++)Ft=s[Ut],Ct+=Ft.bias;for(Ct=1/Ct,Vt=0,O=s.length;Vt<O;Vt++)Ft=s[Vt],Ft.bias=Ft.bias*Ct;for(It=[],Pt=[],A=Bt=0,ct=x.PXL_MAX_WEIGHTS-1;0<=ct?Bt<=ct:Bt>=ct;A=0<=ct?++Bt:--Bt)A<s.length?(Ft=s[A],It.push(Ft.bias),Pt.push(Ft.bone),c=Ft.position.clone(),d.invert(this.skeleton.getBone(Ft.bone).rotation_pose).transVec3(c),c.add(this.skeleton.getBone(Ft.bone).position_pose),c.multScalar(Ft.bias),nt.add(c)):(It.push(0),Pt.push(0));Nt=new M({p:nt,t:Lt[C].u.clone(),w:new E(It[0],It[1],It[2],It[3]),i:new E(Pt[0],Pt[1],Pt[2],Pt[3]),n:new P(0,0,0)}),g.addVertex(Nt)}for(A=0;A<g.indices.length;)Z=g.vertices[g.indices[A]],$=g.vertices[g.indices[A+1]],tt=g.vertices[g.indices[A+2]],At=new w(Z,$,tt),At.computeFaceNormal(),Z.n.add(At.n),$.n.add(At.n),tt.n.add(At.n),g.faces.push(At),A+=3;for(pt=g.vertices,n=0,D=pt.length;n<D;n++)Nt=pt[n],Nt.n.normalize();v.add(S)}q+=1}return null!=this._material_by_name&&(this._material_by_name=void 0),this},e}(h),e.exports={MD5Model:s}},{"../animation/skeleton":2,"../colour/colour":4,"../core/node":6,"../geometry/primitive":9,"../material/basic":25,"../material/phong":28,"../math/math":30,"../util/log":36,"../util/promise":39,"../util/request":41}],19:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b=function(t,e){function i(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},w={}.hasOwnProperty;x=t("../util/log"),h=x.PXLWarning,o=x.PXLError,a=x.PXLLog,y=t("../geometry/primitive"),d=y.TriangleMesh,f=y.Triangle,v=y.Vertex,_=t("../math/math"),g=_.Vec3,m=_.Vec2,r=t("../core/node").Node,c=t("../colour/colour").RGB,l=t("../util/promise").Promise,p=t("../util/request").Request,u=t("../material/phong").PhongMaterial,n=t("../material/basic").BasicColourMaterial,s=function(t){function e(t,i){var n,r,s,o;this.url=t,this.promise=i,e.__super__.constructor.call(this),s=new l,o=new l,r=new l,s.when(r).then(function(t){return function(){return t.promise.resolve()}}(this)),(n=function(t){return function(){var e;return e=new p(t.url),e.get(function(e){var i,n,s;return s=t._checkForMaterials(e),s?(n={},i=function(){var e;return s=t.url.substring(0,t.url.lastIndexOf("/"))+"/"+s,e=new p(s),e.get(function(e){return t._parseMaterialFile(e,n,o)})},o.then(function(){return t._parse(e,n),r.resolve()}),i()):(n=[],t._parse(e,n),r.resolve())})}}(this))()}return b(e,t),e.prototype._checkForMaterials=function(t){var e,i,n,r;for(r=t.split("\n"),e=0,i=r.length;e<i;e++){if(n=r[e],"mtllib"===n.slice(0,6))return n.slice(7);if("f "===n.slice(0,2))break}},e.prototype._parseMaterialFile=function(t,e,i){var n,r,s,o,a,h,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M;for(_=t.split("\n"),f=[],h=[],n=[],r=new l,s=function(t,e,i){return function(){var n,r,s,o;for(n=0,r=e.length;n<r;n++)o=e[n],s=t[o],null!=s.texture?t[o]=new u(s.ambient,s.texture,s.specular,s.shine):t[o]=new u(s.ambient,s.diffuse,s.specular,s.shine);return i.resolve()}},m=0,v=_.length;m<v;m++)y=_[m],"newmtl "===y.slice(0,7)&&(b=y.split(" ")[1],e[b]={},n.push(b)),"Ka"===y.slice(0,2)&&(M=y.split(" "),w=[function(){var t,e,i,n;for(i=M.slice(1),n=[],t=0,e=i.length;t<e;t++)E=i[t],n.push(parseFloat(E));return n}()][0],e[b].ambient=new c(w[0],w[1],w[2])),"Kd"===y.slice(0,2)&&(M=y.split(" "),w=[function(){var t,e,i,n;for(i=M.slice(1),n=[],t=0,e=i.length;t<e;t++)E=i[t],n.push(parseFloat(E));return n}()][0],e[b].diffuse=new c(w[0],w[1],w[2])),"Ks"===y.slice(0,2)&&(M=y.split(" "),w=[function(){var t,e,i,n;for(i=M.slice(1),n=[],t=0,e=i.length;t<e;t++)E=i[t],n.push(parseFloat(E));return n}()][0],e[b].specular=new c(w[0],w[1],w[2])),"Ns"===y.slice(0,2)&&(M=y.split(" "),w=[function(){var t,e,i,n;for(i=M.slice(1),n=[],t=0,e=i.length;t<e;t++)E=i[t],n.push(parseInt(E));return n}()][0],e[b].shine=w[1]),"map_Kd "===y.slice(0,7)&&(L=y.slice(7),T=this.url.substring(0,this.url.lastIndexOf("/"))+"/"+L,"undefined"!=typeof PXL&&null!==PXL&&(d=function(t,e,i,n,r){return function(){return PXL.Context.switchContext(i),PXL.GL.textureFromURL(t,function(t){return n[e].texture=t,r.resolve()})}},p=new l,a=d(T,b,PXL.Context,e,p),f.push(p),h.push(a)));if(f.length>0)for(o=s(e,n,i),r.when.apply(r,f).then(o),g=0,x=h.length;g<x;g++)(P=h[g])();else i.resolve();return this},e.prototype._parse=function(t,e){var i,s,o,a,h,u,l,c,p,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z,N,X,F,O,D,U,V;for(G=[],E=[],F=[],e.none=new n,S=null,A=0,R=0,C=0,w=t.split("\n"),p=0,_=w.length;p<_;p++)if(b=w[p],"o "===b.slice(0,2)&&(S=new r,S._label=b.slice(2),this.add(S),a=new d((!0)),S.geometry=a,A=G.length,C=E.length,R=F.length),"v "===b.slice(0,2))s=b.slice(2).split(" "),D=function(){var t,e,i;for(i=[],t=0,e=s.length;t<e;t++)O=s[t],i.push(parseFloat(O));return i}(),U=new g(D[0],D[1],D[2]),G.push(U);else if("vt "===b.slice(0,3))s=b.slice(3).split(" "),D=function(){var t,e,i;for(i=[],t=0,e=s.length;t<e;t++)O=s[t],i.push(parseFloat(O));return i}(),U=new m(D[0],D[1]),F.push(U);else if("vn "===b.slice(0,3))s=b.slice(3).split(" "),D=function(){var t,e,i;for(i=[],t=0,e=s.length;t<e;t++)O=s[t],i.push(parseFloat(O));return i}(),U=new g(D[0],D[1],D[2]),E.push(U);else if("usemtl "===b.slice(0,7))L=b.slice(7),T=e[L],null==S.material&&(S.material=T);else if("f "===b.slice(0,2))if(X=b.slice(2),s=X.split(" "),o=function(){var t,e,n;for(n=[],t=0,e=s.length;t<e;t++)i=s[t],n.push(i.split("/"));return n}(),3===o.length){for(V=[],h=x=0;x<=2;h=++x)c=parseInt(o[h][0])-1,I=G[c],U=new v({p:I}),""!==o[h][2]&&(u=parseInt(o[h][2])-1,u<E.length&&(U.n=E[u].clone())),""!==o[h][1]&&(l=parseInt(o[h][1])-1,l<F.length&&(U.t=F[l].clone())),V.push(U);a.addTriangle(new f(V[0],V[1],V[2]))}else if(4===o.length){for(V=[],h=y=0;y<=3;h=++y)c=parseInt(o[h][0])-1,I=G[c],U=new v({p:I}),""!==o[h][2]&&(u=parseInt(o[h][2])-1,u<E.length&&(U.n=E[u].clone())),""!==o[h][1]&&(l=parseInt(o[h][1])-1,l<F.length&&(U.t=F[l].clone())),V.push(U);a.addTriangle(new f(V[0],V[1],V[2])),a.addTriangle(new f(V[0],V[2],V[3]))}else{for(V=[],h=P=0,z=o.length-1;0<=z?P<=z:P>=z;h=0<=z?++P:--P)c=D[h]-1,I=G[c],U=new v({p:I}),""!==o[h][2]&&(u=parseInt(o[h][2])-1,u<E.length&&(U.n=E[u])),""!==o[h][1]&&(l=parseInt(o[h][1])-1,l<F.length&&(U.t=E[l])),V.push(U);for(h=M=1,N=D.length-1;1<=N?M<=N:M>=N;h=1<=N?++M:--M)h===D.length-1?a.addTriangle(new f(V[0],V[h],V[1])):a.addTriangle(new f(V[0],V[h],V[h+1]))}return this},e}(r),e.exports={OBJModel:s}},{"../colour/colour":4,"../core/node":6,"../geometry/primitive":9,"../material/basic":25,"../material/phong":28,"../math/math":30,"../util/log":36,"../util/promise":39,"../util/request":41}],20:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T=function(t,e){return function(){return t.apply(e,arguments)}},P=function(t,e){function i(){this.constructor=t}for(var n in e)E.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},E={}.hasOwnProperty;b=t("../geometry/primitive"),m=b.Triangle,h=b.Quad,_=b.Vertex,g=b.TriangleMesh,r=t("../core/node").Node,w=t("../math/math"),v=w.Vec2,x=w.Vec3,y=w.Vec4,n=w.Matrix4,o=t("../material/phong").PhongBasicMaterial,L=t("../colour/colour"),u=L.RGB,l=L.RGBA,f=t("../gl/texture").Texture,c=t("../util/request").Request,p=t("../util/signal").Signal,s=t("../util/log").PXLWarning,a=t("../util/promise").Promise,d=function(t){function e(t,i){var n,s,a,h,l,c,p,f,d,m,v,x,y,_,b;if(this.params=i,this._parse=T(this._parse,this),e.__super__.constructor.call(this),null==this.params?(this.params={},this.params.texturing=!0):null==this.params.texturing&&(this.params.texturing=!0),this.queue=new LoadQueue(this,this.params.onItem,this.params.onLoad),f=t.materials,0===f.length)this.add(new r(new g((!0))));else for(c=p=0,x=f.length-1;0<=x?p<=x:p>=x;c=0<=x?++p:--p)m=new r,this.add(m),null!=t.materials[c].DbgName&&(m.dbgName=t.materials[c].DbgName),"default"===t.materials[c].DbgName||1===t.materials[c].DbgIndex?m.add(PhongColourMaterial()):(a=new u(t.materials[c].colorAmbient[0],t.materials[c].colorAmbient[1],t.materials[c].colorAmbient[2]),null==a&&(a=u.WHITE()),h=new u(t.materials[c].colorDiffuse[0],t.materials[c].colorDiffuse[1],t.materials[c].colorDiffuse[2]),null==h&&(h=u.WHITE()),l=new u(t.materials[c].colorSpecular[0],t.materials[c].colorSpecular[1],t.materials[c].colorSpecular[2]),null==l&&(l=u.WHITE()),y=t.materials[c].specularCoef,null==t.materials[c].mapDiffuse&&m.add(new PhongColourMaterial(a,h,l,y))),m.geometry=new g((!0)),this.params.texturing&&null!=t.materials[c].mapDiffuse&&null!=t._coffeegl_request_url&&(b=t._coffeegl_request_url.substring(0,t._coffeegl_request_url.lastIndexOf("/")),v=b+"/"+t.materials[c].mapDiffuse,n=PXL.Context,_=new LoadItem(function(t,e){var i,r,s;return r=t,s=e,i=n,function(){return PXL.Context.switchContext(i),PXL.GL.textureFromURL(s,function(t){return function(e){return r.add(new o(e,a,h,l,y)),t.loaded(),t}}(this))}}(m,v)),this.queue.add(_));n=PXL.Context,d=this,s=function(e,i){var r,s,o;return o=t,s=i,r=n,function(t){return function(){return PXL.Context.switchContext(r),s._parse(o)}}(this)}(m,d),this.queue.add(new LoadItem(function(){return s(),this.loaded()})),this.queue.start()}return P(e,t),e.prototype._bitset=function(t,e){return t&1<<e},e.prototype._parse=function(t){var e,i,n,r,o,a,u,l,c,p,f,d,g,y,b,w,L,T,P,E,M,S,C,R,A,I;for(y=0,I=0,M=[];I<t.vertices.length;)M.push(new _({p:new x(t.vertices[I++],t.vertices[I++],t.vertices[I++])}));for(n=0;n<t.faces.length;)T=t.faces[n++],d={id:0,type:-1},this._bitset(T,0)?(S=t.faces[n++],C=t.faces[n++],R=t.faces[n++],A=t.faces[n++],b=new h(M[S],M[C],M[R],M[A]),b.indexed=!0):(S=t.faces[n++],C=t.faces[n++],R=t.faces[n++],b=new m(M[S],M[C],M[R]),b.indexed=!0),this._bitset(T,1)&&(d.id=t.faces[n++],P=1|T,d.type===-1?d.type=P:P!==d.type&&s("Different types within the same material")),this._bitset(T,2)&&(E=t.faces[n++]),this._bitset(T,3)&&(r=t.faces[n++],o=t.faces[n++],a=t.faces[n++],b instanceof h&&(u=t.faces[n++],M[A].t=new v(t.uvs[0][2*u],t.uvs[0][2*u+1])),M[S].t=new v(t.uvs[0][2*r],t.uvs[0][2*r+1]),M[C].t=new v(t.uvs[0][2*o],t.uvs[0][2*o+1]),M[R].t=new v(t.uvs[0][2*a],t.uvs[0][2*a+1])),this._bitset(T,4)&&(g=t.faces[n++]),this._bitset(T,5)&&(r=t.faces[n++],o=t.faces[n++],a=t.faces[n++],b instanceof h&&(u=t.faces[n++],M[A].n=new x(t.normals[3*u],t.normals[3*u+1],t.normals[3*u+2])),M[S].n=new x(t.normals[3*r],t.normals[3*r+1],t.normals[3*r+2]),M[C].n=new x(t.normals[3*o],t.normals[3*o+1],t.normals[3*o+2]),M[R].n=new x(t.normals[3*a],t.normals[3*a+1],t.normals[3*a+2])),this._bitset(T,6)&&(i=t.faces[n++]),this._bitset(T,7)&&(r=t.faces[n++],o=t.faces[n++],a=t.faces[n++],b instanceof h&&(u=t.faces[n++])),b instanceof m?this.children[d.id].geometry.addTriangle(b):this.children[d.id].geometry.addQuad(b);for(L=[],w=this.children,l=0,p=w.length;l<p;l++)e=w[l],null!=e.geometry&&0===e.geometry.vertices.length&&L.push(e);for(c=0,f=L.length;c<f;c++)e=L[c],this.remove(e);return this},e}(r),e.exports={ThreeJSModel:d}},{"../colour/colour":4,"../core/node":6,"../geometry/primitive":9,"../gl/texture":14,"../material/phong":28,"../math/math":30,"../util/log":36,"../util/promise":39,"../util/request":41,"../util/signal":42}],21:[function(t,e,i){var n,r,s,o,a,h;h=t("../util/util"),s=t("../math/math").Vec2,r=t("../util/signal").Signal,n={},n.pauseKeyEmitter=function(t){return this.keyUp.pause(t),this.keyDown.pause(t),this.keyPress.pause(t)},o=function(t){if(null!=t.canvas)return h.extend(t,n),t.keyUp=new r,t.keyDown=new r,t.keyPress=new r,t._onKeyUp=function(e){return PXL.Context.switchContext(t),t.keyUp.dispatch(e),!1},t.canvas.addEventListener("keyup",t._onKeyUp),t._onKeyDown=function(e){return PXL.Context.switchContext(t),t.keyDown.dispatch(e),!1},t.canvas.addEventListener("keydown",t._onKeyDown),t._onKeyPress=function(e){return PXL.Context.switchContext(t),t.keyPress.dispatch(e),!1},t.canvas.addEventListener("keypress",t._onKeyPress)},a=function(t){return t.canvas.removeEventListener("keyup",t._onKeyUp),t.canvas.removeEventListener("keydown",t._onKeyDown)},e.exports={makeKeyEmitter:o,removeKeyEmitter:a}},{"../math/math":30,"../util/signal":42,"../util/util":43}],22:[function(t,e,i){var n,r,s,o,a,h;h=t("../util/util"),s=t("../math/math").Vec2,r=t("../util/signal").Signal,n={},n.pauseMouseEmitter=function(t){return this.mouseMove.pause(t),this.mouseDown.pause(t),this.mouseUp.pause(t),this.mouseClick.pause(t),this.mouseOut.pause(t),this.mouseOver.pause(t),this.mouseWheel.pause(t)},n._setMouseEvent=function(t){return this._getMousePos(t),this._setButtons(t),null!=t.preventDefault&&t.preventDefault(),null!=t.stopImmediatePropagation&&t.stopImmediatePropagation(),null!=t.stopPropagation&&t.stopPropagation(),t},n._getMousePos=function(t){return t.clientX||t.clientY?(t.mouseX=t.clientX,t.mouseY=t.clientY):(t.offsetX||t.offsetY)&&(t.mouseX=t.offsetX,t.mouseY=t.offsetY),[t.mouseX,t.mouseY]},n._setButtons=function(t){if("mousedown"===t.type?this._mouseButton=!0:"mouseup"!==t.type&&"mouseout"!==t.type||(this._mouseButton=!1),"Firefox"===PXL.Context.profile.browser&&"mousemove"===t.type&&0!==t.buttons&&(this._mouseButton=!0),!this._mouseButton)return t.buttonLeft=!1,t.buttonMiddle=!1,t.buttonRight=!1,t;if("Firefox"===PXL.Context.profile.browser){if(0===t.button&&1===t.buttons||1===t.buttons)return t.buttonLeft=!0,t.buttonMiddle=!1,t.buttonRight=!1,t;if(1===t.button&&4===t.buttons||4===t.buttons)return t.buttonLeft=!1,t.buttonMiddle=!0,t.buttonRight=!1,t;if(2===t.button&&2===t.buttons||2===t.buttons)return t.buttonLeft=!1,t.buttonMiddle=!1,t.buttonRight=!0,t}else{if(0===t.button)return t.buttonLeft=!0,t.buttonMiddle=!1,t.buttonRight=!1,t;if(1===t.button)return t.buttonLeft=!1,t.buttonMiddle=!0,t.buttonRight=!1,t;if(2===t.button)return t.buttonLeft=!1,t.buttonMiddle=!1,t.buttonRight=!0,t}},o=function(t){if(null!=t.canvas){if(h.extend(t,n),t.mouseMove=new r,t.mouseDown=new r,t.mouseUp=new r,t.mouseClick=new r,t.mouseOut=new r,t.mouseOver=new r,t.mouseWheel=new r,t._mouseButton=!1,t._onMouseMove=function(e){var i;return PXL.Context.switchContext(t),i=t._setMouseEvent(e),t.mouseMove.dispatch(i),!1},t.canvas.onmousemove=t._onMouseMove,t._onMouseDown=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseDown.dispatch(e),!1},t.canvas.onmousedown=t._onMouseDown,t._onMouseUp=function(e){return PXL.Context.switchContext(t),
t._setMouseEvent(e),t.mouseUp.dispatch(e),!1},t.canvas.onmouseup=t._onMouseUp,t._onMouseClick=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseClick.dispatch(e),!1},t.canvas.onmouseclick=t._onMouseClick,t._onContextMenu=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),!1},t.canvas.oncontextmenu=t._onContextMenu,t._onMouseOut=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseOut.dispatch(e),!1},t.canvas.onmouseout=t._onMouseOut,t._onMouseOver=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseOver.dispatch(e),!1},t.canvas.onmouseover=t._onMouseOver,null!=t.canvas.addEventListener)return t._onMouseWheel=function(e){return function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseWheel.dispatch(e),!1}}(this),t._onDOMNouseScroll=function(e){return function(e){return PXL.Context.switchContext(t),e.wheelDelta=Math.max(-500,Math.min(500,500*(e.wheelDelta||-e.detail))),t._setMouseEvent(e),t.mouseWheel.dispatch(e),!1}}(this),t._onMouseClick=function(e){return function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseClick.dispatch(e),!1}}(this),t.canvas.addEventListener("mousewheel",t._onMouseWheel,!1),t.canvas.addEventListener("DOMMouseScroll",t._onDOMNouseScroll,!1),t.canvas.addEventListener("mouseclick",t._onMouseClick,!1);if(null!=t.canvas.onmousewheel)return t._onMouseWheel=function(e){return PXL.Context.switchContext(t),t._setMouseEvent(e),t.mouseWheel.dispatch(e),!1},t.canvas.onmousewheel=t._onMouseWheel}},a=function(t){if(null!=t.canvas)return t.canvas.removeEventListener("click",t._onMouseClick),t.canvas.removeEventListener("mousewheel",t._onMouseWheel),t.canvas.removeEventListener("DOMMouseScroll",t._onDOMNouseScroll),t.canvas.removeEventListener("mouseover",t._onMouseOver),t.canvas.removeEventListener("mouseout",t._onMouseOut),t.canvas.removeEventListener("mouseclick",t._onMouseClick),t.canvas.removeEventListener("mouseup",t._onMouseUp),t.canvas.removeEventListener("mousedown",t._onMouseDown),t.canvas.removeEventListener("mousemove",t._onMouseMove),t.canvas.removeEventListener("mousebutton",t._onMouseButton)},e.exports={makeMouseEmitter:o,removeMouseEmitter:a}},{"../math/math":30,"../util/signal":42,"../util/util":43}],23:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p;p=t("../util/util"),u=t("../math/math").Vec2,a=t("../util/signal").Signal,n=1,o=280,s=.001,r=60,h={},h.pauseTouchEmitter=function(t){return this.touchPinch.pause(t),this.touchTap.pause(t),this.touchSpread.pause(t),this.touchFlick.pause(t),this.touchDrag.pause(t),this.touchDone.pause(t)},l=function(t){var e;if(null!=t.canvas)return p.extend(t,h),t.touchPinch=new a,t.touchTap=new a,t.touchSpread=new a,t.touchDrag=new a,t.touchFlick=new a,t.touchDone=new a,t.ongoingTouches=[],t._lastTouchTime=Date.now(),e=function(e){var i,n,r,s,o;if(PXL.Context.switchContext(t),t.ongoingTouches.length>0)for(i=r=0,s=t.ongoingTouches.length-1;0<=s?r<=s:r>=s;i=0<=s?++r:--r)if(o=t.ongoingTouches[i],n=o.identifier,n===e)return i;return-1},t._onTouchStart=function(i){return function(i){var n,r,s,o,a;for(PXL.Context.switchContext(t),i.preventDefault(),a=i.changedTouches,r=0,s=a.length;r<s;r++)o=a[r],n=e(o.identifier),n===-1&&(o.ppos=new u(o.clientX,o.clientY),o.cpos=new u(o.clientX,o.clientY),o.spos=new u(o.clientX,o.clientY),o.moved=!1,o.timeStart=o.timeNow=o.timePrev=Date.now(),t.ongoingTouches.push(o));if(PXL.Context.debug)return console.log("Touch Start ",t.ongoingTouches)}}(this),t.canvas.ontouchstart=t._onTouchStart,t._onTouchMove=function(i){var a,h,l,c,p,f,d,m,g,v,x,y;for(PXL.Context.switchContext(t),i.preventDefault(),y=i.changedTouches,d=0,m=y.length;d<m;d++)g=y[d],f=e(g.identifier),x=t.ongoingTouches[f],x.ppos.x=x.cpos.x,x.ppos.y=x.cpos.y,x.cpos.x=g.clientX,x.cpos.y=g.clientY,x.timePrev=x.timeNow,x.timeNow=Date.now(),x.ppos.x!==x.cpos.x||x.ppos.y||x.cpos.y?x.moved=!0:x.moved=!1;if(2===t.ongoingTouches.length&&x.moved){if(h=t.ongoingTouches[0].cpos.dist(t.ongoingTouches[1].cpos),l=t.ongoingTouches[0].ppos.dist(t.ongoingTouches[1].ppos),i.ddist=h-l,c=u.sub(t.ongoingTouches[0].cpos,t.ongoingTouches[0].ppos),p=u.sub(t.ongoingTouches[1].cpos,t.ongoingTouches[1].ppos),a=c.dot(p)/(c.length()*p.length()),Math.abs(i.ddist)>n)return a>.5?(i.currentPos=t.ongoingTouches[0].cpos,i.previousPos=t.ongoingTouches[0].ppos,i.fingers=2,t.touchSwipe.dispatch(i)):(i.center=u.add(t.ongoingTouches[0].cpos,t.ongoingTouches[1].cpos),i.center.multScalar(.5),h>l?t.touchSpread.dispatch(i):t.touchPinch.dispatch(i))}else if(1===t.ongoingTouches.length&&Date.now()-t._lastTouchTime>r&&(x=t.ongoingTouches[0],v=x.cpos.distanceTo(x.ppos)/(Date.now()-x.timeStart),(v<=s||x.timeNow-x.timeStart>o)&&x.cpos.distanceTo(x.ppos)>0))return i.currentPos=x.cpos.copy(),i.previousPos=x.ppos.copy(),i.startPos=x.spos.copy(),i.fingers=1,t.touchDrag.dispatch(i)},t.canvas.ontouchmove=t._onTouchMove,t._touchEnd=function(i){var n,o,a,h,l,c,p,f,d,m;if(PXL.Context.switchContext(t),i.preventDefault(),d=i.changedTouches,1===t.ongoingTouches.length)for(Date.now()-t._lastTouchTime>r&&(m=new u(d[0].clientX,d[0].clientY),p=m.distanceTo(t.ongoingTouches[0].ppos)/(Date.now()-t.ongoingTouches[0].timeStart),p>=s&&(f=t.ongoingTouches[0],i.currentPos=f.cpos.copy(),i.previousPos=f.ppos.copy(),i.startPos=f.spos.copy(),i.fingers=1,t.touchFlick.dispatch(i))),o=0,h=d.length;o<h;o++)c=d[o],n=e(c.identifier),t.ongoingTouches[n].moved===fa(lse&&Date.now()-t._lastTouchTime>r)&&(PXL.Context.debug&&console.log(i),i.currentPos=t.ongoingTouches[n].cpos.copy(),i.fingers=1,t.touchTap.dispatch(i)),t.ongoingTouches.splice(n,1);else{for(a=0,l=d.length;a<l;a++)c=d[a],n=e(c.identifier),t.ongoingTouches.splice(n,1);PXL.Context.debug&&console.log("Touch End ",t.ongoingTouches)}if(t._lastTouchTime=Date.now(),0===t.ongoingTouches.length)return t.touchDone.dispatch(i)},t.canvas.ontouchend=t._touchEnd,t.canvas.ontouchcancel=t._touchEnd},c=function(t){return t.canvas.removeEventListener("touchend",t._onTouchEnd),t.canvas.removeEventListener("touchcancel",t._onTouchEnd),t.canvas.removeEventListener("touchmove",t._onTouchMove),t.canvas.removeEventListener("touchstart",t._onTouchStart)},e.exports={makeTouchEmitter:l,removeTouchEmitter:c}},{"../math/math":30,"../util/signal":42,"../util/util":43}],24:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v;g=t("../math/math"),h=g.Matrix4,f=g.Vec2,d=g.Vec3,m=g.Vec4,v=t("../colour/colour"),l=v.RGB,c=v.RGBA,r=t("../gl/contract").Contract,s=t("../gl/fbo").Fbo,o=5,a=5,n=function(){function t(t){this.colour=t,null==this.colour&&(this.colour=new l(0,0,0)),this.contract=new r,this.contract.roles.uAmbientLightingColour="colour"}return t.prototype._addToNode=function(t){return t.ambientLight=this,this},t}(),u=function(){function t(e,i,n){this.pos=e,this.colour=i,this.attenuation=n,this.contract=t.contract,this._posGlobal=t._posGlobal,this._colourGlobal=t._colourGlobal,this._attenuationGlobal=t._attenuationGlobal,this._numGlobal=t._numGlobal,null==this.pos&&(this.pos=new d(1,1,1)),null==this.colour&&(this.colour=l.WHITE()),null==this.attenuation&&(this.attenuation=[100,1,.045,.0075])}return t._posGlobal=new Float32Array(3*o),t._colourGlobal=new Float32Array(3*o),t._attenuationGlobal=new Float32Array(4*o),t.contract=new r,t.contract.roles.uPointLightPos="_posGlobal",t.contract.roles.uPointLightColour="_colourGlobal",t.contract.roles.uPointLightAttenuation="_attenuationGlobal",t.contract.roles.uPointLightNum="_numGlobal",t._preDraw=function(e){var i,n,r,s;if(i=0,null!=e){for(n=0,r=e.length;n<r;n++)s=e[n],t._posGlobal[3*i]=s.pos.x,t._posGlobal[3*i+1]=s.pos.y,t._posGlobal[3*i+2]=s.pos.z,t._colourGlobal[3*i]=s.colour.r,t._colourGlobal[3*i+1]=s.colour.g,t._colourGlobal[3*i+2]=s.colour.b,t._attenuationGlobal[4*i]=s.attenuation.x,t._attenuationGlobal[4*i+1]=s.attenuation.y,t._attenuationGlobal[4*i+2]=s.attenuation.z,t._attenuationGlobal[4*i+3]=s.attenuation.w;return t._numGlobal=e.length}},t.prototype._addToNode=function(t){return t.pointLights.push(this),this},t.prototype._removeFromNode=function(t){return t.pointLights.splice(t.pointLights.indexOf(this)),this},t}(),p=function(){function t(e,i,n,r,o,a,u){this.pos=e,this.colour=i,this.dir=n,this.angle=r,this.shadowmap=o,this.exponent=a,this.attenuation=u,this.contract=t.contract,this._posGlobal=t._posGlobal,this._colourGlobal=t._colourGlobal,this._attenuationGlobal=t._attenuationGlobal,this._dirGlobal=t._dirGlobal,this._angleGlobal=t._angleGlobal,this._expGlobal=t._expGlobal,null==this.pos&&(this.pos=new d(1,1,1)),null==this.colour&&(this.colour=l.WHITE()),null==this.shadowmap&&(this.shadowmap=!1),this.shadowmap&&(this.shadowmap_fbo=new s(640,640),this.invMatrix=new h),null==this.attenuation&&(this.attenuation=[10,1,.045,.0075]),null==this.dir&&(this.dir=new d(0,(-1),0)),this.dir.normalize(),null==this.angle&&(this.angle=45),null==this.exponent&&(this.exponent=100),this.idx=-1}return t._posGlobal=new Float32Array(3*a),t._colourGlobal=new Float32Array(3*a),t._attenuationGlobal=new Float32Array(4*a),t._dirGlobal=new Float32Array(3*a),t._angleGlobal=new Float32Array(a),t._expGlobal=new Float32Array(a),t._invMatrix=new Float32Array(16*a),t.contract=new r,t.contract.roles.uSpotLightPos="_posGlobal",t.contract.roles.uSpotLightColour="_colourGlobal",t.contract.roles.uSpotLightAttenuation="_attenuationGlobal",t.contract.roles.uSpotLightDir="_dirGlobal",t.contract.roles.uSpotLightAngle="_angleGlobal",t.contract.roles.uSpotLightExp="_expGlobal",t.contract.roles.uSpotLightNum="_numGlobal",t.contract.roles.uSpotLightInvMatrix="_invMatrix",t._preDraw=function(e){var i,n,r,s,o,a;if(n=0,null!=e){for(r=0,o=e.length;r<o;r++){for(a=e[r],t._posGlobal[3*n]=a.pos.x,t._posGlobal[3*n+1]=a.pos.y,t._posGlobal[3*n+2]=a.pos.z,t._colourGlobal[3*n]=a.colour.r,t._colourGlobal[3*n+1]=a.colour.g,t._colourGlobal[3*n+2]=a.colour.b,t._attenuationGlobal[4*n]=a.attenuation.x,t._attenuationGlobal[4*n+1]=a.attenuation.y,t._attenuationGlobal[4*n+2]=a.attenuation.z,t._attenuationGlobal[4*n+3]=a.attenuation.w,t._dirGlobal[3*n]=a.dir.x,t._dirGlobal[3*n+1]=a.dir.y,t._dirGlobal[3*n+2]=a.dir.z,t._angleGlobal[n]=a.angle,t._expGlobal[n]=a.exponent,i=s=0;s<=15;i=++s)t._invMatrix[16*n+i]=a.invMatrix.a[i];n+=1}return t.numGlobal=e.length}},t.prototype._addToNode=function(t){return t.spotLights.push(this),this},t.prototype._removeFromNode=function(t){return t.spotLights.splice(t.spotLights.indexOf(this)),this},t}(),e.exports={PointLight:u,AmbientLight:n,SpotLight:p}},{"../colour/colour":4,"../gl/contract":11,"../gl/fbo":12,"../math/math":30}],25:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p=function(t,e){function i(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},f={}.hasOwnProperty;r=t("./material").Material,s=t("../colour/colour").RGBA,h=t("../gl/uber_shader_paths"),l=h.uber_uniform_colour,c=h.uber_vertex_colour,u=h.uber_texture_mat,n=function(t){function e(t){this.colour=t,e.__super__.constructor.call(this),null==this.colour&&(this.colour=new s.WHITE),null==this.colour.a&&(this.colour=new s(this.colour.r,this.colour.g,this.colour.b,1)),this.contract.roles.uColour="colour",this._uber0=l(!0,this._uber0),this._uber_defines=["BASIC_COLOUR"]}return p(e,t),e}(r),a=function(t){function e(){e.__super__.constructor.call(this),this._uber0=c(!0,this._uber0),this._uber_defines=["VERTEX_COLOUR"]}return p(e,t),e}(r),o=function(t){function e(t){this.texture=t,e.__super__.constructor.call(this),this._uber0=u(!0,this._uber0),this._uber_defines=["MAT_TEXTURE","VERTEX_TEXTURE"],this.contract.roles.uSamplerTexture="texture"}return p(e,t),e.prototype._preDraw=function(){return this.texture.bind()},e}(r),e.exports={Material:r,BasicColourMaterial:n,VertexColourMaterial:a,TextureMaterial:o}},{"../colour/colour":4,"../gl/uber_shader_paths":16,"./material":27}],26:[function(t,e,i){var n,r,s,o,a,h,u=function(t,e){function i(){this.constructor=t}for(var n in e)l.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},l={}.hasOwnProperty;r=t("./material").Material,o=t("../gl/uber_shader_paths"),h=o.uber_depth_set,a=o.uber_depth_read,n=function(t){function e(){e.__super__.constructor.call(this),this._override=!0,this._uber0=h(!0,this._uber0),this._uber_defines=["FRAGMENT_DEPTH_OUT","ADVANCED_CAMERA"]}return u(e,t),e}(r),s=function(t){function e(t){this.depth_texture=t,e.__super__.constructor.call(this),this._override=!0,this._uber0=a(!0,this._uber0),this._uber_defines=["FRAGMENT_DEPTH_IN","ADVANCED_CAMERA","VERTEX_TEXTURE"]}return u(e,t),e.prototype._preDraw=function(){return this.depth_texture.bind()},e.prototype._postDraw=function(){return this.depth_texture.unbind()},e}(r),e.exports={DepthMaterial:n,ViewDepthMaterial:s}},{"../gl/uber_shader_paths":16,"./material":27}],27:[function(t,e,i){var n,r;n=t("../gl/contract").Contract,r=function(){function t(){this.contract=new n,this._uber0=0,this._uber_defines=[],this._override=!1}return t.prototype._addToNode=function(t){return t.material=this},t.prototype._preDraw=function(){return this},t.prototype._postDraw=function(){return this},t}(),e.exports={Material:r}},{"../gl/contract":11}],28:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m=function(t,e){function i(){this.constructor=t}for(var n in e)g.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},g={}.hasOwnProperty;h=t("../colour/colour"),s=h.RGB,o=h.RGBA,n=t("./material").Material,a=t("../gl/texture").Texture,u=t("../gl/uber_shader_paths"),l=u.uber_phong_diff_tex,f=u.uber_phong_spec_tex,c=u.uber_phong_emis_tex,d=u.uber_vertex_colour,p=u.uber_phong_mat,r=function(t){function e(t,i,n,r,h){var u;this.ambient=t,this.diffuse=i,this.specular=n,this.shine=r,this.emissive=h,e.__super__.constructor.call(this),this._uber_defines=["MAT_PHONG","VERTEX_NORMAL","ADVANCED_CAMERA"],this._preDrawCalls=[],null==this.ambient&&(this.ambient=new s(0,0,0)),null==this.specular&&(this.specular=new s(1,1,1)),null==this.shine&&(this.shine=20),null==this.emissive&&(this.emissive=new s(0,0,0)),this.contract.roles.uMaterialAmbientColour="ambient",this.contract.roles.uMaterialShininess="shine",u=!1,null==this.diffuse?(this._uber_defines+=["VERTEX_COLOUR"],this._uber0=d(!0,this._uber0)):this.diffuse instanceof s||this.diffuse instanceof o?(this.diffuse=new s(this.diffuse.r,this.diffuse.g,this.diffuse.b),this.contract.roles.uMaterialDiffuseColour="diffuse",this._uber0=l(!1,this._uber0)):this.diffuse instanceof a&&(this.diffuse.contract.roles.uSamplerDiffuse="unit",this._preDrawCalls.push(function(t){return function(){return t.diffuse.bind()}}(this)),u=!0,this._uber0=l(!0,this._uber0)),this.specular instanceof s?(this.contract.roles.uMaterialSpecularColour="specular",this._uber0=f(!1,this._uber0)):this.specular instanceof a&&(this.specular.contract.roles.uSamplerSpecular="unit",this._preDrawCalls.push(function(t){return function(){return t.specular.bind()}}(this)),u=!0,this._uber0=f(!0,this._uber0)),this.emissive instanceof s?(this.contract.roles.uMaterialEmissiveColour="emissive",this._uber0=c(!1,this._uber0)):this.emissive instanceof a&&(this.emissive.contract.roles.uSamplerEmissive="unit",this._preDrawCalls.push(function(t){return function(){return t.emissive.bind()}}(this)),u=!0,this._uber0=f(!0,this._uber0)),u&&this._uber_defines.push("VERTEX_TEXTURE"),this._uber0=p(!0,this._uber0)}return m(e,t),e.prototype._preDraw=function(){var t,e,i,n,r;for(n=this._preDrawCalls,r=[],e=0,i=n.length;e<i;e++)t=n[e],r.push(t());return r},e}(n),e.exports={PhongMaterial:r}},{"../colour/colour":4,"../gl/texture":14,"../gl/uber_shader_paths":16,"./material":27}],29:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,y=function(t,e){function i(){this.constructor=t}for(var n in e)_.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},_={}.hasOwnProperty;v=t("../math/math"),d=v.Vec2,m=v.Vec3,g=v.Vec4,l=v.Matrix4,p=v.PI,h=function(){function t(){}return t.prototype.pointOnCurve=function(t){return new d(t,t)},t.prototype.y=function(t){return t},t.prototype.stepForU=function(t){return t},t.prototype.xForStep=function(t){return x},t.prototype.pointDistance=function(t){var e;return e=Math.sqrt(t*t/2),new d(e,e)},t.prototype.tangentOnCurve=function(t){return new d(1,1)},t.prototype.tangentDistance=function(t){return new d(1,1)},t}(),a=function(){function t(){var e,i,n,r,s;if(this.length=0,t.cache_table){for(this._table=[],r=1/t.cache_size,e=i=0,n=t.cache_size-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)s=e*r,this._table.push({u:s,d:this.stepForU(s)});this.length=this._table[this._table.length-1].d}else this.length=this.stepForU(1)}return t.step_rez=.01,t.cache_table=!0,t.cache_size=200,t.prototype.pointOnCurve=function(t){return new m(0,0,0)},t.prototype.stepForU=function(e){var i,n,r,s,o,a,h;if(0===e)return 0;for(o=0,i=0,h=0,r=0,a=this.pointOnCurve(0),n=a;r<e;)o=i,h=r,a.copyFrom(n),r+=t.step_rez,n=this.pointOnCurve(r),i+=n.dist(a);return s=(e-h)/(r-h),s*(i-o)+o},t.prototype.uForStep=function(e){var i,n,r,s,o,a,h;if(0===e)return 0;for(o=0,i=0,h=0,r=0,a=this.pointOnCurve(0),n=a;i<e;)o=i,h=r,a.copyFrom(n),r+=t.step_rez,n=this.pointOnCurve(r),i+=n.dist(a);return s=e-o,i-o>0&&(s/=i-o),s*(r-h)+h},t.prototype.pointDistance=function(t){var e,i,n,r,s,o,a,h,u;if(0===t)return this.pointOnCurve(0);if(t>=this.length)return this.pointOnCurve(1);if(this._table){for(e=0,i=0,o=0,a=0,h=this._table,r=0,s=h.length;r<s&&(u=h[r],a=i,o=e,i=u.u,e=u.d,!(u.d>=t));r++);return n=t-o,e-o>0&&(n/=e-o),this.pointOnCurve(n*(i-a)+a)}return this.pointOnCurve(this.uForStep(t))},t.prototype.tangentOnCurve=function(e){var i,n;return i=this.pointOnCurve(e),n=this.pointOnCurve(e+t.step_rez/2),e>=1&&(n=i,i=n-t.step_rez/2),m.sub(n,i).normalize()},t.prototype.tangentDistance=function(e){var i,n;return i=this.pointDistance(e),n=this.pointDistance(e+t.step_rez/2),e>=this.length&&(n=i,i=n-t.step_rez/2),m.sub(n,i).normalize()},t}(),n=function(t){function e(t,i,n,r){this.v0=t,this.v1=i,this.v2=n,this.v3=r,e.__super__.constructor.call(this)}return y(e,t),e.prototype._B1=function(t){return t*t*t},e.prototype._B2=function(t){return 3*t*t*(1-t)},e.prototype._B3=function(t){return 3*t*(1-t)*(1-t)},e.prototype._B4=function(t){return(1-t)*(1-t)*(1-t)},e.prototype.pointOnCurve=function(t){return new m(v0.x*this._B1(t)+v1.x*this._B2(t)+v2.x*this._B3(t)+v3.x*this._B4(t),v0.y*this._B1(t)+v1.y*this._B2(t)+v2.y*this._B3(t)+v3.y*this._B4(t),v0.z*this._B1(t)+v1.z*this._B2(t)+v2.z*this._B3(t)+v3.z*this._B4(t))},e}(a),f=function(){function t(t,e,i,n){this.f=t,this.a=e,this.b=i,this.c=n}return t.prototype.sample=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b;return 0===this.a&&0!==this.b?(a=this.f.x,h=(this.f.y+this.c)/2,u=this.f.y-h,e=1/(4*u),n=-a/(2*u),s=a*a/(4*u)+h,y=e*t*t+n*t+s,[y,y]):0===this.b&&0!==this.a?(a=(this.f.x+this.c)/2,h=this.f.y,u=this.f.x-a,_=Math.sqrt(4*u*(t-a))+h,b=h-Math.sqrt(4*u*(t-a)),[_,b]):0!==this.a&&0!==this.b?(i=this.a*this.a,r=this.b*this.b,o=this.c*this.c,d=this.f.x,m=d*d,g=this.f.y,v=g*g,x=t*t,l=-2*i*g-2*this.a*this.b*t-2*r*g-2*this.b*this.c,c=Math.sqrt(l*l-4*i*(i*m-2*i*d*t+i*v-2*this.a*this.c*t+r*m-2*r*d*t+r*v+r*x-o)),p=2*i*g+2*this.a*this.b*t+2*r*g+2*this.b*this.c,f=2*i,[(-c+p)/f,(c+p)/f]):(PXLError("Malformed "),[0,0])},t.prototype.lineCrossing=function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,m,g,v,x,y,_,b,w;return n=this.a,s=this.b,a=this.c,r=this.a*this.a,o=this.b*this.b,h=this.c*this.c,l=e*e,u=t*t,c=i*i,p=this.f.x,m=this.f.y,f=p*p,g=m*m,console.log(n,s,a,e,t,i,p,m),v=2*r*t*e*m+2*r*t*i-2*r*l*p+2*n*s*e*i-2*n*a*l+2*o*t*e*m-2*o*l*p+2*s*a*t*e,console.log("t0",v),x=4*(r*u+2*n*s*t*e+o*l)*(r*l*f+r*l*g+2*r*e*i*m+r*c+o*l*f+o*l*g+2*o*e*i*m+2*s*a*e*i-h*l),console.log("t1",x),y=2*r*t*e*m-2*r*t*i+2*r*l*p-2*n*s*e*i+2*n*a*l-2*o*t*e*m+2*o*l*p-2*s*a*t*e,console.log("t2",y),_=2*(r*u+2*n*s*t*e+o*l),console.log("t3",_),b=(-Math.sqrt(v*v-x)-y)/_,w=(Math.sqrt(v*v-x)-y)/_,[new d(b,(-t*b-i)/e),new d(w,(-t*w-i)/e)]},t}(),r=function(){function t(t){var e,i,n,r,s,o,a,h,u,c;if(16!==t.length)return void PXLError("Catmull Patch needs 16 points");for(e=new l([-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0]),c=[],n=0,s=t.length;n<s;n++)u=t[n],c.push(u.x);for(this.px=new l(c),c=[],r=0,o=t.length;r<o;r++)u=t[r],c.push(u.y);for(this.py=new l(c),c=[],h=0,a=t.length;h<a;h++)u=t[h],c.push(u.z);this.pz=new l(c),i=l.transpose(e),this.px=l.mult(e,this.px).mult(i),this.py=l.mult(e,this.py).mult(i),this.pz=l.mult(e,this.pz).mult(i)}return t.prototype.sample=function(t){var e,i,n,r,s,o,a,h,u,c,p,f;return i=t.x,n=i*i,r=n*i,a=t.y,h=a*a,u=h*a,e=new g(r,n,i,1),o=new g(u,h,a,1),s=l.multVec(this.px,o),c=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w,s=l.multVec(this.py,o),p=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w,s=l.multVec(this.pz,o),f=e.x*s.x+e.y*s.y+e.z*s.z+e.w*s.w,new m(c,p,f)},t}(),o=function(t){function e(t,i,n,r){this.p0=t,this.p1=i,this.m0=n,this.m1=r,e.__super__.constructor.call(this)}return y(e,t),e.prototype.pointOnCurve=function(t){var e,i,n,r,s,o;return o=t*t*t,s=t*t,e=this.p0.copy().multScalar(2*o-3*s+1),i=this.m0.copy().multScalar(o-2*s+t),n=this.p1.copy().multScalar(-2*o+3*s),r=this.m1.copy().multScalar(o-s),e.add(i).add(n).add(r)},e}(a),s=function(t){function e(t){var i,n,r,s,a,h;if(t.length<4)return void PXLError("Catmull-Rom Spline needs at least 4 points");for(h=t.length-3,this.splines=[],i=n=0,a=h-1;0<=a?n<=a:n>=a;i=0<=a?++n:--n)r=t[i+2].copy().sub(t[i]),s=t[i+3].copy().sub(t[i+1]),this.splines.push(new o(t[i+1],t[i+2],r,s));e.__super__.constructor.call(this)}return y(e,t),e.prototype.pointOnCurve=function(t){var e;return e=Math.floor(t*this.splines.length),t>=1?this.splines[this.splines.length-1].pointOnCurve(1):t<=0?this.splines[0].pointOnCurve(0):this.splines[e].pointOnCurve(this.splines.length*t-e)},e}(a),u=function(){function t(t,e){this.curve=t,this.normal=e,this.reset(this.normal,0)}return t.prototype.reset=function(t,e){return this.normal=t,null==e&&(e=0),this.d=e,this.pos=this.curve.pointDistance(this.d),this.tangent=this.curve.tangentDistance(this.d),this.bp=m.cross(this.normal,this.tangent),this.np=this.normal,this.binormal=this.bp},t.prototype.slide=function(t){return this.d+=t,this.d>this.curve.length&&this.reset(this.normal,0),this.pos=this.curve.pointDistance(this.d),this.tangent=this.curve.tangentDistance(this.d),this.bp=this.binormal,this.normal=m.cross(this.bp,this.tangent),this.binormal=m.cross(this.tangent,this.normal)},t}(),c=function(t){function e(){}return y(e,t),e}(a),e.exports={Curve2:h,BezierCubic3:n,CubicHermiteSpline:o,CatmullRomSpline:s,Parabola:f,CatmullPatch:r,CurveSlide:u}},{"../math/math":30}],30:[function(t,e,i){var n,r,s,o,h,u,l,c,p,f,d,m,g,v,_,b=function(t,e){function i(){this.constructor=t}for(var n in e)w.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},w={}.hasOwnProperty;c=t("../util/log").PXLWarning,v=Float32Array,n=437114e-10,l=3.14159,_=function(t){return 57.2957795*t},g=function(t){return.017453292523928*t},f=function(){function t(t,e){var i;null==t&&(t=0),null==e&&(e=0),i=[t,e],this.x=i[0],this.y=i[1]}return t.prototype.DIM=2,t.sub=function(t,e){return t.clone().sub(e)},t.add=function(t,e){return t.clone().add(e)},t.div=function(t,e){return t.clone().div(e)},t.mult=function(t,e){return t.clone().mult(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.normalize=function(t){return t.clone().normalize()},t.dot=function(t,e){return t.dot(e)},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.length=function(){return Math.sqrt(this.lengthSquared())},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var t;return t=this.length(),t>0&&this.multScalar(1/t),this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.dv=function(e){return new t(Math.abs(this.x-e.x)(Math.abs(this.y-e.y)))},t.prototype.dist=function(e){return t.sub(this,e).length()},t.prototype.distSquared=function(e){return t.sub(this,e).lengthSquared()},t.prototype.div=function(t){var e;return e=[this.x/t.x,this.y/t.y],this.x=e[0],this.y=e[1],this},t.prototype.mult=function(t){var e;return e=[this.x*t.x,this.y*t.y],this.x=e[0],this.y=e[1],this},t.prototype.multScalar=function(t){var e;return e=[this.x*t,this.y*t],this.x=e[0],this.y=e[1],this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.invalid=function(){return this.x===1/0||isNaN(this.x)||this.y===1/0||isNaN(this.y)},t.prototype.flatten=function(){return[this.x,this.y]},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t}(),r=function(){function t(t,e){this.start=t,this.end=e}return t.prototype.equation=function(){return[this.start.y-this.end.y,this.end.x-this.start.x,this.start.x*this.end.y-this.end.x*this.start.y]},t.prototype.sample=function(t){var e,i,n,r;return r=this.equation(),e=r[0],i=r[1],n=r[2],(-e*t-n)/i},t.prototype.length=function(){return this.end.dist(this.start)},t}(),s=function(t){function e(t,i,n,r){this.start=t,this.end=i,this.face0=n,this.face1=r,e.__super__.constructor.call(this,this.start,this.end)}return b(e,t),e}(r),d=function(){function t(t,e,i){var n;null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),n=[t,e,i],this.x=n[0],this.y=n[1],this.z=n[2]}return t.prototype.DIM=3,t.sub=function(t,e){return t.clone().sub(e)},t.add=function(t,e){return t.clone().add(e)},t.cross=function(t,e){return t.clone().cross(e)},t.div=function(t,e){return t.clone().div(e)},t.mult=function(t,e){return t.clone().mult(e)},t.perp=function(t){return t.clone().perp()},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.normalize=function(t){return t.clone().normalize()},t.dot=function(t,e){return t.dot(e)},t.prototype.clone=function(){return new t(this.x,this.y,this.z)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t.prototype.xy=function(){return new t(this.x,this.y)},t.prototype.length=function(){return Math.sqrt(this.lengthSquared())},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.normalize=function(){var t;return t=this.length(),t>0&&this.multScalar(1/t),this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.cross=function(t){var e,i,n;return e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,n=this.x*t.y-this.y*t.x,this.x=e,this.y=i,this.z=n,this},t.prototype.dv=function(t){return this.x=Math.abs(this.x-t.x),this.y=Math.abs(this.y-t.y),this.z=Math.abs(this.z-t.z),this},t.prototype.dist=function(e){return t.sub(this,e).length()},t.prototype.distSquared=function(e){return t.sub(this,e).lengthSquared()},t.prototype.div=function(t){var e;return e=[this.x/t.x,this.y/t.y,this.z/t.z],this.x=e[0],this.y=e[1],this.z=e[2],this},t.prototype.perp=function(){return 0!==this.z?(this.z=(2*-this.x-this.y)/this.z,this.x=2,this.y=1):0!==this.y?(this.y=(2*-this.x-this.z)/this.y,this.x=2,this.z=1):0!==this.x&&(this.x=(2*-this.y-this.z)/this.x,this.y=2,this.z=1),this},t.prototype.mult=function(t){var e;return e=[this.x*t.x,this.y*t.y,this.z*t.z],this.x=e[0],this.y=e[1],this.z=e[2],this},t.prototype.multScalar=function(t){var e;return e=[this.x*t,this.y*t,this.z*t],this.x=e[0],this.y=e[1],this.z=e[2],this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.invalid=function(){return this.x===1/0||isNaN(this.x)||this.y===1/0||isNaN(this.y)||this.z===1/0||isNaN(this.z)},t.prototype.flatten=function(){return[this.x,this.y,this.z]},t.prototype.set=function(t,e,i){return this.x=t,this.y=e,this.z=i,this},t}(),m=function(){function t(t,e,i,n){var r;null==t&&(t=0),null==e&&(e=0),null==i&&(i=0),null==n&&(n=1),r=[t,e,i,n],this.x=r[0],this.y=r[1],this.z=r[2],this.w=r[3]}return t.prototype.DIM=4,t.sub=function(t,e){return t.clone().sub(e)},t.add=function(t,e){return t.clone().add(e)},t.cross=function(t,e){return t.clone().cross(e)},t.div=function(t,e){return t.clone().div(e)},t.mult=function(t,e){return t.clone().mult(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.normalize=function(t){return t.clone().normalize()},t.dot=function(t,e){return t.dot(e)},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.xyz=function(){return new d(this.x,this.y,this.z)},t.prototype.length=function(){return Math.sqrt(this.lengthSquared())},t.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},t.prototype.normalize=function(){var t;return t=this.length(),t>0&&this.multScalar(1/t),this},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},t.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},t.prototype.cross=function(t){var e,i,n;return e=this.y*t.z-this.z*t.y,i=this.z*t.x-this.x*t.z,n=this.x*t.y-this.y*t.x,this.x=e,this.y=i,this.z=n,this},t.prototype.dv=function(t){return this.x=Math.abs(this.x-t.x),this.y=Math.abs(this.y-t.y),this.z=Math.abs(this.z-t.z),this.w=Math.abs(this.w-t.w),this},t.prototype.dist=function(e){return t.sub(this,e).length()},t.prototype.distSquared=function(e){return t.sub(this,e).lengthSquared()},t.prototype.div=function(t){var e;return e=[this.x/t.x,this.y/t.y,this.z/t.z,this.w/t.w],this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},t.prototype.mult=function(t){var e;return e=[this.x*t.x,this.y*t.y,this.z*t.z,this.w*t.w],this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},t.prototype.multScalar=function(t){var e;return e=[this.x*t,this.y*t,this.z*t,this.w*t],this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},t.prototype.invalid=function(){return this.x===1/0||isNaN(this.x)||this.y===1/0||isNaN(this.y)||this.z===1/0||isNaN(this.z)||this.w===1/0||isNaN(this.w)},t.prototype.flatten=function(){return[this.x,this.y,this.z,this.w]},t.prototype.set=function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},t}(),o=function(){function t(e){null==e&&(e=[1,0,0,1]),e instanceof t?this.a=e.a:this.a=new v(e)}return t.prototype.DIM=2,t.addScalar=function(t,e){return t.clone().addScalar(e)},t.subScalar=function(t,e){return t.clone().subScalar(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.divScalar=function(t,e){return t.clone().divScalar(e)},t.mult=function(t,e){return t.clone().mult(e)},t.multVec=function(t,e){var i;return i=e.clone(),t.multVec(i),i},t.transpose=function(e){return new t([e.a[0],e.a[2],e.a[1],e.a[3]])},t.prototype.clone=function(){return new t(this.a)},t.prototype.copy=function(t){var e,i;for(e=i=0;i<=3;e=++i)this.a[e]=t.a[e];return this},t.prototype.multScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e*t);return s}.call(this),this},t.prototype.addScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e+t);return s}.call(this),this},t.prototype.subScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e-t);return s}.call(this),this},t.prototype.divScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e/t);return s}.call(this),this},t.prototype.identity=function(){return this.a.set([1,0,0,1]),this},t.prototype.flatten=function(){return this.a},t.prototype.at=function(t,e){return this.a[2*e+t]},t.prototype.mult=function(e){var i;
return i=new t,i.a[0]=this.a[0]*e.a[0]+this.a[2]*e.a[1],i.a[1]=this.a[1]*e.a[0]+this.a[3]*e.a[1],i.a[2]=this.a[0]*e.a[2]+this.a[2]*e.a[3],i.a[3]=this.a[1]*e.a[2]+this.a[3]*e.a[3],this.copy(i),this},t.prototype.multVec=function(t){var e,i;return null!=t.z||null!=t.w?void c("Mismatched vector and matrix dimensions"):(e=this.a[0]*t.x+this.a[2]*t.y,i=this.a[1]*t.x+this.a[3]*t.y,t.x=e,t.y=i,this)},t.prototype.getCol=function(e){return e*=t.DIM,f(this.a[e+0](this.a[e+1]))},t.prototype.getRow=function(t){return f(this.a[t+0](this.a[t+2]))},t.prototype.transpose=function(){return this.copy(new t([this.a[0],a[2],this.a[1],this.a[3]])),this},t.prototype.print=function(){return console.log(this.a[0]+","+this.a[2]),console.log(this.a[1]+","+this.a[3]),this},t.prototype.rotate=function(e){var i,n,r;return n=new t,r=Math.sin(e),i=Math.cos(e),n.a[0]=i,n.a[1]=r,n.a[2]=-r,n.a[3]=i,this.mult(n),this},t.prototype.scale=function(t){var e;return e=new h,e.a[0]=t.x,e.a[4]=t.y,e.a[8]=t.z,this.mult(e),this},t}(),h=function(){function t(e){null==e&&(e=[1,0,0,0,1,0,0,0,1]),e instanceof t?this.a=e.a:this.a=new v(e)}return t.prototype.DIM=3,t.addScalar=function(t,e){return t.clone().addScalar(e)},t.subScalar=function(t,e){return t.clone().subScalar(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.divScalar=function(t,e){return t.clone().divScalar(e)},t.mult=function(t,e){return t.clone().mult(e)},t.invert=function(t){return t._invert()},t.multVec=function(t,e){var i;return i=e.clone(),t.multVec(i),i},t.transpose=function(e){return new t([e.a.a.a[0],e.a[3],e.a[6],e.a[1],e.a[4],e.a[7],e.a[2],e.a[5],e.a[8]])},t.prototype.clone=function(){return new t(this.a)},t.prototype.copy=function(t){var e,i;for(e=i=0;i<=8;e=++i)this.a[e]=t.a[e];return this},t.prototype.multScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e*t);return s}.call(this),this},t.prototype.addScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e+t);return s}.call(this),this},t.prototype.subScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e-t);return s}.call(this),this},t.prototype.divScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e/t);return s}.call(this),this},t.prototype.identity=function(){return this.a.set([1,0,0,0,1,0,0,0,1]),this},t.prototype.at=function(t,e){return this.a[3*e+t]},t.prototype.mult=function(e){var i;return i=new t,i.a[0]=this.a[0]*e.a[0]+this.a[3]*e.a[1]+this.a[6]*e.a[2],i.a[1]=this.a[1]*e.a[0]+this.a[4]*e.a[1]+this.a[7]*e.a[2],i.a[2]=this.a[2]*e.a[0]+this.a[5]*e.a[1]+this.a[8]*e.a[2],i.a[3]=this.a[0]*e.a[3]+this.a[3]*e.a[4]+this.a[6]*e.a[5],i.a[4]=this.a[1]*e.a[3]+this.a[4]*e.a[4]+this.a[7]*e.a[5],i.a[5]=this.a[2]*e.a[3]+this.a[5]*e.a[4]+this.a[8]*e.a[5],i.a[6]=this.a[0]*e.a[6]+this.a[3]*e.a[7]+this.a[6]*e.a[8],i.a[7]=this.a[1]*e.a[6]+this.a[4]*e.a[7]+this.a[7]*e.a[8],i.a[8]=this.a[2]*e.a[6]+this.a[5]*e.a[7]+this.a[8]*e.a[8],this.copy(i),this},t.prototype.flatten=function(){return this.a},t.prototype.multVec=function(t){var e,i,n;return null==t.z||null!=t.w?void c("Mismatched vector and matrix dimensions"):(e=this.a[0]*t.x+this.a[3]*t.y+this.a[6]*t.z,i=this.a[1]*t.x+this.a[4]*t.y+this.a[7]*t.z,n=this.a[2]*t.x+this.a[5]*t.y+this.a[8]*t.z,t.x=e,t.y=i,t.z=n,this)},t.prototype.getCol=function(e){return e*=t.DIM,d(this.a[e+0](this.a[e+1](this.a[e+2])))},t.prototype.getRow=function(t){return d(this.a[t+0](this.a[t+3](this.a[t+6])))},t.prototype._invert=function(){var e,i,n,r;return n=new t,i=437114e-10,n.a[0]=this.a[4]*this.a[8]-this.a[5]*this.a[7],n.a[1]=this.a[2]*this.a[7]-this.a[1]*this.a[8],n.a[2]=this.a[1]*this.a[5]-this.a[2]*this.a[4],n.a[3]=this.a[5]*this.a[6]-this.a[3]*this.a[8],n.a[4]=this.a[0]*this.a[8]-this.a[2]*this.a[6],n.a[5]=this.a[2]*this.a[3]-this.a[0]*this.a[5],n.a[6]=this.a[3]*this.a[7]-this.a[4]*this.a[6],n.a[7]=this.a[1]*this.a[6]-this.a[0]*this.a[7],n.a[8]=this.a[0]*this.a[4]-this.a[1]*this.a[3],e=this.a[0]*n.a[0]+this.a[1]*n.a[3]+this.a[2]*n.a[6],Math.abs(e)>i&&(r=1/e,n.multScalar(r)),n},t.prototype.invert=function(){return this.copy(this._invert()),this},t.prototype.transpose=function(){return this.copy(new t([this.a[0],this.a[3],this.a[6],this.a[1],this.a[4],this.a[7],this.a[2],this.a[5],this.a[8]])),this},t.prototype.print=function(){return console.log(this.a[0]+","+this.a[3]+","+this.a[6]),console.log(this.a[1]+","+this.a[4]+","+this.a[7]),console.log(this.a[2]+","+this.a[5]+","+this.a[8])},t.prototype.rotate=function(e,i){var n,r,s;return r=new t,s=Math.sin(i),n=Math.cos(i),e.normalize(),r.a[0]=e.x*e.x*(1-n)+n,r.a[1]=e.x*e.y*(1-n)+e.z*s,r.a[2]=e.x*e.z*(1-n)-e.y*s,r.a[3]=e.x*e.y*(1-n)-e.z*s,r.a[4]=e.y*e.y*(1-n)+n,r.a[5]=e.y*e.z*(1-n)+e.x*s,r.a[6]=e.x*e.z*(1-n)+e.y*s,r.a[7]=e.y*e.z*(1-n)-e.x*s,r.a[8]=e.z*e.z*(1-n)+n,this.mult(r),this},t.prototype.scale=function(e){var i;return i=new t,i.a[0]=e.x,i.a[4]=e.y,i.a[8]=e.z,this.mult(i),this},t}(),u=function(){function t(e){null==e&&(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),e instanceof t?this.a=e.a:this.a=new v(e)}return t.prototype.DIM=4,t.addScalar=function(t,e){return t.clone().addScalar(e)},t.subScalar=function(t,e){return t.clone().subScalar(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.divScalar=function(t,e){return t.clone().divScalar(e)},t.mult=function(t,e){return t.clone().mult(e)},t.invert=function(t){return t._invert()},t.transpose=function(e){return new t([e.a[0],e.a[4],e.a[8],e.a[12],e.a[1],e.a[5],e.a[9],e.a[13],e.a[2],e.a[6],e.a[10],e.a[14],e.a[3],e.a[7],e.a[11],e.a[15]])},t.multVec=function(t,e){var i;return i=e.clone(),t.multVec(i),i},t.prototype.clone=function(){return new t(this.a)},t.prototype.copy=function(t){var e,i;for(e=i=0;i<=15;e=++i)this.a[e]=t.a[e];return this},t.prototype.multScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e*t);return s}.call(this),this},t.prototype.addScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e+t);return s}.call(this),this},t.prototype.subScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e-t);return s}.call(this),this},t.prototype.divScalar=function(t){var e;return this.a=function(){var i,n,r,s;for(r=this.a,s=[],i=0,n=r.length;i<n;i++)e=r[i],s.push(e/t);return s}.call(this),this},t.prototype.identity=function(){return this.a.set([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this},t.prototype.at=function(t,e){return this.a[4*e+t]},t.prototype.getMatrix3=function(){return new h([this.a[0],this.a[1],this.a[2],this.a[4],this.a[5],this.a[6],this.a[8],this.a[9],this.a[10]])},t.prototype.mult=function(e){var i;return i=new t,i.a[0]=this.a[0]*e.a[0]+this.a[4]*e.a[1]+this.a[8]*e.a[2]+this.a[12]*e.a[3],i.a[1]=this.a[1]*e.a[0]+this.a[5]*e.a[1]+this.a[9]*e.a[2]+this.a[13]*e.a[3],i.a[2]=this.a[2]*e.a[0]+this.a[6]*e.a[1]+this.a[10]*e.a[2]+this.a[14]*e.a[3],i.a[3]=this.a[3]*e.a[0]+this.a[7]*e.a[1]+this.a[11]*e.a[2]+this.a[15]*e.a[3],i.a[4]=this.a[0]*e.a[4]+this.a[4]*e.a[5]+this.a[8]*e.a[6]+this.a[12]*e.a[7],i.a[5]=this.a[1]*e.a[4]+this.a[5]*e.a[5]+this.a[9]*e.a[6]+this.a[13]*e.a[7],i.a[6]=this.a[2]*e.a[4]+this.a[6]*e.a[5]+this.a[10]*e.a[6]+this.a[14]*e.a[7],i.a[7]=this.a[3]*e.a[4]+this.a[7]*e.a[5]+this.a[11]*e.a[6]+this.a[15]*e.a[7],i.a[8]=this.a[0]*e.a[8]+this.a[4]*e.a[9]+this.a[8]*e.a[10]+this.a[12]*e.a[11],i.a[9]=this.a[1]*e.a[8]+this.a[5]*e.a[9]+this.a[9]*e.a[10]+this.a[13]*e.a[11],i.a[10]=this.a[2]*e.a[8]+this.a[6]*e.a[9]+this.a[10]*e.a[10]+this.a[14]*e.a[11],i.a[11]=this.a[3]*e.a[8]+this.a[7]*e.a[9]+this.a[11]*e.a[10]+this.a[15]*e.a[11],i.a[12]=this.a[0]*e.a[12]+this.a[4]*e.a[13]+this.a[8]*e.a[14]+this.a[12]*e.a[15],i.a[13]=this.a[1]*e.a[12]+this.a[5]*e.a[13]+this.a[9]*e.a[14]+this.a[13]*e.a[15],i.a[14]=this.a[2]*e.a[12]+this.a[6]*e.a[13]+this.a[10]*e.a[14]+this.a[14]*e.a[15],i.a[15]=this.a[3]*e.a[12]+this.a[7]*e.a[13]+this.a[11]*e.a[14]+this.a[15]*e.a[15],this.copy(i),this},t.prototype.flatten=function(){return this.a},t.prototype.multVec=function(t){var e,i,n,r;return null==t.z?void c("Mismatched vector and matrix dimensions"):(null==t.w?(i=this.a[0]*t.x+this.a[4]*t.y+this.a[8]*t.z+this.a[12],n=this.a[1]*t.x+this.a[5]*t.y+this.a[9]*t.z+this.a[13],r=this.a[2]*t.x+this.a[6]*t.y+this.a[10]*t.z+this.a[14],e=this.a[3]*t.x+this.a[7]*t.y+this.a[11]*t.z+this.a[15],t.x=i/e,t.y=n/e,t.z=r/e):(i=this.a[0]*t.x+this.a[4]*t.y+this.a[8]*t.z+this.a[12]*t.w,n=this.a[1]*t.x+this.a[5]*t.y+this.a[9]*t.z+this.a[13]*t.w,r=this.a[2]*t.x+this.a[6]*t.y+this.a[10]*t.z+this.a[14]*t.w,e=this.a[3]*t.x+this.a[7]*t.y+this.a[11]*t.z+this.a[15]*t.w,t.x=i,t.y=n,t.z=r,t.w=e),this)},t.prototype.at=function(t,e){return this.a[4*e+t]},t.prototype.getCol=function(t){return t=4*t,m(this.a[t+0](this.a[t+1](this.a[t+2](this.a[t+3]))))},t.prototype.getRow=function(t){return m(this.a[t+0](this.a[t+4](this.a[t+8](this.a[t+12]))))},t.prototype._invert=function(){var e,i,n,r,s,o,a,h,u,l,c,p,f,d,m,g;return m=new t,d=437114e-10,e=this.a[0]*this.a[5]-this.a[1]*this.a[4],i=this.a[0]*this.a[6]-this.a[2]*this.a[4],n=this.a[0]*this.a[7]-this.a[3]*this.a[4],r=this.a[1]*this.a[6]-this.a[2]*this.a[5],s=this.a[1]*this.a[7]-this.a[3]*this.a[5],o=this.a[2]*this.a[7]-this.a[3]*this.a[6],a=this.a[8]*this.a[13]-this.a[9]*this.a[12],h=this.a[8]*this.a[14]-this.a[10]*this.a[12],u=this.a[8]*this.a[15]-this.a[11]*this.a[12],l=this.a[9]*this.a[14]-this.a[10]*this.a[13],c=this.a[9]*this.a[15]-this.a[11]*this.a[13],p=this.a[10]*this.a[15]-this.a[11]*this.a[14],f=e*p-i*c+n*l+r*u-s*h+o*a,Math.abs(f)>d&&(m.a[0]=+this.a[5]*p-this.a[6]*c+this.a[7]*l,m.a[4]=-this.a[4]*p+this.a[6]*u-this.a[7]*h,m.a[8]=+this.a[4]*c-this.a[5]*u+this.a[7]*a,m.a[12]=-this.a[4]*l+this.a[5]*h-this.a[6]*a,m.a[1]=-this.a[1]*p+this.a[2]*c-this.a[3]*l,m.a[5]=+this.a[0]*p-this.a[2]*u+this.a[3]*h,m.a[9]=-this.a[0]*c+this.a[1]*u-this.a[3]*a,m.a[13]=+this.a[0]*l-this.a[1]*h+this.a[2]*a,m.a[2]=+this.a[13]*o-this.a[14]*s+this.a[15]*r,m.a[6]=-this.a[12]*o+this.a[14]*n-this.a[15]*i,m.a[10]=+this.a[12]*s-this.a[13]*n+this.a[15]*e,m.a[14]=-this.a[12]*r+this.a[13]*i-this.a[14]*e,m.a[3]=-this.a[9]*o+this.a[10]*s-this.a[11]*r,m.a[7]=+this.a[8]*o-this.a[10]*n+this.a[11]*i,m.a[11]=-this.a[8]*s+this.a[9]*n-this.a[11]*e,m.a[15]=+this.a[8]*r-this.a[9]*i+this.a[10]*e),g=1/f,m.multScalar(g),m},t.prototype.invert=function(){return this.copy(this._invert()),this},t.prototype.transpose=function(){return this.copy(new t([this.a[0],this.a[4],this.a[8],this.a[12],this.a[1],this.a[5],this.a[9],this.a[13],this.a[2],this.a[6],this.a[10],this.a[14],this.a[3],this.a[7],this.a[11],this.a[15]])),this},t.prototype.translate=function(e){var i;return null!=e.DIM&&3!==e.DIM?(c("Mismatched vector and matrix dimensions"),this):(i=new t,i.a[12]=e.x,i.a[13]=e.y,i.a[14]=e.z,this.mult(i),this)},t.prototype.translatePart=function(t){return null!=t.DIM&&3!==t.DIM?(c("Mismatched vector and matrix dimensions"),this):(this.a[12]=t.x,this.a[13]=t.y,this.a[14]=t.z,this)},t.prototype.setPos=function(t){return null!=t.x&&(this.a[12]=t.x),null!=t.y&&(this.a[13]=t.y),null!=t.z&&(this.a[14]=t.z),this},t.prototype.getPos=function(){return new d(this.a[12],this.a[13],this.a[14])},t.prototype.print=function(){return console.log(this.a[0]+","+this.a[4]+","+this.a[8]+","+this.a[12]),console.log(this.a[1]+","+this.a[5]+","+this.a[9]+","+this.a[13]),console.log(this.a[2]+","+this.a[6]+","+this.a[10]+","+this.a[14]),console.log(this.a[3]+","+this.a[7]+","+this.a[11]+","+this.a[15]),this},t.prototype.lookAt=function(e,i,n){var r,s,o,a,h,u;return r=d.sub(i,e),r.normalize(),h=n.clone(),h.normalize(),o=d.cross(r,h),u=d.cross(o,r),s=new t([o.x,h.x,-r.x,0,o.y,h.y,-r.y,0,o.z,h.z,-r.z,0,0,0,0,1]),a=new t([1,0,0,0,0,1,0,0,0,0,1,0,-e.x,-e.y,-e.z,1]),s.mult(a),this.copy(s),this},t.prototype.makePerspective=function(t,e,i,n){var r,s,o,a;return o=i*Math.tan(t),a=-o,s=a*e,r=o*e,this.makeFrustum(s,r,a,o,i,n),this},t.prototype.makeFrustum=function(t,e,i,n,r,s){var o,a,h,u,l,c;return l=2*r/(e-t),c=2*r/(n-i),o=(e+t)/(e-t),a=(n+i)/(n-i),h=-(s+r)/(s-r),u=-2*s*r/(s-r),this.a=new v([l,0,0,0,0,c,0,0,o,a,h,-1,0,0,u,0]),this},t.prototype.makeOrtho=function(t,e,i,n,r,s){var o,a,h;return o=-(e+t)/(e-t),a=-(n+i)/(n-i),h=-(s+r)/(s-r),this.a=new v([2/(e-t),0,0,0,0,2/(n-i),0,0,0,0,-2/(s-r),0,o,a,h,1]),this},t.prototype.rotate=function(e,i){var n,r,s;return r=new t,s=Math.sin(i),n=Math.cos(i),e.normalize(),r.a[0]=e.x*e.x*(1-n)+n,r.a[1]=e.x*e.y*(1-n)+e.z*s,r.a[2]=e.x*e.z*(1-n)-e.y*s,r.a[4]=e.x*e.y*(1-n)-e.z*s,r.a[5]=e.y*e.y*(1-n)+n,r.a[6]=e.y*e.z*(1-n)+e.x*s,r.a[8]=e.x*e.z*(1-n)+e.y*s,r.a[9]=e.y*e.z*(1-n)-e.x*s,r.a[10]=e.z*e.z*(1-n)+n,this.mult(r),this},t.prototype.scale=function(e){var i;return i=new t,i.a[0]=e.x,i.a[5]=e.y,i.a[10]=e.z,this.mult(i),this},t}(),p=function(){function t(t,e,i,n){this.x=t,this.y=e,this.z=i,this.w=n,null==this.x&&(this.x=0),null==this.y&&(this.y=0),null==this.z&&(this.z=0),null==this.w&&(this.w=1)}return t.addScalar=function(t,e){return t.clone().addScalar(e)},t.subScalar=function(t,e){return t.clone().subScalar(e)},t.multScalar=function(t,e){return t.clone().multScalar(e)},t.divScalar=function(t,e){return t.clone().divScalar(e)},t.conjugate=function(t){return t.clone().conjugate()},t.mult=function(t,e){return t.clone().mult(e)},t.invert=function(t){return t.clone().invert()},t.transVec3=function(t,e){var i;return i=e.clone(),t.transVec3(i),i},t.fromRotations=function(e,i,n){var r;return r=new t,r.fromRotations(e,i,n),r},t.fromTo=function(e,i){var n;return n=new t,n.fromTo(e,i),n},t.prototype.clone=function(){return new t(this.x,this.y,this.z,this.w)},t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t.prototype.axis=function(){var t,e;return t=this.w,e=1/Math.sqrt(1-t*t),x*=e,y*=e,z*=e,new d(x,y,z)},t.prototype.angle=function(){return 2*Math.acos(this.w)},t.prototype.pitch=function(){return Math.atan2(2*(this.y*this.z+this.w*this.x),this.w*this.w-this.x*this.x-this.y*this.y+this.z*this.z)},t.prototype.yaw=function(){return Math.sin(-2*(this.x*this.z-this.w*this.y))},t.prototype.roll=function(){return Math.atan2(2*(this.x*this.y+this.w*this.z),this.w*this.w+this.x*this.x-this.y*this.y-this.z*this.z)},t.prototype.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.length=function(){return Math.sqrt(this.lengthSquared())},t.prototype.lengthSquared=function(){return this.w*this.w+this.x*this.x+this.y*this.y+this.z*this.z},t.prototype.conjugate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.invert=function(){var e;return e=t.conjugate(this),e=e.multScalar(1/this.lengthSquared()),this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this},t.prototype.add=function(t){return this.w+=t.w,this.x+=t.x,this.y+=t.y,this.z+=t.z,this},t.prototype.sub=function(t){return this.w-=t.w,this.x-=t.x,this.y-=t.y,this.z-=t.z,this},t.prototype.multiply=function(t){return this.mult(t)},t.prototype.mult=function(t){var e,i,n,r;return e=-this.x*t.x-this.y*t.y-this.z*t.z+this.w*t.w,i=this.x*t.w+this.y*t.z-this.z*t.y+this.w*t.x,n=-this.x*t.z+this.y*t.w+this.z*t.x+this.w*t.y,r=this.x*t.y-this.y*t.x+this.z*t.w+this.w*t.z,this.w=e,this.x=i,this.y=n,this.z=r,this},t.prototype.multScalar=function(t){return this.w*=t,this.x*=t,this.y*=t,this.z*=t,this},t.prototype.transVec3=function(e){var i,n,r;return i=t.conjugate(this),r=new t(e.x,e.y,e.z,0),n=i.mult(r).mult(this),e.x=n.x,e.y=n.y,e.z=n.z,this},t.prototype.normalize=function(){var t;return t=1/this.length(),this.w*=t,this.x*=t,this.y*=t,this.z*=t,this},t.prototype.log=function(){var e,i,n,r;return n=1,this.w<n&&(n=this.w),r=Math.acos(n),0===r?new t(this.x,this.y,this.z,0):(i=Math.sin(r),e=r/i,Math.abs(i)<1&&Math.abs(r)>=3.402823466e38*Math.abs(i)&&(e=1),this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=0,this)},t.prototype.exp=function(){var t,e,i,n;return n=this.v.length(),i=sin(n),e=i/n,Math.abs(n)<1&&Math.abs(i)>=3.402823466e38*Math.abs(n)&&(e=1),t=Math.cos(n),this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=t},t.prototype.fromTo=function(t,e){var i;return i=d.cross(t,e),this.w=t.dot(e),this.x=i.x,this.y=i.y,this.z=i.z,this.normalize(),this.w+=1,this.w<=n&&(t.z*t.z>t.x*t.x?(this.w=0,this.x=0,this.y=t.z,this.z=-t.y):(this.w=0,this.x=t.y,this.y=-t.x,this.z=0),this.normalize()),this},t.prototype.fromAxisAngle=function(t,e){var i;return this.w=Math.cos(e/2),i=new d(t.x,t.y,t.z),i.normalize().multScalar(Math.sin(e/2)),this.x=i.x,this.y=i.y,this.z=i.z,this},t.prototype.fromRotations=function(t,e,i){var n,r,s,o,a,h;return t*=.5,e*=.5,i*=.5,n=Math.cos(t),o=Math.sin(t),r=Math.cos(e),a=Math.sin(e),s=Math.cos(i),h=Math.sin(i),this.w=n*r*s-o*a*h,this.x=o*r*n+n*a*h,this.y=n*a*s-o*r*h,this.z=n*r*h+o*a*n,this},t.prototype.getAxisAngle=function(){var t,e,i;return t=this.w,i=2*Math.acos(t),e=1/Math.sqrt(1-t*t),[new d(this.x*e,this.y*e,this.z*e),i]},t.prototype.getMatrix4=function(){var t,e,i,n,r,s,o,a,h,l,c,p;return n=this.x+this.x,a=this.y+this.y,c=this.z+this.z,t=this.w*n,e=this.w*a,i=this.w*c,r=this.x*n,s=this.x*a,o=this.x*c,h=this.y*a,l=this.y*c,p=this.z*c,new u([1-(h+p),s+i,o-e,0,s-i,1-(r+p),l+t,0,o+e,l-t,1-(r+h),0,0,0,0,1])},t.prototype.getMatrix3=function(){var t,e,i,n,r,s,o,a,u,l,c,p;return n=this.x+this.x,a=this.y+this.y,c=this.z+this.z,t=this.w*n,e=this.w*a,i=this.w*c,r=this.x*n,s=this.x*a,o=this.x*c,u=this.y*a,l=this.y*c,p=this.z*c,new h([1-(u+p),s+i,o-e,s-i,1-(r+p),l+t,o+e,l-t,1-(r+u)])},t.prototype.lerp=function(e,i){var r,s;return r=i.dot(),s=t.multScalar(i,e),r>=n?s.add(s.multScalar(1-e)):s.add(s.multScalar(e-1)),s},t.prototype.slerpShortestUnenforced=function(t,e){var i,n,r,s,o,a,h,u;return n=this.clone(),n.sub(e),s=Math.sqrt(this.dot(e)),u=this.clone(),u.add(e),o=Math.sqrt(u.dot(u)),i=2*Math.atan2(s,o),h=1-t,a=this.clone(),a.multScalar(sinx_over_x(h*i)/sinx_over_x(i)*h),r=e.clone(),r.multScalar(sinx_over_x(t*i)/sinx_over_x(i)*t),a.add(r),a.normalize(),a},t.prototype.slerp=function(t,e){var i,r,s,o,a,h,u;return i=this.dot(e),i>=n?1-i>n?(u=Math.acos(i),a=1/Math.sin(u),h=Math.sin((1-t)*u)*a,s=Math.sin(t*u)*a):(h=1-t,s=t):1+i>n?(u=Math.acos(-i),a=1/Math.sin(u),h=Math.sin((t-1)*u)*a,s=Math.sin(t*u)*a):(h=t(-1),s=t),o=this.clone(),o.mult(h),r=e.clone(),r.mult(s),o.add(r),o},t.prototype.fromMatrix4=function(t){var e,i,n,r,s,o,a,h;return h=t.a[0]+t.a[5]+t.a[10],h>0?(a=Math.sqrt(h+1),this.w=.5*a,o=.5/a,this.x=(t.at(2,1)-t.at(1,2))*o,this.y=(t.at(0,2)-t.at(2,0))*o,this.z=(t.at(1,0)-t.at(0,1))*o):(n=0,t.at(1,1)>t.at(0,0)&&(n=1),t.at(2,2)>t.at(n,n)&&(n=2),r=(n+1)%3,s=(r+1)%3,a=Math.sqrt(t.at(n,n)-t.at(r,r)-t.at(s,s)+1),0===n?this.x=.5*a:1===n?this.y=.5*a:this.z=.5*a,o=.5/a,this.w=(t.at(s,r)-t.at(r,s))*o,e=(t.at(r,n)+t.at(n,r))*o,i=(t.at(s,n)+t.at(n,s))*o,0===r?this.x=e:1===r?this.y=e:this.z=e,0===s?this.x=i:1===s?this.y=i:this.z=i),this},t}(),e.exports={Vec2:f,Vec3:d,Vec4:m,Matrix2:o,Matrix3:h,Matrix4:u,radToDeg:_,degToRad:g,Quaternion:p,PI:l,EPSILON:n,Edge2:r}},{"../util/log":36}],31:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_;y=t("../math/math"),o=y.Vec2,a=y.Vec3,h=y.Vec4,r=y.Matrix4,s=y.PI,n=y.EPSILON,u=t("../geometry/primitive").Vertex,x=function(t,e,i,n){var r,s;return s=a.dot(e,a.sub(t,i)),r=a.dot(e,n),s/r},_=function(t,e,i,s){var o,h,l;return l=[],h=function(s){return function(s,o){var c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z,N,X,F,O,D;if(A=i.castRay(t,e),o=r.mult(o,s.matrix),null!=s.geometry)for(T=s.geometry.getTrisIndexer(),S=s.geometry.getNumTris(),L=P=0,I=S-1;0<=I?P<=I:P>=I;L=0<=I?++P:--P)G=T(L),c=G[0],d=G[1],g=G[2],c instanceof u&&(c=c.p,d=d.p,g=g.p),c.equals(d)||d.equals(g)||c.equals(g)||(o.multVec(c).multVec(d).multVec(g),_=a.sub(d,c),b=a.sub(g,c),C=A.xyz().cross(b),p=_.dot(C),p>-n&&p<n||(w=1/p,X=a.sub(i.pos,c),O=X.dot(C)*w,O<0||(R=a.cross(X,_),D=A.xyz().dot(R)*w,D<0||O+D>1||(F=b.dot(C)*w,f=c.copy().multScalar(1-O-D),m=d.copy().multScalar(O),x=g.copy().multScalar(D),f.add(m).add(x),y=a.sub(f,i.pos).length(),l.push({pos:f,node:s,index:L,dist:y})))));for(z=s.children,N=[],E=0,M=z.length;E<M;E++)v=z[E],N.push(h(v,o));return N}}(this),h(s,new r),o=function(t,e){return t.dist<e.dist?-1:t.dist>e.dist?1:0},l.sort(o),l},g=function(t,e,i,n,r,s,o,a,h){return[l(t,e,i,n,o,a,h),l(e,i,t,r,a,h,o),l(i,t,e,s,h,o,a)]},l=function(t,e,i,n,r,s,h){var u,l,c,p,f,d,m,g,v,x,y,_,b,w;return p=a.sub(e,t),f=a.sub(i,t),d=o.sub(s,r),m=o.sub(h,r),u=1/(d.x*m.y-d.y*m.x),v=u*(m.y*p.x+-d.y*f.x),x=u*(m.y*p.y+-d.y*f.y),y=u*(m.y*p.z+-d.y*f.z),_=u*(-m.x*p.x+d.x*f.x),b=u*(-m.x*p.y+d.x*f.y),w=u*(-m.x*p.z+d.x*f.z),g=new a(v,x,y),l=new a(_,b,w),g=g.sub(a.multScalar(n,a.dot(n,g))),c=l.sub(a.multScalar(n,a.dot(n,l))),c=c.sub(a.multScalar(g,a.dot(g,l))),g.normalize(),c.normalize(),g},v=function(t,e,i,n){var r,s,o,a,h,u,l,c,p,f,d;return u=PXL.Vec2.sub(t,i),l=n,r=e.dot(e),s=2*u.dot(e),o=u.dot(u)-l*l,d=new PXL.Vec2,h=s*s-4*r*o,0!==h&&(h=Math.sqrt(h),p=(-s-h)/(2*r),f=(-s+h)/(2*r),c=f,f<0&&(c=p),d.copyFrom(t),a=PXL.Vec2.multScalar(e,c),d.add(a)),d},c=function(t){var e,i,n,r,s,o,a;if(t.length)if(3===t[0]._DIM)for(o=new PXL.Vec3(1/0,1/0,1/0),s=new PXL.Vec3((-(1/0)),(-(1/0)),(-(1/0))),e=0,n=t.length;e<n;e++)a=t[e],a.x<o.x&&(o.x=a.x),a.y<o.y&&(o.y=a.y),a.x>s.x&&(s.x=a.x),a.y>s.y&&(s.y=a.y);else if(2===t[1]._DIM)for(o=new PXL.Vec2(1/0,1/0),s=new PXL.Vec2((-(1/0)),(-(1/0))),i=0,r=t.length;i<r;i++)a=t[i],a.x<o.x&&(o.x=a.x),a.y<o.y&&(o.y=a.y),a.z<o.z&&(o.z=a.z),a.x>s.x&&(s.x=a.x),a.y>s.y&&(s.y=a.y),a.z>s.z&&(s.z=a.z);return[o,s]},f=function(t,e){var i,n;return t.start===e.start?(i=o.normalize(o.sub(t.end,t.start)),n=o.normalize(o.sub(e.end,e.start)),new new Edge2(t.start,o.add(t.start,o.normalize(i.add(n))))):t.end===e.start?(i=o.normalize(o.sub(t.start,t.end)),n=o.normalize(o.sub(e.end,e.start)),new Edge2(t.end,o.add(t.end,o.normalize(i.add(n))))):t.start===e.end?(i=o.normalize(o.sub(t.end,t.start)),n=o.normalize(o.sub(e.start,e.end)),new Edge2(t.start,o.add(t.start,o.normalize(i.add(n))))):t.end===e.end?(i=o.normalize(o.sub(t.start,t.end)),n=o.normalize(o.sub(e.start,e.end)),new Edge2(t.end,o.add(t.end,o.normalize(i.add(n))))):PXLError("edge2Bisector - edges must have a common Vec2")},d=function(t,e,i){return(i-t)/(e-t)},p=function(t,e,i){var n,r,s,h,u,l,c,p,f,d;return h=o.sub(e,t),l=new a(h.y,(-h.x),0),c=a.sub(new a(e.x,e.y),new a(t.x,t.y)),p=a.sub(new a(t.x,t.y),new a(e.x,e.y)),r=a.cross(l,c),s=a.cross(l,p),r.z<0?e:s.z>0?t:(h=o.sub(e,t),0===h.x?new a(0,i.y):0===h.y?new a(i.x,0):(u=h.y/h.x,n=t.y-u*t.x,f=(u*i.y+i.x-u*n)/(u*u+1),d=u*f+n,new o(f,d)))},m=function(t,e,i,n,r){var s,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z;if(t.length<3)return[];for(f=[],m=g=0,P=t.length-1;0<=P?g<=P:g>=P;m=0<=P?++g:--g)m+1<t.length?f.push([t[m],t[m+1]]):f.push([t[m],t[0]]);for(h=[],l=new Array,m=v=0,E=f.length-1;0<=E?v<=E:v>=E;m=0<=E?++v:--v)c=f[m],p=f[m+1],m+1===f.length&&(p=f[0]),S=a.sub(new a(c[1].x,c[1].y),new a(c[0].x,c[0].y)),C=a.sub(new a(p[1].x,p[1].y),new a(p[0].x,p[0].y)),u=a.cross(S,C),u.z>0?(0===l.length&&l.push(c),l.push([p[0]]),l.push(p)):(0===l.length&&l.push(c),h.push(l),l=new Array);for(R=[],G=[],z=new a(0,0,1),I=100,x=0,y=h.length;x<y;x++)for(s=h[x],m=w=0,M=s.length-1;0<=M?w<=M:w>=M;m=0<=M?++w:--w)d=s[m],A=[],2===d.length?(S=a.sub(new a(d[0].x,d[0].y),new a(d[1].x,d[1].y)),u=a.cross(S,z),u.normalize(),A.push([new o(d[0].x,d[0].y),new o(d[0].x-u.x,d[0].y-u.y)]),A.push([new o(d[1].x,d[1].y),new o(d[1].x-u.x,d[1].y-u.y)])):(L=m-1,0===m&&(L=s.length-1),_=m+1,m===s.length-1&&(_=0),T=s[L],b=s[_],S=a.sub(new a(T[0].x,T[0].y),new a(T[1].x,T[1].y)),u=a.cross(S,z),u.normalize(),A.push([new o(d[0].x,d[0].y),new o(d[0].x-u.x,d[0].y-u.y)]),C=a.sub(new a(b[0].x,b[0].y),new a(b[1].x,b[1].y)),u=a.cross(C,z),u.normalize(),A.push([new o(d[0].x,d[0].y),new o(d[0].x-u.x,d[0].y-u.y)])),G.push(A);return console.log(G),G},e.exports={rayPlaneIntersect:x,rayCircleIntersection:v,precomputeTangent:g,closestPointLine:p,medialAxis2D:m,boundingBox:c,edge2Bisector:f,screenNodeHitTest:_}},{"../geometry/primitive":9,"../math/math":30}],32:[function(t,e,i){var n,r,s,o,a;r={},n={},a=t("./util/util"),o=function(){var t;switch(arguments.length){case 1:return a.extend(r,arguments[0]);case 2:return t=arguments[0],null==r[t]&&(r[t]={}),a.extend(r[t],arguments[1])}},"undefined"!=typeof window&&null!==window&&(window.PXL=r),"undefined"!=typeof window&&null!==window&&(window.GL=n),o(t("./core/app")),o(t("./core/node")),o("Math",t("./math/math")),o("Math",t("./math/curve")),o("Math",t("./math//math_functions")),o("Colour",t("./colour/colour")),o("Geometry",t("./geometry/primitive")),o("Geometry",t("./geometry/shape")),o("Geometry",t("./geometry/plane")),o("Import",t("./import/three")),o("Import",t("./import/obj")),o("Import",t("./import/md5")),o("GL",t("./gl/shader")),o("GL",t("./gl/uber_shader_paths")),o("GL",t("./gl/uber_shader")),o("GL",t("./gl/fbo")),o("GL",t("./gl/texture")),o("GL",t("./gl/webgl")),o("Util",t("./util/request")),o("Util",t("./util/promise")),o("Util",t("./util/util")),o("Util",t("./util/signal")),o("Util",t("./util/log")),o("Util",t("./util/voronoi")),o("Util",t("./util/medial_axis")),o("Util",t("./util/webcam")),o("Util",t("./util/noise")),o("Util",t("./util/cache_var")),o("Interact",t("./interact/key")),o("Interact",t("./interact/mouse")),o("Interact",t("./interact/touch")),o("Camera",t("./camera/camera")),o("Light",t("./light/light")),o("Material",t("./material/material")),o("Material",t("./material/basic")),o("Material",t("./material/phong")),o("Material",t("./material/depth")),o("Animation",t("./animation/animation")),r.applications=[],s=function(t){var e,i;return t.requestAnimationFrame?i=function(t,e){var i,n,s,o,a,h,u;for(h=r.applications,s=0,o=h.length;s<o;s++)if(u=h[s],n=u[0],a=u[1],n===t&&a===e)return;return r.applications.push([t,e]),(i=function(){var t,e,n,s;for(s=r.applications,e=0,n=s.length;e<n;e++)t=s[e],r.Context.switchContext(t[0]),t[1].call(t[0]);return requestAnimationFrame(i)})()}:t.webkitRequestAnimationFrame?i=function(t,e){var i,n,s,o,a,h,u;for(h=r.applications,s=0,o=h.length;s<o;s++)if(u=h[s],n=u[0],a=u[1],n===t&&a===e)return;return r.applications.push([t,e]),(i=function(){var t,e,n,s;for(s=r.applications,e=0,n=s.length;e<n;e++)t=s[e],r.Context.switchContext(t[0]),t[1].call(t[0]);return webkitRequestAnimationFrame(i)})()}:t.mozRequestAnimationFrame?(i=function(t,e){return r.applications.push([t,e])},(e=function(){var t,i,n,s;for(s=r.applications,i=0,n=s.length;i<n;i++)t=s[i],r.Context.switchContext(t[0]),t[1].call(t[0]);return mozRequestAnimationFrame(e)})()):i=function(t,e){var i;return r.applications.push([t,e]),i=function(){var t,e,i,n,s;for(n=r.applications,s=[],e=0,i=n.length;e<i;e++)t=n[e],r.Context.switchContext(t[0]),s.push(t[1].call(t[0]));return s},setInterval(i,1e3/60)},t.onEachFrame=i},"undefined"!=typeof window&&null!==window&&s(window),e.exports={PXL:r,GL:n}},{"./animation/animation":1,"./camera/camera":3,"./colour/colour":4,"./core/app":5,"./core/node":6,"./geometry/plane":8,"./geometry/primitive":9,"./geometry/shape":10,"./gl/fbo":12,"./gl/shader":13,"./gl/texture":14,"./gl/uber_shader":15,"./gl/uber_shader_paths":16,"./gl/webgl":17,"./import/md5":18,"./import/obj":19,"./import/three":20,"./interact/key":21,"./interact/mouse":22,"./interact/touch":23,"./light/light":24,"./material/basic":25,"./material/depth":26,"./material/material":27,"./material/phong":28,"./math//math_functions":31,"./math/curve":29,"./math/math":30,"./util/cache_var":34,"./util/log":36,"./util/medial_axis":37,"./util/noise":38,"./util/promise":39,"./util/request":41,"./util/signal":42,"./util/util":43,"./util/voronoi":44,"./util/webcam":45}],33:[function(t,e,i){var n="\nprecision highp float;\nprecision highp int;\n\nuniform float uUber0;\nattribute vec3 aVertexPosition;\nuniform mat4 uModelMatrix;\nvarying vec4 vPosition;\n\n#ifdef VERTEX_COLOUR\nattribute vec4 aVertexColour;\nvarying vec4 vColour;\n#endif \n\n#ifdef VERTEX_TEXTURE\nattribute vec2 aVertexTexCoord;\nvarying vec2 vTexCoord;\n#endif\n\n#ifdef BASIC_CAMERA\nuniform mat4 uCameraMatrix;\nuniform mat4 uProjectionMatrix;\n#endif\n\n#ifdef ADVANCED_CAMERA\nuniform float uCameraNear;\nuniform float uCameraFar;\nuniform mat4 uCameraInverseMatrix; \nuniform mat4 uInverseProjectionMatrix;\nvarying vec4 vEyePosition;\n#endif \n\n#ifdef VERTEX_NORMAL\nattribute vec3 aVertexNormal;\nvarying vec3 vNormal;\nuniform mat3 uNormalMatrix;\nvarying vec4 vTransformedNormal;\n#endif\n\n#ifdef VERTEX_TANGENT\nattribute vec3 aVertexTangent;\nvarying vec3 vTangent;\n#endif\n\n#ifdef SKINNING \nattribute vec4 aVertexSkinWeight;\nattribute vec4 aVertexBoneIndex;\nuniform sampler2D uBonePalette;\nuniform int uBoneTexDim;\n#endif\n\n#ifdef LIGHTING\nuniform vec3 uAmbientLightingColour;\n#endif\n\n#ifdef LIGHTING_POINT\n#define LIGHTING_NUM_POINT_LIGHTS 5\nuniform int uPointLightNum;\nuniform vec3 uPointLightPos[LIGHTING_NUM_POINT_LIGHTS];\nuniform vec3 uPointLightColour[LIGHTING_NUM_POINT_LIGHTS];\nuniform vec4 uPointLightAttenuation[LIGHTING_NUM_POINT_LIGHTS];\n\n#endif\n\n#ifdef LIGHTING_SPOT\n#define LIGHTING_NUM_SPOT_LIGHTS 5 \nuniform int uSpotLightNum;\nuniform vec3 uSpotLightPos[LIGHTING_NUM_SPOT_LIGHTS];\nuniform vec3 uSpotLightColour[LIGHTING_NUM_SPOT_LIGHTS];\nuniform vec3 uSpotLightDir[LIGHTING_NUM_SPOT_LIGHTS]; // TODO - if normalised can reduce down - optimise\nuniform vec4 uSpotLightAttenuation[LIGHTING_NUM_SPOT_LIGHTS];\nuniform float uSpotLightAngle[LIGHTING_NUM_SPOT_LIGHTS];\nuniform float uSpotLightExp[LIGHTING_NUM_SPOT_LIGHTS];\n#ifdef SHADOWMAP\nuniform sampler2D uSamplerPointShadow[LIGHTING_NUM_SPOT_LIGHTS];\nuniform mat4 uSpotLightInvMatrix[LIGHTING_NUM_SPOT_LIGHTS];\nvarying vec4 vShadowTexCoord[LIGHTING_NUM_SPOT_LIGHTS]; // TODO - does this need to be vec4?\n#endif\n\n#endif\n\n#ifdef VERTEX_TANGENT_FRAME\n// http://www.thetenthplanet.de/archives/1180\nmat3 computeTangentFrame(vec3 N, vec3 p, vec2 uv) { \n  // get edge vectors of the @fragment triangle \n  vec3 dp1 = dFdx( p ); \n  vec3 dp2 = dFdy( p ); \n  vec2 duv1 = dFdx( uv ); \n  vec2 duv2 = dFdy( uv ); \n \n  // solve the linear system \n  vec3 dp2perp = cross( dp2, N ); \n  vec3 dp1perp = cross( N, dp1 ); \n  vec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \n  vec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \n  \n  // construct a scale-invariant frame  \n  float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) ); \n  return mat3( T * invmax, B * invmax, N ); \n}\n\n\n\n#endif\n\n#ifdef VERTEX_SOBEL\nvec3 sobel(float step, vec2 center, float limit) { \n  // get samples around @fragment \n  float tleft = intensity(texture2D(uSampler,center + vec2(-step,step))); \n  float left = intensity(texture2D(uSampler,center + vec2(-step,0))); \n  float bleft = intensity(texture2D(uSampler,center + vec2(-step,-step))); \n  float top = intensity(texture2D(uSampler,center + vec2(0,step))); \n  float bottom = intensity(texture2D(uSampler,center + vec2(0,-step))); \n  float tright = intensity(texture2D(uSampler,center + vec2(step,step))); \n  float right = intensity(texture2D(uSampler,center + vec2(step,0))); \n  float bright = intensity(texture2D(uSampler,center + vec2(step,-step))); \n   \n  // Sobel masks (to estimate gradient) \n  //        1 0 -1     -1 -2 -1 \n  //    X = 2 0 -2  Y = 0  0  0 \n  //        1 0 -1      1  2  1 \n   \n  float x = tleft + 2.0*left + bleft - tright - 2.0*right - bright; \n  float y = -tleft - 2.0*top - tright + bleft + 2.0 * bottom + bright; \n  float color = sqrt((x*x) + (y*y)); \n  \n  if (color < limit){\n    return vec3(0.0,0.0,0.0);\n  } \n  \n  return vec3(1.0,1.0,1.0);\n}\n\n\n\n#endif\n\n#ifdef SKINNING \nvec3 qtransform( vec4 q, vec3 v ){ \n  return v + 2.0 * cross(cross(v, q.xyz ) + q.w*v, q.xyz);\n}\n\nmat4 sample_palette(const in float idx) {\n  float tt = float(uBoneTexDim) / 4.0;\n  float dd = 1.0 / float(uBoneTexDim);\n  float p0 = 0.5 * dd;\n  float p1 = 1.0 * dd;\n  float p2 = 2.5 * dd;\n  float p3 = 3.5 * dd;\n  float x = float(mod(idx, tt)) * dd * 4.0;\n  float y = floor(float(idx / tt )) * dd;\n  vec4 v0 = texture2D(uBonePalette, vec2(x + p0, y + p0));\n  vec4 v1 = texture2D(uBonePalette, vec2(x + p1, y + p0));\n  vec4 v2 = texture2D(uBonePalette, vec2(x + p2, y + p0));\n  vec4 v3 = texture2D(uBonePalette, vec2(x + p3, y + p0));\n  mat4 tm = mat4(v0,v1,v2,v3);\n  return tm;\n}\n#endif\n\nbool bitcheck(in float fcheck, in int bitpos) { \n  int fsi = int(fcheck);\n  for (int i = 0; i < 32; i++) { \n    if (i >= bitpos) return fract(float(fsi) / 2.0) != 0.0;\n    fsi = fsi / 2; \n  } \n  return false;\n}\n\n\nvoid main() {\n#ifdef VERTEX_COLOUR\n  vColour = aVertexColour;\n#endif\n\n#ifdef VERTEX_TEXTURE\n  vTexCoord = aVertexTexCoord;\n#endif\n  \n#ifdef VERTEX_NORMAL\n  vNormal = aVertexNormal;\n  vTransformedNormal = vec4(uNormalMatrix * aVertexNormal,1.0);\n#endif\n\n#ifdef VERTEX_TANGENT\n  vTangent = aVertexTangent;\n#endif\n\n  vPosition = uModelMatrix * vec4(aVertexPosition, 1.0);\n\n#ifdef SKINNING \n  if(bitcheck(uUber0,2)) {\n    vPosition = vec4(0.0,0.0,0.0,1.0);\n    float bias = aVertexSkinWeight.x;\n    mat4 tm = sample_palette(aVertexBoneIndex.x);\n    vec4 bp = tm * vec4(aVertexPosition,1.0) * bias;\n    vPosition += bp;\n    bias = aVertexSkinWeight.y;\n    tm = sample_palette(aVertexBoneIndex.y);\n    bp = tm * vec4(aVertexPosition,1.0) * bias;\n    vPosition += bp;\n    bias = aVertexSkinWeight.z;\n    tm = sample_palette(aVertexBoneIndex.z);\n    bp = tm * vec4(aVertexPosition,1.0) * bias;\n    vPosition += bp;\n    bias = aVertexSkinWeight.w;\n    tm = sample_palette(aVertexBoneIndex.w);\n    bp = tm * vec4(aVertexPosition,1.0) * bias;\n    vPosition += bp;\n    vPosition.w = 1.0;\n    vPosition = uModelMatrix * vPosition;\n  } \n#endif\n\n  \n#ifdef ADVANCED_CAMERA\n  vEyePosition = uCameraInverseMatrix * uModelMatrix * vPosition;\n#endif\n\n  gl_Position = vPosition;\n\n#ifdef BASIC_CAMERA\n  gl_Position = uProjectionMatrix * uCameraMatrix * vPosition;\n#endif\n}\n\n\n",r="\nprecision highp float;\nprecision highp int;\n\nuniform float uUber0;\nuniform mat4 uModelMatrix;\nvarying vec4 vPosition;\n\n#ifdef BASIC_COLOUR\nuniform vec4 uColour;\n#endif\n  \n#ifdef VERTEX_COLOUR\nvarying vec4 vColour;\n#endif\n  \n#ifdef VERTEX_TEXTURE\nvarying vec2 vTexCoord;\n#endif\n  \n#ifdef VERTEX_NORMAL\nuniform mat3 uNormalMatrix;\nvarying vec3 vNormal;\nvarying vec4 vTransformedNormal;\n#endif\n\n#ifdef VERTEX_TANGENT\nvarying vec3 vTangent;\n#endif\n  \n#ifdef ADVANCED_CAMERA\nuniform float uCameraNear;\nuniform float uCameraFar; \nuniform mat4 uCameraInverseMatrix; \nuniform mat4 uInverseProjectionMatrix;\nvarying vec4 vEyePosition;\n#endif\n\n#ifdef LIGHTING\nuniform vec3 uAmbientLightingColour;\n#endif\n\n#ifdef LIGHTING_POINT\n#define LIGHTING_NUM_POINT_LIGHTS 5\nuniform int uPointLightNum;\nuniform vec3 uPointLightPos[LIGHTING_NUM_POINT_LIGHTS];\nuniform vec3 uPointLightColour[LIGHTING_NUM_POINT_LIGHTS];\nuniform vec4 uPointLightAttenuation[LIGHTING_NUM_POINT_LIGHTS];\n\n#endif\n\n#ifdef LIGHTING_SPOT\n#define LIGHTING_NUM_SPOT_LIGHTS 5 \nuniform int uSpotLightNum;\nuniform vec3 uSpotLightPos[LIGHTING_NUM_SPOT_LIGHTS];\nuniform vec3 uSpotLightColour[LIGHTING_NUM_SPOT_LIGHTS];\nuniform vec3 uSpotLightDir[LIGHTING_NUM_SPOT_LIGHTS]; // TODO - if normalised can reduce down - optimise\nuniform vec4 uSpotLightAttenuation[LIGHTING_NUM_SPOT_LIGHTS];\nuniform float uSpotLightAngle[LIGHTING_NUM_SPOT_LIGHTS];\nuniform float uSpotLightExp[LIGHTING_NUM_SPOT_LIGHTS];\n#ifdef SHADOWMAP\nuniform sampler2D uSamplerPointShadow[LIGHTING_NUM_SPOT_LIGHTS];\nuniform mat4 uSpotLightInvMatrix[LIGHTING_NUM_SPOT_LIGHTS];\nvarying vec4 vShadowTexCoord[LIGHTING_NUM_SPOT_LIGHTS]; // TODO - does this need to be vec4?\n#endif\n\n#endif\n\nbool bitcheck(in float fcheck, in int bitpos) { \n  int fsi = int(fcheck);\n  for (int i = 0; i < 32; i++) { \n    if (i >= bitpos) return fract(float(fsi) / 2.0) != 0.0;\n    fsi = fsi / 2; \n  } \n  return false;\n}\n\n #ifdef MAT_PHONG\nuniform vec3 uMaterialAmbientColour;\nuniform float uMaterialShininess;\nuniform vec3 uMaterialDiffuseColour;\nuniform sampler2D uSamplerDiffuse;\nuniform vec3 uMaterialSpecularColour;\nuniform sampler2D uSamplerSpecular;\nuniform vec3 uMaterialEmissiveColour;\nuniform sampler2D uSamplerEmissive;\n#endif\n#ifdef MAT_TEXTURE\nuniform sampler2D uSamplerTexture;\n#endif\n#ifdef FRAGMENT_DEPTH_OUT\nvec4 pack (float depth) {\n  const vec4 bitSh = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);\n  const vec4 bitMsk = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 comp = fract(depth * bitSh);\n  comp -= comp.xxyz * bitMsk;\n  return comp;\n}\n\nvec4 packDepth() { return pack(gl_FragCoord.z); }\n\n// Returns the 3D position in eye space. \n\nvec3 positionFromDepth(float depth, vec2 texcoord) {\n  vec4 position = vec4(texcoord, depth, 1.0);\n  position.xyz = position.xyz*2.0 -1.0;\n  position = uInverseProjectionMatrix*position;\n  position.xyz /= position.w;\n  return position.xyz;\n}\n\n#endif\n#ifdef FRAGMENT_DEPTH_IN\nuniform sampler2D uSamplerDepth;\nfloat unpack (in vec4 colour) {\n  const vec4 bitShifts = vec4(1.0 / (256.0 * 256.0 * 256.0), 1.0 / (256.0 * 256.0), 1.0 / 256.0, 1.0); \n  return dot(colour, bitShifts);\n}\n\n// Passed in by the coffeegl depth shader. Reproduces from non linear gl_FragCoord.z to linear 0-1\nfloat readDepth(in vec2 coord)  {\n  vec4 colour = texture2D(uSamplerDepth, coord);\n  float unpacked = unpack(colour);\n  return (uCameraNear * unpacked) / ( uCameraFar - unpacked * (uCameraFar - uCameraNear) );\n}\n#endif\n\n#ifdef FRAGMENT_NOISE\n # Functions that can appear in both\nvec3 mod289(vec3 x) {\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 mod289(vec4 x) { \n  return x - floor(x * (1.0 / 289.0)) * 289.0;\n}\n\nvec4 permute(vec4 x) {  \n  return mod289(((x*34.0)+1.0)*x);\n}\n\nvec4 taylorInvSqrt(vec4 r) {\n  return 1.79284291400159 - 0.85373472095314 * r;\n}\n\nfloat snoise(vec3 v) { \n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\n\n  // First corner\n  vec3 i  = floor(v + dot(v, C.yyy) );\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\n\n  // Other corners\n  vec3 g = step(x0.yzx, x0.xyz);\n  vec3 l = 1.0 - g;\n  vec3 i1 = min( g.xyz, l.zxy );\n  vec3 i2 = max( g.xyz, l.zxy );\n\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\n  vec3 x1 = x0 - i1 + C.xxx;\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\n\n  // Permutations\n  i = mod289(i); \n  vec4 p = permute( permute( permute( \n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 )) \n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\n\n  // Gradients: 7x7 points over a square, mapped onto an octahedron.\n  // The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\n  float n_ = 0.142857142857; // 1.0/7.0\n  vec3  ns = n_ * D.wyz - D.xzx;\n\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\n\n  vec4 x_ = floor(j * ns.z);\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\n\n  vec4 x = x_ *ns.x + ns.yyyy; \n  vec4 y = y_ *ns.x + ns.yyyy;  + \n  vec4 h = 1.0 - abs(x) - abs(y); \n\n  vec4 b0 = vec4( x.xy, y.xy ); \n  vec4 b1 = vec4( x.zw, y.zw ); \n\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0; \n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\n  vec4 s0 = floor(b0)*2.0 + 1.0;\n  vec4 s1 = floor(b1)*2.0 + 1.0;\n  vec4 sh = -step(h, vec4(0.0));\n\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\n\nvec3 p0 = vec3(a0.xy,h.x);\n  vec3 p1 = vec3(a0.zw,h.y);\n  vec3 p2 = vec3(a1.xy,h.z);\n  vec3 p3 = vec3(a1.zw,h.w);\n\n  //Normalise gradients\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\n  p0 *= norm.x;\n  p1 *= norm.y;\n  p2 *= norm.z;\n  p3 *= norm.w;\n\n  // Mix final noise value\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\n  m = m * m;\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1), \n                                dot(p2,x2), dot(p3,x3) ) );\n}\n\n\n\n#endif\n\n#ifdef FRAGMENT_INTENSITY\nfloat intensity(in vec4 colour) {\n  return sqrt((colour.x*colour.x)+(colour.y*colour.y)+(colour.z*colour.z));\n}\n#endif\n\n#ifdef FRAGMENT_LUMINANCE\nfloat getLuminance(in vec3 colour) {\n  vec3 lumcoeff = vec3(0.299,0.587,0.114);\n  return dot(colour, lumcoeff);\n}\n#endif\n\n#ifdef FRAGMENT_TANGENT_FRAME\n// http://www.thetenthplanet.de/archives/1180\nmat3 computeTangentFrame(vec3 N, vec3 p, vec2 uv) { \n  // get edge vectors of the @fragment triangle \n  vec3 dp1 = dFdx( p ); \n  vec3 dp2 = dFdy( p ); \n  vec2 duv1 = dFdx( uv ); \n  vec2 duv2 = dFdy( uv ); \n \n  // solve the linear system \n  vec3 dp2perp = cross( dp2, N ); \n  vec3 dp1perp = cross( N, dp1 ); \n  vec3 T = dp2perp * duv1.x + dp1perp * duv2.x; \n  vec3 B = dp2perp * duv1.y + dp1perp * duv2.y; \n  \n  // construct a scale-invariant frame  \n  float invmax = inversesqrt( max( dot(T,T), dot(B,B) ) ); \n  return mat3( T * invmax, B * invmax, N ); \n}\n\n\n\n#endif\n\n#ifdef FRAGMENT_SOBEL\nvec3 sobel(float step, vec2 center, float limit) { \n  // get samples around @fragment \n  float tleft = intensity(texture2D(uSampler,center + vec2(-step,step))); \n  float left = intensity(texture2D(uSampler,center + vec2(-step,0))); \n  float bleft = intensity(texture2D(uSampler,center + vec2(-step,-step))); \n  float top = intensity(texture2D(uSampler,center + vec2(0,step))); \n  float bottom = intensity(texture2D(uSampler,center + vec2(0,-step))); \n  float tright = intensity(texture2D(uSampler,center + vec2(step,step))); \n  float right = intensity(texture2D(uSampler,center + vec2(step,0))); \n  float bright = intensity(texture2D(uSampler,center + vec2(step,-step))); \n   \n  // Sobel masks (to estimate gradient) \n  //        1 0 -1     -1 -2 -1 \n  //    X = 2 0 -2  Y = 0  0  0 \n  //        1 0 -1      1  2  1 \n   \n  float x = tleft + 2.0*left + bleft - tright - 2.0*right - bright; \n  float y = -tleft - 2.0*top - tright + bleft + 2.0 * bottom + bright; \n  float color = sqrt((x*x) + (y*y)); \n  \n  if (color < limit){\n    return vec3(0.0,0.0,0.0);\n  } \n  \n  return vec3(1.0,1.0,1.0);\n}\n\n\n\n#endif\n\nvoid main() {\n  #ifdef MAT_PHONG\nvec3 materialDiffuseColour = uMaterialDiffuseColour;\nvec3 materialSpecularColour = uMaterialSpecularColour;\nvec3 materialEmissiveColour = uMaterialEmissiveColour;\n \n#ifdef VERTEX_TEXTURE\nif(bitcheck(uUber0,10)){ materialDiffuseColour = texture2D(uSamplerDiffuse, vTexCoord).rgb;}\nif(bitcheck(uUber0,11)){ materialSpecularColour = texture2D(uSamplerSpecular, vTexCoord).rgb;}\nif(bitcheck(uUber0,12)){ materialEmissiveColour = texture2D(uSamplerEmissive, vTexCoord).rgb;}\n#endif\n\nvec3 specularLightWeighting = vec3(0.0, 0.0, 0.0);\nvec3 diffuseLightWeighting = vec3(0.0, 0.0, 0.0);\nvec3 materialAmbientColour = uMaterialAmbientColour * uAmbientLightingColour;\ngl_FragColor = vec4(materialAmbientColour, 1.0);\nvec3 eyeDirection = normalize(-vPosition.xyz);\n\n#ifdef LIGHTING_POINT\n\nfor (int i=0; i < LIGHTING_NUM_POINT_LIGHTS; i++) {\n  // TODO could potentially transform the lights in the vertex shader?\n  // TODO - previously we added a break in here for lights - do we keep that?\n  // TODO - attenuation factor\n  vec3 lightDirection = normalize((uModelMatrix * vec4(uPointLightPos[i],1.0)).xyz - vPosition.xyz);\n  vec3 reflectionDirection = reflect(-lightDirection, vTransformedNormal.xyz);\n  float specularLightBrightness = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);\n  specularLightWeighting = specularLightWeighting + (uPointLightColour[i] * specularLightBrightness);\n  float diffuseLightBrightness = max(dot(vTransformedNormal.xyz, lightDirection), 0.0);\n  diffuseLightWeighting = diffuseLightWeighting + (uPointLightColour[i] * diffuseLightBrightness);\n  gl_FragColor += vec4( materialDiffuseColour * diffuseLightWeighting \n   + materialSpecularColour * specularLightWeighting\n   + materialEmissiveColour,\n   0.0);\n}\n#endif\n\n#ifdef LIGHTING_SPOT\n\n// TODO - shadowmap scale might be removed to its own place for use in other materials\n\nvec3 shadow_scale[LIGHTING_NUM_SPOT_LIGHTS];\nfor (int i=0; i < LIGHTING_NUM_SPOT_LIGHTS; i++) {\n  shadow_scale[i] = vec3(1.0,1.0,1.0);\n}\n\n#ifdef SHADOWMAP\n// Unflattened texture lookups for now sadly\nif(bitcheck(uUber0,14)) {\n  vec4 lightdepth = texture2D(uSamplerPointShadow[0],vShadowTexCoord[0].xy);\n  if(lightdepth.x < gl_FragCoord.z ){\n    shadow_scale[0] = vec3(0.0,0.0,0.0);\n  }\n  \n  lightdepth = texture2D(uSamplerPointShadow[1],vShadowTexCoord[1].xy);\n  if(lightdepth.x < gl_FragCoord.z ){\n    shadow_scale[1] = vec3(0.0,0.0,0.0);\n  }\n\n  lightdepth = texture2D(uSamplerPointShadow[2],vShadowTexCoord[2].xy);\n  if(lightdepth.x < gl_FragCoord.z ){\n    shadow_scale[2] = vec3(0.0,0.0,0.0);\n  }\n\n  lightdepth = texture2D(uSamplerPointShadow[3],vShadowTexCoord[3].xy);\n  if(lightdepth.x < gl_FragCoord.z ){\n    shadow_scale[3] = vec3(0.0,0.0,0.0);\n  }\n\n  lightdepth = texture2D(uSamplerPointShadow[4],vShadowTexCoord[4].xy);\n  if(lightdepth.x < gl_FragCoord.z ){\n    shadow_scale[4] = vec3(0.0,0.0,0.0);\n  }\n}\n#endif\n\nfor (int i=0; i < LIGHTING_NUM_SPOT_LIGHTS; i++) {\n  vec3 lightDirection = normalize((uModelMatrix * vec4(uSpotLightPos[i],1.0)).xyz - vPosition.xyz);\n  float spotFactor = dot ( -lightDirection, uSpotLightDir[i]);\n  if (spotFactor >= cos(uSpotLightAngle[i])){\n    spotFactor = pow(spotFactor, uSpotLightExp[i]);\n  } else {\n    spotFactor = 0.0;\n  }\n  vec3 reflectionDirection = reflect(-lightDirection, vTransformedNormal.xyz);\n  float specularLightBrightness = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);\n  specularLightWeighting = specularLightWeighting + (uSpotLightColour[i] * specularLightBrightness);\n  float diffuseLightBrightness = max(dot(vTransformedNormal.xyz, lightDirection), 0.0);\n  diffuseLightWeighting = diffuseLightWeighting + (uSpotLightColour[i] * diffuseLightBrightness);\n  specularLightWeighting *= spotFactor;\n  diffuseLightWeighting *= spotFactor;\n  vec3 final =  (materialDiffuseColour * diffuseLightWeighting + materialSpecularColour * specularLightWeighting + materialEmissiveColour) * shadow_scale[i];\n  gl_FragColor += vec4(final,0.0);\n}\n#endif\n#endif\n\n  #ifdef MAT_TEXTURE\nif(bitcheck(uUber0,4)) { gl_FragColor = texture2D(uSamplerTexture, vTexCoord); }\n#endif\n\n\n#ifdef BASIC_COLOUR\n  if(bitcheck(uUber0,8)) { gl_FragColor = uColour; }\n#endif\n\n#ifdef VERTEX_COLOUR\n  if(bitcheck(uUber0,9)) { gl_FragColor = vColour; }\n#endif\n   \n#ifdef FRAGMENT_DEPTH_OUT\n  if(bitcheck(uUber0,5)) { gl_FragColor = packDepth(); }\n#endif\n\n#ifdef FRAGMENT_DEPTH_IN\n  if(bitcheck(uUber0,6)) {\n    float d = readDepth(vTexCoord);\n    gl_FragColor = vec4(d,d,d,1.0); \n  }\n#endif\n\n}\n\n\n\n\n\n\n\n";
e.exports={vertex:n,fragment:r}},{}],34:[function(t,e,i){var n;n=function(){function t(t){this.variable=t,this.dirty=!1}return t.prototype.set=function(t){var e,i,n;if(t instanceof Array&&this.variable instanceof Array){if(t.length!==this.variable.length)this.dirty=!0,this.variable=t;else for(e=i=0,n=t.length-1;0<=n?i<=n:i>=n;e=0<=n?++i:--i)if(!t[e].equals(this.variable[e]))return this.dirty=!0,this.variable=t,this}else null!=t.equals?t.equals(this.variable)||(this.dirty=!0,this.variable=t):t!==this.variable&&(this.dirty=!0,this.variable=t);return this},t.prototype.get=function(){return this.dirty=!1,this.variable},t.prototype.isDirty=function(){return this.dirty},t}(),e.exports={CacheVar:n}},{}],35:[function(t,e,i){var n,r,s,o,a,h,u;o={enable:{0:!0},disable:{0:!0},getParameter:{0:!0},drawArrays:{0:!0},drawElements:{0:!0,2:!0},createShader:{0:!0},getShaderParameter:{1:!0},getProgramParameter:{1:!0},getVertexAttrib:{1:!0},vertexAttribPointer:{2:!0},bindTexture:{0:!0},activeTexture:{0:!0},getTexParameter:{0:!0,1:!0},texParameterf:{0:!0,1:!0},texParameteri:{0:!0,1:!0,2:!0},texImage2D:{0:!0,2:!0,6:!0,7:!0},texSubImage2D:{0:!0,6:!0,7:!0},copyTexImage2D:{0:!0,2:!0},copyTexSubImage2D:{0:!0},generateMipmap:{0:!0},bindBuffer:{0:!0},bufferData:{0:!0,2:!0},bufferSubData:{0:!0},getBufferParameter:{0:!0,1:!0},pixelStorei:{0:!0,1:!0},readPixels:{4:!0,5:!0},bindRenderbuffer:{0:!0},bindFramebuffer:{0:!0},checkFramebufferStatus:{0:!0},framebufferRenderbuffer:{0:!0,1:!0,2:!0},framebufferTexture2D:{0:!0,1:!0,2:!0},getFramebufferAttachmentParameter:{0:!0,1:!0,2:!0},getRenderbufferParameter:{0:!0,1:!0},renderbufferStorage:{0:!0,1:!0},clear:{0:!0},depthFunc:{0:!0},blendFunc:{0:!0,1:!0},blendFuncSeparate:{0:!0,1:!0,2:!0,3:!0},blendEquation:{0:!0},blendEquationSeparate:{0:!0,1:!0},stencilFunc:{0:!0},stencilFuncSeparate:{0:!0,1:!0},stencilMaskSeparate:{0:!0},stencilOp:{0:!0,1:!0,2:!0},stencilOpSeparate:{0:!0,1:!0,2:!0,3:!0},cullFace:{0:!0},frontFace:{0:!0}},r=null,a=function(t){var e,i,n,s;if(null===r){for(r={},s=[],e=0,i=t.length;e<i;e++)n=t[e],"number"==typeof t[n]?s.push(r[t[n]]=n):s.push(void 0);return s}},u=function(t){return void 0!==r[t]},n=function(t){var e,i;return checkInit(),e=r[t],null!=(i=void 0!==e)?i:{name:"*UNKNOWN WebGL ENUM (0x"+t.toString(16)+")"}},s=function(t,e,i){var r;return r=o[t],void 0!==r&&r[e]?n(i):i.toString()},h=function(t){return a(t)}},{}],36:[function(t,e,i){var n,r,s,o,a,h,u,l,c=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};h=[],l=function(){var t,e,i,n,r,s,o,a,h,u,l,c;t=[],o=!1;try{s.dont.exist+=0}catch(e){if(i=e,i.stack){for(u=i.stack.split("\n"),s=a=0,l=u.length-1;0<=l?a<=l:a>=l;s=0<=l?++a:--a)t.push(u[s]);t.shift(),o=!0}else if(window.opera&&i.message){for(u=i.message.split("\n"),s=h=0,c=u.length-1;0<=c?h<=c:h>=c;s=0<=c?++h:--h)t.push(entry);t.shift(),o=!0}}if(!o)for(e=arguments.callee.caller;e;)n=e.toString(),r=n.substring(n.indexOf("function")+8,n.indexOf(""))||"anonymous",t.push(r),e=e.caller;return t.join("\n")},u=function(t){var e,i;return e=/function (.{1,})\(/,i=e.exec(t.constructor.toString()),null!=i&&i.length>1?i[1]:""},r=function(t){return function(t){var e;throw e="PXL Error : "+t,console.error(e),e}}(this),o=function(t){return function(t){var e;return e="PXL Warning : "+t,console.warn(e),console.warn(l())}}(this),a=function(t){return function(e){var i,n;return n=c.call(h,e)>=0,n||(i="PXL Warning : "+e,console.warn(i),console.warn(l()),h.push(e)),t}}(this),n=function(t){return function(e){var i;if(PXL.Context.debug)return i="PXL Debug : "+e,console.log(i),t}}(this),s=function(t){var e,i;return e="PXL Log : "+t,i=arguments.callee.toString(),i=i.substr("function ".length),i=i.substr(0,i.indexOf("(")),console.log(e)},e.exports={PXLError:r,PXLWarning:o,PXLLog:s,PXLWarningOnce:a,PXLDebug:n}},{}],37:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f=function(t,e){function i(){this.constructor=t}for(var n in e)d.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},d={}.hasOwnProperty;p=t("../math/math"),u=p.Vec2,n=p.Edge2,h=p.Parabola,l=t("../math/math_functions").edge2Bisector,r=function(){function t(t,e){this.start=t,this.end=e}return t}(),s=function(t){function e(t){this.edge=t}return f(e,t),e.prototype.sample=function(t){var e;return e=(this.end.x-this.start.x)*t+this.start.x,this.edge.sample(e)},e}(r),o=function(t){function e(t){this.parabola=t}return f(e,t),e.prototype.sample=function(t){var e,i,n,r,s;return e=(this.end.x-this.start.x)*t+this.start.x,i=(this.end.y-this.start.y)*t+this.start.y,n=this.parabola.sample(e),r=n[0],s=n[1],s!==r?Math.abs(r-i)<Math.abs(s-i)?r:s:r},e}(r),a=function(){function t(){this.components=[],this.right_handed=!0}return t.prototype.voronoiEdgeEdge=function(t,e){var i,r,o,a,u,c,p,f,d,m,g,v,x;return o=l(t,e),x=e,f=t,t.length()<e.length()&&(x=t,f=e),g=this.edgeLineInfluence(o,x,this.right_handed),p=g[0],c=g[1],m=new n(o.start,p),this.components.push(new s(m)),v=f.equation(),i=v[0],r=v[1],a=v[2],d=new h(c,i,r,a),u=this.edgeParabolaInfluence(d,f,this.right_handed),d},t.prototype.edgeParabolaInfluence=function(t,e,i){var n,r,s,o,a,h,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S;for(b=e.equation(),s=b[0],o=b[1],a=b[2],x=o,y=-s,_=s*e.start.x+o*e.start.y+a-o*e.start.x+s*e.start.y,d=o,m=-s,g=s*e.end.x+o*e.end.y+a-o*e.end.x+s*e.end.y,w=t.lineCrossing(x,y,_),P=w[0],E=w[1],L=t.lineCrossing(d,m,g),n=L[0],r=L[1],console.log(P,E),console.log(n,r),M=[u.normalize(P),u.normalize(E)],h=[u.normalize(n),u.normalize(r)],S=u.normalize(e.start),T=[],l=0,p=M.length;l<p;l++)v=M[l],i?S.dot(v)>0&&T.push([v,e.start]):S.dot(v)<=0&&T.push([v,e.start]);for(c=0,f=h.length;c<f;c++)v=h[c],i?S.dot(v)>0&&T.push([v,e.end]):S.dot(v)<=0&&T.push([v,e.end]);return T},t.prototype.edgeLineInfluence=function(t,e,i){var n,r,s,o,a,h,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P;return v=e.equation(),o=v[0],a=v[1],h=v[2],x=t.equation(),n=x[0],r=x[1],s=x[2],d=a,m=-o,g=o*e.start.x+a*e.start.y+h-a*e.start.x+o*e.start.y,c=a,p=-o,f=o*e.end.x+a*e.end.y+h-a*e.end.x+o*e.end.y,P=(d*s-g*n)/(n*m-d*r),L=(-r*P-s)/n,y=new u(L,P),T=(c*s-f*n)/(n*p-c*r),w=(-r*T-s)/n,l=new u(w,T),_=u.normalize(y),b=u.normalize(e.start),_.normalize(),b.normalize(),i?b.dot(_)>0?[l,e.end]:[y,e.start]:b.dot(_)<=0?[y,e.start]:[l,e.end]},t}(),c=function(t,e,i,n,r){var s,o,a,h,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G;if(t.length<3)return[];for(p=[],m=d=0,T=t.length-1;0<=T?d<=T:d>=T;m=0<=T?++d:--d)m+1<t.length?p.push([t[m],t[m+1]]):p.push([t[m],t[0]]);for(o=[],h=new Array,m=g=0,P=p.length-1;0<=P?g<=P:g>=P;m=0<=P?++g:--g)l=p[m],c=p[m+1],m+1===p.length&&(c=p[0]),M=Vec3.sub(new Vec3(l[1].x,l[1].y),new Vec3(l[0].x,l[0].y)),S=Vec3.sub(new Vec3(c[1].x,c[1].y),new Vec3(c[0].x,c[0].y)),a=Vec3.cross(M,S),a.z>0?(0===h.length&&h.push(l),h.push([c[0]]),h.push(c)):(0===h.length&&h.push(l),o.push(h),h=new Array);for(C=[],I=[],G=new Vec3(0,0,1),A=100,v=0,y=o.length;v<y;v++)for(s=o[v],m=x=0,E=s.length-1;0<=E?x<=E:x>=E;m=0<=E?++x:--x)f=s[m],R=[],2===f.length?(M=Vec3.sub(new Vec3(f[0].x,f[0].y),new Vec3(f[1].x,f[1].y)),a=Vec3.cross(M,G),a.normalize(),R.push([new u(f[0].x,f[0].y),new u(f[0].x-a.x,f[0].y-a.y)]),R.push([new u(f[1].x,f[1].y),new u(f[1].x-a.x,f[1].y-a.y)])):(w=m-1,0===m&&(w=s.length-1),_=m+1,m===s.length-1&&(_=0),L=s[w],b=s[_],M=Vec3.sub(new Vec3(L[0].x,L[0].y),new Vec3(L[1].x,L[1].y)),a=Vec3.cross(M,G),a.normalize(),R.push([new u(f[0].x,f[0].y),new u(f[0].x-a.x,f[0].y-a.y)]),S=Vec3.sub(new Vec3(b[0].x,b[0].y),new Vec3(b[1].x,b[1].y)),a=Vec3.cross(S,G),a.normalize(),R.push([new u(f[0].x,f[0].y),new u(f[0].x-a.x,f[0].y-a.y)])),I.push(R);return console.log(I),I},e.exports={MedialGraph:a}},{"../math/math":30,"../math/math_functions":31}],38:[function(t,e,i){var n,r,s,o,a;a=t("../math/math"),r=a.Vec2,s=a.Vec3,o=a.Vec4,n=function(){function t(){this.grad3=[new s(1,1,0),new s((-1),1,0),new s(1,(-1),0),new s((-1),(-1),0),new s(1,0,1),new s((-1),0,1),new s(1,0,(-1)),new s((-1),0,(-1)),new s(0,1,1),new s(0,(-1),1),new s(0,1,(-1)),new s(0,(-1),(-1))],this.p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this.perm=new Array(512),this.gradP=new Array(512),this.setSeed(0),this.F2=.5*(Math.sqrt(3)-1),this.G2=(3-Math.sqrt(3))/6,this.F3=1/3,this.G3=1/6}return t.prototype.setSeed=function(t){var e,i,n,r;for(t>0&&t<1&&(t*=65536),t=Math.floor(t),t<256&&(t|=t<<8),n=[],e=i=0;i<=255;e=++i)r=0,r=1&e?this.p[e]^255&t:this.p[e]^t>>8&255,this.perm[e]=this.perm[e+256]=r,n.push(this.gradP[e]=this.gradP[e+256]=this.grad3[r%12]);return n},t.prototype.simplex2=function(t,e){var i,n,r,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L;return l=c=p=0,f=(t+e)*this.F2,o=Math.floor(t+f),h=Math.floor(e+f),d=(o+h)*this.G2,x=t-o+d,b=e-h+d,a=u=0,x>b?(a=1,u=0):(a=0,u=1),y=x-a+this.G2,w=b-u+this.G2,_=x-1+2*this.G2,L=b-1+2*this.G2,o&=255,h&=255,i=this.gradP[o+this.perm[h]],n=this.gradP[o+a+this.perm[h+u]],r=this.gradP[o+1+this.perm[h+1]],m=.5-x*x-b*b,m<0?l=0:(m*=m,l=m*m*s.dot(i,new s(x,b,0))),g=.5-y*y-w*w,g<0?c=0:(g*=g,c=g*g*s.dot(n,new s(y,w,0))),v=.5-_*_-L*L,v<0?p=0:(v*=v,p=v*v*s.dot(r,new s(_,L,0))),70*(l+c+p)},t.prototype.simplex3=function(t,e,i){var n,r,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b,w,L,T,P,E,M,S,C,R,A,I,G,z,N,X,F,O;return v=x=y=_=0,b=(t+e+i)*this.F3,h=Math.floor(t+b),c=Math.floor(e+b),d=Math.floor(i+b),w=(h+c+d)*this.G3,M=t-h+w,A=e-c+w,N=i-d+w,u=p=m=0,l=f=g=0,M>=A?A>=N?(u=1,p=0,m=0,l=1,f=1,g=0):M>=N?(u=1,p=0,m=0,l=1,f=0,g=1):(u=0,p=0,m=1,l=1,f=0,g=1):A<N?(u=0,p=0,m=1,l=0,f=1,g=1):M<N?(u=0,p=1,m=0,l=0,f=1,g=1):(u=0,p=1,m=0,l=1,f=1,g=0),S=M-u+this.G3,I=A-p+this.G3,X=N-m+this.G3,C=M-l+2*this.G3,G=A-f+2*this.G3,F=N-g+2*this.G3,R=M-1+3*this.G3,z=A-1+3*this.G3,O=N-1+3*this.G3,h&=255,c&=255,d&=255,n=this.gradP[h+this.perm[c+this.perm[d]]],r=this.gradP[h+u+this.perm[c+p+this.perm[d+m]]],o=this.gradP[h+l+this.perm[c+f+this.perm[d+g]]],a=this.gradP[h+1+this.perm[c+1+this.perm[d+1]]],L=.5-M*M-A*A-N*N,L<0?v=0:(L*=L,v=L*L*s.dot(n,new s(M,A,N))),T=.5-S*S-I*I-X*X,T<0?x=0:(T*=T,x=T*T*s.dot(r,new s(S,I,X))),P=.5-C*C-G*G-F*F,P<0?y=0:(P*=P,y=P*P*s.dot(o,new s(C,G,F))),E=.5-R*R-z*z-O*O,E<0?_=0:(E*=E,_=E*E*s.dot(a,new s(R,z,O))),32*(v+x+y+_)},t.prototype.fade=function(t){return t*t*t*(t*(6*t-15)+10)},t.prototype.lerp=function(t,e,i){return(1-i)*t+i*e},t.prototype.perlin2=function(t,e){var i,n,r,o,a,h,u;return i=Math.floor(t),n=Math.floor(e),t-=i,e-=n,i=255&i,n=255&n,r=s.dot(this.gradP[i+this.perm[n]],new s(t,e,0)),o=s.dot(this.gradP[i+this.perm[n+1]],new s(t,e-1,0)),a=s.dot(this.gradP[i+1+this.perm[n]],new s(t-1,e,0)),h=s.dot(this.gradP[i+1+this.perm[n+1]],new s(t-1,e-1,0)),u=this.fade(t),this.lerp(this.lerp(r,a,u),this.lerp(o,h,u),this.fade(e))},t.prototype.perlin3=function(t,e,i){var n,r,o,a,h,u,l,c,p,f,d,m,g,v;return n=Math.floor(t),r=Math.floor(e),o=Math.floor(i),t-=n,e-=r,i-=o,n=255&n,r=255&r,o=255&o,a=s.dot(this.gradP[n+this.perm[r+this.perm[o]]],new s(t,e,i)),h=s.dot(this.gradP[n+this.perm[r+this.perm[o+1]]],new s(t,e,i-1)),u=s.dot(this.gradP[n+this.perm[r+1+this.perm[o]]],new s(t,e-1,i)),l=s.dot(this.gradP[n+this.perm[r+1+this.perm[o+1]]],new s(t,e-1,i-1)),c=s.dot(this.gradP[n+1+this.perm[r+this.perm[o]]],new s(t-1,e,i)),p=s.dot(this.gradP[n+1+this.perm[r+this.perm[o+1]]],new s(t-1,e,i-1)),f=s.dot(this.gradP[n+1+this.perm[r+1+this.perm[o]]],new s(t-1,e-1,i)),d=s.dot(this.gradP[n+1+this.perm[r+1+this.perm[o]]],new s(t-1,e-1,i-1)),m=this.fade(t),g=this.fade(e),v=this.fade(i),this.lerp(this.lerp(this.lerp(a,c,m),this.lerp(h,p,m),v),this.lerp(this.lerp(u,f,m),this.lerp(l,d,m),v),g)},t}(),e.exports={Noise:n}},{"../math/math":30}],39:[function(t,e,i){var n,r,s,o,a;a=t("../util/log"),s=a.PXLWarning,n=a.PXLError,r=a.PXLLog,o=function(){function t(){"undefined"!=typeof PXL&&null!==PXL&&(this.context=PXL.Context)}return t.prototype.when=function(){var t,e,i,n,r,s,o;for(this.results=function(){s=[];for(var t=0,e=arguments.length-1;0<=e?t<=e:t>=e;0<=e?t++:t--)s.push(t);return s}.apply(this,arguments),this.count=arguments.length,t=function(t){return function(){return t.reject(arguments)}}(this),e=i=0,r=arguments.length-1;0<=r?i<=r:i>=r;e=0<=r?++i:--i)n=arguments[e],o=function(t,e){var i,n,r;return n=t,i=e,r=function(t){if(null!=n.context&&PXL.Context.switchContext(n.context),n.results[i]=t,n.count-=1,0===n.count)return n.onResolved.apply(n,n.results)}},n.then(o(this,e),t);return this},t.prototype.then=function(t,e){return this.onResolved=t,this.onRejected=e,null!=this.context&&PXL.Context.switchContext(this.context),this},t.prototype.resolve=function(t){if(null!=this.context&&PXL.Context.switchContext(this.context),null!=this.onResolved)return this.onResolved(t)},t.prototype.reject=function(t){if(null!=this.context&&PXL.Context.switchContext(this.context),null!=this.onRejected)return this.onRejected(t)},t}(),e.exports={Promise:o}},{"../util/log":36}],40:[function(t,e,i){var n;n=function(){function t(){this.root=null}return t.prototype.insertSuccessor=function(t,e){var i,n,r;if(t){if(e.rbPrevious=t,e.rbNext=t.rbNext,t.rbNext&&(t.rbNext.rbPrevious=e),t.rbNext=e,t.rbRight){for(t=t.rbRight;t.rbLeft;)t=t.rbLeft;t.rbLeft=e}else t.rbRight=e;n=t}else this.root?(t=this.getFirst(this.root),e.rbPrevious=null,e.rbNext=t,t.rbPrevious=e,t.rbLeft=e,n=t):(e.rbPrevious=e.rbNext=null,this.root=e,n=null);for(e.rbLeft=e.rbRight=null,e.rbParent=n,e.rbRed=!0,t=e;n&&n.rbRed;)i=n.rbParent,n===i.rbLeft?(r=i.rbRight,r&&r.rbRed?(n.rbRed=r.rbRed=!1,i.rbRed=!0,t=i):(t===n.rbRight&&(this.rotateLeft(n),t=n,n=t.rbParent),n.rbRed=!1,i.rbRed=!0,this.rotateRight(i))):(r=i.rbLeft,r&&r.rbRed?(n.rbRed=r.rbRed=!1,i.rbRed=!0,t=i):(t===n.rbLeft&&(this.rotateRight(n),t=n,n=t.rbParent),n.rbRed=!1,i.rbRed=!0,this.rotateLeft(i),n=t.rbParent));return this.root.rbRed=!1},t.prototype.removeNode=function(t){var e,i,n,r,s,o;if(t.rbNext&&(t.rbNext.rbPrevious=t.rbPrevious),t.rbPrevious&&(t.rbPrevious.rbNext=t.rbNext),t.rbNext=t.rbPrevious=null,r=t.rbParent,i=t.rbLeft,s=t.rbRight,n=i?s?this.getFirst(s):i:s,r?r.rbLeft===t?r.rbLeft=n:r.rbRight=n:this.root=n,i&&s?(e=n.rbRed,n.rbRed=t.rbRed,n.rbLeft=i,i.rbParent=n,n!==s?(r=n.rbParent,n.rbParent=t.rbParent,t=n.rbRight,r.rbLeft=t,n.rbRight=s,s.rbParent=n):(n.rbParent=r,r=n,t=n.rbRight)):(e=t.rbRed,t=n),t&&(t.rbParent=r),!e){if(t&&t.rbRed)return void(t.rbRed=!1);for(;;){if(t===this.root)break;if(t===r.rbLeft){if(o=r.rbRight,o.rbRed&&(o.rbRed=!1,r.rbRed=!0,this.rotateLeft(r),o=r.rbRight),o.rbLeft&&o.rbLeft.rbRed||o.rbRight&&o.rbRight.rbRed){o.rbRight&&o.rbRight.rbRed||(o.rbLeft.rbRed=!1,o.rbRed=!0,this.rotateRight(o),o=r.rbRight),o.rbRed=r.rbRed,r.rbRed=o.rbRight.rbRed=!1,this.rotateLeft(r),t=this.root;break}}else if(o=r.rbLeft,o.rbRed&&(o.rbRed=!1,r.rbRed=!0,this.rotateRight(r),o=r.rbLeft),o.rbLeft&&o.rbLeft.rbRed||o.rbRight&&o.rbRight.rbRed){o.rbLeft&&o.rbLeft.rbRed||(o.rbRight.rbRed=!1,o.rbRed=!0,this.rotateLeft(o),o=r.rbLeft),o.rbRed=r.rbRed,r.rbRed=o.rbLeft.rbRed=!1,this.rotateRight(r),t=this.root;break}if(o.rbRed=!0,t=r,r=r.rbParent,t.rbRed)break}return t?t.rbRed=!1:void 0}},t.prototype.rotateLeft=function(t){var e,i,n;return e=t,n=t.rbRight,i=e.rbParent,i?i.rbLeft===e?i.rbLeft=n:i.rbRight=n:this.root=n,n.rbParent=i,e.rbParent=n,e.rbRight=n.rbLeft,e.rbRight&&(e.rbRight.rbParent=e),n.rbLeft=e},t.prototype.rotateRight=function(t){var e,i,n;return e=t,n=t.rbLeft,i=e.rbParent,i?i.rbLeft===e?i.rbLeft=n:i.rbRight=n:this.root=n,n.rbParent=i,e.rbParent=n,e.rbLeft=n.rbRight,e.rbLeft&&(e.rbLeft.rbParent=e),n.rbRight=e},t.prototype.getFirst=function(t){for(;t.rbLeft;)t=t.rbLeft;return t},t.prototype.getLast=function(t){for(;t.rbRight;)t=t.rbRight;return t},t}(),e.exports={RedBlackTree:n}},{}],41:[function(require,module,exports){var PXLError,PXLLog,PXLWarning,Request,Signal,ref;Signal=require("./signal").Signal,ref=require("./log"),PXLWarning=ref.PXLWarning,PXLError=ref.PXLError,PXLLog=ref.PXLLog,Request=function(){function Request(t){this.url=t,"undefined"!=typeof PXL&&null!==PXL&&(this._context=PXL.Context)}return Request.prototype._parse=function(callback){var data,l;return l=this.url.length-1,""===this.req.responseType||"text"===this.req.responseType?callback(this.req.responseText):"json"===this.req.responseType?(data=eval("("+this.req.responseText+")"),data._coffeegl_request_url=this.url,callback(data)):"blob"===this.req.responseType?PXLError("Blob Type not supported yet",this):""===this.req.responseType?PXLError("responseType was empty",this):callback(this.req.responseText),this},Request.prototype.get=function(t,e,i){var n,r;return null==i&&(i=!1),"undefined"!=typeof XMLHttpRequest&&null!==XMLHttpRequest?(this.req=new XMLHttpRequest,i?(this.req.open("GET",this.url,!1),this.req.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.req.send(null),this._parse(t)):(this.req.onreadystatechange=function(i){return function(){if(4===i.req.readyState)return 200===i.req.status||304===i.req.status?("undefined"!=typeof PXL&&null!==PXL&&PXL.Context.switchContext(i._context),i._parse(t)):("undefined"!=typeof PXL&&null!==PXL&&PXL.Context.switchContext(i._context),e(i.req.responseText))}}(this),this.req.open("GET",this.url),this.req.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.req.send(null))):(r=require("fs"),i?(n=r.readFileSync(this.url),t(n.toString())):r.readFile(this.url,function(e){return function(e,i){return null!=e&&PXLError("nodejs readFile Errored with "+e),t(i.toString())}}(this))),this},Request}(),module.exports={Request:Request}},{"./log":36,"./signal":42,fs:46}],42:[function(t,e,i){var n,r,s;s=t("./util"),r=t("../math/math").Vec2,n=function(){function t(){this.listeners=[],this._pause=!1}return t.prototype.add=function(t,e){return this.listeners.push({f:t,c:e,o:!1,g:PXL.Context}),this},t.prototype.addOnce=function(t,e){return this.listeners.push({f:t,c:e,o:!0,g:PXL.Context}),this},t.prototype.remove=function(t,e){return this.del(t),this},t.prototype.pause=function(t){return null!=t?this._pause=t:this._pause=!this._pause},t.prototype.del=function(t,e){var i,n,r,s,o;for(o=this.listeners,n=0,r=o.length;n<r;n++)if(s=o[n],s.c===e&&s.f===t){i=this.listeners.indexOf(s),this.listeners.splice(i,1);break}return this},t.prototype.dispatch=function(){var t,e,i,n,r,s,o;if(this._pause)return this;for(o=[],s=this.listeners,t=0,n=s.length;t<n;t++)i=s[t],PXL.Context.switchContext(i.g),i.f.apply(i.c,arguments),i.o&&o.push(i);for(e=0,r=o.length;e<r;e++)i=o[e],this.del(i);return this},t}(),e.exports={Signal:n}},{"../math/math":30,"./util":43}],43:[function(t,e,i){var n;n={},n.extend=function(t,e){var i,n,r,s,o;if(Object.keys)for(r=Object.keys(e),i=0,n=r.length;i<n;)s=r[i],Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(e,s)),i++;else{o={}.hasOwnProperty;for(s in e)o.call(e,s)&&(t[s]=e[s])}return t},n.removeElement=function(t,e){var i;return i=e.indexOf(t),i!==-1&&e.splice(i,1),e},n.flatten=function(t){var e,i;e=[];for(i in t)e.push(t[i]);return e},n.type=function(t){var e,i,n,r,s,o;if(void 0===t||null===t)return String(t);for(e=new Object,o="Boolean Number String Function Array Date",i=0,n=o.length;i<n;i++)s=o[i],RegExp.split(" ");return r=Object.prototype.toString.call(t),r in e?e(r):"object"},n.clone=function(t){return JSON.parse(JSON.stringify(t))},n.copy=function(t,e){var i,n,r,s,o;if(t instanceof Float32Array&&e instanceof Float32Array&&t.length===e.size)for(i=n=0,s=t.length-1;0<=s?n<=s:n>=s;i=0<=s?++n:--n)e[i]=t[i];else if(t instanceof Uint16Array&&e instanceof Uint16Array&&t.length===e.size)for(i=r=0,o=t.length-1;0<=o?r<=o:r>=o;i=0<=o?++r:--r)e[i]=t[i];else if("object"!=typeof t&&typof("object"!==e))return e=t},n.QueryString=function(){var t,e,i,n,r,s,o,a;for(s={},"undefined"!=typeof window&&null!==window&&(r=window.location.search.substring(1)),a=r.split("&"),e=i=0,o=a.length-1;0<=o?i<=o:i>=o;e=0<=o?++i:--i)n=a[e].split("="),"undefined"==typeof s[n[0]]?s[n[0]]=n[1]:"string"==typeof s[n[0]]?(t=[s[n[0]],n[1]],s[n[0]]=t):s[n[0]].push(n[1]);return s},e.exports=n},{}],44:[function(t,e,i){var n,r,s,o,a,h,u,l,c,p,f,d;d=t("../math/math"),c=d.Vec2,p=d.Vec3,h=d.Edge2,l=t("./red_black_tree").RedBlackTree,a=function(){function t(t,e){this.lSite=t,this.rSite=e,this.va=this.vb=null}return t}(),r=function(){function t(t){this.site=t,this.halfedges=[],this.closeMe=!1}return t.prototype.init=function(t){return this.site=t,this.halfedges=[],this.closeMe=!1,this},t.prototype.prepareHalfedges=function(){var t,e,i;for(e=this.halfedges,i=e.length;i--;)t=e[i].edge,t.vb&&t.va||e.splice(i,1);return e.sort(function(t,e){return e.angle-t.angle}),e.length},t.prototype.getNeighborIds=function(){var t,e,i;for(i=[],e=this.halfedges.length;e--;)t=this.halfedges[e].edge,null!==t.lSite&&t.lSite.voronoiId!==this.site.voronoiId?i.push(t.lSite.voronoiId):null!==t.rSite&&t.rSite.voronoiId!==this.site.voronoiId&&i.push(t.rSite.voronoiId);return i},t.prototype.getBbox=function(){var t,e,i,n,r,s,o,a,h,u;for(t=this.halfedges,e=t.length,a=1/0,u=1/0,o=-(1/0),h=-(1/0);e--;)return n=t[e].getStartpoint(),r=n.x,s=n.y,r<a&&(a=r),s<u&&(u=s),r>o&&(o=r),s>h&&(h=s),i={x:a,y:u,width:o-a,height:h-u}},t.prototype.pointIntersection=function(t,e){var i,n,r,s,o,a;for(n=this.halfedges,r=n.length;r--;){if(i=n[r],s=i.getStartpoint(),o=i.getEndpoint(),a=(e-s.y)*(o.x-s.x)-(t-s.x)*(o.y-s.y),!a)return 0;if(a>0)return-1}return 1},t}(),o=function(){function t(t){this.site=t}return t}(),u=function(){function t(t,e,i){var n,r;this.edge=t,this.site=e,i?this.angle=Math.atan2(i.y-e.y,i.x-e.x):(n=edge.va,r=edge.vb,edge.lSite===e?this.angle=Math.atan2(r.x-n.x,n.y-r.y):Math.atan2(n.x-r.x,r.y-n.y))}return t.prototype.getStartpoint=function(){return this.edge.lSite===this.site?this.edge.va:this.edge.vb},t.prototype.getEndpoint=function(){return this.edge.lSite===this.site?this.edge.vb:this.edge.va},t}(),n=function(){function t(){}return t}(),s=function(){function t(){this.arc=null,this.rbLeft=null,this.rbNext=null,this.rbParent=null,this.rbPrevious=null,this.rbRed=!1,this.rbRight=null,this.site=null,this.x=this.y=this.ycenter=0}return t}(),f=function(){function t(){this.vertices=null,this.edges=null,this.cells=null,this.toRecycle=null,this.beachsectionJunkyard=[],this.circleEventJunkyard=[],this.vertexJunkyard=[],this.edgeJunkyard=[],this.cellJunkyard=[]}return t.abs=Math.abs,t.epsilon=1e-9,t.invepsilon=1/t.epsilon,t.prototype.equalWithEpsilon=function(t,e){return Math.abs(t-e)<1e-9},t.prototype.greaterThanWithEpsilon=function(t,e){return t-e>1e-9},t.prototype.greaterThanOrEqualWithEpsilon=function(t,e){return e-t<1e-9},t.prototype.lessThanWithEpsilon=function(t,e){return e-t>1e-9},t.prototype.lessThanOrEqualWithEpsilon=function(t,e){return t-e<1e-9},t.prototype.createHalfedge=function(t,e,i){return new u(t,e,i)},t.prototype.reset=function(){var t;if(this.beachline||(this.beachline=new l),this.beachline.root)for(t=this.beachline.getFirst(this.beachline.root);t;)this.beachsectionJunkyard.push(t),t=t.rbNext;return this.beachline.root=null,this.circleEvents||(this.circleEvents=new l),this.circleEvents.root=this.firstCircleEvent=null,this.vertices=[],this.edges=[],this.cells=[],this.segments=[]},t.prototype.createVertex=function(t,e){var i;return i=this.vertexJunkyard.pop(),i?(i.x=t,i.y=e):i=new c(t,e),this.vertices.push(i),i},t.prototype.createEdge=function(t,e,i,n){var r;return r=this.edgeJunkyard.pop(),r?(r.lSite=t,r.rSite=e,r.va=r.vb=null):r=new a(t,e),this.edges.push(r),i&&this.setEdgeStartpoint(r,t,e,i),n&&this.setEdgeEndpoint(r,t,e,n),this.cells[t.voronoiId].halfedges.push(this.createHalfedge(r,t,e)),this.cells[e.voronoiId].halfedges.push(this.createHalfedge(r,e,t)),r},t.prototype.createBorderEdge=function(t,e,i){var n;return n=this.edgeJunkyard.pop(),n?(n.lSite=t,n.rSite=null):n=new a(t,null),n.va=e,n.vb=i,this.edges.push(n),n},t.prototype.setEdgeStartpoint=function(t,e,i,n){return t.va||t.vb?t.lSite===i?t.vb=n:t.va=n:(t.va=n,t.lSite=e,t.rSite=i)},t.prototype.setEdgeEndpoint=function(t,e,i,n){return this.setEdgeStartpoint(t,i,e,n)},t.prototype.createCell=function(t){var e;return e=this.cellJunkyard.pop(),e?e.init(t):new r(t)},t.prototype.createBeachsection=function(t){var e;return e=this.beachsectionJunkyard.pop(),e||(e=new n),e.site=t,e},t.prototype.leftBreakPoint=function(t,e){var i,n,r,s,o,a,h,u,l,c,p;return p=t.site,l=t.site.x,c=t.site.y,(h=c-e)?(s=t.rbPrevious)?(p=s.site,o=p.x,a=p.y,(u=a-e)?(r=o-l,i=1/h-1/u,n=r/u,i?(-n+Math.sqrt(n*n-2*i*(r*r/(-2*u)-a+u/2+c-h/2)))/i+l:(l+o)/2):o):-(1/0):l},t.prototype.rightBreakPoint=function(t,e){var i,n;return(i=t.rbNext)?this.leftBreakPoint(i,e):(n=t.site,n.y===e?n.x:1/0)},t.prototype.detachBeachsection=function(t){return this.detachCircleEvent(t),this.beachline.removeNode(t),this.beachsectionJunkyard.push(t)},t.prototype.removeBeachsection=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,f,d;for(i=t.circleEvent,f=i.x,d=i.ycenter,p=this.createVertex(f,d),u=t.rbPrevious,h=t.rbNext,n=[t],e=Math.abs,this.detachBeachsection(t),o=u;o.circleEvent&&e(f-o.circleEvent.x)<1e-9&&e(d-o.circleEvent.ycenter)<1e-9;)u=o.rbPrevious,n.unshift(o),this.detachBeachsection(o),o=u;for(n.unshift(o),this.detachCircleEvent(o),l=h;l.circleEvent&&e(f-l.circleEvent.x)<1e-9&&e(d-l.circleEvent.ycenter)<1e-9;)h=l.rbNext,n.push(l),this.detachBeachsection(l),l=h;for(n.push(l),this.detachCircleEvent(l),a=n.length,s=r=1,c=a-1;1<=c?r<=c:r>=c;s=1<=c?++r:--r)l=n[s],o=n[s-1],this.setEdgeStartpoint(l.edge,o.site,l.site,p);return o=n[0],l=n[a-1],l.edge=this.createEdge(o.site,l.site,void 0,p),this.attachCircleEvent(o),this.attachCircleEvent(l)},t.prototype.addBeachsection=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_;for(_=t.x,o=t.y,g=this.beachline.root;g;)if(h=this.leftBreakPoint(g,o)-_,h>1e-9)g=g.rbLeft;else{if(u=_-this.rightBreakPoint(g,o),!(u>1e-9)){h>-1e-9?(f=g.rbPrevious,v=g):u>-1e-9?(f=g,v=g.rbNext):f=v=g;break}if(!g.rbRight){f=g;break}g=g.rbRight}if(m=this.createBeachsection(t),this.beachline.insertSuccessor(f,m),f||v)return f===v?(this.detachCircleEvent(f),v=this.createBeachsection(f.site),this.beachline.insertSuccessor(m,v),m.edge=v.edge=this.createEdge(f.site,m.site),this.attachCircleEvent(f),void this.attachCircleEvent(v)):f&&!v?void(m.edge=this.createEdge(f.site,m.site)):void(f!==v&&(this.detachCircleEvent(f),this.detachCircleEvent(v),d=f.site,e=d.x,i=d.y,a=t.x-e,l=t.y-i,x=v.site,n=x.x-e,r=x.y-i,s=2*(a*r-l*n),c=a*a+l*l,p=n*n+r*r,y=this.createVertex((r*c-l*p)/s+e,(a*p-n*c)/s+i),this.setEdgeStartpoint(v.edge,d,x,y),m.edge=this.createEdge(d,t,void 0,y),v.edge=this.createEdge(t,x,void 0,y),this.attachCircleEvent(f),this.attachCircleEvent(v)))},t.prototype.attachCircleEvent=function(t){var e,i,n,r,o,a,h,u,l,c,p,f,d,m,g,v,x,y,_,b;if(f=t.rbPrevious,v=t.rbNext,f&&v&&(d=f.site,n=t.site,x=v.site,d!==x&&(u=n.x,l=n.y,e=d.x-u,i=d.y-l,o=x.x-u,a=x.y-l,h=2*(e*a-i*o),!(h>=-2e-12)))){for(c=e*e+i*i,p=o*o+a*a,y=(a*c-i*p)/h,_=(e*p-o*c)/h,b=_+l,r=this.circleEventJunkyard.pop(),r||(r=new s),r.arc=t,r.site=n,r.x=y+u,r.y=b+Math.sqrt(y*y+_*_),r.ycenter=b,t.circleEvent=r,g=null,m=this.circleEvents.root;m;)if(r.y<m.y||r.y===m.y&&r.x<=m.x){if(!m.rbLeft){g=m.rbPrevious;break}m=m.rbLeft}else{if(!m.rbRight){g=m;break}m=m.rbRight}return this.circleEvents.insertSuccessor(g,r),g?void 0:this.firstCircleEvent=r}},t.prototype.detachCircleEvent=function(t){var e;if(e=t.circleEvent)return e.rbPrevious||(this.firstCircleEvent=e.rbNext),this.circleEvents.removeNode(e),this.circleEventJunkyard.push(e),t.circleEvent=null},t.prototype.connectEdge=function(t,e){var i,n,r,s,o,a,h,u,l,c,p,f,d,m,g,v;if(f=t.vb)return!0;if(p=t.va,d=e.xl,m=e.xr,v=e.yt,g=e.yb,o=t.lSite,u=t.rSite,a=o.x,h=o.y,l=u.x,c=u.y,r=(a+l)/2,s=(h+c)/2,this.cells[o.voronoiId].closeMe=!0,this.cells[u.voronoiId].closeMe=!0,c!==h&&(n=(a-l)/(c-h),i=s-n*r),void 0===n){if(r<d||r>=m)return!1;if(a>l){if(!p||p.y<v)p=this.createVertex(r,v);else if(p.y>=g)return!1;f=this.createVertex(r,g)}else{if(!p||p.y>g)p=this.createVertex(r,g);else if(p.y<v)return!1;f=this.createVertex(r,v)}}else if(n<-1||n>1)if(a>l){if(!p||p.y<v)p=this.createVertex((v-i)/n,v);else if(p.y>=g)return!1;f=this.createVertex((g-i)/n,g)}else{if(!p||p.y>g)p=this.createVertex((g-i)/n,g);else if(p.y<v)return!1;f=this.createVertex((v-i)/n,v)}else if(h<c){if(!p||p.x<d)p=this.createVertex(d,n*d+i);else if(p.x>=m)return!1;f=this.createVertex(m,n*m+i)}else{if(!p||p.x>m)p=this.createVertex(m,n*m+i);else if(p.x<d)return!1;f=this.createVertex(d,n*d+i)}return t.va=p,t.vb=f,!0},t.prototype.clipEdge=function(t,e){var i,n,r,s,o,a,h,u;if(i=t.va.x,n=t.va.y,r=t.vb.x,s=t.vb.y,h=0,u=1,r-=i,s-=n,o=i-e.xl,0===r&&o<0)return!1;if(a=-o/r,r<0){if(a<h)return!1;a<u&&(u=a)}else if(r>0){if(a>u)return!1;a>h&&(h=a)}if(o=e.xr-i,0===r&&o<0)return!1;if(a=o/r,r<0){if(a>u)return!1;a>h&&(h=a)}else if(r>0){if(a<h)return!1;a<u&&(u=a)}if(o=n-e.yt,0===s&&o<0)return!1;if(a=-o/s,s<0){if(a<h)return!1;a<u&&(u=a)}else if(s>0){if(a>u)return!1;a>h&&(h=a)}if(o=e.yb-n,0===s&&o<0)return!1;if(a=o/s,s<0){if(a>u)return!1;a>h&&(h=a)}else if(s>0){if(a<h)return!1;a<u&&(u=a)}return h>0&&(t.va=this.createVertex(i+h*r,n+h*s)),u<1&&(t.vb=this.createVertex(i+u*r,n+u*s)),(h>0||u<1)&&(this.cells[t.lSite.voronoiId].closeMe=!0,this.cells[t.rSite.voronoiId].closeMe=!0),!0},t.prototype.clipEdges=function(t){var e,i,n,r,s;for(n=this.edges,r=n.length,e=Math.abs,s=[];r--;)i=n[r],!this.connectEdge(i,t)||!this.clipEdge(i,t)||e(i.va.x-i.vb.x)<1e-9&&e(i.va.y-i.vb.y)<1e-9?(i.va=i.vb=null,s.push(n.splice(r,1))):s.push(void 0);return s},t.prototype.closeCells=function(t){var e,i,n,r,s,o,a,h,u,l,c,p,f,d,m,g,v,x,y;for(g=t.xl,v=t.xr,y=t.yt,x=t.yb,n=this.cells,o=n.length,e=Math.abs,l=[];o--;)if(i=n[o],i.prepareHalfedges()&&i.closeMe){for(s=i.halfedges,u=s.length,a=0;a<u;){if(f=s[a].getEndpoint(),m=s[(a+1)%u].getStartpoint(),e(f.x-m.x)>=1e-9||e(f.y-m.y)>=1e-9)switch(!0){case this.equalWithEpsilon(f.x,g)&&this.lessThanWithEpsilon(f.y,x):if(h=this.equalWithEpsilon(m.x,g),p=x,h&&(p=m.y),d=this.createVertex(g,p),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;f=d;break;case this.equalWithEpsilon(f.y,x)&&this.lessThanWithEpsilon(f.x,v):if(h=this.equalWithEpsilon(m.y,x),c=v,h&&(c=m.x),d=this.createVertex(c,x),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;f=d;break;case this.equalWithEpsilon(f.x,v)&&this.greaterThanWithEpsilon(f.y,y):if(h=this.equalWithEpsilon(m.x,v),p=y,h&&(p=m.y),d=this.createVertex(v,p),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;f=d;break;case this.equalWithEpsilon(f.y,y)&&this.greaterThanWithEpsilon(f.x,g):if(h=this.equalWithEpsilon(m.y,y),c=g,h&&(c=m.x),d=this.createVertex(c,y),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;if(f=d,h=this.equalWithEpsilon(m.x,g),p=x,h&&(p=m.y),d=this.createVertex(g,p),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;if(f=d,h=this.equalWithEpsilon(m.y,x),c=v,h&&(c=m.x),d=this.createVertex(c,x),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;if(f=d,h=this.equalWithEpsilon(m.x,v),p=y,h&&(p=m.y),d=this.createVertex(v,p),r=this.createBorderEdge(i.site,f,d),a++,s.splice(a,0,this.createHalfedge(r,i.site,null)),u++,h)break;break;default:throw"Voronoi.closeCells() > this makes no sense!";
}a++}l.push(i.closeMe=!1)}return l},t.prototype.dumpBeachline=function(t){var e,i;if(console.log("Voronoi.dumpBeachline(%f) > Beachsections, from left to right:",t),this.beachline){for(e=this.beachline.getFirst(this.beachline.root),i=[];e;)console.log("  site %d: xl: %f, xr: %f",e.site.voronoiId,this.leftBreakPoint(e,t),this.rightBreakPoint(e,t)),i.push(e=e.rbNext);return i}return console.log("  None")},t.prototype.isSegment=function(t){var e,i,n,r;for(r=this.segments,i=0,n=r.length;i<n;i++)if(e=r[i],t===e[0]||t===e[1])return!0;return!1},t.prototype.quantizeSites=function(t){var e,i,n,r;for(e=this.epsilon,i=t.length,n=[];i--;)r=t[i],r.x=Math.floor(r.x/e)*e,n.push(r.y=Math.floor(r.y/e)*e);return n},t.prototype.recycle=function(t){if(t){if(t instanceof o)return this.toRecycle=t;throw"Voronoi.recycleDiagram() > Need a Diagram object."}},t.prototype.compute=function(t,e,i){var n,r,s,a,h,u,l,c,p,f;for(l=new Date,this.reset(),this.segments=i,this.toRecycle&&(this.vertexJunkyard=this.vertexJunkyard.concat(this.toRecycle.vertices),this.edgeJunkyard=this.edgeJunkyard.concat(this.toRecycle.edges),this.cellJunkyard=this.cellJunkyard.concat(this.toRecycle.cells),this.toRecycle=null),h=t.slice(0),h.sort(function(t,e){var i;return i=e.y-t.y,i?i:e.x-t.x}),a=h.pop(),u=0,n=this.cells;;)if(r=this.firstCircleEvent,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===p&&a.y===f||(n[u]=this.createCell(a),a.voronoiId=u++,this.addBeachsection(a),f=a.y,p=a.x),a=h.pop();else{if(!r)break;this.removeBeachsection(r.arc)}return this.clipEdges(e),this.closeCells(e),c=new Date,s=new o,s.cells=this.cells,s.edges=this.edges,s.vertices=this.vertices,s.execTime=c.getTime()-l.getTime(),this.reset(),s},t}(),e.exports={Voronoi:f}},{"../math/math":30,"./red_black_tree":40}],45:[function(t,e,i){var n,r,s,o,a=function(t,e){return function(){return t.apply(e,arguments)}};o=t("./log"),r=o.PXLWarning,n=o.PXLError,s=function(){function t(t,e,i,n,s){this.errorCallback=a(this.errorCallback,this);var o,h;return h={},h.video=!0,null==e&&null==i||(h.mandatory={},null!=e&&(h.mandatory.width=e),null!=i&&(h.mandatory.height=i)),this.hasGetUserMedia?(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,null==n&&(n=!1),h.audio=n,this.dom_object=document.getElementById(t),o=this.errorCallback,null!=s&&(o=s),void navigator.getUserMedia(h,function(t){return function(e){return t.dom_object.src=window.URL.createObjectURL(e)}}(this),o)):(r("No support in this browser for WebRTC."),void(null!=s&&s()))}return t.prototype.hasGetUserMedia=function(){return null!=navigator.getUserMedia||null!=navigator.webkitGetUserMedia||null!=navigator.mozGetUserMedia||null!=navigator.msGetUserMedia},t.prototype.errorCallback=function(t){return r("Cannot create WebRTC video!"),null!=t&&t(),this},t}(),e.exports={WebCamRTC:s}},{"./log":36}],46:[function(t,e,i){},{}]},{},[32]);